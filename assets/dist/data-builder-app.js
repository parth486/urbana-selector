var st=Object.defineProperty;var tt=(s,a,t)=>a in s?st(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var Cs=(s,a,t)=>tt(s,typeof a!="symbol"?a+"":a,t);import{t as bs,k as ue,m as cs,n as at,j as e,o as rt,p as Ms,q as nt,u as Ss,$ as it,v as ot,r as G,c as hs,w as _s,x as Xe,y as ct,f as Bs,z as lt,A as dt,R as oe,b as U,I as o,d as ae,e as re,i as be,s as Qe,l as Ze,B as as,g as Te,C as Ye,h as ut}from"./client.js";import{u as mt,p as ht,i as qs,a as ys,b as Ns,d as fe,c as pt,T as xt}from"./productData.js";import{a as gt,d as ft,t as Ae,c as _e,H as jt}from"./middleware.js";import{u as Ge,c as se,m as Le,a as Ue,b as Me,d as Be,e as qe}from"./index.js";import{d as We,a as Je,b as He,m as ve}from"./chunk-XHRYXXZA.js";import{t as Ce,a as me,c as xe}from"./chunk-ML27DD5T.js";import{p as Ws,c as ls}from"./chunk-XVMALT6H.js";import"./accelerated-values.js";var wt=bs({slots:{base:["flex","relative","justify-center","items-center","box-border","overflow-hidden","align-middle","text-white","z-0",...at],img:["flex","object-cover","w-full","h-full","transition-opacity","!duration-500","opacity-0","data-[loaded=true]:opacity-100"],fallback:[...cs,"flex","items-center","justify-center"],name:[...cs,"font-normal","text-center","text-inherit"],icon:[...cs,"flex","items-center","justify-center","text-inherit","w-full","h-full"]},variants:{size:{sm:{base:"w-8 h-8 text-tiny"},md:{base:"w-10 h-10 text-tiny"},lg:{base:"w-14 h-14 text-small"}},color:{default:{base:ue.solid.default},primary:{base:ue.solid.primary},secondary:{base:ue.solid.secondary},success:{base:ue.solid.success},warning:{base:ue.solid.warning},danger:{base:ue.solid.danger}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},isBordered:{true:{base:"ring-2 ring-offset-2 ring-offset-background dark:ring-offset-background-dark"}},isDisabled:{true:{base:"opacity-disabled"}},isInGroup:{true:{base:["-ms-2 data-[hover=true]:-translate-x-3 rtl:data-[hover=true]:translate-x-3 transition-transform","data-[focus-visible=true]:-translate-x-3 rtl:data-[focus-visible=true]:translate-x-3"]}},isInGridGroup:{true:{base:"m-0 data-[hover=true]:translate-x-0"}},disableAnimation:{true:{base:"transition-none",img:"transition-none"},false:{}}},defaultVariants:{size:"md",color:"default",radius:"full"},compoundVariants:[{color:"default",isBordered:!0,class:{base:"ring-default"}},{color:"primary",isBordered:!0,class:{base:"ring-primary"}},{color:"secondary",isBordered:!0,class:{base:"ring-secondary"}},{color:"success",isBordered:!0,class:{base:"ring-success"}},{color:"warning",isBordered:!0,class:{base:"ring-warning"}},{color:"danger",isBordered:!0,class:{base:"ring-danger"}}]});bs({slots:{base:"flex items-center justify-center h-auto w-max",count:"hover:-translate-x-0"},variants:{isGrid:{true:"inline-grid grid-cols-4 gap-3"}}});var ks=bs({slots:{base:["relative","inline-flex","shrink-0"],badge:["flex","z-10","flex-wrap","absolute","box-border","rounded-full","whitespace-nowrap","place-content-center","origin-center","items-center","text-inherit","select-none","font-regular","scale-100","opacity-100","subpixel-antialiased","data-[invisible=true]:scale-0","data-[invisible=true]:opacity-0"]},variants:{variant:{solid:{},flat:{},faded:{badge:"border-medium"},shadow:{}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{badge:"px-1 text-tiny"},md:{badge:"px-1 text-small"},lg:{badge:"px-1 text-small"}},placement:{"top-right":{},"top-left":{},"bottom-right":{},"bottom-left":{}},shape:{circle:{},rectangle:{}},isInvisible:{true:{}},isOneChar:{true:{badge:"px-0"}},isDot:{true:{}},disableAnimation:{true:{badge:"transition-none"},false:{badge:"transition-transform-opacity !ease-soft-spring !duration-300"}},showOutline:{true:{badge:"border-2 border-background"},false:{badge:"border-transparent border-0"}}},defaultVariants:{variant:"solid",color:"default",size:"md",shape:"rectangle",placement:"top-right",showOutline:!0,isInvisible:!1},compoundVariants:[{variant:"solid",color:"default",class:{badge:ue.solid.default}},{variant:"solid",color:"primary",class:{badge:ue.solid.primary}},{variant:"solid",color:"secondary",class:{badge:ue.solid.secondary}},{variant:"solid",color:"success",class:{badge:ue.solid.success}},{variant:"solid",color:"warning",class:{badge:ue.solid.warning}},{variant:"solid",color:"danger",class:{badge:ue.solid.danger}},{variant:"shadow",color:"default",class:{badge:ue.shadow.default}},{variant:"shadow",color:"primary",class:{badge:ue.shadow.primary}},{variant:"shadow",color:"secondary",class:{badge:ue.shadow.secondary}},{variant:"shadow",color:"success",class:{badge:ue.shadow.success}},{variant:"shadow",color:"warning",class:{badge:ue.shadow.warning}},{variant:"shadow",color:"danger",class:{badge:ue.shadow.danger}},{variant:"flat",color:"default",class:{badge:ue.flat.default}},{variant:"flat",color:"primary",class:{badge:ue.flat.primary}},{variant:"flat",color:"secondary",class:{badge:ue.flat.secondary}},{variant:"flat",color:"success",class:{badge:ue.flat.success}},{variant:"flat",color:"warning",class:{badge:ue.flat.warning}},{variant:"flat",color:"danger",class:{badge:ue.flat.danger}},{variant:"faded",color:"default",class:{badge:ue.faded.default}},{variant:"faded",color:"primary",class:{badge:ue.faded.primary}},{variant:"faded",color:"secondary",class:{badge:ue.faded.secondary}},{variant:"faded",color:"success",class:{badge:ue.faded.success}},{variant:"faded",color:"warning",class:{badge:ue.faded.warning}},{variant:"faded",color:"danger",class:{badge:ue.faded.danger}},{isOneChar:!0,size:"sm",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{isOneChar:!0,size:"md",class:{badge:"w-5 h-5 min-w-5 min-h-5"}},{isOneChar:!0,size:"lg",class:{badge:"w-6 h-6 min-w-6 min-h-6"}},{isDot:!0,size:"sm",class:{badge:"w-3 h-3 min-w-3 min-h-3"}},{isDot:!0,size:"md",class:{badge:"w-3.5 h-3.5 min-w-3.5 min-h-3.5"}},{isDot:!0,size:"lg",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{placement:"top-right",shape:"rectangle",class:{badge:"top-[5%] right-[5%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"rectangle",class:{badge:"top-[5%] left-[5%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"rectangle",class:{badge:"bottom-[5%] right-[5%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"rectangle",class:{badge:"bottom-[5%] left-[5%] -translate-x-1/2 translate-y-1/2"}},{placement:"top-right",shape:"circle",class:{badge:"top-[10%] right-[10%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"circle",class:{badge:"top-[10%] left-[10%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"circle",class:{badge:"bottom-[10%] right-[10%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"circle",class:{badge:"bottom-[10%] left-[10%] -translate-x-1/2 translate-y-1/2"}}]}),vt=()=>e.jsxs("svg",{"aria-hidden":"true",fill:"none",height:"80%",role:"presentation",viewBox:"0 0 24 24",width:"80%",children:[e.jsx("path",{d:"M12 2C9.38 2 7.25 4.13 7.25 6.75C7.25 9.32 9.26 11.4 11.88 11.49C11.96 11.48 12.04 11.48 12.1 11.49C12.12 11.49 12.13 11.49 12.15 11.49C12.16 11.49 12.16 11.49 12.17 11.49C14.73 11.4 16.74 9.32 16.75 6.75C16.75 4.13 14.62 2 12 2Z",fill:"currentColor"}),e.jsx("path",{d:"M17.0809 14.1489C14.2909 12.2889 9.74094 12.2889 6.93094 14.1489C5.66094 14.9989 4.96094 16.1489 4.96094 17.3789C4.96094 18.6089 5.66094 19.7489 6.92094 20.5889C8.32094 21.5289 10.1609 21.9989 12.0009 21.9989C13.8409 21.9989 15.6809 21.5289 17.0809 20.5889C18.3409 19.7389 19.0409 18.5989 19.0409 17.3589C19.0309 16.1289 18.3409 14.9889 17.0809 14.1489Z",fill:"currentColor"})]}),[da,bt]=rt({name:"AvatarGroupContext",strict:!1});function yt(s={}){var a,t,r,n,i,c,h,p;const u=Ms(),d=bt(),m=!!d,{as:x,ref:j,src:y,name:R,icon:q,classNames:_,fallback:H,alt:L=R||"avatar",imgRef:Q,color:z=(a=d==null?void 0:d.color)!=null?a:"default",radius:O=(t=d==null?void 0:d.radius)!=null?t:"full",size:b=(r=d==null?void 0:d.size)!=null?r:"md",isBordered:k=(n=d==null?void 0:d.isBordered)!=null?n:!1,isDisabled:v=(i=d==null?void 0:d.isDisabled)!=null?i:!1,isFocusable:f=!1,getInitials:T=nt,ignoreFallback:V=!1,showFallback:E=!1,ImgComponent:l="img",imgProps:C,className:I,onError:B,disableAnimation:Z,...ne}=s,ce=x||"span",N=Ss(j),w=Ss(Q),{isFocusVisible:S,isFocused:A,focusProps:M}=it(),{isHovered:Y,hoverProps:ee}=ot({isDisabled:v}),J=(c=Z??(u==null?void 0:u.disableAnimation))!=null?c:!1,te=(p=typeof l=="object"&&((h=l==null?void 0:l.displayName)==null?void 0:h.includes("HeroUI")))!=null?p:!1,ie=mt({src:y,onError:B,ignoreFallback:V,shouldBypassImageLoad:x!==void 0||l!=="img"&&!te})==="loaded",he=!te,ge=(!y||!ie)&&E,g=G.useMemo(()=>{var K;return wt({color:z,radius:O,size:b,isBordered:k,isDisabled:v,isInGroup:m,disableAnimation:J,isInGridGroup:(K=d==null?void 0:d.isGrid)!=null?K:!1})},[z,O,b,k,v,J,m,d==null?void 0:d.isGrid]),P=hs(_==null?void 0:_.base,I),D=G.useMemo(()=>f||x==="button",[f,x]),X=G.useCallback((K={})=>({ref:N,tabIndex:D?0:-1,"data-hover":Xe(Y),"data-focus":Xe(A),"data-focus-visible":Xe(S),className:g.base({class:hs(P,K==null?void 0:K.className)}),..._s(ne,ee,D?M:{})}),[D,g,P,M,ne]),W=G.useCallback((K={})=>({ref:w,src:y,"data-loaded":Xe(ie),className:g.img({class:_==null?void 0:_.img}),..._s(C,K,ct({disableAnimation:J},{enabled:he}))}),[g,ie,C,J,y,w,he]);return{Component:ce,ImgComponent:l,src:y,alt:L,icon:q,name:R,imgRef:w,slots:g,classNames:_,fallback:H,isImgLoaded:ie,showFallback:ge,ignoreFallback:V,getInitials:T,getAvatarProps:X,getImageProps:W}}var Js=Bs((s,a)=>{const{Component:t,ImgComponent:r,src:n,icon:i=e.jsx(vt,{}),alt:c,classNames:h,slots:p,name:u,showFallback:d,fallback:m,getInitials:x,getAvatarProps:j,getImageProps:y}=yt({...s,ref:a}),R=G.useMemo(()=>!d&&n?null:m?e.jsx("div",{"aria-label":c,className:p.fallback({class:h==null?void 0:h.fallback}),role:"img",children:m}):u?e.jsx("span",{"aria-label":c,className:p.name({class:h==null?void 0:h.name}),role:"img",children:x(u)}):e.jsx("span",{"aria-label":c,className:p.icon({class:h==null?void 0:h.icon}),role:"img",children:i}),[d,n,m,u,h]);return e.jsxs(t,{...j(),children:[n&&e.jsx(r,{...y(),alt:c}),R]})});Js.displayName="HeroUI.Avatar";var De=Js;function Nt(s){var a,t;const r=Ms(),n=(t=(a=s==null?void 0:s.disableAnimation)!=null?a:r==null?void 0:r.disableAnimation)!=null?t:!1,[i,c]=lt(s,ks.variantKeys),{as:h,children:p,className:u,content:d,classNames:m,...x}=i,j=h||"span",y=G.useMemo(()=>{var L;return((L=String(d))==null?void 0:L.length)===1||(s==null?void 0:s.isOneChar)},[d,s==null?void 0:s.isOneChar]),R=G.useMemo(()=>{var L;return((L=String(d))==null?void 0:L.length)===0},[d]),q=hs(m==null?void 0:m.badge,u),_=G.useMemo(()=>ks({...c,showOutline:s!=null&&s.disableOutline?!(s!=null&&s.disableOutline):s==null?void 0:s.showOutline,isOneChar:y,isDot:R}),[dt(c),y,R]),H=()=>({className:_.badge({class:q}),"data-invisible":s.isInvisible,...x});return{Component:j,children:p,content:d,slots:_,classNames:m,disableAnimation:n,isInvisible:s==null?void 0:s.isInvisible,getBadgeProps:H}}var Hs=Bs((s,a)=>{const{Component:t,children:r,content:n,slots:i,classNames:c,getBadgeProps:h}=Nt({...s});return e.jsxs("div",{className:i.base({class:c==null?void 0:c.base}),children:[r,e.jsx(t,{ref:a,...h(),children:n})]})});Hs.displayName="HeroUI.Badge";var Ds=Hs,Vs=Symbol.for("immer-nothing"),Rs=Symbol.for("immer-draftable"),ye=Symbol.for("immer-state");function Pe(s,...a){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var Ie=Object.getPrototypeOf;function Fe(s){return!!s&&!!s[ye]}function Re(s){var a;return s?Xs(s)||Array.isArray(s)||!!s[Rs]||!!((a=s.constructor)!=null&&a[Rs])||Ve(s)||ns(s):!1}var Pt=Object.prototype.constructor.toString(),Es=new WeakMap;function Xs(s){if(!s||typeof s!="object")return!1;const a=Object.getPrototypeOf(s);if(a===null||a===Object.prototype)return!0;const t=Object.hasOwnProperty.call(a,"constructor")&&a.constructor;if(t===Object)return!0;if(typeof t!="function")return!1;let r=Es.get(t);return r===void 0&&(r=Function.toString.call(t),Es.set(t,r)),r===Pt}function es(s,a,t=!0){rs(s)===0?(t?Reflect.ownKeys(s):Object.keys(s)).forEach(n=>{a(n,s[n],s)}):s.forEach((r,n)=>a(n,r,s))}function rs(s){const a=s[ye];return a?a.type_:Array.isArray(s)?1:Ve(s)?2:ns(s)?3:0}function ps(s,a){return rs(s)===2?s.has(a):Object.prototype.hasOwnProperty.call(s,a)}function Ys(s,a,t){const r=rs(s);r===2?s.set(a,t):r===3?s.add(t):s[a]=t}function Ot(s,a){return s===a?s!==0||1/s===1/a:s!==s&&a!==a}function Ve(s){return s instanceof Map}function ns(s){return s instanceof Set}function ke(s){return s.copy_||s.base_}function xs(s,a){if(Ve(s))return new Map(s);if(ns(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const t=Xs(s);if(a===!0||a==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(s);delete r[ye];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){const c=n[i],h=r[c];h.writable===!1&&(h.writable=!0,h.configurable=!0),(h.get||h.set)&&(r[c]={configurable:!0,writable:!0,enumerable:h.enumerable,value:s[c]})}return Object.create(Ie(s),r)}else{const r=Ie(s);if(r!==null&&t)return{...s};const n=Object.create(r);return Object.assign(n,s)}}function Ps(s,a=!1){return is(s)||Fe(s)||!Re(s)||(rs(s)>1&&Object.defineProperties(s,{set:Ke,add:Ke,clear:Ke,delete:Ke}),Object.freeze(s),a&&Object.values(s).forEach(t=>Ps(t,!0))),s}function Ct(){Pe(2)}var Ke={value:Ct};function is(s){return s===null||typeof s!="object"?!0:Object.isFrozen(s)}var St={};function Ee(s){const a=St[s];return a||Pe(0,s),a}var ze;function Ks(){return ze}function _t(s,a){return{drafts_:[],parent_:s,immer_:a,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Fs(s,a){a&&(Ee("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=a)}function gs(s){fs(s),s.drafts_.forEach(kt),s.drafts_=null}function fs(s){s===ze&&(ze=s.parent_)}function Ts(s){return ze=_t(ze,s)}function kt(s){const a=s[ye];a.type_===0||a.type_===1?a.revoke_():a.revoked_=!0}function As(s,a){a.unfinalizedDrafts_=a.drafts_.length;const t=a.drafts_[0];return s!==void 0&&s!==t?(t[ye].modified_&&(gs(a),Pe(4)),Re(s)&&(s=ss(a,s),a.parent_||ts(a,s)),a.patches_&&Ee("Patches").generateReplacementPatches_(t[ye].base_,s,a.patches_,a.inversePatches_)):s=ss(a,t,[]),gs(a),a.patches_&&a.patchListener_(a.patches_,a.inversePatches_),s!==Vs?s:void 0}function ss(s,a,t){if(is(a))return a;const r=s.immer_.shouldUseStrictIteration(),n=a[ye];if(!n)return es(a,(i,c)=>Is(s,n,a,i,c,t),r),a;if(n.scope_!==s)return a;if(!n.modified_)return ts(s,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let c=i,h=!1;n.type_===3&&(c=new Set(i),i.clear(),h=!0),es(c,(p,u)=>Is(s,n,i,p,u,t,h),r),ts(s,i,!1),t&&s.patches_&&Ee("Patches").generatePatches_(n,t,s.patches_,s.inversePatches_)}return n.copy_}function Is(s,a,t,r,n,i,c){if(n==null||typeof n!="object"&&!c)return;const h=is(n);if(!(h&&!c)){if(Fe(n)){const p=i&&a&&a.type_!==3&&!ps(a.assigned_,r)?i.concat(r):void 0,u=ss(s,n,p);if(Ys(t,r,u),Fe(u))s.canAutoFreeze_=!1;else return}else c&&t.add(n);if(Re(n)&&!h){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1||a&&a.base_&&a.base_[r]===n&&h)return;ss(s,n),(!a||!a.scope_.parent_)&&typeof r!="symbol"&&(Ve(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&ts(s,n)}}}function ts(s,a,t=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&Ps(a,t)}function Dt(s,a){const t=Array.isArray(s),r={type_:t?1:0,scope_:a?a.scope_:Ks(),modified_:!1,finalized_:!1,assigned_:{},parent_:a,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let n=r,i=Os;t&&(n=[r],i=$e);const{revoke:c,proxy:h}=Proxy.revocable(n,i);return r.draft_=h,r.revoke_=c,h}var Os={get(s,a){if(a===ye)return s;const t=ke(s);if(!ps(t,a))return Rt(s,t,a);const r=t[a];return s.finalized_||!Re(r)?r:r===ds(s.base_,a)?(us(s),s.copy_[a]=ws(r,s)):r},has(s,a){return a in ke(s)},ownKeys(s){return Reflect.ownKeys(ke(s))},set(s,a,t){const r=Qs(ke(s),a);if(r!=null&&r.set)return r.set.call(s.draft_,t),!0;if(!s.modified_){const n=ds(ke(s),a),i=n==null?void 0:n[ye];if(i&&i.base_===t)return s.copy_[a]=t,s.assigned_[a]=!1,!0;if(Ot(t,n)&&(t!==void 0||ps(s.base_,a)))return!0;us(s),js(s)}return s.copy_[a]===t&&(t!==void 0||a in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[a])||(s.copy_[a]=t,s.assigned_[a]=!0),!0},deleteProperty(s,a){return ds(s.base_,a)!==void 0||a in s.base_?(s.assigned_[a]=!1,us(s),js(s)):delete s.assigned_[a],s.copy_&&delete s.copy_[a],!0},getOwnPropertyDescriptor(s,a){const t=ke(s),r=Reflect.getOwnPropertyDescriptor(t,a);return r&&{writable:!0,configurable:s.type_!==1||a!=="length",enumerable:r.enumerable,value:t[a]}},defineProperty(){Pe(11)},getPrototypeOf(s){return Ie(s.base_)},setPrototypeOf(){Pe(12)}},$e={};es(Os,(s,a)=>{$e[s]=function(){return arguments[0]=arguments[0][0],a.apply(this,arguments)}});$e.deleteProperty=function(s,a){return $e.set.call(this,s,a,void 0)};$e.set=function(s,a,t){return Os.set.call(this,s[0],a,t,s[0])};function ds(s,a){const t=s[ye];return(t?ke(t):s)[a]}function Rt(s,a,t){var n;const r=Qs(a,t);return r?"value"in r?r.value:(n=r.get)==null?void 0:n.call(s.draft_):void 0}function Qs(s,a){if(!(a in s))return;let t=Ie(s);for(;t;){const r=Object.getOwnPropertyDescriptor(t,a);if(r)return r;t=Ie(t)}}function js(s){s.modified_||(s.modified_=!0,s.parent_&&js(s.parent_))}function us(s){s.copy_||(s.copy_=xs(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var Et=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(a,t,r)=>{if(typeof a=="function"&&typeof t!="function"){const i=t;t=a;const c=this;return function(p=i,...u){return c.produce(p,d=>t.call(this,d,...u))}}typeof t!="function"&&Pe(6),r!==void 0&&typeof r!="function"&&Pe(7);let n;if(Re(a)){const i=Ts(this),c=ws(a,void 0);let h=!0;try{n=t(c),h=!1}finally{h?gs(i):fs(i)}return Fs(i,r),As(n,i)}else if(!a||typeof a!="object"){if(n=t(a),n===void 0&&(n=a),n===Vs&&(n=void 0),this.autoFreeze_&&Ps(n,!0),r){const i=[],c=[];Ee("Patches").generateReplacementPatches_(a,n,i,c),r(i,c)}return n}else Pe(1,a)},this.produceWithPatches=(a,t)=>{if(typeof a=="function")return(c,...h)=>this.produceWithPatches(c,p=>a(p,...h));let r,n;return[this.produce(a,t,(c,h)=>{r=c,n=h}),r,n]},typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof(s==null?void 0:s.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy),typeof(s==null?void 0:s.useStrictIteration)=="boolean"&&this.setUseStrictIteration(s.useStrictIteration)}createDraft(s){Re(s)||Pe(8),Fe(s)&&(s=Ft(s));const a=Ts(this),t=ws(s,void 0);return t[ye].isManual_=!0,fs(a),t}finishDraft(s,a){const t=s&&s[ye];(!t||!t.isManual_)&&Pe(9);const{scope_:r}=t;return Fs(r,a),As(void 0,r)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}setUseStrictIteration(s){this.useStrictIteration_=s}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(s,a){let t;for(t=a.length-1;t>=0;t--){const n=a[t];if(n.path.length===0&&n.op==="replace"){s=n.value;break}}t>-1&&(a=a.slice(t+1));const r=Ee("Patches").applyPatches_;return Fe(s)?r(s,a):this.produce(s,n=>r(n,a))}};function ws(s,a){const t=Ve(s)?Ee("MapSet").proxyMap_(s,a):ns(s)?Ee("MapSet").proxySet_(s,a):Dt(s,a);return(a?a.scope_:Ks()).drafts_.push(t),t}function Ft(s){return Fe(s)||Pe(10,s),Zs(s)}function Zs(s){if(!Re(s)||is(s))return s;const a=s[ye];let t,r=!0;if(a){if(!a.modified_)return a.base_;a.finalized_=!0,t=xs(s,a.scope_.immer_.useStrictShallowCopy_),r=a.scope_.immer_.shouldUseStrictIteration()}else t=xs(s,!0);return es(t,(n,i)=>{Ys(t,n,Zs(i))},r),a&&(a.finalized_=!1),t}var Tt=new Et,At=Tt.produce;const It=s=>(a,t,r)=>(r.setState=(n,i,...c)=>{const h=typeof n=="function"?At(n):n;return a(h,i,...c)},s(r.setState,t,r)),zt=It,Ne=s=>s.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),zs=s=>({Shelter:"lucide:home",Toilet:"lucide:bath",Bridge:"lucide:route",Access:"lucide:wheelchair",Seating:"lucide:armchair",Lighting:"lucide:lamp"})[s]||"lucide:box",$s=s=>({Shelter:"Outdoor structures for shade and protection",Toilet:"Public and portable sanitation facilities",Bridge:"Pedestrian and light vehicle crossings",Access:"Ramps, stairs, and accessibility solutions",Seating:"Benches and outdoor furniture options",Lighting:"Outdoor and pathway lighting solutions"})[s]||"Product category",Gs=s=>({Peninsula:"Modern shelters with excellent weather protection for parks and urban settings",Whyalla:"Robust shelters designed for coastal and high-wind environments",Coastal:"Corrosion-resistant designs perfect for beachfront and marine locations",Urban:"Contemporary designs that blend with modern city landscapes",Heritage:"Traditional designs that complement historic and cultural settings",EcoSan:"Environmentally friendly composting toilet solutions with minimal water usage",Standard:"Reliable and cost-effective public toilet facilities",Accessible:"Fully compliant accessible toilet facilities with enhanced features",Premium:"High-end toilet facilities with superior finishes and amenities",Compact:"Space-saving designs for areas with limited footprint","Small Span":"Compact bridges for garden paths and small water crossings","Large Span":"Extended bridges for wider crossings and heavier loads",Pedestrian:"Dedicated walkways designed for high foot traffic areas",Decorative:"Ornamental bridges that serve as landscape features","Heavy Duty":"Reinforced bridges capable of supporting maintenance vehicles"})[s]||`${s} product range`,Ls=s=>{const a={Peninsula:["Modern","Weather-resistant","Versatile"],Whyalla:["Robust","Wind-resistant","Durable"],Coastal:["Corrosion-resistant","Salt-proof","UV-stable"],Urban:["Contemporary","Modular","Space-efficient"],Heritage:["Traditional","Ornate","Classic"],EcoSan:["Eco-friendly","Low-water","Composting"],Standard:["Cost-effective","Reliable","Low-maintenance"],Accessible:["ADA Compliant","Spacious","Universal"],Premium:["High-end","Enhanced features","Superior finishes"],Compact:["Space-saving","Efficient","Urban-friendly"],"Small Span":["Compact","Decorative","Easy-install"],"Large Span":["Extended","Reinforced","Heavy-load"],Pedestrian:["High-traffic","Safety-focused","Accessible"],Decorative:["Ornamental","Artistic","Feature piece"],"Heavy Duty":["Vehicle-rated","Industrial","Maximum strength"],default:["Quality","Durable","Customizable"]};return a[s]||a.default},ms={id:1,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:[]},{step:2,title:"Select Product Range",ranges:{}},{step:3,title:"Select Individual Product",products:{}},{step:4,title:"View Product Content",productDetails:{}},{step:5,title:"Configure Options",options:{}},{step:6,title:"Contact Information",fields:[{name:"fullName",label:"Full Name",type:"text",required:!0},{name:"email",label:"Email Address",type:"email",required:!0},{name:"phone",label:"Phone Number",type:"tel",required:!1},{name:"company",label:"Company/Organization",type:"text",required:!1},{name:"message",label:"Additional Notes",type:"textarea",required:!1}]}]}},we=gt()(ft(zt((s,a)=>({productData:ms,productGroups:[],productRanges:[],products:[],relationships:{groupToRanges:{},rangeToProducts:{}},isDirty:!1,isSaving:!1,isLoading:!1,lastSaved:null,error:null,initializeFromWindowData:()=>{const t=window.urbanaAdmin;if(!t){console.warn("No urbanaAdmin window data found");return}t.stepperFormData&&s(r=>{r.productData=t.stepperFormData}),t.stepperDataBuilder&&typeof t.stepperDataBuilder=="object"&&t.stepperDataBuilder.productGroups&&t.stepperDataBuilder.productGroups.length>0?s(r=>{r.productGroups=t.stepperDataBuilder.productGroups||[],r.productRanges=t.stepperDataBuilder.productRanges||[],r.products=t.stepperDataBuilder.products||[],r.relationships=t.stepperDataBuilder.relationships||{groupToRanges:{},rangeToProducts:{}},t.stepperDataBuilder.lastSaved&&(r.lastSaved=new Date(t.stepperDataBuilder.lastSaved)),r.isDirty=!1}):(console.log("No existing data builder data found, extracting from stepper form data"),t.stepperFormData&&t.stepperFormData.stepperForm?a().initializeFromProductData(t.stepperFormData):(a().initializeFromProductData(ht),console.warn("No stepper form data found in window.urbanaAdmin")))},loadData:async t=>{var r;if(!t){a().initializeFromWindowData();return}s(n=>{n.isLoading=!0,n.error=null});try{const n=await fetch(`/wp-json/urbana/v1/data-builder/${t}`,{method:"GET",headers:{"X-WP-Nonce":((r=window.urbanaAdmin)==null?void 0:r.nonce)||""}});if(!n.ok)throw new Error(`Failed to load data: ${n.status} ${n.statusText}`);const i=await n.json();i.stepper_form_data&&s(c=>{c.productData=i.stepper_form_data}),i.stepper_data_builder&&typeof i.stepper_data_builder=="object"&&i.stepper_data_builder.productGroups&&i.stepper_data_builder.productGroups.length>0?(console.log("Loading existing API data builder data:",i.stepper_data_builder),s(c=>{c.productGroups=i.stepper_data_builder.productGroups||[],c.productRanges=i.stepper_data_builder.productRanges||[],c.products=i.stepper_data_builder.products||[],c.relationships=i.stepper_data_builder.relationships||{groupToRanges:{},rangeToProducts:{}},i.stepper_data_builder.lastSaved&&(c.lastSaved=new Date(i.stepper_data_builder.lastSaved))})):(console.log("No existing API data builder data found, extracting from stepper form data"),i.stepper_form_data&&a().initializeFromProductData(i.stepper_form_data))}catch(n){const i=n instanceof Error?n.message:"Unknown error occurred";throw console.error("Error loading data:",i),s(c=>{c.error=i}),n}finally{s(n=>{n.isLoading=!1})}},getRangesForGroup:t=>{const{productRanges:r,relationships:n}=a(),i=n.groupToRanges[t]||[];return r.filter(c=>i.includes(c.id))},getProductsForRange:t=>{const{products:r,relationships:n}=a(),i=n.rangeToProducts[t]||[];return r.filter(c=>i.includes(c.id))},getProductById:t=>{const{products:r}=a();return r.find(n=>n.id===t)},getGroupById:t=>{const{productGroups:r}=a();return r.find(n=>n.id===t)},getRangeById:t=>{const{productRanges:r}=a();return r.find(n=>n.id===t)},saveData:async()=>{var t;s(r=>{r.isSaving=!0,r.error=null});try{const r=a().exportData(),{productGroups:n,productRanges:i,products:c,relationships:h}=a(),p=await fetch("/wp-json/urbana/v1/product-data",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({stepper_form_data:r,stepper_data_builder:{productGroups:n,productRanges:i,products:c,relationships:h,lastSaved:new Date().toISOString()}})});if(!p.ok)throw new Error(`Failed to save data: ${p.status} ${p.statusText}`);const u=await p.json();return s(d=>{d.productData=r,d.isDirty=!1,d.lastSaved=new Date}),console.log("Data saved successfully, stepper ID:",u.stepper_id),u.stepper_id}catch(r){const n=r instanceof Error?r.message:"Unknown error occurred";throw console.error("Error saving data:",n),s(i=>{i.error=n}),r}finally{s(r=>{r.isSaving=!1})}},initializeFromProductData:t=>s(r=>{r.productData=t;const n=(t.stepperForm.steps[0].categories||[]).map(u=>({id:Ne(u),name:u,icon:zs(u),description:$s(u)}));r.productGroups=n;const i=[];Object.entries(t.stepperForm.steps[1].ranges||{}).forEach(([u,d])=>{d.forEach(m=>{i.push({id:Ne(m),name:m,image:"",description:Gs(m),tags:Ls(m),groupName:u})})}),r.productRanges=i;const c=[];Object.entries(t.stepperForm.steps[2].products||{}).forEach(([u,d])=>{d.forEach(m=>{var j;const x=(j=t.stepperForm.steps[3].productDetails)==null?void 0:j[m];c.push({id:Ne(m),code:m,name:(x==null?void 0:x.name)||`${m} Product`,overview:(x==null?void 0:x.overview)||"",description:(x==null?void 0:x.description)||"",specifications:(x==null?void 0:x.specifications)||[],imageGallery:(x==null?void 0:x.imageGallery)||[],files:(x==null?void 0:x.files)||{}})})}),r.products=c;const h={};Object.entries(t.stepperForm.steps[1].ranges||{}).forEach(([u,d])=>{const m=Ne(u);h[m]=d.map(x=>Ne(x))});const p={};Object.entries(t.stepperForm.steps[2].products||{}).forEach(([u,d])=>{const m=Ne(u);p[m]=d.map(x=>Ne(x))}),r.relationships={groupToRanges:h,rangeToProducts:p}}),updateProductData:t=>s(r=>{r.productData=t,r.isDirty=!0}),exportData:()=>{const{productGroups:t,productRanges:r,products:n,relationships:i,productData:c}=a();return{id:c.id,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:t.map(p=>p.name)},{step:2,title:"Select Product Range",ranges:(()=>{const p={};return Object.entries(i.groupToRanges).forEach(([u,d])=>{const m=t.find(x=>x.id===u);m&&(p[m.name]=d.map(x=>{const j=r.find(y=>y.id===x);return j?j.name:""}).filter(x=>x!==""))}),p})()},{step:3,title:"Select Individual Product",products:(()=>{const p={};return Object.entries(i.rangeToProducts).forEach(([u,d])=>{const m=r.find(x=>x.id===u);m&&(p[m.name]=d.map(x=>{const j=n.find(y=>y.id===x);return j?j.code:""}).filter(x=>x!==""))}),p})()},{step:4,title:"View Product Content",productDetails:(()=>{const p={};return n.forEach(u=>{p[u.code]={name:u.name,overview:u.overview,description:u.description,specifications:u.specifications,imageGallery:u.imageGallery,files:u.files,faqs:u.faqs||[]}}),p})()},{step:5,title:"Configure Options",options:(()=>{const p={};return n.forEach(u=>{u.options&&Object.entries(u.options).forEach(([d,m])=>{p[d]||(p[d]=[]),m.forEach(x=>{p[d].some(y=>y.value===x.value)||p[d].push(x)})})}),p})(),productOptions:(()=>{const p={};return n.forEach(u=>{u.options&&Object.keys(u.options).length>0&&(p[u.code]=u.options)}),p})()},c.stepperForm.steps[5]||{step:6,title:"Contact Information",fields:ms.stepperForm.steps[5].fields}]}}},addProductGroup:t=>s(r=>{const n=Ne(t.name),i={...t,id:n,icon:t.icon||zs(t.name),description:t.description||$s(t.name),active:t.active!==void 0?t.active:!0};r.productGroups.some(h=>h.id===n)||(r.productGroups.push(i),r.relationships.groupToRanges[n]=[],r.isDirty=!0)}),updateProductGroup:(t,r)=>s(n=>{const i=n.productGroups.findIndex(c=>c.id===t);i!==-1&&(n.productGroups[i]={...n.productGroups[i],...r},n.isDirty=!0)}),removeProductGroup:t=>s(r=>{r.productGroups=r.productGroups.filter(i=>i.id!==t),(r.relationships.groupToRanges[t]||[]).forEach(i=>{r.productRanges=r.productRanges.filter(h=>h.id!==i),(r.relationships.rangeToProducts[i]||[]).forEach(h=>{r.products=r.products.filter(p=>p.id!==h)}),delete r.relationships.rangeToProducts[i]}),delete r.relationships.groupToRanges[t],r.isDirty=!0}),addProductRange:t=>s(r=>{const n=Ne(t.name),i={...t,id:n,description:t.description||Gs(t.name),tags:t.tags||Ls(t.name),active:t.active!==void 0?t.active:!0,groupName:t.groupName||""};r.productRanges.some(h=>h.id===n)||(r.productRanges.push(i),r.relationships.rangeToProducts[n]=[],r.isDirty=!0)}),updateProductRange:(t,r)=>s(n=>{const i=n.productRanges.findIndex(c=>c.id===t);i!==-1&&(n.productRanges[i]={...n.productRanges[i],...r},r.groupName&&(n.productRanges[i].groupName=r.groupName),n.isDirty=!0)}),removeProductRange:t=>s(r=>{r.productRanges=r.productRanges.filter(i=>i.id!==t),(r.relationships.rangeToProducts[t]||[]).forEach(i=>{r.products=r.products.filter(c=>c.id!==i)}),Object.keys(r.relationships.groupToRanges).forEach(i=>{r.relationships.groupToRanges[i]=r.relationships.groupToRanges[i].filter(c=>c!==t)}),delete r.relationships.rangeToProducts[t],r.isDirty=!0}),addProduct:t=>s(r=>{const n=Ne(t.code||t.name),i={...t,id:n,code:t.code||Ne(t.name),active:t.active!==void 0?t.active:!0};r.products.some(h=>h.id===n)||(r.products.push(i),r.isDirty=!0)}),updateProduct:(t,r)=>s(n=>{const i=n.products.findIndex(c=>c.id===t);i!==-1&&(n.products[i]={...n.products[i],...r},n.isDirty=!0)}),removeProduct:t=>s(r=>{r.products=r.products.filter(n=>n.id!==t),Object.keys(r.relationships.rangeToProducts).forEach(n=>{r.relationships.rangeToProducts[n]=r.relationships.rangeToProducts[n].filter(i=>i!==t)}),r.isDirty=!0}),linkRangeToGroup:(t,r)=>s(n=>{n.relationships.groupToRanges[t]||(n.relationships.groupToRanges[t]=[]),n.relationships.groupToRanges[t].includes(r)||(n.relationships.groupToRanges[t].push(r),n.isDirty=!0)}),unlinkRangeFromGroup:(t,r)=>s(n=>{n.relationships.groupToRanges[t]&&(n.relationships.groupToRanges[t]=n.relationships.groupToRanges[t].filter(i=>i!==r),n.isDirty=!0)}),linkProductToRange:(t,r)=>s(n=>{n.relationships.rangeToProducts[t]||(n.relationships.rangeToProducts[t]=[]),n.relationships.rangeToProducts[t].includes(r)||(n.relationships.rangeToProducts[t].push(r),n.isDirty=!0)}),unlinkProductFromRange:(t,r)=>s(n=>{n.relationships.rangeToProducts[t]&&(n.relationships.rangeToProducts[t]=n.relationships.rangeToProducts[t].filter(i=>i!==r),n.isDirty=!0)}),updateRelationships:t=>s(r=>{r.relationships=t,r.isDirty=!0}),updateOptions:t=>s(r=>{if(r.productData.stepperForm.steps[4]){const n={};Object.entries(t).forEach(([i,c])=>{n[i]=c.map(h=>typeof h=="string"?{value:h}:h)}),r.productData.stepperForm.steps[4].options=n,r.isDirty=!0}}),updateContactFields:t=>s(r=>{r.productData.stepperForm.steps[5]&&(r.productData.stepperForm.steps[5].fields=t,r.isDirty=!0)}),resetData:()=>s(t=>{t.productData=ms,t.productGroups=[],t.productRanges=[],t.products=[],t.relationships={groupToRanges:{},rangeToProducts:{}},t.isDirty=!1,t.lastSaved=null,t.error=null}),importData:t=>s(r=>{r.isDirty=!0,r.lastSaved=null,r.error=null,a().initializeFromProductData(t)}),setError:t=>s(r=>{r.error=t}),clearError:()=>s(t=>{t.error=null})})),{name:"urbana-data-builder"})),$t=({selectedIcon:s,onIconSelect:a})=>{const t=["lucide:box","lucide:home","lucide:bath","lucide:route","lucide:wheelchair","lucide:armchair","lucide:lamp","lucide:tree","lucide:building","lucide:car","lucide:tools","lucide:shield"];return e.jsx("div",{className:"grid grid-cols-6 gap-2",children:t.map(r=>e.jsx(U,{isIconOnly:!0,variant:s===r?"solid":"bordered",color:s===r?"primary":"default",onPress:()=>a(r),className:"h-12 w-12",children:e.jsx(o,{icon:r,width:20})},r))})},Gt=()=>{const{productGroups:s,addProductGroup:a,updateProductGroup:t,removeProductGroup:r,getRangesForGroup:n}=we(),{isOpen:i,onOpen:c,onOpenChange:h,onClose:p}=Ge(),[u,d]=oe.useState(null),[m,x]=oe.useState({name:"",icon:"lucide:box",description:"",active:!0}),[j,y]=oe.useState({}),R=()=>{d(null),x({name:"",icon:"lucide:box",description:"",active:!0}),y({}),c()},q=l=>{d(l),x({name:l.name,icon:l.icon,description:l.description,active:l.active}),y({}),c()},_=l=>{t(l.id,{active:typeof l.active>"u"?!1:!l.active})},H=l=>{const C=n(l).length,I=C>0?`Are you sure you want to delete this product group? This will also remove ${C} associated range(s) and their products.`:"Are you sure you want to delete this product group?";confirm(I)&&r(l)},L=(l,C)=>{x(I=>({...I,[l]:C})),j[l]&&y(I=>({...I,[l]:""}))},Q=l=>{x(C=>({...C,icon:l}))},z=()=>{const l={};return m.name.trim()||(l.name="Name is required"),s.some(I=>I.name.toLowerCase()===m.name.toLowerCase()&&(!u||I.id!==u.id))&&(l.name="A product group with this name already exists"),m.description.trim()||(l.description="Description is required"),y(l),Object.keys(l).length===0},O=async(l,C)=>{var Z,ne;const I=l,B=C;try{const ce=((Z=window.urbanaAdmin)==null?void 0:Z.apiUrl)||"/wp-json/urbana/v1/",N=await fetch(`${ce}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((ne=window.urbanaAdmin)==null?void 0:ne.nonce)||""},body:JSON.stringify({old_path:I,new_path:B,type:"group"})});if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);return(await N.json()).success}catch(ce){return console.error("Failed to rename folder in Digital Ocean:",ce),!1}},b=async()=>{if(z()){if(u){if(u.name!==m.name&&confirm(`You've renamed "${u.name}" to "${m.name}".

Do you also want to rename the folder in Digital Ocean Spaces?

• Yes = Rename folder and move all files (recommended)
• No = Only update WordPress, folder stays as "${u.name}"`)){const I=await O(u.name,m.name);alert(I?"✓ Folder renamed successfully in Digital Ocean!":"⚠️ Failed to rename folder in Digital Ocean. You may need to rename it manually.")}t(u.id,m)}else a(m);p()}},[k,v]=oe.useState([]),f=oe.useCallback(async()=>{var l,C;try{const I=((l=window.urbanaAdmin)==null?void 0:l.apiUrl)||"/wp-json/urbana/v1/",B=await fetch(`${I}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((C=window.urbanaAdmin)==null?void 0:C.nonce)||""},body:JSON.stringify({type:"groups"})});if(B.ok){const Z=await B.json();Z.success&&Z.results&&v(ne=>ne.map(ce=>{const N=Z.results.find(w=>{const S=(ce.name||ce.id||"").toLowerCase().replace(/\/+$/,""),A=(w.id||"").toLowerCase().replace(/\/+$/,"");return S===A});return{...ce,exists:N?N.exists:!1}}))}}catch(I){console.error("Failed to check group folder existence:",I)}},[]);oe.useEffect(()=>{v(s.map(l=>({id:l.id,name:l.name,type:"group",exists:void 0,checked:!1}))),setTimeout(()=>f(),500)},[s,f]);const T=(l,C)=>{v(I=>I.map(B=>B.id===l?{...B,checked:C}:B))},V=l=>{v(C=>C.map(I=>({...I,checked:l})))},E=async l=>{var C,I;try{const B=((C=window.urbanaAdmin)==null?void 0:C.apiUrl)||"/wp-json/urbana/v1/",Z=await fetch(`${B}digital-ocean/create-group-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((I=window.urbanaAdmin)==null?void 0:I.nonce)||""},body:JSON.stringify({group_ids:l})});if(!Z.ok)throw new Error(`HTTP error! status: ${Z.status}`);const ne=await Z.json();if(!ne.success)throw new Error(ne.message||"Failed to create folders");v(ce=>ce.map(N=>l.includes(N.id)?{...N,exists:!0,checked:!1}:N))}catch(B){throw B}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Groups"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Organize your products into logical categories"})]}),e.jsx(U,{color:"primary",onPress:R,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]}),e.jsxs(Ce,{"aria-label":"Product Groups Options",className:"mb-6",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:layers",width:16}),e.jsx("span",{children:"Manage Groups"})]}),children:e.jsx("div",{className:"mt-4",children:s.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:layers",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product group to get started"})]}),e.jsx(U,{color:"primary",onPress:R,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(l=>{const C=n(l.id).length;return e.jsxs(ae,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{icon:e.jsx(o,{icon:l.icon,width:20,style:{stroke:"currentColor",fill:"currentColor"}}),className:"bg-primary-100 text-primary-800",size:"sm"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:l.name}),typeof l.active<"u"&&!l.active&&e.jsx(se,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),e.jsxs(se,{size:"sm",variant:"flat",color:"primary",children:[C," range",C!==1?"s":""]})]})]}),e.jsxs(We,{children:[e.jsx(Je,{children:e.jsx(U,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(o,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(He,{"aria-label":"Group Actions",children:[e.jsx(ve,{startContent:e.jsx(o,{icon:"lucide:edit",width:16}),onPress:()=>q(l),children:"Edit"},"edit"),e.jsx(ve,{startContent:e.jsx(o,{icon:typeof l.active<"u"&&!l.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:()=>_(l),children:typeof l.active<"u"&&!l.active?"Activate":"Deactivate"},"toggle-active"),e.jsx(ve,{className:"text-danger",color:"danger",startContent:e.jsx(o,{icon:"lucide:trash",width:16}),onPress:()=>H(l.id),children:"Delete"},"delete")]})]})]})}),e.jsx(re,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600",children:l.description})})]},l.id)})})})},"manage"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:16}),e.jsx("span",{children:"Digital Ocean Sync"})]}),children:e.jsx("div",{className:"mt-4",children:e.jsxs(ae,{className:"urbana-card",children:[e.jsxs(xe,{className:"flex gap-3",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:24}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-md font-semibold",children:"Product Groups - Digital Ocean Sync"}),e.jsx("p",{className:"text-small text-default-500",children:"Organize like the Manage Groups tab with card layout"})]})]}),e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(U,{color:"primary",variant:"flat",size:"sm",onPress:()=>V(!0),startContent:e.jsx(o,{icon:"lucide:check-square",width:16}),children:"Select All"}),e.jsx(U,{color:"default",variant:"flat",size:"sm",onPress:()=>V(!1),startContent:e.jsx(o,{icon:"lucide:square",width:16}),children:"Clear All"}),e.jsx(U,{color:"primary",size:"sm",onPress:()=>{const l=k.filter(C=>C.checked).map(C=>C.id);E(l)},isDisabled:!k.some(l=>l.checked),startContent:e.jsx(o,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),k.length===0?e.jsxs("div",{className:"text-center py-8 text-foreground-500",children:[e.jsx(o,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No groups available to sync"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map(l=>{const C=s.find(B=>B.id===l.id),I=C?n(C.id).length:0;return e.jsxs(ae,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${l.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>T(l.id,!l.checked),children:[e.jsx(xe,{className:"pb-3",children:e.jsx("div",{className:"flex justify-between items-start w-full",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(De,{icon:e.jsx(o,{icon:(C==null?void 0:C.icon)||"lucide:layers",width:20}),className:"bg-primary-100 text-primary-800",size:"sm"}),e.jsx("div",{className:`absolute -top-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-white text-xs transition-all ${l.checked?"bg-primary":"bg-gray-300"}`,children:l.checked?e.jsx(o,{icon:"lucide:check",width:10}):null})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:l.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(se,{size:"sm",variant:"flat",color:"primary",children:[I," range",I!==1?"s":""]}),e.jsx(se,{size:"sm",variant:"flat",color:l.exists===!0?"success":l.exists===!1?"warning":"default",startContent:l.exists===void 0?e.jsx(o,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):l.exists?e.jsx(o,{icon:"lucide:check",width:12}):e.jsx(o,{icon:"lucide:cloud-upload",width:12}),children:l.exists===void 0?"Checking...":l.exists?"Exists":"Missing"})]})]})]})})}),e.jsxs(re,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-foreground-600",children:(C==null?void 0:C.description)||"No description available"}),l.checked&&e.jsx("div",{className:"mt-2 p-2 bg-primary/10 rounded text-xs text-primary",children:"✓ Selected for sync"})]})]},l.id)})}),k.some(l=>l.checked)&&e.jsxs("div",{className:"mt-4 bg-primary/10 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm text-primary font-medium",children:[k.filter(l=>l.checked).length," group folder(s) will be created in Digital Ocean Spaces"]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[k.filter(l=>l.checked).slice(0,5).map(l=>e.jsx(se,{size:"sm",variant:"flat",color:"primary",children:l.name},l.id)),k.filter(l=>l.checked).length>5&&e.jsxs(se,{size:"sm",variant:"flat",color:"default",children:["+",k.filter(l=>l.checked).length-5," more"]})]})]})]})]})})},"sync")]}),e.jsx(Le,{isOpen:i,onOpenChange:h,size:"lg",className:"urbana-modal",children:e.jsx(Ue,{children:l=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:u?"Edit Product Group":"Add Product Group"}),e.jsx(Be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{label:"Name",placeholder:"Enter group name",value:m.name,onChange:C=>L("name",C.target.value),errorMessage:j.name,isInvalid:!!j.name,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Icon"}),e.jsx($t,{selectedIcon:m.icon,onIconSelect:Q})]}),e.jsx(Ae,{label:"Description",placeholder:"Enter group description",value:m.description,onChange:C=>L("description",C.target.value),errorMessage:j.description,isInvalid:!!j.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}})]})}),e.jsxs(qe,{children:[e.jsx(U,{variant:"light",onPress:l,children:"Cancel"}),e.jsxs(U,{color:"primary",onPress:b,children:[u?"Update":"Add"," Group"]})]})]})})})]})},Lt=({tags:s,onTagsChange:a})=>{const[t,r]=oe.useState(""),n=c=>{if(c.key==="Enter"&&t.trim()){c.preventDefault();const h=t.trim();s.includes(h)||a([...s,h]),r("")}},i=c=>{a(s.filter(h=>h!==c))};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(be,{placeholder:"Type a tag and press Enter",value:t,onChange:c=>r(c.target.value),onKeyDown:n,classNames:{input:"urbana-input"}}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(c=>e.jsx(se,{onClose:()=>i(c),variant:"flat",size:"sm",children:c},c))})]})},Ut=()=>{const{productRanges:s,productGroups:a,addProductRange:t,updateProductRange:r,removeProductRange:n,getProductsForRange:i,linkRangeToGroup:c,unlinkRangeFromGroup:h,relationships:p}=we(),{isOpen:u,onOpen:d,onOpenChange:m,onClose:x}=Ge(),[j,y]=oe.useState(null),[R,q]=oe.useState({name:"",image:"",description:"",tags:[],active:!0,groupName:""}),[_,H]=oe.useState(new Set),[L,Q]=oe.useState({}),z=()=>{y(null),q({name:"",image:"",description:"",tags:[],active:!0,groupName:""}),H(new Set),Q({}),d()},O=N=>{y(N),q({name:N.name,image:N.image,description:N.description,tags:[...N.tags],active:N.active,groupName:N.groupName||""});const w=new Set;Object.entries(p.groupToRanges).forEach(([S,A])=>{A.includes(N.id)&&w.add(S)}),H(w),Q({}),d()},b=N=>{const w=i(N).length,S=w>0?`Are you sure you want to delete this product range? This will also remove ${w} associated product(s).`:"Are you sure you want to delete this product range?";confirm(S)&&n(N)},k=(N,w)=>{q(S=>({...S,[N]:w})),L[N]&&Q(S=>({...S,[N]:""}))},v=()=>{const N={};return R.name.trim()||(N.name="Name is required"),s.some(S=>S.name.toLowerCase()===R.name.toLowerCase()&&(!j||S.id!==j.id))&&(N.name="A product range with this name already exists"),R.description.trim()||(N.description="Description is required"),_.size===0&&(N.groups="Please select at least one product group"),Q(N),Object.keys(N).length===0},f=async(N,w,S)=>{var A,M;try{const Y=`${S}/${N}`,ee=`${S}/${w}`,J=((A=window.urbanaAdmin)==null?void 0:A.apiUrl)||"/wp-json/urbana/v1/",te=await fetch(`${J}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((M=window.urbanaAdmin)==null?void 0:M.nonce)||""},body:JSON.stringify({old_path:Y,new_path:ee})});if(!te.ok)throw new Error(`HTTP error! status: ${te.status}`);const le=await te.json();if(!le.success)throw new Error(le.message||"Failed to rename folder");return!0}catch(Y){throw console.error("Failed to rename folder in Digital Ocean:",Y),Y}},T=async()=>{var ee,J;if(!v())return;let N,w=!1,S=null,A=null;const M=((ee=a.find(te=>te.id===Array.from(_)[0]))==null?void 0:ee.name)||"",Y={...R,groupName:M};if(j){if(w=j.name!==R.name,A=j.name,w){const te=(J=Object.entries(p.groupToRanges).find(([le,ie])=>ie.includes(j.id)))==null?void 0:J[0];if(te){const le=a.find(ie=>ie.id===te);le&&(S=le.name)}}r(j.id,Y),N=j.id,Object.keys(p.groupToRanges).forEach(te=>{h(te,j.id)})}else t(Y),N=R.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");if(_.forEach(te=>{c(te,N)}),w&&A&&S&&confirm(`The range name has changed from "${A}" to "${R.name}".

Do you want to rename the folder in Digital Ocean as well?
This will move all contents from:
  ${S}/${A}/
to:
  ${S}/${R.name}/`))try{await f(A,R.name,S),alert(`✅ Successfully renamed folder in Digital Ocean from "${A}" to "${R.name}"`)}catch(le){alert(`❌ Failed to rename folder in Digital Ocean. Error: ${le instanceof Error?le.message:"Unknown error"}

The range has been updated in WordPress, but the Digital Ocean folder was not renamed.`)}x()},V=()=>{const N={},w=[];return s.forEach(S=>{let A=!1;Object.entries(p.groupToRanges).forEach(([M,Y])=>{if(Y.includes(S.id)){const ee=a.find(J=>J.id===M);ee&&(N[ee.name]||(N[ee.name]=[]),N[ee.name].push(S),A=!0)}}),A||w.push(S)}),{grouped:N,ungrouped:w}},{grouped:E,ungrouped:l}=V(),[C,I]=oe.useState({grouped:{},ungrouped:[]}),B=oe.useCallback(async()=>{var N,w;try{const S=((N=window.urbanaAdmin)==null?void 0:N.apiUrl)||"/wp-json/urbana/v1/",A=await fetch(`${S}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((w=window.urbanaAdmin)==null?void 0:w.nonce)||""},body:JSON.stringify({type:"ranges"})});if(A.ok){const M=await A.json();M.success&&M.results&&I(Y=>{const ee={...Y.grouped},J=[...Y.ungrouped];return Object.keys(ee).forEach(te=>{ee[te]=ee[te].map(le=>{const ie=te.toLowerCase().replace(/\/+$/,"").trim(),he=(le.name||"").toLowerCase().replace(/\/+$/,"").trim(),ge=`${ie}/${he}`,g=M.results.find(P=>{const D=(P.folder_path||P.id||"").toLowerCase().replace(/\/+$/g,"").trim();return D===ge||D===ge+"/"});if(g)window.__URBANA_DEBUG&&console.log(`[DO Sync] FOUND: range '${le.name}' expected '${ge}' → matched DO folder '${g.folder_path||g.id}' (files: ${g.fileCount||0})`);else{const P=$=>(($.folder_path||$.folderPath||$.folderPath||$.id||"")+"").toLowerCase().replace(/\/+$/g,"").trim(),D=M.results.map($=>({path:P($),raw:$})).filter($=>$.path.includes(he)||$.path.includes(ie)),X=M.results.map($=>({path:P($),fileCount:$.fileCount??$.file_count??0,raw:$})).filter($=>$.path===he||$.path===he+"/"),W=ie.endsWith("s")?ie.slice(0,-1):ie+"s",K=M.results.find($=>P($).startsWith(W+"/")),F=D.slice(0,3).map($=>$.path).join(", ");D.length||X.length||K?window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING: '${le.name}' expected '${ge}'. Found ${D.length+X.length} close matches in DO (sample: ${F||"none"})`+(K?`; possible pluralization mismatch (DO contains '${P(K)}')`:"")):window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING: '${le.name}' expected '${ge}' — no nearby matches in DO (checked ${M.results.length} entries).`)}return{...le,exists:g?g.exists:!1}})}),J.forEach((te,le)=>{const ie=(te.name||"").toLowerCase().replace(/\/+$/,"").trim(),he=M.results.find(g=>{const P=(g.folder_path||g.id||"").toLowerCase().replace(/\/+$/g,"").trim();return P.endsWith("/"+ie)||P===ie});if(he){window.__URBANA_DEBUG&&console.log(`[DO Sync] FOUND (ungrouped): range '${te.name}' matched DO folder '${he.folder_path||he.id}'`),J[le]={...te,exists:he.exists};return}const ge=M.results.map(g=>({path:(g.folder_path||g.id||"").toLowerCase().replace(/\/+$/g,"").trim(),raw:g})).filter(g=>g.path.includes(ie));ge.length>0?window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING (ungrouped): range '${te.name}' — partial matches in DO: ${ge.map(g=>g.path).slice(0,5).join(", ")}${ge.length>5?" (and more)":""}`):window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING (ungrouped): range '${te.name}' — no entries containing '${ie}' found in DO results.`)}),{grouped:ee,ungrouped:J}})}else console.error("[DO Sync] check-folders returned HTTP",A.status),I(M=>{const Y={...M.grouped},ee=[...M.ungrouped];return Object.keys(Y).forEach(J=>{Y[J]=Y[J].map(te=>({...te,exists:!1}))}),ee.forEach((J,te)=>{ee[te]={...J,exists:!1}}),{grouped:Y,ungrouped:ee}})}catch(S){console.error("❌ Failed to check folder existence:",S)}},[]);oe.useEffect(()=>{const{grouped:N,ungrouped:w}=V(),S={};Object.entries(N).forEach(([M,Y])=>{S[M]=Y.map(ee=>({id:ee.id,name:ee.name,type:"range",exists:void 0,checked:!1}))});const A=w.map(M=>({id:M.id,name:M.name,type:"range",exists:void 0,checked:!1}));I({grouped:S,ungrouped:A}),B()},[s,p,a]),oe.useEffect(()=>{const N=w=>{if(!w||!w.detail||!w.detail.results)return;const S=w.detail;I(A=>{const M={...A.grouped},Y=[...A.ungrouped];return Object.keys(M).forEach(ee=>{M[ee]=M[ee].map(J=>{const te=ee.toLowerCase().replace(/\/+$/,"").trim(),le=(J.name||"").toLowerCase().replace(/\/+$/,"").trim(),ie=`${te}/${le}`,he=S.results.find(ge=>{const g=(ge.folder_path||ge.id||"").toLowerCase().replace(/\/+$/g,"").trim();return g===ie||g===ie+"/"});return{...J,exists:he?he.exists:!1}})}),Y.forEach((ee,J)=>{const te=(ee.name||"").toLowerCase().replace(/\/+$/,"").trim(),le=S.results.find(ie=>{const he=(ie.folder_path||ie.id||"").toLowerCase().replace(/\/+$/g,"").trim();return he.endsWith("/"+te)||he===te});le&&(Y[J]={...ee,exists:le.exists})}),{grouped:M,ungrouped:Y}})};return window.addEventListener("urbana:do-scan-completed",N),()=>window.removeEventListener("urbana:do-scan-completed",N)},[]);const Z=(N,w)=>{I(S=>{const A={...S.grouped},M=[...S.ungrouped];Object.keys(A).forEach(ee=>{A[ee]=A[ee].map(J=>J.id===N?{...J,checked:w}:J)});const Y=M.findIndex(ee=>ee.id===N);return Y!==-1&&(M[Y]={...M[Y],checked:w}),{grouped:A,ungrouped:M}})},ne=N=>{I(w=>{const S={...w.grouped},A=[...w.ungrouped];return Object.keys(S).forEach(M=>{S[M]=S[M].map(Y=>({...Y,checked:N}))}),A.forEach((M,Y)=>{A[Y]={...M,checked:N}}),{grouped:S,ungrouped:A}})},ce=async N=>{var w,S;try{const A=((w=window.urbanaAdmin)==null?void 0:w.apiUrl)||"/wp-json/urbana/v1/",M=await fetch(`${A}digital-ocean/create-range-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((S=window.urbanaAdmin)==null?void 0:S.nonce)||""},body:JSON.stringify({range_ids:N})});if(!M.ok)throw new Error(`HTTP error! status: ${M.status}`);const Y=await M.json();if(!Y.success)throw new Error(Y.message||"Failed to create folders");I(ee=>{const J={...ee.grouped},te=[...ee.ungrouped];return Object.keys(J).forEach(le=>{J[le]=J[le].map(ie=>N.includes(ie.id)?{...ie,exists:!0,checked:!1}:ie)}),te.forEach((le,ie)=>{N.includes(le.id)&&(te[ie]={...le,exists:!0,checked:!1})}),{grouped:J,ungrouped:te}})}catch(A){throw A}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Ranges"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Define specific product lines within each group"})]}),e.jsx(U,{color:"primary",onPress:z,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),isDisabled:a.length===0,children:"Add Product Range"})]}),e.jsxs(Ce,{"aria-label":"Product Ranges Options",className:"mb-6",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:16}),e.jsx("span",{children:"Manage Ranges"})]}),children:e.jsx("div",{className:"mt-4",children:a.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Available"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"You need to create product groups first before adding ranges"})]})]})})}):s.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product range to organize your products"})]}),e.jsx(U,{color:"primary",onPress:z,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),children:"Add Product Range"})]})})}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(E).map(([N,w])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:layers",width:18}),N,e.jsxs(se,{size:"sm",variant:"flat",children:[w.length," range",w.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(S=>e.jsx(Us,{range:S,onEdit:O,onDelete:b},S.id))})]},N)),l.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Ranges",e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[l.length," range",l.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(N=>e.jsx(Us,{range:N,onEdit:O,onDelete:b},N.id))})]})]})})},"manage"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:16}),e.jsx("span",{children:"Digital Ocean Sync"})]}),children:e.jsx("div",{className:"mt-4",children:e.jsxs(ae,{className:"urbana-card",children:[e.jsxs(xe,{className:"flex gap-3",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:24}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-md font-semibold",children:"Product Ranges - Digital Ocean Sync"}),e.jsx("p",{className:"text-small text-default-500",children:"Organize by groups like the Manage Ranges tab"})]})]}),e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(U,{color:"primary",variant:"flat",size:"sm",onPress:()=>ne(!0),startContent:e.jsx(o,{icon:"lucide:check-square",width:16}),children:"Select All"}),e.jsx(U,{color:"default",variant:"flat",size:"sm",onPress:()=>ne(!1),startContent:e.jsx(o,{icon:"lucide:square",width:16}),children:"Clear All"}),e.jsx(U,{color:"primary",size:"sm",onPress:()=>{const N=[];Object.values(C.grouped).forEach(w=>{w.forEach(S=>{S.checked&&N.push(S.id)})}),C.ungrouped.forEach(w=>{w.checked&&N.push(w.id)}),ce(N)},isDisabled:(()=>{let N=!1;return Object.values(C.grouped).forEach(w=>{w.forEach(S=>{S.checked&&(N=!0)})}),C.ungrouped.forEach(w=>{w.checked&&(N=!0)}),!N})(),startContent:e.jsx(o,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),Object.keys(C.grouped).length===0&&C.ungrouped.length===0?e.jsxs("div",{className:"text-center py-8 text-foreground-500",children:[e.jsx(o,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No ranges available to sync"})]}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(C.grouped).map(([N,w])=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:layers",width:18,className:"text-primary"}),e.jsx("h4",{className:"font-semibold text-lg text-primary",children:N}),e.jsxs(se,{size:"sm",variant:"flat",color:"primary",children:[w.length," range",w.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(S=>{const A=s.find(Y=>Y.id===S.id),M=A?i(S.id).length:0;return e.jsxs(ae,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${S.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>Z(S.id,!S.checked),children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:grid-3x3",width:20,className:"text-secondary-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(_e,{isSelected:S.checked||!1,onValueChange:Y=>{Z(S.id,Y)},size:"sm",onClick:Y=>Y.stopPropagation()})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold",children:S.name}),e.jsxs(se,{size:"sm",variant:"flat",color:"secondary",children:[M," product",M!==1?"s":""]})]})]}),e.jsx(se,{size:"sm",variant:"flat",color:S.exists===!0?"success":S.exists===!1?"warning":"default",startContent:S.exists===void 0?e.jsx(o,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):S.exists?e.jsx(o,{icon:"lucide:check-circle",width:14}):e.jsx(o,{icon:"lucide:alert-circle",width:14}),children:S.exists===void 0?"Checking...":S.exists?"Exists":"Missing"})]})}),A&&e.jsx(re,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600",children:A.description||"No description"})})]},S.id)})})]},N)),C.ungrouped.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:18,className:"text-warning"}),e.jsx("h4",{className:"font-semibold text-lg text-warning",children:"Ungrouped Ranges"}),e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[C.ungrouped.length," range",C.ungrouped.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.ungrouped.map(N=>{const w=s.find(A=>A.id===N.id),S=w?i(N.id).length:0;return e.jsxs(ae,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${N.checked?"border-warning bg-warning/5":"border-transparent hover:border-warning/30"}`,isPressable:!0,onPress:()=>Z(N.id,!N.checked),children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:grid-3x3",width:20,className:"text-warning-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(_e,{isSelected:N.checked||!1,onValueChange:A=>{Z(N.id,A)},size:"sm",onClick:A=>A.stopPropagation()})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold",children:N.name}),e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[S," product",S!==1?"s":""]})]})]}),e.jsx(se,{size:"sm",variant:"flat",color:N.exists?"success":"warning",startContent:e.jsx(o,{icon:N.exists?"lucide:check-circle":"lucide:alert-circle",width:14}),children:N.exists?"Exists":"Missing"})]})}),w&&e.jsx(re,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600",children:w.description||"No description"})})]},N.id)})})]})]})]})]})})},"sync")]}),e.jsx(Le,{isOpen:u,onOpenChange:m,size:"2xl",className:"urbana-modal",children:e.jsx(Ue,{children:N=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:j?"Edit Product Range":"Add Product Range"}),e.jsx(Be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(be,{label:"Name",placeholder:"Enter range name",value:R.name,onChange:w=>k("name",w.target.value),errorMessage:L.name,isInvalid:!!L.name,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsx(Qe,{label:"Product Groups",placeholder:"Select product groups for this range",selectionMode:"multiple",selectedKeys:_,onSelectionChange:w=>H(w),errorMessage:L.groups,isInvalid:!!L.groups,isRequired:!0,children:a.map(w=>e.jsx(Ze,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:w.icon,width:16}),w.name]})},w.id))}),e.jsx(be,{label:"Image URL",placeholder:"Enter image URL (optional)",value:R.image,onChange:w=>k("image",w.target.value),classNames:{input:"urbana-input"}}),e.jsx(Ae,{label:"Description",placeholder:"Enter range description",value:R.description,onChange:w=>k("description",w.target.value),errorMessage:L.description,isInvalid:!!L.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Tags"}),e.jsx(Lt,{tags:R.tags,onTagsChange:w=>k("tags",w)})]})]})}),e.jsxs(qe,{children:[e.jsx(U,{variant:"light",onPress:N,children:"Cancel"}),e.jsxs(U,{color:"primary",onPress:T,children:[j?"Update":"Add"," Range"]})]})]})})})]})},Us=({range:s,onEdit:a,onDelete:t})=>{const{getProductsForRange:r,updateProductRange:n}=we(),i=r(s.id).length,c=()=>{n(s.id,{active:typeof s.active>"u"?!1:!s.active})};return e.jsxs(ae,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.image?e.jsx(qs,{src:s.image,alt:s.name,width:40,height:40,className:"rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:grid-3x3",width:20,className:"text-secondary-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:s.name}),typeof s.active<"u"&&!s.active&&e.jsx(se,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),e.jsxs(se,{size:"sm",variant:"flat",color:"secondary",children:[i," product",i!==1?"s":""]})]})]}),e.jsxs(We,{children:[e.jsx(Je,{children:e.jsx(U,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(o,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(He,{"aria-label":"Range Actions",children:[e.jsx(ve,{startContent:e.jsx(o,{icon:"lucide:edit",width:16}),onPress:()=>a(s),children:"Edit"},"edit"),e.jsx(ve,{startContent:e.jsx(o,{icon:typeof s.active<"u"&&!s.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:c,children:typeof s.active<"u"&&!s.active?"Activate":"Deactivate"},"toggle-active"),e.jsx(ve,{className:"text-danger",color:"danger",startContent:e.jsx(o,{icon:"lucide:trash",width:16}),onPress:()=>t(s.id),children:"Delete"},"delete")]})]})]})}),e.jsxs(re,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:s.description}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map(h=>e.jsx(se,{size:"sm",variant:"flat",color:"default",children:h},h))})]})]})},et=({imagePath:s,productCode:a,className:t="",alt:r="Product image",onClick:n})=>{var y,R;const[i,c]=G.useState(""),[h,p]=G.useState(!0),[u,d]=G.useState(""),[m,x]=G.useState(""),j=window.urbanaDebugMode||((y=window.urbanaAdmin)==null?void 0:y.debugMode)||((R=window.urbanaPublic)==null?void 0:R.debugMode)||!1;return G.useEffect(()=>{s&&(async()=>{var _,H;try{p(!0),d(""),x("");const L=((_=window.urbanaAdmin)==null?void 0:_.nonce)||((H=window.urbanaPublic)==null?void 0:H.nonce)||"";j&&console.log(`[SecureImage] Fetching: ${s}`,{productCode:a,nonce:L?"present":"missing",debugMode:j});const Q=await fetch("/wp-json/urbana/v1/image-proxy",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":L},body:JSON.stringify({image_path:s})});if(!Q.ok)throw new Error(`HTTP ${Q.status}: ${Q.statusText}`);const z=await Q.json();if(j&&console.log(`[SecureImage] Response for ${s}:`,{method:z.method,success:z.success,hasImageUrl:!!z.image_url,hasImageData:!!z.image_data,error:z.error,message:z.message}),z.success)if(z.method==="presigned_url"&&z.image_url)j&&console.log("✅ Using presigned URL method (instant loading from DO)"),x("presigned_url"),c(z.image_url);else if(z.method==="base64_fallback"&&z.image_data)j&&console.log("⚠️ Using base64 fallback method (slower, full data transfer)"),x("base64_fallback"),c(z.image_data);else if(z.image_data)j&&console.log("⚠️ Using legacy base64 format"),x("base64_legacy"),c(z.image_data);else if(z.imageData)j&&console.log("⚠️ Using legacy imageData format"),x("imageData_legacy"),c(z.imageData);else throw j&&console.error("No image URL or data received from server"),new Error("No image URL or data received");else if(z.use_svg_icon)j&&console.warn("Server requested SVG icon fallback:",z.error),x("svg_fallback"),d("Failed to load image - using SVG icon instead");else throw new Error(z.error||z.message||"Failed to get image")}catch(L){j&&console.error(`[SecureImage] Fetch error for ${s}:`,L.message,L),d(L.message)}finally{p(!1)}})()},[s,a]),h?e.jsx("div",{className:`${t} bg-gray-100 animate-pulse flex items-center justify-center`,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-gray-400",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}):u||!i?e.jsxs("div",{className:`${t} bg-orange-100 border-2 border-orange-300 flex items-center justify-center relative group`,title:u||"Image failed to load",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-orange-600",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),j&&u&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:[u.substring(0,50),"..."]})]}):e.jsxs("div",{className:"relative group h-full",children:[e.jsx("img",{src:i,alt:r,className:t,onClick:q=>{window.urbanaDebugMode&&console.log("[DataBuilder SecureImage] image clicked",s),n&&n(q)},title:j&&m?`Loaded via: ${m}`:"",onError:()=>{d("Image load failed")}}),j&&m&&e.jsx("div",{className:"absolute top-0 left-0 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded opacity-70 group-hover:opacity-100 transition-opacity font-semibold",title:`Method: ${m}`,children:m==="presigned_url"?"🔗 URL":m==="base64_fallback"?"📦 B64":"⚠️"})]})},Mt=({files:s,onFilesChange:a,productCode:t,category:r,range:n})=>{const[i,c]=oe.useState(""),[h,p]=oe.useState(""),u=G.useCallback(()=>{i.trim()&&h.trim()&&(a({...s,[i.trim()]:h.trim()}),c(""),p(""))},[i,h,s,a]),d=G.useCallback(j=>{const y={...s};delete y[j],a(y)},[s,a]),m=G.useCallback(()=>{var y;if(!((y=window.wp)!=null&&y.media)){console.error("WordPress media library not available");return}const j=window.wp.media({title:"Select Files",button:{text:"Add to Product"},multiple:!0});j.on("select",()=>{const R=j.state().get("selection").toJSON(),q={...s};R.forEach(_=>{const H=_.filename||_.title;q[H]=_.url}),a(q)}),j.open()},[s,a]);G.useCallback(async()=>{var y;if(!t||!r||!n){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch files from the plugin folder and update the current file list. Continue?"))try{const R=await fetch("/wp-json/urbana/v1/fetch-product-files",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((y=window.urbanaAdmin)==null?void 0:y.nonce)||""},body:JSON.stringify({productCode:t.toLowerCase(),category:r.toLowerCase(),range:n.toLowerCase().replace(/\s+/g,"-")})});if(!R.ok)throw new Error(`Failed to fetch files: ${R.status}`);const q=await R.json();q.success&&q.files?a(q.files):console.warn("No files found in folder or fetch failed")}catch(R){console.error("Error fetching files from folder:",R)}},[t,r,n,a]);const x=j=>{var R;switch((R=j.split(".").pop())==null?void 0:R.toLowerCase()){case"pdf":return"lucide:file-text";case"dwg":case"dxf":return"lucide:compass";case"rvt":return"lucide:building";case"doc":case"docx":return"lucide:file-type";case"xls":case"xlsx":return"lucide:sheet";default:return"lucide:file"}};return e.jsxs(ae,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Product Files"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(U,{size:"sm",color:"primary",variant:"flat",onPress:m,startContent:e.jsx(o,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),e.jsxs(re,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(be,{placeholder:"File name",value:i,onChange:j=>c(j.target.value),size:"sm",classNames:{input:"urbana-input"}}),e.jsx(be,{placeholder:"File URL or path",value:h,onChange:j=>p(j.target.value),size:"sm",classNames:{input:"urbana-input"}}),e.jsx(U,{size:"sm",color:"primary",onPress:u,isDisabled:!i.trim()||!h.trim(),children:"Add"})]})}),Object.entries(s).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(as,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm font-medium",children:["Files (",Object.entries(s).length,")"]})}),Object.entries(s).map(([j,y])=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-default-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{icon:x(y),width:20,className:"text-primary-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:j}),e.jsx("p",{className:"text-xs text-foreground-500 truncate",children:y})]})]}),e.jsxs(We,{children:[e.jsx(Je,{children:e.jsx(U,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(o,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(He,{children:[e.jsx(ve,{startContent:e.jsx(o,{icon:"lucide:external-link",width:16}),onPress:()=>window.open(y,"_blank"),children:"View File"},"view"),e.jsx(ve,{className:"text-danger",color:"danger",startContent:e.jsx(o,{icon:"lucide:trash",width:16}),onPress:()=>d(j),children:"Remove"},"remove")]})]})]},j))]})]})]})]})},Bt=({imageGallery:s,onImageGalleryChange:a,productCode:t,category:r,range:n})=>{const i=G.useCallback((u,d)=>{const m=[...s];m[u]=d,a(m)},[s,a]),c=G.useCallback(u=>{const d=s.filter((m,x)=>x!==u);a(d)},[s,a]),h=G.useCallback(()=>{a([...s,""])},[s,a]),p=G.useCallback(()=>{var d;if(!((d=window.wp)!=null&&d.media)){console.error("WordPress media library not available");return}const u=window.wp.media({title:"Select Images",button:{text:"Add to Gallery"},multiple:!0,library:{type:"image"}});u.on("select",()=>{const x=u.state().get("selection").toJSON().map(j=>j.url);a([...s,...x])}),u.open()},[s,a]);return G.useCallback(async()=>{var d;if(!t||!r||!n){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch images from the plugin folder and update the current gallery. Continue?"))try{const m=await fetch("/wp-json/urbana/v1/fetch-product-images",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((d=window.urbanaAdmin)==null?void 0:d.nonce)||""},body:JSON.stringify({productCode:t.toLowerCase(),category:r.toLowerCase(),range:n.toLowerCase().replace(/\s+/g,"-")})});if(!m.ok)throw new Error(`Failed to fetch images: ${m.status}`);const x=await m.json();x.success&&x.images?a(x.images):console.warn("No images found in folder or fetch failed")}catch(m){console.error("Error fetching images from folder:",m)}},[t,r,n,a]),e.jsxs(ae,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Image Gallery"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(U,{size:"sm",color:"primary",variant:"flat",onPress:p,startContent:e.jsx(o,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),e.jsxs(re,{className:"space-y-4",children:[s.length>0&&e.jsx("div",{className:"flex flex-wrap justify-center items-start gap-4",children:s.map((u,d)=>e.jsxs("div",{className:"relative group h-full w-40 sm:w-48 md:w-56 lg:w-64 flex flex-col items-stretch",children:[e.jsxs("div",{className:"aspect-[4/3] rounded-lg overflow-hidden border-2 border-default-200",children:[u?e.jsx(et,{imagePath:u,productCode:t||"unknown",alt:`Gallery image ${d+1}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-default-100 flex items-center justify-center",children:e.jsx(o,{icon:"lucide:image-plus",width:32,className:"text-default-400"})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs(We,{children:[e.jsx(Je,{children:e.jsx(U,{isIconOnly:!0,size:"sm",variant:"solid",color:"default",className:"bg-black/50 text-white",children:e.jsx(o,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(He,{children:[e.jsx(ve,{startContent:e.jsx(o,{icon:"lucide:edit",width:16}),onPress:()=>{const m=prompt("Enter image URL:",u);m!==null&&i(d,m)},children:"Edit URL"},"edit"),e.jsx(ve,{className:"text-danger",color:"danger",startContent:e.jsx(o,{icon:"lucide:trash",width:16}),onPress:()=>c(d),children:"Remove"},"remove")]})]})})]}),e.jsx(be,{placeholder:"Image URL",value:u,onChange:m=>i(d,m.target.value),size:"sm",className:"mt-2",classNames:{input:"urbana-input"}})]},d))}),e.jsx(as,{}),e.jsx("div",{className:"flex justify-center",children:e.jsx(U,{variant:"dashed",onPress:h,startContent:e.jsx(o,{icon:"lucide:plus",width:16}),className:"w-full",children:"Add Image"})})]})]})},qt=({specifications:s,onSpecificationsChange:a})=>{const[t,r]=oe.useState(""),n=G.useCallback(()=>{t.trim()&&!s.includes(t.trim())&&(a([...s,t.trim()]),r(""))},[t,s,a]),i=G.useCallback(h=>{a(s.filter(p=>p!==h))},[s,a]),c=G.useCallback(h=>{h.key==="Enter"&&n()},[n]);return e.jsxs(ae,{children:[e.jsx(xe,{className:"pb-3",children:e.jsx("h4",{className:"text-md font-semibold",children:"Product Specifications"})}),e.jsxs(re,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(be,{placeholder:"Add specification (e.g., Dimensions: 3.0m x 3.0m)",value:t,onChange:h=>r(h.target.value),onKeyPress:c,size:"sm",classNames:{input:"urbana-input"},className:"flex-1"}),e.jsx(U,{size:"sm",color:"primary",onPress:n,isDisabled:!t.trim()||s.includes(t.trim()),startContent:e.jsx(o,{icon:"lucide:plus",width:16}),children:"Add"})]}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm font-medium",children:["Specifications (",s.length,")"]})}),e.jsx("div",{className:"space-y-2",children:s.map((h,p)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-default-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-primary-600",children:p+1})}),e.jsx("span",{className:"text-sm flex-1",children:h})]}),e.jsx(U,{size:"sm",variant:"light",color:"danger",onPress:()=>i(h),startContent:e.jsx(o,{icon:"lucide:x",width:14}),children:"Remove"})]},p))})]})]})]})},Wt=({options:s,onOptionsChange:a})=>{const t=G.useMemo(()=>Object.keys(s).sort(),[s]),r=G.useCallback(()=>{const d=prompt("Enter option group name (e.g., Color Scheme, Post Material):");if(!d||!d.trim())return;const m=d.trim();if(s[m]){alert("An option group with this name already exists");return}a({...s,[m]:[]})},[s,a]),n=G.useCallback(d=>{if(!confirm(`Remove the entire "${d}" option group?`))return;const m={...s};delete m[d],a(m)},[s,a]),i=G.useCallback(d=>{const m=prompt("Enter new name for option group:",d);if(!m||!m.trim()||m.trim()===d)return;const x=m.trim();if(s[x]){alert("An option group with this name already exists");return}const j={...s};j[x]=j[d],delete j[d],a(j)},[s,a]),c=G.useCallback(d=>{const m=prompt("Enter option value:");if(!m||!m.trim())return;const x=m.trim();if(s[d].some(y=>y.value===x)){alert("This option value already exists in this group");return}const j={...s};j[d]=[...j[d],{value:x}],a(j)},[s,a]),h=G.useCallback((d,m)=>{const x={...s};x[d]=x[d].filter((j,y)=>y!==m),a(x)},[s,a]),p=G.useCallback((d,m,x,j)=>{const y={...s};y[d]=[...y[d]],y[d][m]={...y[d][m],[x]:j},a(y)},[s,a]),u=G.useCallback((d,m)=>{var j;if(!((j=window.wp)!=null&&j.media)){console.error("WordPress media library not available");return}const x=window.wp.media({title:"Select Option Image",button:{text:"Use Image"},multiple:!1,library:{type:"image"}});x.on("select",()=>{const y=x.state().get("selection").first().toJSON();p(d,m,"imageUrl",y.url)}),x.open()},[p]);return e.jsxs(ae,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold",children:"Product Options"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Configure product options with associated images"})]}),e.jsx(U,{size:"sm",color:"primary",variant:"flat",onPress:r,startContent:e.jsx(o,{icon:"lucide:plus",width:16}),children:"Add Option Group"})]})}),e.jsx(re,{className:"space-y-4",children:t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{icon:"lucide:settings",width:48,className:"text-foreground-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"No option groups yet. Add one to get started."})]}):e.jsx(ys,{variant:"bordered",selectionMode:"multiple",children:t.map(d=>{const m=s[d]||[];return e.jsx(Ns,{"aria-label":d,title:e.jsxs("div",{className:"flex items-center justify-between w-full pr-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:tag",width:18,className:"text-primary"}),e.jsx("span",{className:"font-semibold",children:d}),e.jsx(se,{size:"sm",variant:"flat",color:"primary",children:m.length})]}),e.jsxs("div",{className:"flex gap-1",onClick:x=>x.stopPropagation(),children:[e.jsx(U,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>i(d),title:"Rename group",children:e.jsx(o,{icon:"lucide:edit-3",width:14})}),e.jsx(U,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>n(d),title:"Remove group",children:e.jsx(o,{icon:"lucide:trash",width:14})})]})]}),children:e.jsxs("div",{className:"space-y-4 pt-2",children:[m.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map((x,j)=>e.jsx("div",{className:"border border-default-200 rounded-lg p-3 space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:x.imageUrl?e.jsxs("div",{className:"relative group w-20 h-20 rounded-lg overflow-hidden border-2 border-default-200",children:[e.jsx(qs,{src:x.imageUrl,alt:x.value,className:"w-full h-full object-cover",fallback:e.jsx("div",{className:"w-full h-full bg-default-100 flex items-center justify-center",children:e.jsx(o,{icon:"lucide:image",width:24,className:"text-default-400"})})}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-1",children:[e.jsx(U,{isIconOnly:!0,size:"sm",variant:"solid",color:"primary",onPress:()=>u(d,j),title:"Change image",children:e.jsx(o,{icon:"lucide:image",width:14})}),e.jsx(U,{isIconOnly:!0,size:"sm",variant:"solid",color:"danger",onPress:()=>p(d,j,"imageUrl",""),title:"Remove image",children:e.jsx(o,{icon:"lucide:x",width:14})})]})]}):e.jsx(U,{className:"w-20 h-20",variant:"bordered",onPress:()=>u(d,j),children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-1",children:[e.jsx(o,{icon:"lucide:image-plus",width:20,className:"text-default-400"}),e.jsx("span",{className:"text-xs",children:"Add Image"})]})})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(be,{placeholder:"Option value",value:x.value,onChange:y=>p(d,j,"value",y.target.value),size:"sm",classNames:{input:"urbana-input"},endContent:e.jsx(U,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>h(d,j),title:"Remove option",children:e.jsx(o,{icon:"lucide:trash-2",width:14})})}),e.jsx(be,{placeholder:"Image URL (optional)",value:x.imageUrl||"",onChange:y=>p(d,j,"imageUrl",y.target.value),size:"sm",classNames:{input:"urbana-input"},startContent:e.jsx(o,{icon:"lucide:link",width:14,className:"text-default-400"})})]})]})},j))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-foreground-500",children:"No options in this group yet"})}),e.jsx(as,{}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(U,{variant:"dashed",onPress:()=>c(d),startContent:e.jsx(o,{icon:"lucide:plus",width:16}),className:"w-full",children:["Add Option to ",d]})})]})},d)})})})]})};class Oe{static generateAssetStructure(a,t,r,n){const i=[];return r.forEach(c=>{var R,q;const h=(R=Object.entries(n.rangeToProducts).find(([_,H])=>H.includes(c.id)))==null?void 0:R[0];if(!h)return;const p=t.find(_=>_.id===h);if(!p)return;const u=(q=Object.entries(n.groupToRanges).find(([_,H])=>H.includes(h)))==null?void 0:q[0];if(!u)return;const d=a.find(_=>_.id===u);if(!d)return;const m=this.sanitizePathSegment(d.name),x=this.sanitizePathSegment(p.name),j=this.sanitizePathSegment(c.code),y={category:d.name.toLowerCase(),range:p.name.toLowerCase().replace(/\s+/g,"-"),productCode:c.code.toLowerCase(),paths:{imagesPath:`${this.baseAssetsPath}/${m}/${x}/${j}/images`,downloadsPath:`${this.baseAssetsPath}/${m}/${x}/${j}/downloads`,fullImagePath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${m}/${x}/${j}/images`,fullDownloadPath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${m}/${x}/${j}/downloads`}};i.push(y)}),i}static sanitizePathSegment(a){let t=a.replace(/[^a-zA-Z0-9\s\-_]/g," ");return t=t.replace(/\s+/g," "),t.toLowerCase().trim()}static async generateFoldersAPI(a){var t;try{const r=await fetch("/wp-json/urbana/v1/generate-asset-folders",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({structures:a.map(i=>({category:i.category,range:i.range,productCode:i.productCode,imagesPath:i.paths.imagesPath,downloadsPath:i.paths.downloadsPath}))})});if(!r.ok)throw new Error(`Failed to generate folders: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error generating folders:",r),r}}static async debugPaths(){var a;try{const t=await fetch("/wp-json/urbana/v1/debug-paths",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Failed to get debug info: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting debug info:",t),t}}static generateFolderPreview(a){const t=[];return a.forEach(r=>{t.push(r.paths.imagesPath),t.push(r.paths.downloadsPath)}),[...new Set(t)].sort()}static updateProductPaths(a,t){return a.map(r=>{const n=t.find(h=>h.productCode===r.code.toLowerCase());if(!n)return r;const i=r.imageGallery.length>0?r.imageGallery.map((h,p)=>!h||h.includes("shelter/")||h.includes("toilet/")||h.includes("bridge/")||h.includes("access/")?`${n.paths.imagesPath}/image-${p+1}.jpg`:h):[`${n.paths.imagesPath}/hero-image.jpg`],c={};return Object.entries(r.files).forEach(([h,p])=>{p.includes("/")?c[h]=p:c[h]=`${n.paths.downloadsPath}/${p}`}),{...r,imageGallery:i,files:c}})}static async fetchAndUpdateAllProductAssets(a,t,r,n,i,c){var p;if(this.generateAssetStructure(a,t,r,n).length===0)return{success:!1,updatedCount:0,message:"No products found with proper group/range relationships."};try{const u=await fetch("/wp-json/urbana/v1/fetch-all-product-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((p=window.urbanaAdmin)==null?void 0:p.nonce)||""},body:JSON.stringify({stepperID:c||1})});if(!u.ok)throw new Error(`Failed to fetch assets: ${u.status}`);const d=await u.json();if(d.success){let m=0;return Object.entries(d.productAssets).forEach(([x,j])=>{const y=r.find(R=>R.code===x);y?(i(y.id,{imageGallery:j.images||[],files:j.files||{}}),m++):console.warn("Product not found for code:",x)}),{success:!0,updatedCount:m,message:`Successfully updated ${m} products with their assets.`}}else return{success:!1,updatedCount:0,message:"Failed to fetch assets: "+d.message}}catch(u){throw console.error("Error fetching all product assets:",u),u}}static async testDigitalOceanConnection(){var a;try{const t=await fetch("/wp-json/urbana/v1/digital-ocean/test-connection",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Connection test failed: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error testing Digital Ocean connection:",t),t}}static async fetchDigitalOceanAssets(a=""){var t;try{const r=await fetch("/wp-json/urbana/v1/digital-ocean/fetch-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({prefix:a})});if(!r.ok)throw new Error(`Failed to fetch assets: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error fetching Digital Ocean assets:",r),r}}static async fetchDigitalOceanAssetsForProducts(a,t,r,n,i){try{const c=[];if(a.forEach(d=>{var L,Q;const m=n.find(z=>z.code.toLowerCase()===d.toLowerCase());if(!m)return;const x=(L=Object.entries(i.rangeToProducts).find(([z,O])=>O.includes(m.id)))==null?void 0:L[0];if(!x)return;const j=r.find(z=>z.id===x);if(!j)return;const y=(Q=Object.entries(i.groupToRanges).find(([z,O])=>O.includes(x)))==null?void 0:Q[0];if(!y)return;const R=t.find(z=>z.id===y);if(!R)return;const q=this.sanitizePathSegment(R.name),_=this.sanitizePathSegment(j.name),H=this.sanitizePathSegment(m.code);c.push(`${q}/${_}/${H}`)}),c.length===0)throw new Error("No valid products found to sync");const h=this.findCommonPrefix(c),p=await this.fetchDigitalOceanAssets("");if(!p.success)return p;const u=this.filterStructuredDataByProducts(p.structured_data,a,t,r,n,i);return{...p,structured_data:u}}catch(c){throw console.error("Error fetching Digital Ocean assets for products:",c),c}}static findCommonPrefix(a){if(a.length===0)return"";if(a.length===1)return a[0];const t=a.map(i=>i.split("/")),r=[],n=Math.min(...t.map(i=>i.length));for(let i=0;i<n;i++){const c=t[0][i];if(t.every(h=>h[i]===c))r.push(c);else break}return r.length>0?r.join("/")+"/":""}static filterStructuredDataByProducts(a,t,r,n,i,c){const h={},p=new Map;return t.forEach(u=>{var R,q;const d=i.find(_=>_.code.toLowerCase()===u.toLowerCase());if(!d)return;const m=(R=Object.entries(c.rangeToProducts).find(([_,H])=>H.includes(d.id)))==null?void 0:R[0];if(!m)return;const x=n.find(_=>_.id===m);if(!x)return;const j=(q=Object.entries(c.groupToRanges).find(([_,H])=>H.includes(m)))==null?void 0:q[0];if(!j)return;const y=r.find(_=>_.id===j);y&&p.set(u.toLowerCase(),{category:y.name,range:x.name,productCode:u})}),Object.entries(a).forEach(([u,d])=>{Object.entries(d).forEach(([m,x])=>{Object.entries(x).forEach(([j,y])=>{const R=j.toLowerCase();for(const[q,_]of p.entries())if(q===R){const H=u.toLowerCase().includes(_.category.toLowerCase())||_.category.toLowerCase().includes(u.toLowerCase()),L=m.toLowerCase().replace(/[\s-_]/g,"")===_.range.toLowerCase().replace(/[\s-_]/g,"");H&&L&&(h[u]||(h[u]={}),h[u][m]||(h[u][m]={}),h[u][m][j]=y);break}})})}),h}static async getDigitalOceanConfig(){var a;try{const t=await fetch("/wp-json/urbana/v1/digital-ocean/config",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Failed to get config: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting Digital Ocean config:",t),t}}static updateProductPathsFromDigitalOcean(a,t,r,n,i){return a.map(c=>{var _,H;const h=(_=Object.entries(i.rangeToProducts).find(([L,Q])=>Q.includes(c.id)))==null?void 0:_[0];if(!h)return console.warn(`No range found for product: ${c.code}`),c;const p=n.find(L=>L.id===h);if(!p)return console.warn(`Range not found for rangeId: ${h}`),c;const u=(H=Object.entries(i.groupToRanges).find(([L,Q])=>Q.includes(h)))==null?void 0:H[0];if(!u)return console.warn(`No group found for range: ${p.name}`),c;const d=r.find(L=>L.id===u);if(!d)return console.warn(`Group not found for groupId: ${u}`),c;let m=null,x=null,j=null;for(const[L,Q]of Object.entries(t)){if(typeof Q=="object"&&!Array.isArray(Q)&&(L.toLowerCase().includes(d.name.toLowerCase())||d.name.toLowerCase().includes(L.toLowerCase())))for(const[z,O]of Object.entries(Q)){if(typeof O=="object"&&!Array.isArray(O)&&z.toLowerCase().replace(/[\s-_]/g,"")===p.name.toLowerCase().replace(/[\s-_]/g,"")){for(const[k,v]of Object.entries(O))if(k.toLowerCase()===c.code.toLowerCase()){m=v,x=L,j=z;break}}if(m)break}if(m)break}if(!m)return console.warn(`No Digital Ocean data found for product: ${c.code} (Group: ${d.name}, Range: ${p.name})`),c;console.log(`Found match for ${c.code}:`,{category:x,range:j,images:m.images.length,downloads:m.downloads.length,optionGroups:m.img_conf?Object.keys(m.img_conf).length:0});const y=m.images.map(L=>L.url),R={};m.downloads.forEach(L=>{const Q=this.generateFileDisplayNameFromFilename(L.filename);R[Q]=L.url});const q={};return m.img_conf&&Object.entries(m.img_conf).forEach(([L,Q])=>{q[L]=Object.entries(Q).map(([z,O])=>({value:z,imageUrl:O.url})),q[L].sort((z,O)=>z.value.localeCompare(O.value))}),{...c,imageGallery:y.length>0?y:c.imageGallery,files:Object.keys(R).length>0?R:c.files,options:Object.keys(q).length>0?q:c.options}})}static generateFileDisplayNameFromFilename(a){var i;const t=a.replace(/\.[^/.]+$/,""),r=((i=a.split(".").pop())==null?void 0:i.toLowerCase())||"",n=t.replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");switch(r){case"pdf":return/spec/i.test(t)?"PDF Specification":/install/i.test(t)?"Installation Guide":/manual/i.test(t)?"User Manual":`${n} (PDF)`;case"dwg":return"CAD Drawing";case"rvt":return"Revit Model";case"doc":case"docx":return`${n} (Document)`;default:return n}}static buildCompleteStructureFromDigitalOcean(a){const t=[],r=[],n=[],i={groupToRanges:{},rangeToProducts:{}};return Object.entries(a).forEach(([c,h])=>{const p=this.sanitizePathSegment(c);t.push({id:p,name:c,icon:this.getDefaultIconForGroup(c),description:this.getDescriptionForGroup(c)}),i.groupToRanges[p]=[],Object.entries(h).forEach(([u,d])=>{const m=this.sanitizePathSegment(u);r.push({id:m,name:u,image:"",description:this.getDescriptionForRange(u),tags:this.getTagsForRange(u)}),i.groupToRanges[p].push(m),i.rangeToProducts[m]=[],Object.entries(d).forEach(([x,j])=>{const y=this.sanitizePathSegment(x),R={};j.img_conf&&Object.entries(j.img_conf).forEach(([q,_])=>{R[q]=Object.entries(_).map(([H,L])=>({value:H,imageUrl:L.url}))}),n.push({id:y,code:x,name:this.generateProductName(x),overview:`Overview for ${x}`,description:`Detailed description for ${x}`,specifications:[],imageGallery:j.images.map(q=>q.url),files:j.downloads.reduce((q,_)=>{const H=this.generateFileDisplayNameFromFilename(_.filename);return q[H]=_.url,q},{}),options:Object.keys(R).length>0?R:void 0}),i.rangeToProducts[m].push(y)})})}),{productGroups:t,productRanges:r,products:n,relationships:i}}static getDefaultIconForGroup(a){const t=a.toLowerCase();return t.includes("shelter")?"lucide:home":t.includes("toilet")?"lucide:door-open":t.includes("access")?"lucide:key":t.includes("config")?"lucide:settings":"lucide:package"}static getDescriptionForGroup(a){return`${a} product category`}static getDescriptionForRange(a){return`${a} product range`}static getTagsForRange(a){return[a.toLowerCase()]}static generateProductName(a){return a.toUpperCase()}}Cs(Oe,"baseAssetsPath","assets/products");const Jt=({stepperID:s})=>{const{products:a,productRanges:t,productGroups:r,addProduct:n,updateProduct:i,removeProduct:c,linkProductToRange:h,unlinkProductFromRange:p,relationships:u,productData:d}=we(),{isOpen:m,onOpen:x,onOpenChange:j,onClose:y}=Ge(),[R,q]=oe.useState(null),[_,H]=oe.useState({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{},options:void 0,faqs:[],active:!0}),[L,Q]=oe.useState({}),[z,O]=oe.useState(new Set),[b,k]=oe.useState(new Set),[v,f]=oe.useState(!1),[T,V]=oe.useState({}),E=G.useMemo(()=>{var W,K;if(!R)return null;const g=(W=Object.entries(u.rangeToProducts).find(([F,$])=>$.includes(R.id)))==null?void 0:W[0];if(!g)return null;const P=t.find(F=>F.id===g);if(!P)return null;const D=(K=Object.entries(u.groupToRanges).find(([F,$])=>$.includes(g)))==null?void 0:K[0];if(!D)return null;const X=r.find(F=>F.id===D);return X?{category:X.name,range:P.name,productCode:R.code}:null},[R,u,t,r]);G.useCallback(async()=>{if(confirm("This will fetch images and files from plugin folders for ALL products and update their data. This action cannot be undone. Continue?"))try{const P=await Oe.fetchAndUpdateAllProductAssets(r,t,a,u,i,s??void 0);fe({color:P.success?"success":P.updatedCount===0?"warning":"danger",title:P.message})}catch(P){console.error("Error fetching all product assets:",P),fe({color:"danger",title:"Error fetching assets. Please check console for details."})}},[i]);const l=G.useCallback(()=>{q(null),H({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{},options:void 0,active:!0}),Q({}),O(new Set),V({}),x()},[x]),C=G.useCallback(g=>{q(g),H({code:g.code,name:g.name,overview:g.overview,description:g.description,specifications:[...g.specifications],imageGallery:[...g.imageGallery],files:{...g.files},faqs:g.faqs||[],options:g.options,active:g.active}),Q(g.options||{});const P=new Set;Object.entries(u.rangeToProducts).forEach(([D,X])=>{X.includes(g.id)&&P.add(D)}),O(P),V({}),x()},[u.rangeToProducts,x]),I=G.useCallback(g=>{confirm("Are you sure you want to delete this product?")&&c(g)},[c]),B=G.useCallback((g,P)=>{if(H(D=>({...D,[g]:P})),g==="name"&&!_.code&&typeof P=="string"){const D=P.toUpperCase().replace(/\s+/g,"-").replace(/[^A-Z0-9-]/g,"");H(X=>({...X,code:D}))}T[g]&&V(D=>({...D,[g]:""}))},[_.code,T]),Z=G.useCallback(()=>{const g={};return _.code.trim()||(g.code="Product code is required"),a.some(D=>D.code.toLowerCase()===_.code.toLowerCase()&&(!R||D.id!==R.id))&&(g.code="A product with this code already exists"),_.name.trim()||(g.name="Product name is required"),_.overview.trim()||(g.overview="Product overview is required"),_.description.trim()||(g.description="Product description is required"),z.size===0&&(g.ranges="Please select at least one product range"),V(g),Object.keys(g).length===0},[_,a,R,z]),ne=async(g,P,D,X)=>{var W,K;try{const F=`${X}/${D}/${g}`,$=`${X}/${D}/${P}`,de=((W=window.urbanaAdmin)==null?void 0:W.apiUrl)||"/wp-json/urbana/v1/",pe=await fetch(`${de}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((K=window.urbanaAdmin)==null?void 0:K.nonce)||""},body:JSON.stringify({old_path:F,new_path:$})});if(!pe.ok)throw new Error(`HTTP error! status: ${pe.status}`);const je=await pe.json();if(!je.success)throw new Error(je.message||"Failed to rename folder");return!0}catch(F){throw console.error("Failed to rename folder in Digital Ocean:",F),F}},ce=G.useCallback(async()=>{var X,W;if(!Z())return;let g=!1,P=null,D=null;if(R){if(g=R.code!==_.code,P=R.code,g){const F=(X=Object.entries(u.rangeToProducts).find(([$,de])=>de.includes(R.id)))==null?void 0:X[0];if(F){const $=t.find(de=>de.id===F);if($){const de=(W=Object.entries(u.groupToRanges).find(([pe,je])=>je.includes(F)))==null?void 0:W[0];if(de){const pe=r.find(je=>je.id===de);pe&&(D={rangeName:$.name,groupName:pe.name})}}}}i(R.id,{..._,options:Object.keys(L).length>0?L:void 0});const K=new Set(Object.entries(u.rangeToProducts).filter(([F,$])=>$.includes(R.id)).map(([F,$])=>F));K.forEach(F=>{z.has(F)||p(F,R.id)}),z.forEach(F=>{K.has(F)||h(F,R.id)})}else{const K={..._,options:Object.keys(L).length>0?L:void 0};n(K);const F=N(_.code);z.forEach($=>{h($,F)})}if(g&&P&&D&&confirm(`The product code has changed from "${P}" to "${_.code}".

Do you want to rename the folder in Digital Ocean as well?
This will move all contents from:
  ${D.groupName}/${D.rangeName}/${P}/
to:
  ${D.groupName}/${D.rangeName}/${_.code}/`))try{await ne(P,_.code,D.rangeName,D.groupName),alert(`✅ Successfully renamed folder in Digital Ocean from "${P}" to "${_.code}"`)}catch(F){alert(`❌ Failed to rename folder in Digital Ocean. Error: ${F instanceof Error?F.message:"Unknown error"}

The product has been updated in WordPress, but the Digital Ocean folder was not renamed.`)}y()},[Z,R,i,_,L,u.rangeToProducts,u.groupToRanges,p,n,z,h,t,r,y]),N=g=>g.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),w=G.useCallback(()=>{const g={},P=[];return a.forEach(D=>{let X=!1;Object.entries(u.rangeToProducts).forEach(([W,K])=>{if(K.includes(D.id)){const F=t.find($=>$.id===W);F&&(g[F.name]||(g[F.name]=[]),g[F.name].push(D),X=!0)}}),X||P.push(D)}),{grouped:g,ungrouped:P}},[a,u.rangeToProducts,t]),S=G.useCallback(g=>{k(P=>{const D=new Set(P);return D.has(g)?D.delete(g):D.add(g),D})},[]),A=G.useCallback(()=>{b.size===a.length?k(new Set):k(new Set(a.map(g=>g.id)))},[a,b.size]),M=G.useCallback(async()=>{if(b.size===0){fe({color:"warning",title:"No products selected",description:"Please select at least one product to sync"});return}if(confirm(`This will fetch and update assets from Digital Ocean for ${b.size} selected product(s). Continue?`)){f(!0);try{const P=a.filter(W=>b.has(W.id)),D=P.map(W=>W.code),X=await Oe.fetchDigitalOceanAssetsForProducts(D,r,t,a,u);if(X.success){const W=Oe.updateProductPathsFromDigitalOcean(P,X.structured_data,r,t,u);let K=0,F=0;W.forEach($=>{const de=a.find(pe=>pe.id===$.id);de&&(JSON.stringify(de.imageGallery)!==JSON.stringify($.imageGallery)||JSON.stringify(de.files)!==JSON.stringify($.files)||JSON.stringify(de.options)!==JSON.stringify($.options))&&(i($.id,{imageGallery:$.imageGallery,files:$.files,options:$.options}),K++)}),F=b.size-W.filter($=>$.imageGallery.length>0||Object.keys($.files).length>0).length,K>0?fe({color:"success",title:"Digital Ocean sync completed!",description:`Updated ${K} out of ${b.size} selected products${F>0?`. ${F} products had no assets found`:""}`}):F===b.size?fe({color:"warning",title:"No assets found",description:"No assets were found in Digital Ocean for the selected products"}):fe({color:"secondary",title:"No updates needed",description:"Selected products already have the latest assets"}),k(new Set)}else throw new Error(X.message)}catch(P){console.error("Error syncing with Digital Ocean:",P),fe({color:"danger",title:"Sync failed",description:P instanceof Error?P.message:"Unknown error occurred"})}finally{f(!1)}}},[b,a,r,t,u,i]),{grouped:Y,ungrouped:ee}=w(),[J,te]=oe.useState({grouped:{},ungrouped:[]}),le=oe.useCallback(async()=>{var g,P;try{const D=((g=window.urbanaAdmin)==null?void 0:g.apiUrl)||"/wp-json/urbana/v1/",X=await fetch(`${D}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((P=window.urbanaAdmin)==null?void 0:P.nonce)||""},body:JSON.stringify({type:"products"})});if(X.ok){const W=await X.json();console.log("[DO Sync] API /check-folders result:",W),W.success&&W.results&&te(K=>{console.log("[DO Sync] Previous syncItemsGrouped:",K);const F={...K.grouped},$=[...K.ungrouped];Object.keys(F).forEach(pe=>{F[pe]=F[pe].map(je=>{const Se=W.results.find(os=>os.id===je.id);return Se?console.log(`[DO Sync] Mapping item id: ${je.id}, exists:`,Se.exists):console.warn(`[DO Sync] No existence data for item id: ${je.id}`),{...je,exists:Se?Se.exists:!1}})}),$.forEach((pe,je)=>{const Se=W.results.find(os=>os.id===pe.id);Se?(console.log(`[DO Sync] Mapping ungrouped item id: ${pe.id}, exists:`,Se.exists),$[je]={...pe,exists:Se.exists}):console.warn(`[DO Sync] No existence data for ungrouped item id: ${pe.id}`)});const de={grouped:F,ungrouped:$};return console.log("[DO Sync] Updated syncItemsGrouped:",de),de})}else console.error("[DO Sync] check-folders returned HTTP",X.status),te(W=>{const K={...W.grouped},F=[...W.ungrouped];return Object.keys(K).forEach($=>{K[$]=K[$].map(de=>({...de,exists:!1}))}),F.forEach(($,de)=>{F[de]={...$,exists:!1}}),{grouped:K,ungrouped:F}})}catch(D){console.error("❌ Failed to check folder existence:",D)}},[]);oe.useEffect(()=>{const{grouped:g,ungrouped:P}=w(),D={};Object.entries(g).forEach(([W,K])=>{D[W]=K.map(F=>({id:F.id,name:F.name||F.code,type:"product",exists:void 0,checked:!1}))});const X=P.map(W=>({id:W.id,name:W.name||W.code,type:"product",exists:void 0,checked:!1}));te({grouped:D,ungrouped:X}),le()},[a,u,t]);const ie=(g,P)=>{te(D=>{const X={...D.grouped},W=[...D.ungrouped];Object.keys(X).forEach(F=>{X[F]=X[F].map($=>$.id===g?{...$,checked:P}:$)});const K=W.findIndex(F=>F.id===g);return K!==-1&&(W[K]={...W[K],checked:P}),{grouped:X,ungrouped:W}})},he=g=>{te(P=>{const D={...P.grouped},X=[...P.ungrouped];return Object.keys(D).forEach(W=>{D[W]=D[W].map(K=>({...K,checked:g}))}),X.forEach((W,K)=>{X[K]={...W,checked:g}}),{grouped:D,ungrouped:X}})},ge=async g=>{var P,D;try{const X=((P=window.urbanaAdmin)==null?void 0:P.apiUrl)||"/wp-json/urbana/v1/",W=await fetch(`${X}digital-ocean/create-product-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((D=window.urbanaAdmin)==null?void 0:D.nonce)||""},body:JSON.stringify({product_ids:g})});if(!W.ok)throw new Error(`HTTP error! status: ${W.status}`);const K=await W.json();if(!K.success)throw new Error(K.message||"Failed to create folders");te(F=>{const $={...F.grouped},de=[...F.ungrouped];return Object.keys($).forEach(pe=>{$[pe]=$[pe].map(je=>g.includes(je.id)?{...je,exists:!0,checked:!1}:je)}),de.forEach((pe,je)=>{g.includes(pe.id)&&(de[je]={...pe,exists:!0,checked:!1})}),{grouped:$,ungrouped:de}})}catch(X){throw X}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Products"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Manage individual products with detailed specifications"})]}),e.jsxs("div",{className:"flex gap-2",children:[a.length>0&&e.jsx(U,{color:"default",variant:"flat",size:"sm",onPress:A,startContent:e.jsx(o,{icon:b.size===a.length?"lucide:square-check":"lucide:square",width:16}),children:b.size===a.length?"Deselect All":"Select All"}),b.size>0&&e.jsx(U,{color:"secondary",variant:"flat",onPress:M,isLoading:v,startContent:v?void 0:e.jsx(o,{icon:"lucide:cloud-download",width:18}),children:v?"Syncing...":`Sync DO (${b.size})`}),e.jsx(U,{color:"primary",onPress:l,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),isDisabled:t.length===0,children:"Add Product"})]})]}),e.jsxs(Ce,{"aria-label":"Products Options",className:"mb-6",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:package",width:16}),e.jsx("span",{children:"Manage Products"})]}),children:e.jsx("div",{className:"mt-4",children:t.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Available"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"You need to create product ranges first before adding products"})]})]})})}):a.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:package",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Products Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product to get started"})]}),e.jsx(U,{color:"primary",onPress:l,startContent:e.jsx(o,{icon:"lucide:plus",width:18}),children:"Add Product"})]})})}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(Y).map(([g,P])=>{var K;const D=t.find(F=>F.name===g);let X=null,W=null;if(D){const F=(K=Object.entries(u.groupToRanges).find(([,de])=>de.includes(D.id)))==null?void 0:K[0],$=F?r.find(de=>de.id===F):null;$&&(X=$.name,W=$.icon)}return e.jsxs("div",{children:[X&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-primary",children:[W&&e.jsx(o,{icon:W,width:16}),e.jsx("span",{className:"text-sm font-medium",children:X})]}),e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:18}),g,e.jsxs(se,{size:"sm",variant:"flat",children:[P.length," product",P.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(F=>e.jsx(vs,{product:F,onEdit:C,onDelete:I,isSelected:b.has(F.id),onToggleSelect:S},F.id))})]},g)}),ee.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Products",e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[ee.length," product",ee.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ee.map(g=>e.jsx(vs,{product:g,onEdit:C,onDelete:I,isSelected:b.has(g.id),onToggleSelect:S},g.id))})]})]})})},"manage"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:16}),e.jsx("span",{children:"Digital Ocean Sync"})]}),children:e.jsx("div",{className:"mt-4",children:e.jsxs(ae,{className:"urbana-card",children:[e.jsxs(xe,{className:"flex gap-3",children:[e.jsx(o,{icon:"lucide:cloud-upload",width:24}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-md font-semibold",children:"Products - Digital Ocean Sync"}),e.jsx("p",{className:"text-small text-default-500",children:"Organize by ranges like the Manage Products tab"})]})]}),e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(U,{color:"primary",variant:"flat",size:"sm",onPress:()=>he(!0),startContent:e.jsx(o,{icon:"lucide:check-square",width:16}),children:"Select All"}),e.jsx(U,{color:"default",variant:"flat",size:"sm",onPress:()=>he(!1),startContent:e.jsx(o,{icon:"lucide:square",width:16}),children:"Clear All"}),e.jsx(U,{color:"primary",size:"sm",onPress:()=>{const g=[];Object.values(J.grouped).forEach(P=>{P.forEach(D=>{D.checked&&g.push(D.id)})}),J.ungrouped.forEach(P=>{P.checked&&g.push(P.id)}),ge(g)},isDisabled:(()=>{let g=!1;return Object.values(J.grouped).forEach(P=>{P.forEach(D=>{D.checked&&(g=!0)})}),J.ungrouped.forEach(P=>{P.checked&&(g=!0)}),!g})(),startContent:e.jsx(o,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),Object.keys(J.grouped).length===0&&J.ungrouped.length===0?e.jsxs("div",{className:"text-center py-8 text-foreground-500",children:[e.jsx(o,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No products available to sync"})]}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(J.grouped).map(([g,P])=>{var K;const D=t.find(F=>F.name===g),X=D?(K=Object.entries(u.groupToRanges).find(([,F])=>F.includes(D.id)))==null?void 0:K[0]:null,W=X?r.find(F=>F.id===X):null;return e.jsxs("div",{className:"space-y-3",children:[W&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{icon:W.icon,width:16,className:"text-default-500"}),e.jsx("span",{className:"text-sm text-default-500",children:W.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:18,className:"text-primary"}),e.jsx("h4",{className:"font-semibold text-lg text-primary",children:g}),e.jsxs(se,{size:"sm",variant:"flat",color:"primary",children:[P.length," product",P.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(F=>{const $=a.find(de=>de.id===F.id);return e.jsxs(ae,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${F.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>ie(F.id,!F.checked),children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:package",width:20,className:"text-secondary-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(_e,{isSelected:F.checked||!1,onValueChange:de=>{ie(F.id,de)},size:"sm",onClick:de=>de.stopPropagation()})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold",children:F.name}),$&&e.jsx("p",{className:"text-xs text-foreground-500",children:$.code})]})]}),e.jsx(se,{size:"sm",variant:"flat",color:F.exists===!0?"success":F.exists===!1?"warning":"default",startContent:F.exists===void 0?e.jsx(o,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):F.exists?e.jsx(o,{icon:"lucide:check-circle",width:14}):e.jsx(o,{icon:"lucide:alert-circle",width:14}),children:F.exists===void 0?"Checking...":F.exists?"Exists":"Missing"})]})}),$&&$.overview&&e.jsx(re,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600 line-clamp-2",children:$.overview})})]},F.id)})})]},g)}),J.ungrouped.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:18,className:"text-warning"}),e.jsx("h4",{className:"font-semibold text-lg text-warning",children:"Ungrouped Products"}),e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[J.ungrouped.length," product",J.ungrouped.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:J.ungrouped.map(g=>{const P=a.find(D=>D.id===g.id);return e.jsxs(ae,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${g.checked?"border-warning bg-warning/5":"border-transparent hover:border-warning/30"}`,isPressable:!0,onPress:()=>ie(g.id,!g.checked),children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:package",width:20,className:"text-warning-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(_e,{isSelected:g.checked||!1,onValueChange:D=>{ie(g.id,D)},size:"sm",onClick:D=>D.stopPropagation()})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold",children:g.name}),P&&e.jsx("p",{className:"text-xs text-foreground-500",children:P.code})]})]}),e.jsx(se,{size:"sm",variant:"flat",color:g.exists===!0?"success":g.exists===!1?"warning":"default",startContent:g.exists===void 0?e.jsx(o,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):g.exists?e.jsx(o,{icon:"lucide:check-circle",width:14}):e.jsx(o,{icon:"lucide:alert-circle",width:14}),children:g.exists===void 0?"Checking...":g.exists?"Exists":"Missing"})]})}),P&&P.overview&&e.jsx(re,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600 line-clamp-2",children:P.overview})})]},g.id)})})]})]}),(()=>{const g=Object.values(J.grouped).reduce((P,D)=>P+D.filter(X=>X.checked).length,0)+J.ungrouped.filter(P=>P.checked).length;return g===0?null:e.jsx("div",{className:"mt-4 bg-primary/10 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-primary font-medium",children:[g," product folder(s) will be created in Digital Ocean Spaces"]})})})()]})]})})},"sync")]}),e.jsx(Le,{isDismissable:!1,isKeyboardDismissDisabled:!0,isOpen:m,onOpenChange:j,size:"4xl",scrollBehavior:"inside",className:"urbana-modal",children:e.jsx(Ue,{children:g=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:R?"Edit Product":"Add Product"}),e.jsx(Be,{children:e.jsxs(Ce,{"aria-label":"Product Details",defaultSelectedKey:"basic",children:[e.jsx(me,{title:"Basic Info",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(be,{label:"Product Code",placeholder:"e.g., SH-PEN-001",value:_.code,onChange:P=>B("code",P.target.value),errorMessage:T.code,isInvalid:!!T.code,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsx(be,{label:"Product Name",placeholder:"Enter product name",value:_.name,onChange:P=>B("name",P.target.value),errorMessage:T.name,isInvalid:!!T.name,isRequired:!0,classNames:{input:"urbana-input"}})]}),e.jsx(Qe,{label:"Product Ranges",placeholder:"Select product ranges",selectionMode:"multiple",selectedKeys:z,onSelectionChange:P=>O(P),errorMessage:T.ranges,isInvalid:!!T.ranges,isRequired:!0,children:t.map(P=>e.jsx(Ze,{children:P.name},P.id))}),e.jsx(Ae,{label:"Overview",placeholder:"Brief product overview",value:_.overview,onChange:P=>B("overview",P.target.value),errorMessage:T.overview,isInvalid:!!T.overview,isRequired:!0,rows:2,classNames:{input:"urbana-input"}}),e.jsx(Ae,{label:"Description",placeholder:"Detailed product description",value:_.description,onChange:P=>B("description",P.target.value),errorMessage:T.description,isInvalid:!!T.description,isRequired:!0,rows:4,classNames:{input:"urbana-input"}})]})},"basic"),e.jsx(me,{title:"Specifications",children:e.jsx(qt,{specifications:_.specifications,onSpecificationsChange:P=>B("specifications",P)})},"specifications"),e.jsx(me,{title:"Images",children:e.jsx(Bt,{imageGallery:_.imageGallery,onImageGalleryChange:P=>B("imageGallery",P),productCode:(E==null?void 0:E.productCode)||_.code,category:E==null?void 0:E.category,range:E==null?void 0:E.range})},"images"),e.jsx(me,{title:"Files",children:e.jsx(Mt,{files:_.files,onFilesChange:P=>B("files",P),productCode:(E==null?void 0:E.productCode)||_.code,category:E==null?void 0:E.category,range:E==null?void 0:E.range})},"files"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Options"}),Object.keys(L).length>0&&e.jsx(se,{size:"sm",variant:"flat",children:Object.keys(L).length})]}),children:e.jsx(Wt,{options:L,onOptionsChange:Q})},"options"),e.jsx(me,{title:"FAQs",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-default-500",children:"Add frequently asked questions for this product. These will appear in the product details FAQ tab in the frontend."}),(_.faqs||[]).map((P,D)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-start",children:[e.jsx("input",{className:"col-span-12 urbana-input",placeholder:`Question ${D+1}`,value:P.question,onChange:X=>{const W=[..._.faqs||[]];W[D]={...W[D],question:X.target.value},B("faqs",W)}}),e.jsx("textarea",{className:"col-span-12 urbana-input",placeholder:`Answer ${D+1}`,rows:3,value:P.answer,onChange:X=>{const W=[..._.faqs||[]];W[D]={...W[D],answer:X.target.value},B("faqs",W)}}),e.jsx("div",{className:"col-span-12 flex justify-end",children:e.jsx(U,{variant:"light",color:"danger",onPress:()=>{const X=[..._.faqs||[]];X.splice(D,1),B("faqs",X)},children:"Remove"})})]},D)),e.jsx("div",{children:e.jsx(U,{onPress:()=>B("faqs",[..._.faqs||[],{question:"",answer:""}]),children:"Add FAQ"})})]})},"faqs")]})}),e.jsxs(qe,{children:[e.jsx(U,{variant:"light",onPress:g,children:"Cancel"}),e.jsxs(U,{color:"primary",onPress:ce,children:[R?"Update":"Add"," Product"]})]})]})})})]})},vs=oe.memo(({product:s,onEdit:a,onDelete:t,isSelected:r,onToggleSelect:n})=>{const{updateProduct:i}=we(),c=s.imageGallery.length>0&&s.imageGallery[0]&&s.imageGallery[0].trim()!=="",h=()=>{i(s.id,{active:typeof s.active>"u"?!1:!s.active})};return e.jsxs(ae,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(_e,{isSelected:r,onValueChange:()=>n(s.id),size:"sm"}),c?e.jsx("div",{className:"w-10 h-10 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx(et,{imagePath:s.imageGallery[0],productCode:s.code,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{icon:"lucide:package",width:20,className:"text-success-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[typeof s.active<"u"&&!s.active&&e.jsx(se,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),e.jsx(se,{size:"sm",variant:"flat",color:"success",children:s.code})]})]})]}),e.jsxs(We,{children:[e.jsx(Je,{children:e.jsx(U,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(o,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(He,{"aria-label":"Product Actions",children:[e.jsx(ve,{startContent:e.jsx(o,{icon:"lucide:edit",width:16}),onPress:()=>a(s),children:"Edit"},"edit"),e.jsx(ve,{startContent:e.jsx(o,{icon:typeof s.active<"u"&&!s.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:h,children:typeof s.active<"u"&&!s.active?"Activate":"Deactivate"},"toggle-active"),e.jsx(ve,{className:"text-danger",color:"danger",startContent:e.jsx(o,{icon:"lucide:trash",width:16}),onPress:()=>t(s.id),children:"Delete"},"delete")]})]})]})}),e.jsxs(re,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:s.overview}),s.specifications.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground-700",children:"Specifications:"}),e.jsxs("div",{className:"text-xs text-foreground-500",children:[s.specifications.slice(0,3).map((p,u)=>e.jsxs("div",{children:["• ",p]},u)),s.specifications.length>3&&e.jsxs("div",{children:["... and ",s.specifications.length-3," more"]})]})]})]})]})});vs.displayName="ProductCard";const Ht=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,linkRangeToGroup:n,unlinkRangeFromGroup:i,linkProductToRange:c,unlinkProductFromRange:h}=we(),[p,u]=oe.useState(null),[d,m]=oe.useState(null),[x,j]=oe.useState(!1),y=()=>s.map(f=>{const T=r.groupToRanges[f.id]||[],V=T.map(E=>{const l=a.find(B=>B.id===E),C=r.rangeToProducts[E]||[],I=C.map(B=>{const Z=t.find(ne=>ne.id===B);return{id:B,name:(Z==null?void 0:Z.name)||"Unknown Product",code:Z==null?void 0:Z.code,overview:Z==null?void 0:Z.overview,type:"product",hasIssues:!Z}}).filter(Boolean);return{id:E,name:(l==null?void 0:l.name)||"Unknown Range",description:l==null?void 0:l.description,type:"range",children:I,hasIssues:!l||C.length===0}}).filter(Boolean);return{id:f.id,name:f.name,description:f.description,type:"group",children:V,hasIssues:T.length===0}}),R=()=>{const f=a.filter(V=>!Object.values(r.groupToRanges).some(E=>E.includes(V.id))),T=t.filter(V=>!Object.values(r.rangeToProducts).some(E=>E.includes(V.id)));return{orphanedRanges:f,orphanedProducts:T}},q=()=>{const{orphanedRanges:f,orphanedProducts:T}=R(),V=Object.values(r.groupToRanges).reduce((l,C)=>l+C.length,0)+Object.values(r.rangeToProducts).reduce((l,C)=>l+C.length,0),E=Math.round((s.length-s.filter(l=>(r.groupToRanges[l.id]||[]).length===0).length+(a.length-f.length)+(t.length-T.length))/(s.length+a.length+t.length)*100);return{totalConnections:V,orphanedRanges:f.length,orphanedProducts:T.length,completionRate:isNaN(E)?0:E}},_=(f,T)=>{n(f,T)},H=(f,T)=>{i(f,T)},L=(f,T)=>{c(f,T)},Q=(f,T)=>{h(f,T)},z=async()=>{j(!0),await new Promise(f=>setTimeout(f,1500)),j(!1)},O=y(),{orphanedRanges:b,orphanedProducts:k}=R(),v=q();return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Relationship Manager"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Manage connections between groups, ranges, and products"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(U,{color:"secondary",variant:"flat",onPress:z,startContent:e.jsx(o,{icon:"lucide:search",width:18}),isLoading:x,children:x?"Analyzing...":"Analyze Structure"})})]}),e.jsx(ae,{className:"mb-6",children:e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:v.totalConnections}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Total Connections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning-600",children:v.orphanedRanges}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Orphaned Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-danger-600",children:v.orphanedProducts}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Orphaned Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-success-600",children:[v.completionRate,"%"]}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Structure Complete"}),e.jsx(Ws,{value:v.completionRate,color:v.completionRate>80?"success":v.completionRate>50?"warning":"danger",size:"sm",className:"mt-1"})]})]})})}),e.jsxs(Ce,{"aria-label":"Relationship Views",defaultSelectedKey:"tree",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:git-branch",width:16}),"Tree View"]}),children:e.jsxs("div",{className:"space-y-4",children:[O.length===0?e.jsx(ae,{children:e.jsx(re,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(o,{icon:"lucide:git-branch",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Structure Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create groups, ranges, and products to see the relationship tree"})]})]})})}):e.jsx(ys,{selectionMode:"multiple",variant:"bordered",children:O.map(f=>{var T;return e.jsx(Ns,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{icon:e.jsx(o,{icon:"lucide:folder",width:16,style:{stroke:"currentColor",fill:"currentColor"}}),className:"w-6 h-6 bg-primary-100 text-primary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:f.name}),f.hasIssues&&e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),e.jsx("div",{className:"text-xs text-foreground-500",children:f.description||"No description"})]}),e.jsx(Ds,{classNames:{base:"absolute"},content:((T=f.children)==null?void 0:T.length)||0,color:"primary",size:"sm",children:e.jsx("div",{className:"w-4 h-4"})})]}),classNames:{indicator:"-rotate-90 data-[open=true]:rotate-90 rtl:-rotate-180"},children:f.children&&f.children.length>0?e.jsx("div",{className:"space-y-3 pl-4",children:f.children.map(V=>{var E;return e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(De,{icon:e.jsx(o,{icon:"lucide:grid-3x3",width:16,style:{stroke:"currentColor",fill:"currentColor"}}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:V.name}),V.hasIssues&&e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),e.jsx("div",{className:"text-xs text-foreground-500",children:V.description||"No description"})]}),e.jsx(Ds,{classNames:{base:"absolute"},content:((E=V.children)==null?void 0:E.length)||0,color:"secondary",size:"sm",children:e.jsx("div",{className:"w-4 h-4"})})]}),V.children&&V.children.length>0&&e.jsx("div",{className:"space-y-2 pl-8",children:V.children.map(l=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx(De,{icon:e.jsx(o,{icon:"lucide:package",width:16}),className:"w-5 h-5 bg-success-100 text-success-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:l.name}),l.code&&e.jsx(se,{size:"sm",variant:"flat",color:"success",children:l.code}),l.hasIssues&&e.jsx(o,{icon:"lucide:alert-triangle",width:14,className:"text-warning-500"})]}),l.overview&&e.jsx("div",{className:"text-xs text-foreground-500",children:l.overview})]})]},l.id))})]},V.id)})}):e.jsxs("div",{className:"text-center py-6 text-foreground-400",children:[e.jsx(o,{icon:"lucide:inbox",width:32,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"No ranges linked to this group"})]})},f.id)})}),(b.length>0||k.length>0)&&e.jsxs(ae,{className:"border-warning-200 bg-warning-50",children:[e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center gap-2 text-warning-700",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:20}),e.jsx("h4",{className:"font-semibold",children:"Orphaned Items"})]})}),e.jsxs(re,{className:"pt-0",children:[b.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Ranges:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:b.map(f=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),e.jsx("span",{className:"text-sm",children:f.name}),e.jsx("span",{className:"text-xs text-gray-500",children:f.description})]},f.id))})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Products:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:k.map(f=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(o,{icon:"lucide:package",width:16,className:"text-success-600"}),e.jsx("span",{className:"text-sm",children:f.name}),e.jsx(se,{size:"sm",variant:"flat",color:"success",children:f.code})]},f.id))})]})]})]})]})},"tree"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:link",width:16}),"Manage Links"]}),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:arrow-right",width:16}),"Group → Range Links"]})}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qe,{label:"Select Group",placeholder:"Choose a product group",selectedKeys:p?new Set([p]):new Set,onSelectionChange:f=>u(Array.from(f)[0]||null),children:s.map(f=>e.jsx(Ze,{children:f.name},f.id))}),p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground-700",children:"Available Ranges:"}),a.map(f=>{const T=(r.groupToRanges[p]||[]).includes(f.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:f.name}),e.jsx("div",{className:"text-xs text-foreground-500",children:f.description})]})]}),e.jsx(U,{size:"sm",color:T?"danger":"primary",variant:T?"flat":"solid",onPress:()=>{T?H(p,f.id):_(p,f.id)},children:T?"Unlink":"Link"})]},f.id)})]})]})})]}),e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:arrow-right",width:16}),"Range → Product Links"]})}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qe,{label:"Select Range",placeholder:"Choose a product range",selectedKeys:d?new Set([d]):new Set,onSelectionChange:f=>m(Array.from(f)[0]||null),children:a.map(f=>e.jsx(Ze,{children:f.name},f.id))}),d&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground-700",children:"Available Products:"}),t.map(f=>{const T=(r.rangeToProducts[d]||[]).includes(f.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{icon:"lucide:package",width:16,className:"text-success-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:f.name}),e.jsx("div",{className:"text-xs text-foreground-500",children:f.code})]})]}),e.jsx(U,{size:"sm",color:T?"danger":"primary",variant:T?"flat":"solid",onPress:()=>{T?Q(d,f.id):L(d,f.id)},children:T?"Unlink":"Link"})]},f.id)})]})]})})]})]})},"manage"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:bar-chart-3",width:16}),"Analysis"]}),children:e.jsx("div",{className:"space-y-6",children:x?e.jsx(ae,{children:e.jsxs(re,{className:"text-center py-12",children:[e.jsx(Te,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-foreground-600",children:"Analyzing relationship structure..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsx("h4",{className:"font-semibold",children:"Structure Analysis"})}),e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Groups"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Groups"}),e.jsx("span",{className:"text-sm font-medium",children:s.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"With Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:s.filter(f=>(r.groupToRanges[f.id]||[]).length>0).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Empty Groups"}),e.jsx("span",{className:"text-sm font-medium text-warning-600",children:s.filter(f=>(r.groupToRanges[f.id]||[]).length===0).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Ranges"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:a.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Linked to Groups"}),e.jsx("span",{className:"text-sm font-medium",children:a.length-b.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"With Products"}),e.jsx("span",{className:"text-sm font-medium",children:a.filter(f=>(r.rangeToProducts[f.id]||[]).length>0).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Products"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Products"}),e.jsx("span",{className:"text-sm font-medium",children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Linked to Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:t.length-k.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Orphaned"}),e.jsx("span",{className:"text-sm font-medium text-danger-600",children:k.length})]})]})]})]})})]}),e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:lightbulb",width:16}),"Recommendations"]})}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-3",children:[v.orphanedProducts>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-danger-50 rounded-lg border border-danger-200",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-danger-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-danger-800",children:["You have ",v.orphanedProducts," unlinked product",v.orphanedProducts!==1?"s":""]}),e.jsx("p",{className:"text-xs text-danger-600",children:"Link these products to ranges so they appear in your product stepper."})]})]}),v.orphanedRanges>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-warning-50 rounded-lg border border-warning-200",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-warning-800",children:["You have ",v.orphanedRanges," unlinked range",v.orphanedRanges!==1?"s":""]}),e.jsx("p",{className:"text-xs text-warning-600",children:"Link these ranges to product groups to organize your structure."})]})]}),s.filter(f=>(r.groupToRanges[f.id]||[]).length===0).length>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-primary-50 rounded-lg border border-primary-200",children:[e.jsx(o,{icon:"lucide:info",width:16,className:"text-primary-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary-800",children:"Some product groups are empty"}),e.jsx("p",{className:"text-xs text-primary-600",children:"Consider linking ranges to these groups or removing unused groups."})]})]}),v.completionRate>=90&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-success-50 rounded-lg border border-success-200",children:[e.jsx(o,{icon:"lucide:check-circle",width:16,className:"text-success-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-success-800",children:"Great job! Your structure is well organized"}),e.jsx("p",{className:"text-xs text-success-600",children:"Your data structure is ready for the product stepper."})]})]})]})})]})]})})},"analysis")]})]})},Vt=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,exportData:n,importData:i}=we(),{isOpen:c,onOpen:h,onOpenChange:p,onClose:u}=Ge(),[d,m]=oe.useState(""),[x,j]=oe.useState(""),[y,R]=oe.useState("structure"),q=G.useMemo(()=>n(),[n]),_=G.useMemo(()=>{const b={};return q.stepperForm.steps.forEach(k=>{k.step===3&&k.products&&Object.entries(k.products).forEach(([v,f])=>{b[v]||(b[v]=[]),f.forEach(T=>{var l,C,I,B;const V=(C=(l=q.stepperForm.steps[3])==null?void 0:l.productDetails)==null?void 0:C[T],E=(B=(I=q.stepperForm.steps[4])==null?void 0:I.productOptions)==null?void 0:B[T];V&&b[v].push({code:T,...V,options:E||{},hasOptions:E&&Object.keys(E).length>0})})})}),b},[q]),H=G.useMemo(()=>{var v;const b=Object.values(_).reduce((f,T)=>f+T.length,0),k=Object.values(_).reduce((f,T)=>f+T.filter(V=>V.hasOptions).length,0);return{totalSteps:q.stepperForm.steps.length,totalCategories:Object.keys(_).length,totalProducts:b,productsWithOptions:k,hasIssues:((v=q.stepperForm.steps[1])==null?void 0:v.ranges)&&Object.keys(q.stepperForm.steps[1].ranges).length===0}},[q,_]),L=G.useCallback(()=>{const b=n();j(JSON.stringify(b,null,2)),R("json")},[n]),Q=G.useCallback(()=>{try{const b=JSON.parse(d);i(b),m(""),u()}catch{alert("Invalid JSON format. Please check your data.")}},[d,i,u]),z=G.useCallback(()=>{const b=n(),k=JSON.stringify(b,null,2),v="data:application/json;charset=utf-8,"+encodeURIComponent(k),f="stepper-config.json",T=document.createElement("a");T.setAttribute("href",v),T.setAttribute("download",f),T.click()},[n]),O=G.useCallback(()=>{const b=n();navigator.clipboard.writeText(JSON.stringify(b,null,2))},[n]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Data Preview"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Preview and export your stepper configuration"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"flat",onPress:h,startContent:e.jsx(o,{icon:"lucide:upload",width:18}),children:"Import"}),e.jsx(U,{color:"secondary",onPress:L,startContent:e.jsx(o,{icon:"lucide:download",width:18}),children:"Export Data"}),e.jsx(U,{color:"primary",onPress:z,startContent:e.jsx(o,{icon:"lucide:file-down",width:18}),children:"Download Config"})]})]}),e.jsx(ae,{className:"mb-6",children:e.jsx(re,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:H.totalSteps}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Stepper Steps"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-secondary-600",children:H.totalCategories}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success-600",children:H.totalProducts}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning-600",children:H.productsWithOptions}),e.jsx("div",{className:"text-sm text-foreground-500",children:"With Options"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`flex justify-center text-2xl font-bold ${H.hasIssues?"text-warning-600":"text-success-600"}`,children:H.hasIssues?e.jsx(o,{icon:"lucide:alert-triangle",width:32}):e.jsx(o,{icon:"lucide:check-circle",width:32})}),e.jsx("div",{className:"text-sm text-foreground-500",children:H.hasIssues?"Has Issues":"Ready"})]})]})})}),e.jsxs(Ce,{"aria-label":"Preview Options",selectedKey:y,onSelectionChange:b=>R(b),children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:layers",width:16}),"Structure Preview"]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:list",width:16}),"Stepper Steps"]})}),e.jsx(re,{children:q.stepperForm.steps.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{icon:"lucide:layers",width:48,className:"mx-auto text-foreground-300 mb-4"}),e.jsx("p",{className:"text-foreground-600",children:"No stepper steps configured"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create product groups to generate stepper steps"})]}):e.jsx("div",{className:"space-y-4",children:q.stepperForm.steps.map(b=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-primary-600",children:b.step})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold",children:b.title}),b.step===1&&b.categories&&b.categories.length>0&&e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:b.categories.map((k,v)=>e.jsx(se,{size:"sm",variant:"flat",color:"secondary",children:k},v))}),b.step===2&&b.ranges&&Object.keys(b.ranges).length>0&&e.jsxs("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.ranges).length," group(s) with ranges"]}),b.step===3&&b.products&&Object.keys(b.products).length>0&&e.jsxs("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.products).length," range(s) with products"]}),b.step===4&&b.productDetails&&Object.keys(b.productDetails).length>0&&e.jsxs("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.productDetails).length," product detail(s)"]}),b.step===5&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[b.options&&Object.keys(b.options).length>0&&e.jsxs(se,{size:"sm",variant:"flat",color:"primary",children:[Object.keys(b.options).length," global option group(s)"]}),b.productOptions&&Object.keys(b.productOptions).length>0&&e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[Object.keys(b.productOptions).length," product(s) with options"]})]})]})]},b.step))})})]}),e.jsxs(ae,{children:[e.jsx(xe,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:package",width:16}),"Products by Range"]})}),e.jsx(re,{children:Object.keys(_).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{icon:"lucide:package",width:48,className:"mx-auto text-foreground-300 mb-4"}),e.jsx("p",{className:"text-foreground-600",children:"No products configured"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Link products to ranges to see them here"})]}):e.jsx(ys,{variant:"bordered",children:Object.entries(_).map(([b,k])=>e.jsx(Ns,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{icon:e.jsx(o,{icon:"lucide:grid-3x3",width:16}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),e.jsx("span",{className:"font-medium",children:b}),e.jsxs(se,{size:"sm",variant:"flat",color:"secondary",children:[k.length," product",k.length!==1?"s":""]}),k.some(v=>v.hasOptions)&&e.jsxs(se,{size:"sm",variant:"flat",color:"warning",children:[k.filter(v=>v.hasOptions).length," with options"]})]}),children:e.jsx("div",{className:"space-y-3 pl-4",children:k.map(v=>{var f,T;return e.jsx("div",{className:"border-l-2 border-success-200 pl-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{icon:e.jsx(o,{icon:"lucide:package",width:16}),className:"w-8 h-8 bg-success-100 text-success-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h6",{className:"font-semibold",children:v.name}),e.jsx(se,{size:"sm",variant:"flat",color:"success",children:v.code}),v.hasOptions&&e.jsxs(se,{size:"sm",variant:"flat",color:"warning",startContent:e.jsx(o,{icon:"lucide:settings",width:12}),children:[Object.keys(v.options).length," option groups"]})]}),e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:v.overview}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Specifications:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:((f=v.specifications)==null?void 0:f.length)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Images:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:((T=v.imageGallery)==null?void 0:T.length)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Files:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:Object.keys(v.files||{}).length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Options:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:v.hasOptions?Object.keys(v.options).length:"None"})]})]}),v.hasOptions&&e.jsxs("div",{className:"mt-3 p-3 bg-warning-50 rounded-medium border border-warning-200",children:[e.jsxs("h6",{className:"text-xs font-semibold text-warning-800 mb-2 flex items-center gap-1",children:[e.jsx(o,{icon:"lucide:settings",width:12}),"Configuration Options"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(v.options).map(([V,E])=>e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"font-medium text-foreground-700",children:[V,":"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:E.map((l,C)=>e.jsx(se,{size:"sm",variant:"flat",color:"default",startContent:l.imageUrl&&e.jsx(o,{icon:"lucide:image",width:10}),children:typeof l=="string"?l:l.value},C))})]},V))})]})]})]})},v.code)})})},b))})})]})]})},"structure"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:code",width:16}),"JSON Preview"]}),children:e.jsxs(ae,{children:[e.jsxs(xe,{className:"flex flex-row justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"Configuration JSON"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{size:"sm",variant:"flat",onPress:O,startContent:e.jsx(o,{icon:"lucide:copy",width:16}),children:"Copy"}),e.jsx(U,{size:"sm",color:"primary",onPress:z,startContent:e.jsx(o,{icon:"lucide:download",width:16}),children:"Download"})]})]}),e.jsx(re,{children:e.jsx("pre",{className:"w-full px-2 py-1 h-fit font-mono font-normal bg-default/40 text-default-700 rounded-small text-xs overflow-x-auto",children:e.jsx("code",{children:x||JSON.stringify(q,null,2)})})})]})},"json")]}),e.jsx(Le,{isOpen:c,onOpenChange:p,size:"2xl",children:e.jsx(Ue,{children:b=>e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:"Import Configuration"}),e.jsx(Be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-800",children:"Warning"}),e.jsx("p",{className:"text-xs text-warning-600",children:"Importing will replace all current data. Make sure to export your current configuration first if needed."})]})]})}),e.jsx(Ae,{label:"JSON Data",placeholder:"Paste your exported JSON configuration here...",value:d,onChange:k=>m(k.target.value),rows:12,className:"font-mono text-sm"})]})}),e.jsxs(qe,{children:[e.jsx(U,{variant:"light",onPress:b,children:"Cancel"}),e.jsx(U,{color:"primary",onPress:Q,isDisabled:!d.trim(),children:"Import"})]})]})})})]})},Xt=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r}=we(),[n,i]=G.useState(!1),[c,h]=G.useState(!1),[p,u]=G.useState({groups:[],ranges:[],products:[]}),[d,m]=G.useState([]),[x,j]=G.useState(null),y=G.useCallback(async(O=!1)=>{i(!0),j(null);try{const b=window.urbanaAdmin;console.log("Fetching DO folders...",{ajaxUrl:b==null?void 0:b.ajaxUrl,forceRefresh:O});const k=new URL(b.ajaxUrl);k.searchParams.append("action","urbana_list_all_folders"),k.searchParams.append("_wpnonce",b.nonce),O&&k.searchParams.append("force_refresh","true");const v=await fetch(k.toString(),{method:"GET",credentials:"same-origin"});console.log("Response status:",v.status);const f=await v.json();console.log("Response data:",f),f.success&&f.data&&f.data.folders?(console.log("Setting DO folders:",f.data.folders),console.log("Total DO folders count:",f.data.folders.length),console.log("First 10 folders:",f.data.folders.slice(0,10)),m(f.data.folders)):f.success===!1&&f.data&&f.data.message?(console.error("Error from server:",f.data.message),j(f.data.message),m([])):(console.error("Unexpected response format:",f),j("Unexpected response from server"),m([]))}catch(b){console.error("Failed to fetch DO folders:",b),j(b instanceof Error?b.message:"Network error"),m([])}finally{i(!1)}},[]),R=G.useCallback(()=>{const O=[],b=[],k=[],v=E=>{const l=E.toLowerCase();return d.some(C=>C.toLowerCase()===l)};s.forEach(E=>{const l=v(E.name);O.push({path:E.name,name:E.name,type:"group",exists_do:l,exists_site:!0,synced:l,checked:!1})});const f=new Set;d.forEach(E=>{if(!E.includes("/")){const l=E.toLowerCase();!s.some(I=>I.name.toLowerCase()===l)&&!f.has(l)&&(O.push({path:E,name:E,type:"group",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),f.add(l))}}),a.forEach(E=>{var Z;const l=(Z=Object.entries(r.groupToRanges).find(([,ne])=>ne.includes(E.id)))==null?void 0:Z[0],C=l?s.find(ne=>ne.id===l):null,I=C?`${C.name}/${E.name}`:E.name,B=v(I);b.push({path:I,name:E.name,type:"range",exists_do:B,exists_site:!0,synced:B,checked:!1})});const T=new Set;d.forEach(E=>{const l=E.split("/");if(l.length===2){const C=E.toLowerCase();!a.some(B=>{var N;const Z=(N=Object.entries(r.groupToRanges).find(([,w])=>w.includes(B.id)))==null?void 0:N[0],ne=Z?s.find(w=>w.id===Z):null;return(ne?`${ne.name}/${B.name}`:B.name).toLowerCase()===C})&&!T.has(C)&&(b.push({path:E,name:l[1],type:"range",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),T.add(C))}}),t.forEach(E=>{var Z,ne;const l=(Z=Object.entries(r.rangeToProducts).find(([,ce])=>ce.includes(E.id)))==null?void 0:Z[0],C=l?a.find(ce=>ce.id===l):null;let I=E.code;if(C){const ce=(ne=Object.entries(r.groupToRanges).find(([,w])=>w.includes(C.id)))==null?void 0:ne[0],N=ce?s.find(w=>w.id===ce):null;N?I=`${N.name}/${C.name}/${E.code}`:I=`${C.name}/${E.code}`}const B=v(I);k.push({path:I,name:E.name,type:"product",exists_do:B,exists_site:!0,synced:B,checked:!1})});const V=new Set;d.forEach(E=>{const l=E.split("/");if(console.log("Checking DO folder:",E,"parts:",l),l.length===3){const C=E.toLowerCase(),I=l[2],B=t.some(Z=>Z.code.toLowerCase()===I.toLowerCase());console.log("Product check:",{folder:E,productCode:I,existsInSite:B}),!B&&!V.has(C)&&(k.push({path:E,name:I,type:"product",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),V.add(C))}}),u({groups:O.sort((E,l)=>E.name.localeCompare(l.name)),ranges:b.sort((E,l)=>E.name.localeCompare(l.name)),products:k.sort((E,l)=>E.name.localeCompare(l.name))}),console.log("Built folder comparison:",{groups:O.length,ranges:b.length,products:k.length,doFoldersCount:d.length,productGroupsCount:s.length,productRangesCount:a.length,productsCount:t.length})},[s,a,t,r,d]);G.useEffect(()=>{console.log("BiDirectionalSync mounted"),y()},[y]),G.useEffect(()=>{console.log("Building folder comparison...",{hasDoFolders:d.length>0,hasGroups:s.length>0,hasRanges:a.length>0,hasProducts:t.length>0}),R()},[d,s,a,t,R]);const q=(O,b)=>{u(k=>({...k,[O]:k[O].map((v,f)=>f===b?{...v,checked:!v.checked}:v)}))},_=(O,b)=>{u(k=>({...k,[O]:k[O].map(v=>({...v,checked:b}))}))},H=async()=>{var O;h(!0);try{const b=[];if(Object.values(p).flat().forEach(V=>{V.checked&&V.exists_site&&!V.exists_do&&b.push(V.path)}),b.length===0){alert("No folders selected to sync to Digital Ocean");return}const k=window.urbanaAdmin,v=new FormData;v.append("action","urbana_sync_folders_to_do"),v.append("_wpnonce",k.nonce),v.append("folders",JSON.stringify(b));const T=await(await fetch(k.ajaxUrl,{method:"POST",credentials:"same-origin",body:v})).json();console.log("Sync result:",T),T.success?(alert(`Successfully synced ${b.length} folder(s) to Digital Ocean`),y()):alert(`Sync failed: ${((O=T.data)==null?void 0:O.message)||"Unknown error"}`)}catch(b){console.error("Sync failed:",b),alert("Failed to sync folders")}finally{h(!1)}},L=async()=>{h(!0);try{const{addProductGroup:O,addProductRange:b,addProduct:k,linkRangeToGroup:v,linkProductToRange:f}=we.getState(),T=[];if(Object.values(p).flat().forEach(C=>{C.checked&&C.exists_do&&!C.exists_site&&T.push(C)}),T.length===0){alert("No 'DO Only' items selected to import");return}let V=0;const E=[],l=T.sort((C,I)=>{const B={group:0,range:1,product:2};return B[C.type]-B[I.type]});for(const C of l)try{const I=C.path.split("/");if(C.type==="group"){const B=I[0];O({name:B,icon:"lucide:folder",description:"Imported from Digital Ocean",active:!0}),V++,console.log("Imported group:",B)}else if(C.type==="range"){const B=I[0],Z=I[1];let ne=s.find(ce=>ce.name.toLowerCase()===B.toLowerCase());if(!ne){const ce=crypto.randomUUID();O({name:B,icon:"lucide:folder",description:"Auto-created during import",active:!0}),ne=we.getState().productGroups.find(N=>N.name.toLowerCase()===B.toLowerCase())}if(ne){const ce=crypto.randomUUID();b({name:Z,image:"",description:"Imported from Digital Ocean",tags:[],active:!0});const N=we.getState().productRanges.find(w=>w.name.toLowerCase()===Z.toLowerCase());N&&v(ne.id,N.id),V++,console.log("Imported range:",Z)}}else if(C.type==="product"){const B=I[0],Z=I[1],ne=I[2];let ce=s.find(w=>w.name.toLowerCase()===B.toLowerCase());ce||(O({name:B,icon:"lucide:folder",description:"Auto-created during import",active:!0}),ce=we.getState().productGroups.find(w=>w.name.toLowerCase()===B.toLowerCase()));let N=a.find(w=>w.name.toLowerCase()===Z.toLowerCase());if(!N&&ce&&(b({name:Z,image:"",description:"Auto-created during import",tags:[],active:!0}),N=we.getState().productRanges.find(w=>w.name.toLowerCase()===Z.toLowerCase()),N&&v(ce.id,N.id)),N){k({name:ne,code:ne,overview:"Imported from Digital Ocean",description:"",specifications:[],imageGallery:[],files:{},active:!0});const w=we.getState().products.find(S=>S.code.toLowerCase()===ne.toLowerCase());w&&f(N.id,w.id),V++,console.log("Imported product:",ne)}}}catch(I){console.error(`Failed to import ${C.path}:`,I),E.push(`${C.path}: ${I instanceof Error?I.message:"Unknown error"}`)}E.length>0?alert(`Imported ${V} item(s) with ${E.length} error(s):

${E.join(`
`)}`):alert(`Successfully imported ${V} item(s) from Digital Ocean!`),y(!0)}catch(O){console.error("Import failed:",O),alert(`Import failed: ${O instanceof Error?O.message:"Unknown error"}`)}finally{h(!1)}},Q=(O,b)=>{if(O.length===0)return e.jsxs("div",{className:"text-center py-8 text-foreground-500",children:[e.jsx(o,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No items found"})]});const k=O.filter(v=>v.checked).length;return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{size:"sm",variant:"flat",onPress:()=>_(b,!0),startContent:e.jsx(o,{icon:"lucide:check-square",width:14}),children:"Select All"}),e.jsx(U,{size:"sm",variant:"flat",onPress:()=>_(b,!1),startContent:e.jsx(o,{icon:"lucide:square",width:14}),children:"Clear"})]}),k>0&&e.jsxs(se,{size:"sm",color:"primary",variant:"flat",children:[k," selected"]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:O.map((v,f)=>e.jsx(ae,{className:`cursor-pointer border-2 transition-all ${v.checked?"border-primary bg-primary/5":"border-transparent hover:border-default-300"}`,isPressable:!0,onPress:()=>q(b,f),children:e.jsx(re,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(_e,{isSelected:v.checked,onValueChange:()=>q(b,f),size:"sm",onClick:T=>T.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:v.name}),e.jsx("p",{className:"text-xs text-foreground-500",children:v.path})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:v.synced?e.jsx(se,{size:"sm",color:"success",variant:"flat",startContent:e.jsx(o,{icon:"lucide:check-circle",width:14}),children:"Synced"}):e.jsxs(e.Fragment,{children:[v.exists_site&&e.jsx(se,{size:"sm",color:"primary",variant:"dot",children:"Site"}),v.exists_do&&e.jsx(se,{size:"sm",color:"secondary",variant:"dot",children:"DO"}),!v.exists_site&&v.exists_do&&e.jsx(se,{size:"sm",color:"warning",variant:"flat",startContent:e.jsx(o,{icon:"lucide:cloud",width:14}),children:"DO Only"}),v.exists_site&&!v.exists_do&&e.jsx(se,{size:"sm",color:"warning",variant:"flat",startContent:e.jsx(o,{icon:"lucide:database",width:14}),children:"Site Only"})]})})]})})},v.path))})]})},z={groups:{total:p.groups.length,synced:p.groups.filter(O=>O.synced).length,siteOnly:p.groups.filter(O=>O.exists_site&&!O.exists_do).length,doOnly:p.groups.filter(O=>!O.exists_site&&O.exists_do).length},ranges:{total:p.ranges.length,synced:p.ranges.filter(O=>O.synced).length,siteOnly:p.ranges.filter(O=>O.exists_site&&!O.exists_do).length,doOnly:p.ranges.filter(O=>!O.exists_site&&O.exists_do).length},products:{total:p.products.length,synced:p.products.filter(O=>O.synced).length,siteOnly:p.products.filter(O=>O.exists_site&&!O.exists_do).length,doOnly:p.products.filter(O=>!O.exists_site&&O.exists_do).length}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ae,{children:[e.jsxs(xe,{className:"flex gap-3",children:[e.jsx(o,{icon:"lucide:refresh-cw",width:24}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("p",{className:"text-md font-semibold",children:"Bi-Directional Sync Manager"}),e.jsx("p",{className:"text-small text-default-500",children:"Compare and sync folders between your site and Digital Ocean Spaces"})]}),e.jsx(U,{color:"primary",variant:"flat",onPress:()=>y(!0),isLoading:n,startContent:n?void 0:e.jsx(o,{icon:"lucide:refresh-cw",width:16}),children:"Refresh"})]}),e.jsxs(re,{children:[x&&e.jsx("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-danger",children:[e.jsx(o,{icon:"lucide:alert-circle",width:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Error fetching Digital Ocean folders"}),e.jsx("p",{className:"text-sm",children:x}),x.includes("not configured")&&e.jsx("p",{className:"text-xs mt-1",children:"Please configure Digital Ocean Spaces in Settings"})]})]})}),!x&&d.length===0&&!n&&e.jsx("div",{className:"mb-4 p-3 bg-warning/10 border border-warning/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-warning",children:[e.jsx(o,{icon:"lucide:info",width:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"No folders in Digital Ocean"}),e.jsx("p",{className:"text-sm",children:'All items shown are only in your site. Use "Sync to Digital Ocean" to create them.'})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx(ae,{className:"bg-primary/10",children:e.jsx(re,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-foreground-500",children:"Total Items"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:z.groups.total+z.ranges.total+z.products.total})]}),e.jsx(o,{icon:"lucide:folder",width:32,className:"text-primary opacity-50"})]})})}),e.jsx(ae,{className:"bg-success/10",children:e.jsx(re,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-foreground-500",children:"Synced"}),e.jsx("p",{className:"text-2xl font-bold text-success",children:z.groups.synced+z.ranges.synced+z.products.synced})]}),e.jsx(o,{icon:"lucide:check-circle",width:32,className:"text-success opacity-50"})]})})}),e.jsx(ae,{className:"bg-warning/10",children:e.jsx(re,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-foreground-500",children:"Need Sync"}),e.jsx("p",{className:"text-2xl font-bold text-warning",children:z.groups.siteOnly+z.ranges.siteOnly+z.products.siteOnly+z.groups.doOnly+z.ranges.doOnly+z.products.doOnly})]}),e.jsx(o,{icon:"lucide:alert-circle",width:32,className:"text-warning opacity-50"})]})})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(U,{color:"primary",onPress:H,isLoading:c,isDisabled:p.groups.filter(O=>O.checked&&O.exists_site&&!O.exists_do).length===0&&p.ranges.filter(O=>O.checked&&O.exists_site&&!O.exists_do).length===0&&p.products.filter(O=>O.checked&&O.exists_site&&!O.exists_do).length===0,startContent:c?void 0:e.jsx(o,{icon:"lucide:cloud-upload",width:16}),children:c?"Syncing...":"Sync to Digital Ocean"}),e.jsx(U,{color:"secondary",variant:"flat",isLoading:c,isDisabled:c||p.groups.filter(O=>O.checked&&!O.exists_site&&O.exists_do).length===0&&p.ranges.filter(O=>O.checked&&!O.exists_site&&O.exists_do).length===0&&p.products.filter(O=>O.checked&&!O.exists_site&&O.exists_do).length===0,startContent:c?void 0:e.jsx(o,{icon:"lucide:download-cloud",width:16}),onPress:L,children:"Import from Digital Ocean"})]})]})]}),e.jsxs(Ce,{"aria-label":"Folder Types",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:layers",width:16}),e.jsx("span",{children:"Product Groups"}),e.jsx(se,{size:"sm",variant:"flat",children:z.groups.total})]}),children:e.jsx("div",{className:"mt-4",children:n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Te,{})}):Q(p.groups,"groups")})},"groups"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:16}),e.jsx("span",{children:"Product Ranges"}),e.jsx(se,{size:"sm",variant:"flat",children:z.ranges.total})]}),children:e.jsx("div",{className:"mt-4",children:n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Te,{})}):Q(p.ranges,"ranges")})},"ranges"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:package",width:16}),e.jsx("span",{children:"Products"}),e.jsx(se,{size:"sm",variant:"flat",children:z.products.total})]}),children:e.jsx("div",{className:"mt-4",children:n?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(Te,{})}):Q(p.products,"products")})},"products")]})]})},Yt=({isOpen:s,onOpenChange:a})=>{const{productGroups:t,productRanges:r,products:n,relationships:i,updateProduct:c,addProductGroup:h,addProductRange:p,addProduct:u,linkRangeToGroup:d,linkProductToRange:m,resetData:x,updateOptions:j}=we(),[y,R]=G.useState(null),[q,_]=G.useState(!1),[H,L]=G.useState(!1),[Q,z]=G.useState(!1),[O,b]=G.useState(null),[k,v]=G.useState(null),[f,T]=G.useState(!0),[V,E]=G.useState(""),[l,C]=G.useState("update"),I=G.useMemo(()=>{if(!k)return{categories:0,ranges:0,products:0,totalFiles:0,totalFolders:0,optionGroups:0,optionImages:0};const{structured_data:w,total_folders:S,total_objects:A}=k,M=Object.keys(w).length;let Y=0,ee=0,J=0,te=0,le=0;return Object.values(w).forEach(ie=>{Y+=Object.keys(ie).length,Object.values(ie).forEach(he=>{ee+=Object.keys(he).length,Object.values(he).forEach(ge=>{J+=ge.images.length+ge.downloads.length,ge.img_conf&&(te+=Object.keys(ge.img_conf).length,Object.values(ge.img_conf).forEach(g=>{le+=Object.keys(g).length}))})})}),{categories:M,ranges:Y,products:ee,totalFiles:J,totalFolders:S||0,optionGroups:te,optionImages:le}},[k]);G.useEffect(()=>{s&&(B(),v(null),b(null))},[s]);const B=G.useCallback(async()=>{_(!0);try{const w=await Oe.getDigitalOceanConfig();R(w)}catch(w){console.error("Failed to load config:",w),fe({color:"danger",title:"Failed to load Digital Ocean configuration"})}finally{_(!1)}},[]),Z=G.useCallback(async()=>{L(!0),b(null);try{const w=await Oe.testDigitalOceanConnection();b(w),fe({color:w.success?"success":"danger",title:w.message})}catch(w){const S=w instanceof Error?w.message:"Unknown error occurred";b({success:!1,message:S}),fe({color:"danger",title:"Connection test failed",description:S})}finally{L(!1)}},[]),ne=G.useCallback(async()=>{z(!0),v(null);try{const w=await Oe.fetchDigitalOceanAssets(V);if(v(w),w.success)if(l==="replace"){const S=Oe.buildCompleteStructureFromDigitalOcean(w.structured_data);x(),S.productGroups.forEach(A=>{h({name:A.name,icon:A.icon,description:A.description,active:A.active})}),S.productRanges.forEach(A=>{p({name:A.name,image:A.image,description:A.description,tags:A.tags,active:A.active}),Object.entries(S.relationships.groupToRanges).forEach(([M,Y])=>{Y.includes(A.id)&&d(M,A.id)})}),S.products.forEach(A=>{u({code:A.code,name:A.name,overview:A.overview,description:A.description,specifications:A.specifications,imageGallery:A.imageGallery,files:A.files,options:A.options,active:A.active}),Object.entries(S.relationships.rangeToProducts).forEach(([M,Y])=>{Y.includes(A.id)&&m(M,A.id)})}),fe({color:"success",title:"Structure imported successfully!",description:`Created ${S.productGroups.length} groups, ${S.productRanges.length} ranges, and ${S.products.length} products with their options.`})}else{const S=Oe.updateProductPathsFromDigitalOcean(n,w.structured_data,t,r,i);let A=0;S.forEach(M=>{const Y=n.find(ee=>ee.code.toLowerCase()===M.code.toLowerCase());Y&&(JSON.stringify(Y.imageGallery)!==JSON.stringify(M.imageGallery)||JSON.stringify(Y.files)!==JSON.stringify(M.files)||JSON.stringify(Y.options)!==JSON.stringify(M.options))&&(c(M.id,{imageGallery:M.imageGallery,files:M.files,options:M.options}),A++)}),fe({color:"success",title:"Assets fetched successfully!",description:`Updated ${A} products with Digital Ocean assets and their specific options.`})}}catch(w){const S=w instanceof Error?w.message:"Unknown error occurred";v({success:!1,message:S,total_folders:0,total_objects:0,raw_folders:[],raw_objects:[],structured_data:{},debug_info:{prefix:V||"",configuration:y||{bucket_name:"",region:"",endpoint:"",configured:!1},categories:[]}}),fe({color:"danger",title:"Failed to fetch assets",description:S})}finally{z(!1)}},[V,l,n,t,r,i,c,h,p,u,d,m,x,j,y]),ce=G.useCallback(()=>{v(null),b(null),z(!1),L(!1),a(!1)},[a]),N=w=>Object.entries(w).map(([S,A])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-lg text-primary mb-2 flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:folder",width:16}),S]}),Object.entries(A).map(([M,Y])=>e.jsxs("div",{className:"ml-4 mb-3",children:[e.jsxs("h5",{className:"font-medium text-secondary mb-1 flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:folder-open",width:14}),M]}),Object.entries(Y).map(([ee,J])=>e.jsxs("div",{className:"ml-4 mb-2",children:[e.jsxs("h6",{className:"font-medium text-success mb-1 flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:package",width:12}),ee]}),e.jsxs("div",{className:"ml-4 text-sm space-y-1",children:[J.images.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:image",width:12,className:"text-primary"}),e.jsxs("span",{children:["Images: ",J.images.length]}),e.jsx(se,{size:"sm",variant:"flat",color:"primary",children:J.images.length})]}),J.downloads.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:file",width:12,className:"text-secondary"}),e.jsxs("span",{children:["Downloads: ",J.downloads.length]}),e.jsx(se,{size:"sm",variant:"flat",color:"secondary",children:J.downloads.length})]}),J.img_conf&&Object.keys(J.img_conf).length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:settings",width:12,className:"text-warning"}),e.jsxs("span",{children:["Option Groups: ",Object.keys(J.img_conf).length]}),e.jsx(se,{size:"sm",variant:"flat",color:"warning",children:Object.keys(J.img_conf).length})]})]})]},ee))]},M))]},S));return e.jsx(Le,{isOpen:s,onOpenChange:a,size:"5xl",scrollBehavior:"inside",className:"urbana-modal",isDismissable:!Q&&!H,children:e.jsx(Ue,{children:w=>e.jsxs(e.Fragment,{children:[e.jsxs(Me,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:cloud-download",width:20}),"Fetch from Digital Ocean Spaces"]}),e.jsx("p",{className:"text-sm text-foreground-500 font-normal",children:"Fetch assets from Digital Ocean Spaces and update product paths automatically"})]}),e.jsx(Be,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{className:y!=null&&y.configured?"border-success":"border-warning",children:e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{icon:y!=null&&y.configured?"lucide:check-circle":"lucide:alert-circle",width:20,className:y!=null&&y.configured?"text-success":"text-warning"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Configuration Status"}),e.jsx("p",{className:"text-sm text-foreground-500",children:y!=null&&y.configured?"Digital Ocean Spaces is configured":"Configuration required"})]})]}),e.jsx(U,{color:"primary",variant:"flat",size:"sm",onPress:Z,isLoading:H,isDisabled:!(y!=null&&y.configured)||H||Q,startContent:H?void 0:e.jsx(o,{icon:"lucide:wifi",width:16}),children:H?"Testing...":"Test Connection"})]}),y&&e.jsxs("div",{className:"mt-3 text-sm text-foreground-600",children:[e.jsxs("div",{children:["Bucket: ",y.bucket_name||"Not set"]}),e.jsxs("div",{children:["Region: ",y.region||"Not set"]}),e.jsxs("div",{children:["Endpoint: ",y.endpoint||"Not set"]})]}),O&&e.jsx("div",{className:"mt-3",children:e.jsx(se,{size:"sm",variant:"flat",color:O.success?"success":"danger",startContent:e.jsx(o,{icon:O.success?"lucide:check":"lucide:x",width:12}),children:O.message})})]})}),e.jsx(ae,{children:e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-2",children:[e.jsx(o,{icon:"lucide:settings",width:16}),"Fetch Options"]}),e.jsx(be,{label:"Prefix Filter (Optional)",placeholder:"e.g., shelter/ or shelter/peninsula/",value:V,onValueChange:E,description:"Filter objects by prefix to limit the search scope",startContent:e.jsx(o,{icon:"lucide:filter",width:16}),isDisabled:Q,classNames:{input:"urbana-input"}}),e.jsx(as,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm",children:"Import Mode"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(_e,{isSelected:l==="update",onValueChange:S=>C(S?"update":"replace"),isDisabled:Q,size:"sm",children:e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium",children:"Update existing products only"}),e.jsx("div",{className:"text-xs text-foreground-500",children:"Only update assets for products that already exist in your store"})]})}),e.jsx(_e,{isSelected:l==="replace",onValueChange:S=>C(S?"replace":"update"),isDisabled:Q,size:"sm",children:e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium",children:"Replace entire structure"}),e.jsx("div",{className:"text-xs text-foreground-500",children:"Clear existing data and import complete structure from Digital Ocean"})]})})]})]}),l==="replace"&&e.jsx("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-warning-700",children:[e.jsx("strong",{children:"Warning:"})," This will clear all existing product groups, ranges, and products, then import the complete structure from Digital Ocean Spaces."]})]})})]})})}),Q&&e.jsx(ae,{className:"border-primary",children:e.jsx(re,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:loader",width:16,className:"animate-spin text-primary"}),e.jsx("span",{className:"font-semibold",children:"Fetching Assets..."})]}),e.jsx(Ws,{isIndeterminate:!0,color:"primary",size:"sm",className:"w-full"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Please wait while we fetch assets from Digital Ocean Spaces..."})]})})}),k&&e.jsx(ae,{className:k.success?"border-success":"border-danger",children:e.jsx(re,{children:e.jsxs(Ce,{"aria-label":"Fetch Results",children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:bar-chart",width:16}),"Summary"]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:k.success?"lucide:check-circle":"lucide:x-circle",width:16,className:k.success?"text-success":"text-danger"}),e.jsx("span",{className:"font-semibold",children:k.success?"Fetch Successful!":"Fetch Failed"})]}),e.jsx("p",{className:"text-sm",children:k.message}),k.success&&e.jsxs("div",{className:"grid grid-cols-7 gap-4 text-center mt-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:I.categories}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Categories"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-secondary",children:I.ranges}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Ranges"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:I.products}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Products"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:I.totalFiles}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Files"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-danger",children:I.totalFolders}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Folders"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:I.optionGroups}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Option Groups"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-secondary",children:I.optionImages}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Option Images"})]})]})]})},"summary"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:folder-tree",width:16}),"Structure"]}),children:e.jsx(Ye,{className:"max-h-96",children:e.jsx("div",{className:"text-sm",children:Object.keys(k.structured_data).length>0?N(k.structured_data):e.jsxs("div",{className:"text-center text-foreground-500 py-8",children:[e.jsx(o,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No structured data found"})]})})})},"structure"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:bug",width:16}),"Debug"]}),children:e.jsx(Ye,{className:"max-h-96",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Configuration"}),e.jsx(ls,{className:"text-xs",children:JSON.stringify(k.debug_info.configuration,null,2)})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Folders Found"}),e.jsx(Ye,{className:"max-h-32",children:e.jsx(ls,{className:"text-xs",children:k.raw_folders.length>0?k.raw_folders.join(`
`):"No folders found"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Fetch Summary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Prefix: ",k.debug_info.prefix||"(none)"]}),e.jsxs("div",{children:["Total Folders: ",k.total_folders]}),e.jsxs("div",{children:["Total Objects: ",k.total_objects]}),e.jsxs("div",{children:["Categories Found: ",k.debug_info.categories.join(", ")||"(none)"]})]})]}),k.raw_objects.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Sample Objects"}),e.jsx(Ye,{className:"max-h-32",children:e.jsx(ls,{className:"text-xs",children:JSON.stringify(k.raw_objects.slice(0,5),null,2)})})]})]})})},"debug")]})})}),!k&&(y==null?void 0:y.configured)&&e.jsx(ae,{className:"bg-primary-50 border-primary",children:e.jsx(re,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-primary-600 flex items-center gap-2 mb-2",children:[e.jsx(o,{icon:"lucide:info",width:16}),"Instructions"]}),e.jsxs("ul",{className:"text-sm space-y-2 text-foreground-600",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Expected folder structure: category/range/product_code/type/filename"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Example: shelter/peninsula/k302/images/hero.jpg"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),'Type folders should be either "images" or "downloads" or "img_conf"']}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(o,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Use prefix filter to limit search scope for better performance"]})]})]})})})]})}),e.jsxs(qe,{children:[e.jsx(U,{variant:"light",onPress:ce,isDisabled:Q||H,children:k?"Close":"Cancel"}),!k&&e.jsx(U,{color:"primary",onPress:ne,isLoading:Q,isDisabled:!(y!=null&&y.configured)||Q||H,startContent:Q?void 0:e.jsx(o,{icon:"lucide:cloud-download",width:16}),children:Q?"Fetching...":"Fetch Assets"})]})]})})})},Kt=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,exportData:n,importData:i,error:c,productData:h,loadData:p,saveData:u,isLoading:d,isSaving:m,isDirty:x,lastSaved:j,initializeFromWindowData:y,clearError:R}=we(),[q,_]=G.useState(null),{isOpen:H,onOpen:L,onOpenChange:Q}=Ge();G.useEffect(()=>{const v=window.urbanaAdmin;v&&(y(),_(v.stepperId||1))},[y]);const z=async()=>{try{R();const v=await u();v&&_(v),fe({color:"success",title:"Data saved successfully!"})}catch(v){console.error("Failed to save data:",v),fe({color:"danger",title:"Failed to save data. Please try again."})}},O=async v=>{try{const f=new URL(window.location.href);f.searchParams.set("stepper_id",v.toString()),window.location.href=f.toString()}catch(f){console.error("Failed to load data builder:",f),fe({color:"danger",title:"Failed to load data builder"})}},b=()=>{try{const v=n(),f="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(v,null,2)),T=document.createElement("a");T.setAttribute("href",f),T.setAttribute("download","product-configurator-data.json"),document.body.appendChild(T),T.click(),T.remove(),fe({color:"success",title:"Data exported successfully!"})}catch(v){console.error("Export failed:",v),fe({color:"danger",title:"Failed to export data"})}},k=v=>{var V;const f=(V=v.target.files)==null?void 0:V[0];if(!f)return;const T=new FileReader;T.onload=E=>{var l;try{const C=JSON.parse((l=E.target)==null?void 0:l.result);i(C),v.target.value="",fe({color:"success",title:"Data imported successfully!"})}catch(C){console.error("Error parsing imported data:",C),fe({color:"danger",title:"Invalid data format. Please check your JSON file."})}},T.readAsText(f)};return e.jsxs("div",{className:"urbana-builder-page max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-foreground",children:["Data Management",q&&e.jsxs("span",{className:"text-sm text-foreground-500 ml-2",children:["(Stepper ID: ",q,")"]})]}),e.jsx("p",{className:"text-sm text-foreground-500 mt-1",children:"Manage product groups, ranges, products, and their relationships"})]})}),e.jsxs("div",{className:"flex gap-2",children:[j&&e.jsxs("div",{className:"text-sm text-foreground-500 text-right ml-6",children:[e.jsx("div",{className:"text-xs",children:"Last saved:"}),e.jsx("div",{className:"font-medium",children:new Date(j).toLocaleString()})]}),e.jsx(U,{color:x?"primary":"success",variant:x?"solid":"flat",onPress:z,isLoading:m,isDisabled:m,startContent:m?"":e.jsx(o,{icon:"lucide:save",width:18}),children:m?"Saving...":x?"Save Changes":"Save Data"}),e.jsx(U,{color:"primary",variant:"flat",onPress:b,startContent:e.jsx(o,{icon:"lucide:download",width:18}),children:"Export Data"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(U,{color:"primary",variant:"flat",as:"span",startContent:e.jsx(o,{icon:"lucide:upload",width:18}),children:"Import Data"}),e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:k})]}),e.jsx(U,{color:"warning",variant:"flat",onPress:L,startContent:e.jsx(o,{icon:"lucide:cloud-download",width:18}),isDisabled:t.length===0,children:"Fetch from Digital Ocean"})]})]}),e.jsx(ae,{className:"p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Switch to Stepper ID:"}),e.jsx("input",{type:"number",min:"1",className:"px-3 py-2 border rounded-md w-20",placeholder:"ID",onKeyDown:v=>{if(v.key==="Enter"){const f=parseInt(v.target.value);f>0&&O(f)}}}),e.jsx(U,{size:"sm",color:"primary",variant:"flat",onPress:()=>{const v=document.querySelector('input[type="number"]'),f=parseInt(v.value);f>0&&O(f)},children:"Switch"})]})}),e.jsx(ae,{className:"p-0",children:e.jsxs(Ce,{"aria-label":"Data Builder Tabs",fullWidth:!0,classNames:{tabList:"gap-0"},children:[e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:layers",width:18}),e.jsx("span",{children:"Product Groups"}),e.jsx("span",{className:"text-xs bg-primary-100 text-primary-800 px-2 py-0.5 rounded-full",children:s.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Gt,{})})},"groups"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:grid-3x3",width:18}),e.jsx("span",{children:"Product Ranges"}),e.jsx("span",{className:"text-xs bg-secondary-100 text-secondary-800 px-2 py-0.5 rounded-full",children:a.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Ut,{})})},"ranges"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:package",width:18}),e.jsx("span",{children:"Products"}),e.jsx("span",{className:"text-xs bg-success-100 text-success-800 px-2 py-0.5 rounded-full",children:t.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Jt,{stepperID:q})})},"products"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:link",width:18}),e.jsx("span",{children:"Relationships"})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Ht,{})})},"relationships"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:refresh-cw",width:18}),e.jsx("span",{children:"Bi-Directional Sync"})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Xt,{})})},"sync"),e.jsx(me,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{icon:"lucide:eye",width:18}),e.jsx("span",{children:"Data Preview"})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Vt,{})})},"preview")]})}),e.jsx(Yt,{isOpen:H,onOpenChange:Q})]})};function Qt(){const{productGroups:s,isLoading:a,error:t,clearError:r,initializeFromWindowData:n,loadData:i}=we();G.useEffect(()=>{window.urbanaAdmin&&s.length===0&&n()},[n,s.length]);const c=async()=>{try{r(),await i()}catch(h){console.error("Load failed:",h)}};return a?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(Te,{size:"lg"}),e.jsx("p",{className:"text-foreground-600",children:"Loading product data..."})]})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"py-6 px-4 sm:px-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Product Data Builder"}),e.jsx("p",{className:"text-foreground-500 mt-2",children:"Create and manage product configuration data"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(U,{variant:"flat",color:"primary",startContent:e.jsx(o,{icon:"lucide:refresh-cw",width:18}),onPress:c,isLoading:a,children:"Refresh Data"})})]}),t&&e.jsx(pt,{color:"danger",variant:"flat",className:"mb-6",title:"Error",description:t,endContent:e.jsx(U,{variant:"light",color:"danger",size:"sm",onPress:r,children:"Dismiss"})}),e.jsx(Kt,{})]})})}document.getElementById("urbana-data-builder-root");const Zt=()=>{const s=document.getElementById("urbana-data-builder-root");return s?(ut.createRoot(s).render(e.jsx(oe.StrictMode,{children:e.jsxs(jt,{children:[e.jsx(xt,{}),e.jsx("main",{className:"text-foreground bg-background",children:e.jsx(Qt,{})})]})})),!0):!1},ea=(s=20,a=100)=>{let t=0,r=!1;const n=()=>{t++,r=Zt(),!(r||t>=s)&&setTimeout(n,a)};n()};ea(20,100);
