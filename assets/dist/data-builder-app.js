var Ns=Object.defineProperty;var Ds=(e,n,r)=>n in e?Ns(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;var rr=(e,n,r)=>Ds(e,typeof n!="symbol"?n+"":n,r);import{t as Mn,q as ve,r as wn,v as Ss,b as a,j as t,x as Cs,y as jr,z as Os,u as sr,$ as Ps,A as Rs,e as he,c as Rn,m as ae,B as ir,C as Vt,D as _s,f as Ar,E as Es,G as ks,w as re,d as V,I as f,g as ce,h as de,F as ke,l as Ee,s as it,o as nt,i as fe,k as ge,H as Ot,J as Ts,n as ye,K as It,L as js,M as As,N as Yt,O as at,P as Is,p as Nt,Q as Kt,R as Fs}from"./iconPatch.js";import{u as zs,p as $s,i as Ls,d as Se,a as Ir,b as Fr,c as Gs,T as Ms}from"./productData.js";import{a as Us,d as Bs,t as Pt,c as Ve,H as Ws}from"./middleware.js";import{u as Ft,c as ie,m as zt,a as $t,b as Lt,d as Gt,e as Mt}from"./index.js";import{d as Ut,a as Bt,b as Wt,m as Fe}from"./chunk-XHRYXXZA.js";import{t as Ye,a as we,c as De}from"./chunk-ML27DD5T.js";import{p as zr,c as xn}from"./chunk-XVMALT6H.js";import"./accelerated-values.js";var qs=Mn({slots:{base:["flex","relative","justify-center","items-center","box-border","overflow-hidden","align-middle","text-white","z-0",...Ss],img:["flex","object-cover","w-full","h-full","transition-opacity","!duration-500","opacity-0","data-[loaded=true]:opacity-100"],fallback:[...wn,"flex","items-center","justify-center"],name:[...wn,"font-normal","text-center","text-inherit"],icon:[...wn,"flex","items-center","justify-center","text-inherit","w-full","h-full"]},variants:{size:{sm:{base:"w-8 h-8 text-tiny"},md:{base:"w-10 h-10 text-tiny"},lg:{base:"w-14 h-14 text-small"}},color:{default:{base:ve.solid.default},primary:{base:ve.solid.primary},secondary:{base:ve.solid.secondary},success:{base:ve.solid.success},warning:{base:ve.solid.warning},danger:{base:ve.solid.danger}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},isBordered:{true:{base:"ring-2 ring-offset-2 ring-offset-background dark:ring-offset-background-dark"}},isDisabled:{true:{base:"opacity-disabled"}},isInGroup:{true:{base:["-ms-2 data-[hover=true]:-translate-x-3 rtl:data-[hover=true]:translate-x-3 transition-transform","data-[focus-visible=true]:-translate-x-3 rtl:data-[focus-visible=true]:translate-x-3"]}},isInGridGroup:{true:{base:"m-0 data-[hover=true]:translate-x-0"}},disableAnimation:{true:{base:"transition-none",img:"transition-none"},false:{}}},defaultVariants:{size:"md",color:"default",radius:"full"},compoundVariants:[{color:"default",isBordered:!0,class:{base:"ring-default"}},{color:"primary",isBordered:!0,class:{base:"ring-primary"}},{color:"secondary",isBordered:!0,class:{base:"ring-secondary"}},{color:"success",isBordered:!0,class:{base:"ring-success"}},{color:"warning",isBordered:!0,class:{base:"ring-warning"}},{color:"danger",isBordered:!0,class:{base:"ring-danger"}}]});Mn({slots:{base:"flex items-center justify-center h-auto w-max",count:"hover:-translate-x-0"},variants:{isGrid:{true:"inline-grid grid-cols-4 gap-3"}}});var ar=Mn({slots:{base:["relative","inline-flex","shrink-0"],badge:["flex","z-10","flex-wrap","absolute","box-border","rounded-full","whitespace-nowrap","place-content-center","origin-center","items-center","text-inherit","select-none","font-regular","scale-100","opacity-100","subpixel-antialiased","data-[invisible=true]:scale-0","data-[invisible=true]:opacity-0"]},variants:{variant:{solid:{},flat:{},faded:{badge:"border-medium"},shadow:{}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{badge:"px-1 text-tiny"},md:{badge:"px-1 text-small"},lg:{badge:"px-1 text-small"}},placement:{"top-right":{},"top-left":{},"bottom-right":{},"bottom-left":{}},shape:{circle:{},rectangle:{}},isInvisible:{true:{}},isOneChar:{true:{badge:"px-0"}},isDot:{true:{}},disableAnimation:{true:{badge:"transition-none"},false:{badge:"transition-transform-opacity !ease-soft-spring !duration-300"}},showOutline:{true:{badge:"border-2 border-background"},false:{badge:"border-transparent border-0"}}},defaultVariants:{variant:"solid",color:"default",size:"md",shape:"rectangle",placement:"top-right",showOutline:!0,isInvisible:!1},compoundVariants:[{variant:"solid",color:"default",class:{badge:ve.solid.default}},{variant:"solid",color:"primary",class:{badge:ve.solid.primary}},{variant:"solid",color:"secondary",class:{badge:ve.solid.secondary}},{variant:"solid",color:"success",class:{badge:ve.solid.success}},{variant:"solid",color:"warning",class:{badge:ve.solid.warning}},{variant:"solid",color:"danger",class:{badge:ve.solid.danger}},{variant:"shadow",color:"default",class:{badge:ve.shadow.default}},{variant:"shadow",color:"primary",class:{badge:ve.shadow.primary}},{variant:"shadow",color:"secondary",class:{badge:ve.shadow.secondary}},{variant:"shadow",color:"success",class:{badge:ve.shadow.success}},{variant:"shadow",color:"warning",class:{badge:ve.shadow.warning}},{variant:"shadow",color:"danger",class:{badge:ve.shadow.danger}},{variant:"flat",color:"default",class:{badge:ve.flat.default}},{variant:"flat",color:"primary",class:{badge:ve.flat.primary}},{variant:"flat",color:"secondary",class:{badge:ve.flat.secondary}},{variant:"flat",color:"success",class:{badge:ve.flat.success}},{variant:"flat",color:"warning",class:{badge:ve.flat.warning}},{variant:"flat",color:"danger",class:{badge:ve.flat.danger}},{variant:"faded",color:"default",class:{badge:ve.faded.default}},{variant:"faded",color:"primary",class:{badge:ve.faded.primary}},{variant:"faded",color:"secondary",class:{badge:ve.faded.secondary}},{variant:"faded",color:"success",class:{badge:ve.faded.success}},{variant:"faded",color:"warning",class:{badge:ve.faded.warning}},{variant:"faded",color:"danger",class:{badge:ve.faded.danger}},{isOneChar:!0,size:"sm",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{isOneChar:!0,size:"md",class:{badge:"w-5 h-5 min-w-5 min-h-5"}},{isOneChar:!0,size:"lg",class:{badge:"w-6 h-6 min-w-6 min-h-6"}},{isDot:!0,size:"sm",class:{badge:"w-3 h-3 min-w-3 min-h-3"}},{isDot:!0,size:"md",class:{badge:"w-3.5 h-3.5 min-w-3.5 min-h-3.5"}},{isDot:!0,size:"lg",class:{badge:"w-4 h-4 min-w-4 min-h-4"}},{placement:"top-right",shape:"rectangle",class:{badge:"top-[5%] right-[5%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"rectangle",class:{badge:"top-[5%] left-[5%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"rectangle",class:{badge:"bottom-[5%] right-[5%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"rectangle",class:{badge:"bottom-[5%] left-[5%] -translate-x-1/2 translate-y-1/2"}},{placement:"top-right",shape:"circle",class:{badge:"top-[10%] right-[10%] translate-x-1/2 -translate-y-1/2"}},{placement:"top-left",shape:"circle",class:{badge:"top-[10%] left-[10%] -translate-x-1/2 -translate-y-1/2"}},{placement:"bottom-right",shape:"circle",class:{badge:"bottom-[10%] right-[10%] translate-x-1/2 translate-y-1/2"}},{placement:"bottom-left",shape:"circle",class:{badge:"bottom-[10%] left-[10%] -translate-x-1/2 translate-y-1/2"}}]}),Js=()=>a("svg",{"aria-hidden":"true",fill:"none",height:"80%",role:"presentation",viewBox:"0 0 24 24",width:"80%",children:[t("path",{d:"M12 2C9.38 2 7.25 4.13 7.25 6.75C7.25 9.32 9.26 11.4 11.88 11.49C11.96 11.48 12.04 11.48 12.1 11.49C12.12 11.49 12.13 11.49 12.15 11.49C12.16 11.49 12.16 11.49 12.17 11.49C14.73 11.4 16.74 9.32 16.75 6.75C16.75 4.13 14.62 2 12 2Z",fill:"currentColor"}),t("path",{d:"M17.0809 14.1489C14.2909 12.2889 9.74094 12.2889 6.93094 14.1489C5.66094 14.9989 4.96094 16.1489 4.96094 17.3789C4.96094 18.6089 5.66094 19.7489 6.92094 20.5889C8.32094 21.5289 10.1609 21.9989 12.0009 21.9989C13.8409 21.9989 15.6809 21.5289 17.0809 20.5889C18.3409 19.7389 19.0409 18.5989 19.0409 17.3589C19.0309 16.1289 18.3409 14.9889 17.0809 14.1489Z",fill:"currentColor"})]}),[Co,Xs]=Cs({name:"AvatarGroupContext",strict:!1});function Hs(e={}){var n,r,s,i,o,c,l,u;const d=jr(),m=Xs(),h=!!m,{as:g,ref:v,src:P,name:C,icon:I,classNames:R,fallback:L,alt:E=C||"avatar",imgRef:M,color:j=(n=m==null?void 0:m.color)!=null?n:"default",radius:y=(r=m==null?void 0:m.radius)!=null?r:"full",size:b=(s=m==null?void 0:m.size)!=null?s:"md",isBordered:_=(i=m==null?void 0:m.isBordered)!=null?i:!1,isDisabled:S=(o=m==null?void 0:m.isDisabled)!=null?o:!1,isFocusable:w=!1,getInitials:F=Os,ignoreFallback:J=!1,showFallback:N=!1,ImgComponent:p="img",imgProps:x,className:G,onError:U,disableAnimation:K,...se}=e,le=g||"span",k=sr(v),O=sr(M),{isFocusVisible:A,isFocused:B,focusProps:q}=Ps(),{isHovered:X,hoverProps:ne}=Rs({isDisabled:S}),H=(c=K??(d==null?void 0:d.disableAnimation))!=null?c:!1,te=(u=typeof p=="object"&&((l=p==null?void 0:p.displayName)==null?void 0:l.includes("HeroUI")))!=null?u:!1,oe=zs({src:P,onError:U,ignoreFallback:J,shouldBypassImageLoad:g!==void 0||p!=="img"&&!te})==="loaded",me=!te,be=(!P||!oe)&&N,D=he(()=>{var ee;return qs({color:j,radius:y,size:b,isBordered:_,isDisabled:S,isInGroup:h,disableAnimation:H,isInGridGroup:(ee=m==null?void 0:m.isGrid)!=null?ee:!1})},[j,y,b,_,S,H,h,m==null?void 0:m.isGrid]),T=Rn(R==null?void 0:R.base,G),z=he(()=>w||g==="button",[w,g]),Z=ae((ee={})=>({ref:k,tabIndex:z?0:-1,"data-hover":Vt(X),"data-focus":Vt(B),"data-focus-visible":Vt(A),className:D.base({class:Rn(T,ee==null?void 0:ee.className)}),...ir(se,ne,z?q:{})}),[z,D,T,q,se]),Y=ae((ee={})=>({ref:O,src:P,"data-loaded":Vt(oe),className:D.img({class:R==null?void 0:R.img}),...ir(x,ee,_s({disableAnimation:H},{enabled:me}))}),[D,oe,x,H,P,O,me]);return{Component:le,ImgComponent:p,src:P,alt:E,icon:I,name:C,imgRef:O,slots:D,classNames:R,fallback:L,isImgLoaded:oe,showFallback:be,ignoreFallback:J,getInitials:F,getAvatarProps:Z,getImageProps:Y}}var $r=Ar((e,n)=>{const{Component:r,ImgComponent:s,src:i,icon:o=t(Js,{}),alt:c,classNames:l,slots:u,name:d,showFallback:m,fallback:h,getInitials:g,getAvatarProps:v,getImageProps:P}=Hs({...e,ref:n}),C=he(()=>!m&&i?null:h?t("div",{"aria-label":c,className:u.fallback({class:l==null?void 0:l.fallback}),role:"img",children:h}):d?t("span",{"aria-label":c,className:u.name({class:l==null?void 0:l.name}),role:"img",children:g(d)}):t("span",{"aria-label":c,className:u.icon({class:l==null?void 0:l.icon}),role:"img",children:o}),[m,i,h,d,l]);return a(r,{...v(),children:[i&&t(s,{...P(),alt:c}),C]})});$r.displayName="HeroUI.Avatar";var st=$r;function Vs(e){var n,r;const s=jr(),i=(r=(n=e==null?void 0:e.disableAnimation)!=null?n:s==null?void 0:s.disableAnimation)!=null?r:!1,[o,c]=Es(e,ar.variantKeys),{as:l,children:u,className:d,content:m,classNames:h,...g}=o,v=l||"span",P=he(()=>{var E;return((E=String(m))==null?void 0:E.length)===1||(e==null?void 0:e.isOneChar)},[m,e==null?void 0:e.isOneChar]),C=he(()=>{var E;return((E=String(m))==null?void 0:E.length)===0},[m]),I=Rn(h==null?void 0:h.badge,d),R=he(()=>ar({...c,showOutline:e!=null&&e.disableOutline?!(e!=null&&e.disableOutline):e==null?void 0:e.showOutline,isOneChar:P,isDot:C}),[ks(c),P,C]),L=()=>({className:R.badge({class:I}),"data-invisible":e.isInvisible,...g});return{Component:v,children:u,content:m,slots:R,classNames:h,disableAnimation:i,isInvisible:e==null?void 0:e.isInvisible,getBadgeProps:L}}var Lr=Ar((e,n)=>{const{Component:r,children:s,content:i,slots:o,classNames:c,getBadgeProps:l}=Vs({...e});return a("div",{className:o.base({class:c==null?void 0:c.base}),children:[s,t(r,{ref:n,...l(),children:i})]})});Lr.displayName="HeroUI.Badge";var or=Lr,Gr=Symbol.for("immer-nothing"),cr=Symbol.for("immer-draftable"),ze=Symbol.for("immer-state");function Me(e,...n){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Rt=Object.getPrototypeOf;function mt(e){return!!e&&!!e[ze]}function ot(e){var n;return e?Mr(e)||Array.isArray(e)||!!e[cr]||!!((n=e.constructor)!=null&&n[cr])||qt(e)||un(e):!1}var Ys=Object.prototype.constructor.toString(),lr=new WeakMap;function Mr(e){if(!e||typeof e!="object")return!1;const n=Object.getPrototypeOf(e);if(n===null||n===Object.prototype)return!0;const r=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;if(r===Object)return!0;if(typeof r!="function")return!1;let s=lr.get(r);return s===void 0&&(s=Function.toString.call(r),lr.set(r,s)),s===Ys}function nn(e,n,r=!0){dn(e)===0?(r?Reflect.ownKeys(e):Object.keys(e)).forEach(i=>{n(i,e[i],e)}):e.forEach((s,i)=>n(i,s,e))}function dn(e){const n=e[ze];return n?n.type_:Array.isArray(e)?1:qt(e)?2:un(e)?3:0}function _n(e,n){return dn(e)===2?e.has(n):Object.prototype.hasOwnProperty.call(e,n)}function Ur(e,n,r){const s=dn(e);s===2?e.set(n,r):s===3?e.add(r):e[n]=r}function Ks(e,n){return e===n?e!==0||1/e===1/n:e!==e&&n!==n}function qt(e){return e instanceof Map}function un(e){return e instanceof Set}function rt(e){return e.copy_||e.base_}function En(e,n){if(qt(e))return new Map(e);if(un(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=Mr(e);if(n===!0||n==="class_only"&&!r){const s=Object.getOwnPropertyDescriptors(e);delete s[ze];let i=Reflect.ownKeys(s);for(let o=0;o<i.length;o++){const c=i[o],l=s[c];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(s[c]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[c]})}return Object.create(Rt(e),s)}else{const s=Rt(e);if(s!==null&&r)return{...e};const i=Object.create(s);return Object.assign(i,e)}}function Un(e,n=!1){return hn(e)||mt(e)||!ot(e)||(dn(e)>1&&Object.defineProperties(e,{set:Qt,add:Qt,clear:Qt,delete:Qt}),Object.freeze(e),n&&Object.values(e).forEach(r=>Un(r,!0))),e}function Qs(){Me(2)}var Qt={value:Qs};function hn(e){return e===null||typeof e!="object"?!0:Object.isFrozen(e)}var Zs={};function ct(e){const n=Zs[e];return n||Me(0,e),n}var _t;function Br(){return _t}function ei(e,n){return{drafts_:[],parent_:e,immer_:n,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function dr(e,n){n&&(ct("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=n)}function kn(e){Tn(e),e.drafts_.forEach(ti),e.drafts_=null}function Tn(e){e===_t&&(_t=e.parent_)}function ur(e){return _t=ei(_t,e)}function ti(e){const n=e[ze];n.type_===0||n.type_===1?n.revoke_():n.revoked_=!0}function hr(e,n){n.unfinalizedDrafts_=n.drafts_.length;const r=n.drafts_[0];return e!==void 0&&e!==r?(r[ze].modified_&&(kn(n),Me(4)),ot(e)&&(e=rn(n,e),n.parent_||sn(n,e)),n.patches_&&ct("Patches").generateReplacementPatches_(r[ze].base_,e,n.patches_,n.inversePatches_)):e=rn(n,r,[]),kn(n),n.patches_&&n.patchListener_(n.patches_,n.inversePatches_),e!==Gr?e:void 0}function rn(e,n,r){if(hn(n))return n;const s=e.immer_.shouldUseStrictIteration(),i=n[ze];if(!i)return nn(n,(o,c)=>mr(e,i,n,o,c,r),s),n;if(i.scope_!==e)return n;if(!i.modified_)return sn(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const o=i.copy_;let c=o,l=!1;i.type_===3&&(c=new Set(o),o.clear(),l=!0),nn(c,(u,d)=>mr(e,i,o,u,d,r,l),s),sn(e,o,!1),r&&e.patches_&&ct("Patches").generatePatches_(i,r,e.patches_,e.inversePatches_)}return i.copy_}function mr(e,n,r,s,i,o,c){if(i==null||typeof i!="object"&&!c)return;const l=hn(i);if(!(l&&!c)){if(mt(i)){const u=o&&n&&n.type_!==3&&!_n(n.assigned_,s)?o.concat(s):void 0,d=rn(e,i,u);if(Ur(r,s,d),mt(d))e.canAutoFreeze_=!1;else return}else c&&r.add(i);if(ot(i)&&!l){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||n&&n.base_&&n.base_[s]===i&&l)return;rn(e,i),(!n||!n.scope_.parent_)&&typeof s!="symbol"&&(qt(r)?r.has(s):Object.prototype.propertyIsEnumerable.call(r,s))&&sn(e,i)}}}function sn(e,n,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Un(n,r)}function ni(e,n){const r=Array.isArray(e),s={type_:r?1:0,scope_:n?n.scope_:Br(),modified_:!1,finalized_:!1,assigned_:{},parent_:n,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=s,o=Bn;r&&(i=[s],o=Et);const{revoke:c,proxy:l}=Proxy.revocable(i,o);return s.draft_=l,s.revoke_=c,l}var Bn={get(e,n){if(n===ze)return e;const r=rt(e);if(!_n(r,n))return ri(e,r,n);const s=r[n];return e.finalized_||!ot(s)?s:s===yn(e.base_,n)?(Nn(e),e.copy_[n]=An(s,e)):s},has(e,n){return n in rt(e)},ownKeys(e){return Reflect.ownKeys(rt(e))},set(e,n,r){const s=Wr(rt(e),n);if(s!=null&&s.set)return s.set.call(e.draft_,r),!0;if(!e.modified_){const i=yn(rt(e),n),o=i==null?void 0:i[ze];if(o&&o.base_===r)return e.copy_[n]=r,e.assigned_[n]=!1,!0;if(Ks(r,i)&&(r!==void 0||_n(e.base_,n)))return!0;Nn(e),jn(e)}return e.copy_[n]===r&&(r!==void 0||n in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[n])||(e.copy_[n]=r,e.assigned_[n]=!0),!0},deleteProperty(e,n){return yn(e.base_,n)!==void 0||n in e.base_?(e.assigned_[n]=!1,Nn(e),jn(e)):delete e.assigned_[n],e.copy_&&delete e.copy_[n],!0},getOwnPropertyDescriptor(e,n){const r=rt(e),s=Reflect.getOwnPropertyDescriptor(r,n);return s&&{writable:!0,configurable:e.type_!==1||n!=="length",enumerable:s.enumerable,value:r[n]}},defineProperty(){Me(11)},getPrototypeOf(e){return Rt(e.base_)},setPrototypeOf(){Me(12)}},Et={};nn(Bn,(e,n)=>{Et[e]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}});Et.deleteProperty=function(e,n){return Et.set.call(this,e,n,void 0)};Et.set=function(e,n,r){return Bn.set.call(this,e[0],n,r,e[0])};function yn(e,n){const r=e[ze];return(r?rt(r):e)[n]}function ri(e,n,r){var i;const s=Wr(n,r);return s?"value"in s?s.value:(i=s.get)==null?void 0:i.call(e.draft_):void 0}function Wr(e,n){if(!(n in e))return;let r=Rt(e);for(;r;){const s=Object.getOwnPropertyDescriptor(r,n);if(s)return s;r=Rt(r)}}function jn(e){e.modified_||(e.modified_=!0,e.parent_&&jn(e.parent_))}function Nn(e){e.copy_||(e.copy_=En(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var si=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(n,r,s)=>{if(typeof n=="function"&&typeof r!="function"){const o=r;r=n;const c=this;return function(u=o,...d){return c.produce(u,m=>r.call(this,m,...d))}}typeof r!="function"&&Me(6),s!==void 0&&typeof s!="function"&&Me(7);let i;if(ot(n)){const o=ur(this),c=An(n,void 0);let l=!0;try{i=r(c),l=!1}finally{l?kn(o):Tn(o)}return dr(o,s),hr(i,o)}else if(!n||typeof n!="object"){if(i=r(n),i===void 0&&(i=n),i===Gr&&(i=void 0),this.autoFreeze_&&Un(i,!0),s){const o=[],c=[];ct("Patches").generateReplacementPatches_(n,i,o,c),s(o,c)}return i}else Me(1,n)},this.produceWithPatches=(n,r)=>{if(typeof n=="function")return(c,...l)=>this.produceWithPatches(c,u=>n(u,...l));let s,i;return[this.produce(n,r,(c,l)=>{s=c,i=l}),s,i]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),typeof(e==null?void 0:e.useStrictIteration)=="boolean"&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){ot(e)||Me(8),mt(e)&&(e=ii(e));const n=ur(this),r=An(e,void 0);return r[ze].isManual_=!0,Tn(n),r}finishDraft(e,n){const r=e&&e[ze];(!r||!r.isManual_)&&Me(9);const{scope_:s}=r;return dr(s,n),hr(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,n){let r;for(r=n.length-1;r>=0;r--){const i=n[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(n=n.slice(r+1));const s=ct("Patches").applyPatches_;return mt(e)?s(e,n):this.produce(e,i=>s(i,n))}};function An(e,n){const r=qt(e)?ct("MapSet").proxyMap_(e,n):un(e)?ct("MapSet").proxySet_(e,n):ni(e,n);return(n?n.scope_:Br()).drafts_.push(r),r}function ii(e){return mt(e)||Me(10,e),qr(e)}function qr(e){if(!ot(e)||hn(e))return e;const n=e[ze];let r,s=!0;if(n){if(!n.modified_)return n.base_;n.finalized_=!0,r=En(e,n.scope_.immer_.useStrictShallowCopy_),s=n.scope_.immer_.shouldUseStrictIteration()}else r=En(e,!0);return nn(r,(i,o)=>{Ur(r,i,qr(o))},s),n&&(n.finalized_=!1),r}var ai=new si,oi=ai.produce;const ci=e=>(n,r,s)=>(s.setState=(i,o,...c)=>{const l=typeof i=="function"?oi(i):i;return n(l,o,...c)},e(s.setState,r,s)),li=ci,Ge=e=>e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),pr=e=>({Shelter:"lucide:home",Toilet:"lucide:bath",Bridge:"lucide:route",Access:"lucide:wheelchair",Seating:"lucide:armchair",Lighting:"lucide:lamp"})[e]||"lucide:box",fr=e=>({Shelter:"Outdoor structures for shade and protection",Toilet:"Public and portable sanitation facilities",Bridge:"Pedestrian and light vehicle crossings",Access:"Ramps, stairs, and accessibility solutions",Seating:"Benches and outdoor furniture options",Lighting:"Outdoor and pathway lighting solutions"})[e]||"Product category",gr=e=>({Peninsula:"Modern shelters with excellent weather protection for parks and urban settings",Whyalla:"Robust shelters designed for coastal and high-wind environments",Coastal:"Corrosion-resistant designs perfect for beachfront and marine locations",Urban:"Contemporary designs that blend with modern city landscapes",Heritage:"Traditional designs that complement historic and cultural settings",EcoSan:"Environmentally friendly composting toilet solutions with minimal water usage",Standard:"Reliable and cost-effective public toilet facilities",Accessible:"Fully compliant accessible toilet facilities with enhanced features",Premium:"High-end toilet facilities with superior finishes and amenities",Compact:"Space-saving designs for areas with limited footprint","Small Span":"Compact bridges for garden paths and small water crossings","Large Span":"Extended bridges for wider crossings and heavier loads",Pedestrian:"Dedicated walkways designed for high foot traffic areas",Decorative:"Ornamental bridges that serve as landscape features","Heavy Duty":"Reinforced bridges capable of supporting maintenance vehicles"})[e]||`${e} product range`,vr=e=>{const n={Peninsula:["Modern","Weather-resistant","Versatile"],Whyalla:["Robust","Wind-resistant","Durable"],Coastal:["Corrosion-resistant","Salt-proof","UV-stable"],Urban:["Contemporary","Modular","Space-efficient"],Heritage:["Traditional","Ornate","Classic"],EcoSan:["Eco-friendly","Low-water","Composting"],Standard:["Cost-effective","Reliable","Low-maintenance"],Accessible:["ADA Compliant","Spacious","Universal"],Premium:["High-end","Enhanced features","Superior finishes"],Compact:["Space-saving","Efficient","Urban-friendly"],"Small Span":["Compact","Decorative","Easy-install"],"Large Span":["Extended","Reinforced","Heavy-load"],Pedestrian:["High-traffic","Safety-focused","Accessible"],Decorative:["Ornamental","Artistic","Feature piece"],"Heavy Duty":["Vehicle-rated","Industrial","Maximum strength"],default:["Quality","Durable","Customizable"]};return n[e]||n.default},Dn={id:1,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:[]},{step:2,title:"Select Product Range",ranges:{}},{step:3,title:"Select Individual Product",products:{}},{step:4,title:"View Product Content",productDetails:{}},{step:5,title:"Configure Options",options:{}},{step:6,title:"Contact Information",fields:[{name:"fullName",label:"Full Name",type:"text",required:!0},{name:"email",label:"Email Address",type:"email",required:!0},{name:"phone",label:"Phone Number",type:"tel",required:!1},{name:"company",label:"Company/Organization",type:"text",required:!1},{name:"message",label:"Additional Notes",type:"textarea",required:!1}]}]}},Re=Us()(Bs(li((e,n)=>({productData:Dn,productGroups:[],productRanges:[],products:[],relationships:{groupToRanges:{},rangeToProducts:{}},isDirty:!1,isSaving:!1,isLoading:!1,lastSaved:null,error:null,initializeFromWindowData:()=>{const r=window.urbanaAdmin;if(!r){console.warn("No urbanaAdmin window data found");return}r.stepperFormData&&e(s=>{s.productData=r.stepperFormData}),r.stepperDataBuilder&&typeof r.stepperDataBuilder=="object"&&r.stepperDataBuilder.productGroups&&r.stepperDataBuilder.productGroups.length>0?e(s=>{s.productGroups=r.stepperDataBuilder.productGroups||[],s.productRanges=r.stepperDataBuilder.productRanges||[],s.products=r.stepperDataBuilder.products||[],s.relationships=r.stepperDataBuilder.relationships||{groupToRanges:{},rangeToProducts:{}},r.stepperDataBuilder.lastSaved&&(s.lastSaved=new Date(r.stepperDataBuilder.lastSaved)),s.isDirty=!1}):(console.log("No existing data builder data found, extracting from stepper form data"),r.stepperFormData&&r.stepperFormData.stepperForm?n().initializeFromProductData(r.stepperFormData):(n().initializeFromProductData($s),console.warn("No stepper form data found in window.urbanaAdmin")))},loadData:async r=>{var s;if(!r){n().initializeFromWindowData();return}e(i=>{i.isLoading=!0,i.error=null});try{const i=await fetch(`/wp-json/urbana/v1/data-builder/${r}`,{method:"GET",headers:{"X-WP-Nonce":((s=window.urbanaAdmin)==null?void 0:s.nonce)||""}});if(!i.ok)throw new Error(`Failed to load data: ${i.status} ${i.statusText}`);const o=await i.json();o.stepper_form_data&&e(c=>{c.productData=o.stepper_form_data}),o.stepper_data_builder&&typeof o.stepper_data_builder=="object"&&o.stepper_data_builder.productGroups&&o.stepper_data_builder.productGroups.length>0?(console.log("Loading existing API data builder data:",o.stepper_data_builder),e(c=>{c.productGroups=o.stepper_data_builder.productGroups||[],c.productRanges=o.stepper_data_builder.productRanges||[],c.products=o.stepper_data_builder.products||[],c.relationships=o.stepper_data_builder.relationships||{groupToRanges:{},rangeToProducts:{}},o.stepper_data_builder.lastSaved&&(c.lastSaved=new Date(o.stepper_data_builder.lastSaved))})):(console.log("No existing API data builder data found, extracting from stepper form data"),o.stepper_form_data&&n().initializeFromProductData(o.stepper_form_data))}catch(i){const o=i instanceof Error?i.message:"Unknown error occurred";throw console.error("Error loading data:",o),e(c=>{c.error=o}),i}finally{e(i=>{i.isLoading=!1})}},getRangesForGroup:r=>{const{productRanges:s,relationships:i}=n(),o=i.groupToRanges[r]||[];return s.filter(c=>o.includes(c.id))},getProductsForRange:r=>{const{products:s,relationships:i}=n(),o=i.rangeToProducts[r]||[];return s.filter(c=>o.includes(c.id))},getProductById:r=>{const{products:s}=n();return s.find(i=>i.id===r)},getGroupById:r=>{const{productGroups:s}=n();return s.find(i=>i.id===r)},getRangeById:r=>{const{productRanges:s}=n();return s.find(i=>i.id===r)},saveData:async()=>{var r;e(s=>{s.isSaving=!0,s.error=null});try{const s=n().exportData(),{productGroups:i,productRanges:o,products:c,relationships:l}=n();console.log("[saveData] Products being saved:",c),c.forEach(m=>{console.log(`[saveData] Product ${m.code} coreDesignElement:`,m.coreDesignElement),m.coreDesignElement&&m.coreDesignElement.forEach(h=>{console.log(`  Field: ${h.label}, type: ${h.type}, defaultValue: ${h.defaultValue}, values: ${JSON.stringify(h.values)}`)})});const u=await fetch("/wp-json/urbana/v1/product-data",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((r=window.urbanaAdmin)==null?void 0:r.nonce)||""},body:JSON.stringify({stepper_form_data:s,stepper_data_builder:{productGroups:i,productRanges:o,products:c,relationships:l,lastSaved:new Date().toISOString()}})});if(!u.ok)throw new Error(`Failed to save data: ${u.status} ${u.statusText}`);const d=await u.json();return e(m=>{m.productData=s,m.isDirty=!1,m.lastSaved=new Date}),console.log("Data saved successfully, stepper ID:",d.stepper_id),d.stepper_id}catch(s){const i=s instanceof Error?s.message:"Unknown error occurred";throw console.error("Error saving data:",i),e(o=>{o.error=i}),s}finally{e(s=>{s.isSaving=!1})}},initializeFromProductData:r=>e(s=>{s.productData=r;const i=(r.stepperForm.steps[0].categories||[]).map(d=>({id:Ge(d),name:d,icon:pr(d),description:fr(d)}));s.productGroups=i;const o=[];Object.entries(r.stepperForm.steps[1].ranges||{}).forEach(([d,m])=>{m.forEach(h=>{o.push({id:Ge(h),name:h,image:"",description:gr(h),tags:vr(h),groupName:d})})}),s.productRanges=o;const c=[];Object.entries(r.stepperForm.steps[2].products||{}).forEach(([d,m])=>{m.forEach(h=>{var v;const g=(v=r.stepperForm.steps[3].productDetails)==null?void 0:v[h];c.push({id:Ge(h),code:h,name:(g==null?void 0:g.name)||`${h} Product`,overview:(g==null?void 0:g.overview)||"",description:(g==null?void 0:g.description)||"",specifications:(g==null?void 0:g.specifications)||[],imageGallery:(g==null?void 0:g.imageGallery)||[],files:(g==null?void 0:g.files)||{}})})}),s.products=c;const l={};Object.entries(r.stepperForm.steps[1].ranges||{}).forEach(([d,m])=>{const h=Ge(d);l[h]=m.map(g=>Ge(g))});const u={};Object.entries(r.stepperForm.steps[2].products||{}).forEach(([d,m])=>{const h=Ge(d);u[h]=m.map(g=>Ge(g))}),s.relationships={groupToRanges:l,rangeToProducts:u}}),updateProductData:r=>e(s=>{s.productData=r,s.isDirty=!0}),exportData:()=>{const{productGroups:r,productRanges:s,products:i,relationships:o,productData:c}=n();return{id:c.id,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:r.map(u=>u.name)},{step:2,title:"Select Product Range",ranges:(()=>{const u={};return Object.entries(o.groupToRanges).forEach(([d,m])=>{const h=r.find(g=>g.id===d);h&&(u[h.name]=m.map(g=>{const v=s.find(P=>P.id===g);return v?v.name:""}).filter(g=>g!==""))}),u})()},{step:3,title:"Select Individual Product",products:(()=>{const u={};return Object.entries(o.rangeToProducts).forEach(([d,m])=>{const h=s.find(g=>g.id===d);h&&(u[h.name]=m.map(g=>{const v=i.find(P=>P.id===g);return v?v.code:""}).filter(g=>g!==""))}),u})()},{step:4,title:"View Product Content",productDetails:(()=>{const u={};return i.forEach(d=>{u[d.code]={name:d.name,overview:d.overview,description:d.description,specifications:d.specifications,imageGallery:d.imageGallery,files:d.files,faqs:d.faqs||[]}}),u})()},{step:5,title:"Configure Options",options:(()=>{const u={};return i.forEach(d=>{d.options&&Object.entries(d.options).forEach(([m,h])=>{u[m]||(u[m]=[]),h.forEach(g=>{u[m].some(P=>P.value===g.value)||u[m].push(g)})})}),u})(),productOptions:(()=>{const u={};return i.forEach(d=>{d.options&&Object.keys(d.options).length>0&&(u[d.code]=d.options)}),u})()},c.stepperForm.steps[5]||{step:6,title:"Contact Information",fields:Dn.stepperForm.steps[5].fields}]}}},addProductGroup:r=>e(s=>{const i=Ge(r.name),o={...r,id:i,icon:r.icon||pr(r.name),description:r.description||fr(r.name),active:r.active!==void 0?r.active:!0};s.productGroups.some(l=>l.id===i)||(s.productGroups.push(o),s.relationships.groupToRanges[i]=[],s.isDirty=!0)}),updateProductGroup:(r,s)=>e(i=>{const o=i.productGroups.findIndex(c=>c.id===r);o!==-1&&(i.productGroups[o]={...i.productGroups[o],...s},i.isDirty=!0)}),removeProductGroup:r=>e(s=>{s.productGroups=s.productGroups.filter(o=>o.id!==r),(s.relationships.groupToRanges[r]||[]).forEach(o=>{s.productRanges=s.productRanges.filter(l=>l.id!==o),(s.relationships.rangeToProducts[o]||[]).forEach(l=>{s.products=s.products.filter(u=>u.id!==l)}),delete s.relationships.rangeToProducts[o]}),delete s.relationships.groupToRanges[r],s.isDirty=!0}),addProductRange:r=>e(s=>{const i=Ge(r.name),o={...r,id:i,description:r.description||gr(r.name),tags:r.tags||vr(r.name),active:r.active!==void 0?r.active:!0,groupName:r.groupName||""};s.productRanges.some(l=>l.id===i)||(s.productRanges.push(o),s.relationships.rangeToProducts[i]=[],s.isDirty=!0)}),updateProductRange:(r,s)=>e(i=>{const o=i.productRanges.findIndex(c=>c.id===r);o!==-1&&(i.productRanges[o]={...i.productRanges[o],...s},s.groupName&&(i.productRanges[o].groupName=s.groupName),i.isDirty=!0)}),removeProductRange:r=>e(s=>{s.productRanges=s.productRanges.filter(o=>o.id!==r),(s.relationships.rangeToProducts[r]||[]).forEach(o=>{s.products=s.products.filter(c=>c.id!==o)}),Object.keys(s.relationships.groupToRanges).forEach(o=>{s.relationships.groupToRanges[o]=s.relationships.groupToRanges[o].filter(c=>c!==r)}),delete s.relationships.rangeToProducts[r],s.isDirty=!0}),addProduct:r=>e(s=>{const i=Ge(r.code||r.name),o={...r,id:i,code:r.code||Ge(r.name),active:r.active!==void 0?r.active:!0};s.products.some(l=>l.id===i)||(s.products.push(o),s.isDirty=!0)}),updateProduct:(r,s)=>e(i=>{const o=i.products.findIndex(c=>c.id===r);o!==-1&&(i.products[o]={...i.products[o],...s},i.isDirty=!0)}),removeProduct:r=>e(s=>{s.products=s.products.filter(i=>i.id!==r),Object.keys(s.relationships.rangeToProducts).forEach(i=>{s.relationships.rangeToProducts[i]=s.relationships.rangeToProducts[i].filter(o=>o!==r)}),s.isDirty=!0}),linkRangeToGroup:(r,s)=>e(i=>{i.relationships.groupToRanges[r]||(i.relationships.groupToRanges[r]=[]),i.relationships.groupToRanges[r].includes(s)||(i.relationships.groupToRanges[r].push(s),i.isDirty=!0)}),unlinkRangeFromGroup:(r,s)=>e(i=>{i.relationships.groupToRanges[r]&&(i.relationships.groupToRanges[r]=i.relationships.groupToRanges[r].filter(o=>o!==s),i.isDirty=!0)}),linkProductToRange:(r,s)=>e(i=>{i.relationships.rangeToProducts[r]||(i.relationships.rangeToProducts[r]=[]),i.relationships.rangeToProducts[r].includes(s)||(i.relationships.rangeToProducts[r].push(s),i.isDirty=!0)}),unlinkProductFromRange:(r,s)=>e(i=>{i.relationships.rangeToProducts[r]&&(i.relationships.rangeToProducts[r]=i.relationships.rangeToProducts[r].filter(o=>o!==s),i.isDirty=!0)}),updateRelationships:r=>e(s=>{s.relationships=r,s.isDirty=!0}),updateOptions:r=>e(s=>{if(s.productData.stepperForm.steps[4]){const i={};Object.entries(r).forEach(([o,c])=>{i[o]=c.map(l=>typeof l=="string"?{value:l}:l)}),s.productData.stepperForm.steps[4].options=i,s.isDirty=!0}}),updateContactFields:r=>e(s=>{s.productData.stepperForm.steps[5]&&(s.productData.stepperForm.steps[5].fields=r,s.isDirty=!0)}),resetData:()=>e(r=>{r.productData=Dn,r.productGroups=[],r.productRanges=[],r.products=[],r.relationships={groupToRanges:{},rangeToProducts:{}},r.isDirty=!1,r.lastSaved=null,r.error=null}),importData:r=>e(s=>{s.isDirty=!0,s.lastSaved=null,s.error=null,n().initializeFromProductData(r)}),setError:r=>e(s=>{s.error=r}),clearError:()=>e(r=>{r.error=null})})),{name:"urbana-data-builder"})),di=({selectedIcon:e,onIconSelect:n})=>t("div",{className:"grid grid-cols-6 gap-2",children:["lucide:box","lucide:home","lucide:bath","lucide:route","lucide:wheelchair","lucide:armchair","lucide:lamp","lucide:tree","lucide:building","lucide:car","lucide:tools","lucide:shield"].map(s=>t(V,{isIconOnly:!0,variant:e===s?"solid":"bordered",color:e===s?"primary":"default",onPress:()=>n(s),className:"h-12 w-12",children:t(f,{icon:s,width:20})},s))}),ui=()=>{const{productGroups:e,addProductGroup:n,updateProductGroup:r,removeProductGroup:s,getRangesForGroup:i}=Re(),{isOpen:o,onOpen:c,onOpenChange:l,onClose:u}=Ft(),[d,m]=re.useState(null),[h,g]=re.useState({name:"",icon:"lucide:box",description:"",active:!0}),[v,P]=re.useState({}),C=()=>{m(null),g({name:"",icon:"lucide:box",description:"",active:!0}),P({}),c()},I=p=>{m(p),g({name:p.name,icon:p.icon,description:p.description,active:p.active}),P({}),c()},R=p=>{r(p.id,{active:typeof p.active>"u"?!1:!p.active})},L=p=>{const x=i(p).length,G=x>0?`Are you sure you want to delete this product group? This will also remove ${x} associated range(s) and their products.`:"Are you sure you want to delete this product group?";confirm(G)&&s(p)},E=(p,x)=>{g(G=>({...G,[p]:x})),v[p]&&P(G=>({...G,[p]:""}))},M=p=>{g(x=>({...x,icon:p}))},j=()=>{const p={};return h.name.trim()||(p.name="Name is required"),e.some(G=>G.name.toLowerCase()===h.name.toLowerCase()&&(!d||G.id!==d.id))&&(p.name="A product group with this name already exists"),h.description.trim()||(p.description="Description is required"),P(p),Object.keys(p).length===0},y=async(p,x)=>{var K,se;const G=p,U=x;try{const le=((K=window.urbanaAdmin)==null?void 0:K.apiUrl)||"/wp-json/urbana/v1/",k=await fetch(`${le}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((se=window.urbanaAdmin)==null?void 0:se.nonce)||""},body:JSON.stringify({old_path:G,new_path:U,type:"group"})});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);return(await k.json()).success}catch(le){return console.error("Failed to rename folder in Digital Ocean:",le),!1}},b=async()=>{if(j()){if(d){if(d.name!==h.name&&confirm(`You've renamed "${d.name}" to "${h.name}".

Do you also want to rename the folder in Digital Ocean Spaces?

• Yes = Rename folder and move all files (recommended)
• No = Only update WordPress, folder stays as "${d.name}"`)){const G=await y(d.name,h.name);alert(G?"✓ Folder renamed successfully in Digital Ocean!":"⚠️ Failed to rename folder in Digital Ocean. You may need to rename it manually.")}r(d.id,h)}else n(h);u()}},[_,S]=re.useState([]),w=re.useCallback(async()=>{var p,x;try{const G=((p=window.urbanaAdmin)==null?void 0:p.apiUrl)||"/wp-json/urbana/v1/",U=await fetch(`${G}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((x=window.urbanaAdmin)==null?void 0:x.nonce)||""},body:JSON.stringify({type:"groups"})});if(U.ok){const K=await U.json();K.success&&K.results&&S(se=>se.map(le=>{const k=K.results.find(O=>{const A=(le.name||le.id||"").toLowerCase().replace(/\/+$/,""),B=(O.id||"").toLowerCase().replace(/\/+$/,"");return A===B});return{...le,exists:k?k.exists:!1}}))}}catch(G){console.error("Failed to check group folder existence:",G)}},[]);re.useEffect(()=>{S(e.map(p=>({id:p.id,name:p.name,type:"group",exists:void 0,checked:!1}))),setTimeout(()=>w(),500)},[e,w]);const F=(p,x)=>{S(G=>G.map(U=>U.id===p?{...U,checked:x}:U))},J=p=>{S(x=>x.map(G=>({...G,checked:p})))},N=async p=>{var x,G;try{const U=((x=window.urbanaAdmin)==null?void 0:x.apiUrl)||"/wp-json/urbana/v1/",K=await fetch(`${U}digital-ocean/create-group-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((G=window.urbanaAdmin)==null?void 0:G.nonce)||""},body:JSON.stringify({group_ids:p})});if(!K.ok)throw new Error(`HTTP error! status: ${K.status}`);const se=await K.json();if(!se.success)throw new Error(se.message||"Failed to create folders");S(le=>le.map(k=>p.includes(k.id)?{...k,exists:!0,checked:!1}:k))}catch(U){throw U}};return a(ke,{children:[a("div",{className:"flex justify-between items-center mb-6",children:[a("div",{children:[t("h3",{className:"text-xl font-semibold",children:"Product Groups"}),t("p",{className:"text-sm text-foreground-500",children:"Organize your products into logical categories"})]}),t(V,{color:"primary",onPress:C,startContent:t(f,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]}),a(Ye,{"aria-label":"Product Groups Options",className:"mb-6",children:[t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:layers",width:16}),t("span",{children:"Manage Groups"})]}),children:t("div",{className:"mt-4",children:e.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:layers",width:48,className:"text-foreground-300"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Yet"}),t("p",{className:"text-sm text-foreground-500",children:"Create your first product group to get started"})]}),t(V,{color:"primary",onPress:C,startContent:t(f,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]})})}):t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(p=>{const x=i(p.id).length;return a(ce,{className:"hover:shadow-lg transition-shadow",children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[t(st,{icon:t(f,{icon:p.icon,width:20,style:{stroke:"currentColor",fill:"currentColor"}}),className:"bg-primary-100 text-primary-800",size:"sm"}),a("div",{children:[t("h4",{className:"text-lg font-semibold",children:p.name}),typeof p.active<"u"&&!p.active&&t(ie,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),a(ie,{size:"sm",variant:"flat",color:"primary",children:[x," range",x!==1?"s":""]})]})]}),a(Ut,{children:[t(Bt,{children:t(V,{isIconOnly:!0,variant:"light",size:"sm",children:t(f,{icon:"lucide:more-vertical",width:16})})}),a(Wt,{"aria-label":"Group Actions",children:[t(Fe,{startContent:t(f,{icon:"lucide:edit",width:16}),onPress:()=>I(p),children:"Edit"},"edit"),t(Fe,{startContent:t(f,{icon:typeof p.active<"u"&&!p.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:()=>R(p),children:typeof p.active<"u"&&!p.active?"Activate":"Deactivate"},"toggle-active"),t(Fe,{className:"text-danger",color:"danger",startContent:t(f,{icon:"lucide:trash",width:16}),onPress:()=>L(p.id),children:"Delete"},"delete")]})]})]})}),t(de,{className:"pt-0",children:t("p",{className:"text-sm text-foreground-600",children:p.description})})]},p.id)})})})},"manage"),t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:cloud-upload",width:16}),t("span",{children:"Digital Ocean Sync"})]}),children:t("div",{className:"mt-4",children:a(ce,{className:"urbana-card",children:[a(De,{className:"flex gap-3",children:[t(f,{icon:"lucide:cloud-upload",width:24}),a("div",{className:"flex flex-col",children:[t("p",{className:"text-md font-semibold",children:"Product Groups - Digital Ocean Sync"}),t("p",{className:"text-small text-default-500",children:"Organize like the Manage Groups tab with card layout"})]})]}),a(de,{children:[a("div",{className:"flex items-center justify-between mb-4",children:[t(V,{color:"primary",variant:"flat",size:"sm",onPress:()=>J(!0),startContent:t(f,{icon:"lucide:check-square",width:16}),children:"Select All"}),t(V,{color:"default",variant:"flat",size:"sm",onPress:()=>J(!1),startContent:t(f,{icon:"lucide:square",width:16}),children:"Clear All"}),t(V,{color:"primary",size:"sm",onPress:()=>{const p=_.filter(x=>x.checked).map(x=>x.id);N(p)},isDisabled:!_.some(p=>p.checked),startContent:t(f,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),_.length===0?a("div",{className:"text-center py-8 text-foreground-500",children:[t(f,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),t("p",{children:"No groups available to sync"})]}):t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_.map(p=>{const x=e.find(U=>U.id===p.id),G=x?i(x.id).length:0;return a(ce,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${p.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>F(p.id,!p.checked),children:[t(De,{className:"pb-3",children:t("div",{className:"flex justify-between items-start w-full",children:a("div",{className:"flex items-center gap-3",children:[a("div",{className:"relative",children:[t(st,{icon:t(f,{icon:(x==null?void 0:x.icon)||"lucide:layers",width:20}),className:"bg-primary-100 text-primary-800",size:"sm"}),t("div",{className:`absolute -top-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center text-white text-xs transition-all ${p.checked?"bg-primary":"bg-gray-300"}`,children:p.checked?t(f,{icon:"lucide:check",width:10}):null})]}),a("div",{children:[t("h4",{className:"text-lg font-semibold",children:p.name}),a("div",{className:"flex gap-2",children:[a(ie,{size:"sm",variant:"flat",color:"primary",children:[G," range",G!==1?"s":""]}),t(ie,{size:"sm",variant:"flat",color:p.exists===!0?"success":p.exists===!1?"warning":"default",startContent:p.exists===void 0?t(f,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):p.exists?t(f,{icon:"lucide:check",width:12}):t(f,{icon:"lucide:cloud-upload",width:12}),children:p.exists===void 0?"Checking...":p.exists?"Exists":"Missing"})]})]})]})})}),a(de,{className:"pt-0",children:[t("p",{className:"text-sm text-foreground-600",children:(x==null?void 0:x.description)||"No description available"}),p.checked&&t("div",{className:"mt-2 p-2 bg-primary/10 rounded text-xs text-primary",children:"✓ Selected for sync"})]})]},p.id)})}),_.some(p=>p.checked)&&a("div",{className:"mt-4 bg-primary/10 rounded-lg p-3",children:[a("p",{className:"text-sm text-primary font-medium",children:[_.filter(p=>p.checked).length," group folder(s) will be created in Digital Ocean Spaces"]}),a("div",{className:"flex flex-wrap gap-1 mt-2",children:[_.filter(p=>p.checked).slice(0,5).map(p=>t(ie,{size:"sm",variant:"flat",color:"primary",children:p.name},p.id)),_.filter(p=>p.checked).length>5&&a(ie,{size:"sm",variant:"flat",color:"default",children:["+",_.filter(p=>p.checked).length-5," more"]})]})]})]})]})})},"sync")]}),t(zt,{isOpen:o,onOpenChange:l,size:"lg",className:"urbana-modal",children:t($t,{children:p=>a(ke,{children:[t(Lt,{children:d?"Edit Product Group":"Add Product Group"}),t(Gt,{children:a("div",{className:"space-y-4",children:[t(Ee,{label:"Name",placeholder:"Enter group name",value:h.name,onChange:x=>E("name",x.target.value),errorMessage:v.name,isInvalid:!!v.name,isRequired:!0,classNames:{input:"urbana-input"}}),a("div",{children:[t("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Icon"}),t(di,{selectedIcon:h.icon,onIconSelect:M})]}),t(Pt,{label:"Description",placeholder:"Enter group description",value:h.description,onChange:x=>E("description",x.target.value),errorMessage:v.description,isInvalid:!!v.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}})]})}),a(Mt,{children:[t(V,{variant:"light",onPress:p,children:"Cancel"}),a(V,{color:"primary",onPress:b,children:[d?"Update":"Add"," Group"]})]})]})})})]})},hi=({tags:e,onTagsChange:n})=>{const[r,s]=re.useState(""),i=c=>{if(c.key==="Enter"&&r.trim()){c.preventDefault();const l=r.trim();e.includes(l)||n([...e,l]),s("")}},o=c=>{n(e.filter(l=>l!==c))};return a("div",{className:"space-y-2",children:[t(Ee,{placeholder:"Type a tag and press Enter",value:r,onChange:c=>s(c.target.value),onKeyDown:i,classNames:{input:"urbana-input"}}),e.length>0&&t("div",{className:"flex flex-wrap gap-2",children:e.map(c=>t(ie,{onClose:()=>o(c),variant:"flat",size:"sm",children:c},c))})]})},mi=()=>{const{productRanges:e,productGroups:n,addProductRange:r,updateProductRange:s,removeProductRange:i,getProductsForRange:o,linkRangeToGroup:c,unlinkRangeFromGroup:l,relationships:u}=Re(),{isOpen:d,onOpen:m,onOpenChange:h,onClose:g}=Ft(),[v,P]=re.useState(null),[C,I]=re.useState({name:"",image:"",description:"",tags:[],active:!0,groupName:""}),[R,L]=re.useState(new Set),[E,M]=re.useState({}),j=()=>{P(null),I({name:"",image:"",description:"",tags:[],active:!0,groupName:""}),L(new Set),M({}),m()},y=k=>{P(k),I({name:k.name,image:k.image,description:k.description,tags:[...k.tags],active:k.active,groupName:k.groupName||""});const O=new Set;Object.entries(u.groupToRanges).forEach(([A,B])=>{B.includes(k.id)&&O.add(A)}),L(O),M({}),m()},b=k=>{const O=o(k).length,A=O>0?`Are you sure you want to delete this product range? This will also remove ${O} associated product(s).`:"Are you sure you want to delete this product range?";confirm(A)&&i(k)},_=(k,O)=>{I(A=>({...A,[k]:O})),E[k]&&M(A=>({...A,[k]:""}))},S=()=>{const k={};return C.name.trim()||(k.name="Name is required"),e.some(A=>A.name.toLowerCase()===C.name.toLowerCase()&&(!v||A.id!==v.id))&&(k.name="A product range with this name already exists"),C.description.trim()||(k.description="Description is required"),R.size===0&&(k.groups="Please select at least one product group"),M(k),Object.keys(k).length===0},w=async(k,O,A)=>{var B,q;try{const X=`${A}/${k}`,ne=`${A}/${O}`,H=((B=window.urbanaAdmin)==null?void 0:B.apiUrl)||"/wp-json/urbana/v1/",te=await fetch(`${H}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((q=window.urbanaAdmin)==null?void 0:q.nonce)||""},body:JSON.stringify({old_path:X,new_path:ne})});if(!te.ok)throw new Error(`HTTP error! status: ${te.status}`);const Q=await te.json();if(!Q.success)throw new Error(Q.message||"Failed to rename folder");return!0}catch(X){throw console.error("Failed to rename folder in Digital Ocean:",X),X}},F=async()=>{var ne,H;if(!S())return;let k,O=!1,A=null,B=null;const q=((ne=n.find(te=>te.id===Array.from(R)[0]))==null?void 0:ne.name)||"",X={...C,groupName:q};if(v){if(O=v.name!==C.name,B=v.name,O){const te=(H=Object.entries(u.groupToRanges).find(([Q,oe])=>oe.includes(v.id)))==null?void 0:H[0];if(te){const Q=n.find(oe=>oe.id===te);Q&&(A=Q.name)}}s(v.id,X),k=v.id,Object.keys(u.groupToRanges).forEach(te=>{l(te,v.id)})}else r(X),k=C.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");if(R.forEach(te=>{c(te,k)}),O&&B&&A&&confirm(`The range name has changed from "${B}" to "${C.name}".

Do you want to rename the folder in Digital Ocean as well?
This will move all contents from:
  ${A}/${B}/
to:
  ${A}/${C.name}/`))try{await w(B,C.name,A),alert(`✅ Successfully renamed folder in Digital Ocean from "${B}" to "${C.name}"`)}catch(Q){alert(`❌ Failed to rename folder in Digital Ocean. Error: ${Q instanceof Error?Q.message:"Unknown error"}

The range has been updated in WordPress, but the Digital Ocean folder was not renamed.`)}g()},J=()=>{const k={},O=[];return e.forEach(A=>{let B=!1;Object.entries(u.groupToRanges).forEach(([q,X])=>{if(X.includes(A.id)){const ne=n.find(H=>H.id===q);ne&&(k[ne.name]||(k[ne.name]=[]),k[ne.name].push(A),B=!0)}}),B||O.push(A)}),{grouped:k,ungrouped:O}},{grouped:N,ungrouped:p}=J(),[x,G]=re.useState({grouped:{},ungrouped:[]}),U=re.useCallback(async()=>{var k,O;try{const A=((k=window.urbanaAdmin)==null?void 0:k.apiUrl)||"/wp-json/urbana/v1/",B=await fetch(`${A}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((O=window.urbanaAdmin)==null?void 0:O.nonce)||""},body:JSON.stringify({type:"ranges"})});if(B.ok){const q=await B.json();q.success&&q.results&&G(X=>{const ne={...X.grouped},H=[...X.ungrouped];return Object.keys(ne).forEach(te=>{ne[te]=ne[te].map(Q=>{const oe=te.toLowerCase().replace(/\/+$/,"").trim(),me=(Q.name||"").toLowerCase().replace(/\/+$/,"").trim(),be=`${oe}/${me}`,D=q.results.find(T=>{const z=(T.folder_path||T.id||"").toLowerCase().replace(/\/+$/g,"").trim();return z===be||z===be+"/"});if(D)window.__URBANA_DEBUG&&console.log(`[DO Sync] FOUND: range '${Q.name}' expected '${be}' → matched DO folder '${D.folder_path||D.id}' (files: ${D.fileCount||0})`);else{const T=W=>((W.folder_path||W.folderPath||W.folderPath||W.id||"")+"").toLowerCase().replace(/\/+$/g,"").trim(),z=q.results.map(W=>({path:T(W),raw:W})).filter(W=>W.path.includes(me)||W.path.includes(oe)),Z=q.results.map(W=>({path:T(W),fileCount:W.fileCount??W.file_count??0,raw:W})).filter(W=>W.path===me||W.path===me+"/"),Y=oe.endsWith("s")?oe.slice(0,-1):oe+"s",ee=q.results.find(W=>T(W).startsWith(Y+"/")),$=z.slice(0,3).map(W=>W.path).join(", ");z.length||Z.length||ee?window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING: '${Q.name}' expected '${be}'. Found ${z.length+Z.length} close matches in DO (sample: ${$||"none"})`+(ee?`; possible pluralization mismatch (DO contains '${T(ee)}')`:"")):window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING: '${Q.name}' expected '${be}' — no nearby matches in DO (checked ${q.results.length} entries).`)}return{...Q,exists:D?D.exists:!1}})}),H.forEach((te,Q)=>{const oe=(te.name||"").toLowerCase().replace(/\/+$/,"").trim(),me=q.results.find(D=>{const T=(D.folder_path||D.id||"").toLowerCase().replace(/\/+$/g,"").trim();return T.endsWith("/"+oe)||T===oe});if(me){window.__URBANA_DEBUG&&console.log(`[DO Sync] FOUND (ungrouped): range '${te.name}' matched DO folder '${me.folder_path||me.id}'`),H[Q]={...te,exists:me.exists};return}const be=q.results.map(D=>({path:(D.folder_path||D.id||"").toLowerCase().replace(/\/+$/g,"").trim(),raw:D})).filter(D=>D.path.includes(oe));be.length>0?window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING (ungrouped): range '${te.name}' — partial matches in DO: ${be.map(D=>D.path).slice(0,5).join(", ")}${be.length>5?" (and more)":""}`):window.__URBANA_DEBUG&&console.warn(`[DO Sync] MISSING (ungrouped): range '${te.name}' — no entries containing '${oe}' found in DO results.`)}),{grouped:ne,ungrouped:H}})}else console.error("[DO Sync] check-folders returned HTTP",B.status),G(q=>{const X={...q.grouped},ne=[...q.ungrouped];return Object.keys(X).forEach(H=>{X[H]=X[H].map(te=>({...te,exists:!1}))}),ne.forEach((H,te)=>{ne[te]={...H,exists:!1}}),{grouped:X,ungrouped:ne}})}catch(A){console.error("❌ Failed to check folder existence:",A)}},[]);re.useEffect(()=>{const{grouped:k,ungrouped:O}=J(),A={};Object.entries(k).forEach(([q,X])=>{A[q]=X.map(ne=>({id:ne.id,name:ne.name,type:"range",exists:void 0,checked:!1}))});const B=O.map(q=>({id:q.id,name:q.name,type:"range",exists:void 0,checked:!1}));G({grouped:A,ungrouped:B}),U()},[e,u,n]),re.useEffect(()=>{const k=O=>{if(!O||!O.detail||!O.detail.results)return;const A=O.detail;G(B=>{const q={...B.grouped},X=[...B.ungrouped];return Object.keys(q).forEach(ne=>{q[ne]=q[ne].map(H=>{const te=ne.toLowerCase().replace(/\/+$/,"").trim(),Q=(H.name||"").toLowerCase().replace(/\/+$/,"").trim(),oe=`${te}/${Q}`,me=A.results.find(be=>{const D=(be.folder_path||be.id||"").toLowerCase().replace(/\/+$/g,"").trim();return D===oe||D===oe+"/"});return{...H,exists:me?me.exists:!1}})}),X.forEach((ne,H)=>{const te=(ne.name||"").toLowerCase().replace(/\/+$/,"").trim(),Q=A.results.find(oe=>{const me=(oe.folder_path||oe.id||"").toLowerCase().replace(/\/+$/g,"").trim();return me.endsWith("/"+te)||me===te});Q&&(X[H]={...ne,exists:Q.exists})}),{grouped:q,ungrouped:X}})};return window.addEventListener("urbana:do-scan-completed",k),()=>window.removeEventListener("urbana:do-scan-completed",k)},[]);const K=(k,O)=>{G(A=>{const B={...A.grouped},q=[...A.ungrouped];Object.keys(B).forEach(ne=>{B[ne]=B[ne].map(H=>H.id===k?{...H,checked:O}:H)});const X=q.findIndex(ne=>ne.id===k);return X!==-1&&(q[X]={...q[X],checked:O}),{grouped:B,ungrouped:q}})},se=k=>{G(O=>{const A={...O.grouped},B=[...O.ungrouped];return Object.keys(A).forEach(q=>{A[q]=A[q].map(X=>({...X,checked:k}))}),B.forEach((q,X)=>{B[X]={...q,checked:k}}),{grouped:A,ungrouped:B}})},le=async k=>{var O,A;try{const B=((O=window.urbanaAdmin)==null?void 0:O.apiUrl)||"/wp-json/urbana/v1/",q=await fetch(`${B}digital-ocean/create-range-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((A=window.urbanaAdmin)==null?void 0:A.nonce)||""},body:JSON.stringify({range_ids:k})});if(!q.ok)throw new Error(`HTTP error! status: ${q.status}`);const X=await q.json();if(!X.success)throw new Error(X.message||"Failed to create folders");G(ne=>{const H={...ne.grouped},te=[...ne.ungrouped];return Object.keys(H).forEach(Q=>{H[Q]=H[Q].map(oe=>k.includes(oe.id)?{...oe,exists:!0,checked:!1}:oe)}),te.forEach((Q,oe)=>{k.includes(Q.id)&&(te[oe]={...Q,exists:!0,checked:!1})}),{grouped:H,ungrouped:te}})}catch(B){throw B}};return a(ke,{children:[a("div",{className:"flex justify-between items-center mb-6",children:[a("div",{children:[t("h3",{className:"text-xl font-semibold",children:"Product Ranges"}),t("p",{className:"text-sm text-foreground-500",children:"Define specific product lines within each group"})]}),t(V,{color:"primary",onPress:j,startContent:t(f,{icon:"lucide:plus",width:18}),isDisabled:n.length===0,children:"Add Product Range"})]}),a(Ye,{"aria-label":"Product Ranges Options",className:"mb-6",children:[t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:grid-3x3",width:16}),t("span",{children:"Manage Ranges"})]}),children:t("div",{className:"mt-4",children:n.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Available"}),t("p",{className:"text-sm text-foreground-500",children:"You need to create product groups first before adding ranges"})]})]})})}):e.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:grid-3x3",width:48,className:"text-foreground-300"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Yet"}),t("p",{className:"text-sm text-foreground-500",children:"Create your first product range to organize your products"})]}),t(V,{color:"primary",onPress:j,startContent:t(f,{icon:"lucide:plus",width:18}),children:"Add Product Range"})]})})}):a("div",{className:"space-y-6",children:[Object.entries(N).map(([k,O])=>a("div",{children:[a("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[t(f,{icon:"lucide:layers",width:18}),k,a(ie,{size:"sm",variant:"flat",children:[O.length," range",O.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(A=>t(br,{range:A,onEdit:y,onDelete:b},A.id))})]},k)),p.length>0&&a("div",{children:[a("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[t(f,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Ranges",a(ie,{size:"sm",variant:"flat",color:"warning",children:[p.length," range",p.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(k=>t(br,{range:k,onEdit:y,onDelete:b},k.id))})]})]})})},"manage"),t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:cloud-upload",width:16}),t("span",{children:"Digital Ocean Sync"})]}),children:t("div",{className:"mt-4",children:a(ce,{className:"urbana-card",children:[a(De,{className:"flex gap-3",children:[t(f,{icon:"lucide:cloud-upload",width:24}),a("div",{className:"flex flex-col",children:[t("p",{className:"text-md font-semibold",children:"Product Ranges - Digital Ocean Sync"}),t("p",{className:"text-small text-default-500",children:"Organize by groups like the Manage Ranges tab"})]})]}),a(de,{children:[a("div",{className:"flex items-center justify-between mb-4",children:[t(V,{color:"primary",variant:"flat",size:"sm",onPress:()=>se(!0),startContent:t(f,{icon:"lucide:check-square",width:16}),children:"Select All"}),t(V,{color:"default",variant:"flat",size:"sm",onPress:()=>se(!1),startContent:t(f,{icon:"lucide:square",width:16}),children:"Clear All"}),t(V,{color:"primary",size:"sm",onPress:()=>{const k=[];Object.values(x.grouped).forEach(O=>{O.forEach(A=>{A.checked&&k.push(A.id)})}),x.ungrouped.forEach(O=>{O.checked&&k.push(O.id)}),le(k)},isDisabled:(()=>{let k=!1;return Object.values(x.grouped).forEach(O=>{O.forEach(A=>{A.checked&&(k=!0)})}),x.ungrouped.forEach(O=>{O.checked&&(k=!0)}),!k})(),startContent:t(f,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),Object.keys(x.grouped).length===0&&x.ungrouped.length===0?a("div",{className:"text-center py-8 text-foreground-500",children:[t(f,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),t("p",{children:"No ranges available to sync"})]}):a("div",{className:"space-y-6",children:[Object.entries(x.grouped).map(([k,O])=>a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:layers",width:18,className:"text-primary"}),t("h4",{className:"font-semibold text-lg text-primary",children:k}),a(ie,{size:"sm",variant:"flat",color:"primary",children:[O.length," range",O.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(A=>{const B=e.find(X=>X.id===A.id),q=B?o(A.id).length:0;return a(ce,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${A.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>K(A.id,!A.checked),children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[a("div",{className:"relative",children:[t("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:grid-3x3",width:20,className:"text-secondary-600"})}),t("div",{className:"absolute -top-1 -right-1",children:t(Ve,{isSelected:A.checked||!1,onValueChange:X=>{K(A.id,X)},size:"sm",onClick:X=>X.stopPropagation()})})]}),a("div",{children:[t("h4",{className:"text-md font-semibold",children:A.name}),a(ie,{size:"sm",variant:"flat",color:"secondary",children:[q," product",q!==1?"s":""]})]})]}),t(ie,{size:"sm",variant:"flat",color:A.exists===!0?"success":A.exists===!1?"warning":"default",startContent:A.exists===void 0?t(f,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):A.exists?t(f,{icon:"lucide:check-circle",width:14}):t(f,{icon:"lucide:alert-circle",width:14}),children:A.exists===void 0?"Checking...":A.exists?"Exists":"Missing"})]})}),B&&t(de,{className:"pt-0",children:t("p",{className:"text-sm text-foreground-600",children:B.description||"No description"})})]},A.id)})})]},k)),x.ungrouped.length>0&&a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:alert-triangle",width:18,className:"text-warning"}),t("h4",{className:"font-semibold text-lg text-warning",children:"Ungrouped Ranges"}),a(ie,{size:"sm",variant:"flat",color:"warning",children:[x.ungrouped.length," range",x.ungrouped.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.ungrouped.map(k=>{const O=e.find(B=>B.id===k.id),A=O?o(k.id).length:0;return a(ce,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${k.checked?"border-warning bg-warning/5":"border-transparent hover:border-warning/30"}`,isPressable:!0,onPress:()=>K(k.id,!k.checked),children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[a("div",{className:"relative",children:[t("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:grid-3x3",width:20,className:"text-warning-600"})}),t("div",{className:"absolute -top-1 -right-1",children:t(Ve,{isSelected:k.checked||!1,onValueChange:B=>{K(k.id,B)},size:"sm",onClick:B=>B.stopPropagation()})})]}),a("div",{children:[t("h4",{className:"text-md font-semibold",children:k.name}),a(ie,{size:"sm",variant:"flat",color:"warning",children:[A," product",A!==1?"s":""]})]})]}),t(ie,{size:"sm",variant:"flat",color:k.exists?"success":"warning",startContent:t(f,{icon:k.exists?"lucide:check-circle":"lucide:alert-circle",width:14}),children:k.exists?"Exists":"Missing"})]})}),O&&t(de,{className:"pt-0",children:t("p",{className:"text-sm text-foreground-600",children:O.description||"No description"})})]},k.id)})})]})]})]})]})})},"sync")]}),t(zt,{isOpen:d,onOpenChange:h,size:"2xl",className:"urbana-modal",children:t($t,{children:k=>a(ke,{children:[t(Lt,{children:v?"Edit Product Range":"Add Product Range"}),t(Gt,{children:a("div",{className:"space-y-4",children:[t(Ee,{label:"Name",placeholder:"Enter range name",value:C.name,onChange:O=>_("name",O.target.value),errorMessage:E.name,isInvalid:!!E.name,isRequired:!0,classNames:{input:"urbana-input"}}),t(it,{label:"Product Groups",placeholder:"Select product groups for this range",selectionMode:"multiple",selectedKeys:R,onSelectionChange:O=>L(O),errorMessage:E.groups,isInvalid:!!E.groups,isRequired:!0,children:n.map(O=>t(nt,{children:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:O.icon,width:16}),O.name]})},O.id))}),t(Ee,{label:"Image URL",placeholder:"Enter image URL (optional)",value:C.image,onChange:O=>_("image",O.target.value),classNames:{input:"urbana-input"}}),t(Pt,{label:"Description",placeholder:"Enter range description",value:C.description,onChange:O=>_("description",O.target.value),errorMessage:E.description,isInvalid:!!E.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}}),a("div",{children:[t("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Tags"}),t(hi,{tags:C.tags,onTagsChange:O=>_("tags",O)})]})]})}),a(Mt,{children:[t(V,{variant:"light",onPress:k,children:"Cancel"}),a(V,{color:"primary",onPress:F,children:[v?"Update":"Add"," Range"]})]})]})})})]})},br=({range:e,onEdit:n,onDelete:r})=>{const{getProductsForRange:s,updateProductRange:i}=Re(),o=s(e.id).length,c=()=>{i(e.id,{active:typeof e.active>"u"?!1:!e.active})};return a(ce,{className:"hover:shadow-lg transition-shadow",children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[e.image?t(Ls,{src:e.image,alt:e.name,width:40,height:40,className:"rounded-lg object-cover"}):t("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:grid-3x3",width:20,className:"text-secondary-600"})}),a("div",{children:[t("h4",{className:"text-lg font-semibold",children:e.name}),typeof e.active<"u"&&!e.active&&t(ie,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),a(ie,{size:"sm",variant:"flat",color:"secondary",children:[o," product",o!==1?"s":""]})]})]}),a(Ut,{children:[t(Bt,{children:t(V,{isIconOnly:!0,variant:"light",size:"sm",children:t(f,{icon:"lucide:more-vertical",width:16})})}),a(Wt,{"aria-label":"Range Actions",children:[t(Fe,{startContent:t(f,{icon:"lucide:edit",width:16}),onPress:()=>n(e),children:"Edit"},"edit"),t(Fe,{startContent:t(f,{icon:typeof e.active<"u"&&!e.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:c,children:typeof e.active<"u"&&!e.active?"Activate":"Deactivate"},"toggle-active"),t(Fe,{className:"text-danger",color:"danger",startContent:t(f,{icon:"lucide:trash",width:16}),onPress:()=>r(e.id),children:"Delete"},"delete")]})]})]})}),a(de,{className:"pt-0",children:[t("p",{className:"text-sm text-foreground-600 mb-2",children:e.description}),e.tags.length>0&&t("div",{className:"flex flex-wrap gap-1",children:e.tags.map(l=>t(ie,{size:"sm",variant:"flat",color:"default",children:l},l))})]})]})},Jr=({imagePath:e,productCode:n,className:r="",alt:s="Product image",onClick:i})=>{var P,C;const[o,c]=fe(""),[l,u]=fe(!0),[d,m]=fe(""),[h,g]=fe(""),v=window.urbanaDebugMode||((P=window.urbanaAdmin)==null?void 0:P.debugMode)||((C=window.urbanaPublic)==null?void 0:C.debugMode)||!1;return ge(()=>{e&&(async()=>{var R,L;try{u(!0),m(""),g("");const E=((R=window.urbanaAdmin)==null?void 0:R.nonce)||((L=window.urbanaPublic)==null?void 0:L.nonce)||"";v&&console.log(`[SecureImage] Fetching: ${e}`,{productCode:n,nonce:E?"present":"missing",debugMode:v});const M=await fetch("/wp-json/urbana/v1/image-proxy",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":E},body:JSON.stringify({image_path:e})});if(!M.ok)throw new Error(`HTTP ${M.status}: ${M.statusText}`);const j=await M.json();if(v&&console.log(`[SecureImage] Response for ${e}:`,{method:j.method,success:j.success,hasImageUrl:!!j.image_url,hasImageData:!!j.image_data,error:j.error,message:j.message}),j.success)if(j.method==="presigned_url"&&j.image_url)v&&console.log("✅ Using presigned URL method (instant loading from DO)"),g("presigned_url"),c(j.image_url);else if(j.method==="base64_fallback"&&j.image_data)v&&console.log("⚠️ Using base64 fallback method (slower, full data transfer)"),g("base64_fallback"),c(j.image_data);else if(j.image_data)v&&console.log("⚠️ Using legacy base64 format"),g("base64_legacy"),c(j.image_data);else if(j.imageData)v&&console.log("⚠️ Using legacy imageData format"),g("imageData_legacy"),c(j.imageData);else throw v&&console.error("No image URL or data received from server"),new Error("No image URL or data received");else if(j.use_svg_icon)v&&console.warn("Server requested SVG icon fallback:",j.error),g("svg_fallback"),m("Failed to load image - using SVG icon instead");else throw new Error(j.error||j.message||"Failed to get image")}catch(E){v&&console.error(`[SecureImage] Fetch error for ${e}:`,E.message,E),m(E.message)}finally{u(!1)}})()},[e,n]),l?t("div",{className:`${r} bg-gray-100 animate-pulse flex items-center justify-center`,children:a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-gray-400",children:[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),t("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}):d||!o?a("div",{className:`${r} bg-orange-100 border-2 border-orange-300 flex items-center justify-center relative group`,title:d||"Image failed to load",children:[a("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-orange-600",children:[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),v&&d&&a("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:[d.substring(0,50),"..."]})]}):a("div",{className:"relative group h-full",children:[t("img",{src:o,alt:s,className:r,onClick:I=>{window.urbanaDebugMode&&console.log("[DataBuilder SecureImage] image clicked",e),i&&i(I)},title:v&&h?`Loaded via: ${h}`:"",onError:()=>{m("Image load failed")}}),v&&h&&t("div",{className:"absolute top-0 left-0 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded opacity-70 group-hover:opacity-100 transition-opacity font-semibold",title:`Method: ${h}`,children:h==="presigned_url"?"🔗 URL":h==="base64_fallback"?"📦 B64":"⚠️"})]})},pi=({files:e,onFilesChange:n,productCode:r,category:s,range:i})=>{const[o,c]=re.useState(""),[l,u]=re.useState(""),d=ae(()=>{o.trim()&&l.trim()&&(n({...e,[o.trim()]:l.trim()}),c(""),u(""))},[o,l,e,n]),m=ae(v=>{const P={...e};delete P[v],n(P)},[e,n]),h=ae(()=>{var P;if(!((P=window.wp)!=null&&P.media)){console.error("WordPress media library not available");return}const v=window.wp.media({title:"Select Files",button:{text:"Add to Product"},multiple:!0});v.on("select",()=>{const C=v.state().get("selection").toJSON(),I={...e};C.forEach(R=>{const L=R.filename||R.title;I[L]=R.url}),n(I)}),v.open()},[e,n]);ae(async()=>{var P;if(!r||!s||!i){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch files from the plugin folder and update the current file list. Continue?"))try{const C=await fetch("/wp-json/urbana/v1/fetch-product-files",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((P=window.urbanaAdmin)==null?void 0:P.nonce)||""},body:JSON.stringify({productCode:r.toLowerCase(),category:s.toLowerCase(),range:i.toLowerCase().replace(/\s+/g,"-")})});if(!C.ok)throw new Error(`Failed to fetch files: ${C.status}`);const I=await C.json();I.success&&I.files?n(I.files):console.warn("No files found in folder or fetch failed")}catch(C){console.error("Error fetching files from folder:",C)}},[r,s,i,n]);const g=v=>{var C;switch((C=v.split(".").pop())==null?void 0:C.toLowerCase()){case"pdf":return"lucide:file-text";case"dwg":case"dxf":return"lucide:compass";case"rvt":return"lucide:building";case"doc":case"docx":return"lucide:file-type";case"xls":case"xlsx":return"lucide:sheet";default:return"lucide:file"}};return a(ce,{children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-center w-full",children:[t("h4",{className:"text-md font-semibold",children:"Product Files"}),t("div",{className:"flex gap-2",children:t(V,{size:"sm",color:"primary",variant:"flat",onPress:h,startContent:t(f,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),a(de,{className:"space-y-4",children:[t("div",{className:"space-y-3",children:a("div",{className:"flex gap-2",children:[t(Ee,{placeholder:"File name",value:o,onChange:v=>c(v.target.value),size:"sm",classNames:{input:"urbana-input"}}),t(Ee,{placeholder:"File URL or path",value:l,onChange:v=>u(v.target.value),size:"sm",classNames:{input:"urbana-input"}}),t(V,{size:"sm",color:"primary",onPress:d,isDisabled:!o.trim()||!l.trim(),children:"Add"})]})}),Object.entries(e).length>0&&a(ke,{children:[t(Ot,{}),a("div",{className:"space-y-2",children:[t("div",{className:"flex items-center justify-between",children:a("span",{className:"text-sm font-medium",children:["Files (",Object.entries(e).length,")"]})}),Object.entries(e).map(([v,P])=>a("div",{className:"flex justify-between items-center p-3 bg-default-50 rounded-lg",children:[a("div",{className:"flex items-center gap-3",children:[t(f,{icon:g(P),width:20,className:"text-primary-500"}),a("div",{className:"flex-1 min-w-0",children:[t("span",{className:"font-medium text-sm",children:v}),t("p",{className:"text-xs text-foreground-500 truncate",children:P})]})]}),a(Ut,{children:[t(Bt,{children:t(V,{isIconOnly:!0,size:"sm",variant:"light",children:t(f,{icon:"lucide:more-vertical",width:16})})}),a(Wt,{children:[t(Fe,{startContent:t(f,{icon:"lucide:external-link",width:16}),onPress:()=>window.open(P,"_blank"),children:"View File"},"view"),t(Fe,{className:"text-danger",color:"danger",startContent:t(f,{icon:"lucide:trash",width:16}),onPress:()=>m(v),children:"Remove"},"remove")]})]})]},v))]})]})]})]})},fi=({imageGallery:e,onImageGalleryChange:n,productCode:r,category:s,range:i})=>{const o=ae((d,m)=>{const h=[...e];h[d]=m,n(h)},[e,n]),c=ae(d=>{const m=e.filter((h,g)=>g!==d);n(m)},[e,n]),l=ae(()=>{n([...e,""])},[e,n]),u=ae(()=>{var m;if(!((m=window.wp)!=null&&m.media)){console.error("WordPress media library not available");return}const d=window.wp.media({title:"Select Images",button:{text:"Add to Gallery"},multiple:!0,library:{type:"image"}});d.on("select",()=>{const g=d.state().get("selection").toJSON().map(v=>v.url);n([...e,...g])}),d.open()},[e,n]);return ae(async()=>{var m;if(!r||!s||!i){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch images from the plugin folder and update the current gallery. Continue?"))try{const h=await fetch("/wp-json/urbana/v1/fetch-product-images",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((m=window.urbanaAdmin)==null?void 0:m.nonce)||""},body:JSON.stringify({productCode:r.toLowerCase(),category:s.toLowerCase(),range:i.toLowerCase().replace(/\s+/g,"-")})});if(!h.ok)throw new Error(`Failed to fetch images: ${h.status}`);const g=await h.json();g.success&&g.images?n(g.images):console.warn("No images found in folder or fetch failed")}catch(h){console.error("Error fetching images from folder:",h)}},[r,s,i,n]),a(ce,{children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-center w-full",children:[t("h4",{className:"text-md font-semibold",children:"Image Gallery"}),t("div",{className:"flex gap-2",children:t(V,{size:"sm",color:"primary",variant:"flat",onPress:u,startContent:t(f,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),a(de,{className:"space-y-4",children:[e.length>0&&t("div",{className:"flex flex-wrap justify-center items-start gap-4",children:e.map((d,m)=>a("div",{className:"relative group h-full w-40 sm:w-48 md:w-56 lg:w-64 flex flex-col items-stretch",children:[a("div",{className:"aspect-[4/3] rounded-lg overflow-hidden border-2 border-default-200",children:[d?t(Jr,{imagePath:d,productCode:r||"unknown",alt:`Gallery image ${m+1}`,className:"w-full h-full object-cover"}):t("div",{className:"w-full h-full bg-default-100 flex items-center justify-center",children:t(f,{icon:"lucide:image-plus",width:32,className:"text-default-400"})}),t("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:a(Ut,{children:[t(Bt,{children:t(V,{isIconOnly:!0,size:"sm",variant:"solid",color:"default",className:"bg-black/50 text-white",children:t(f,{icon:"lucide:more-vertical",width:16})})}),a(Wt,{children:[t(Fe,{startContent:t(f,{icon:"lucide:edit",width:16}),onPress:()=>{const h=prompt("Enter image URL:",d);h!==null&&o(m,h)},children:"Edit URL"},"edit"),t(Fe,{className:"text-danger",color:"danger",startContent:t(f,{icon:"lucide:trash",width:16}),onPress:()=>c(m),children:"Remove"},"remove")]})]})})]}),t(Ee,{placeholder:"Image URL",value:d,onChange:h=>o(m,h.target.value),size:"sm",className:"mt-2",classNames:{input:"urbana-input"}})]},m))}),t(Ot,{}),t("div",{className:"flex justify-center",children:t(V,{variant:"dashed",onPress:l,startContent:t(f,{icon:"lucide:plus",width:16}),className:"w-full",children:"Add Image"})})]})]})};function gi(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return he(()=>s=>{n.forEach(i=>i(s))},n)}const mn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function pt(e){const n=Object.prototype.toString.call(e);return n==="[object Window]"||n==="[object global]"}function Wn(e){return"nodeType"in e}function Te(e){var n,r;return e?pt(e)?e:Wn(e)&&(n=(r=e.ownerDocument)==null?void 0:r.defaultView)!=null?n:window:window}function qn(e){const{Document:n}=Te(e);return e instanceof n}function Jt(e){return pt(e)?!1:e instanceof Te(e).HTMLElement}function Xr(e){return e instanceof Te(e).SVGElement}function ft(e){return e?pt(e)?e.document:Wn(e)?qn(e)?e:Jt(e)||Xr(e)?e.ownerDocument:document:document:document}const Je=mn?Ts:ge;function Jn(e){const n=ye(e);return Je(()=>{n.current=e}),ae(function(){for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return n.current==null?void 0:n.current(...s)},[])}function vi(){const e=ye(null),n=ae((s,i)=>{e.current=setInterval(s,i)},[]),r=ae(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[n,r]}function kt(e,n){n===void 0&&(n=[e]);const r=ye(e);return Je(()=>{r.current!==e&&(r.current=e)},n),r}function Xt(e,n){const r=ye();return he(()=>{const s=e(r.current);return r.current=s,s},[...n])}function an(e){const n=Jn(e),r=ye(null),s=ae(i=>{i!==r.current&&(n==null||n(i,r.current)),r.current=i},[]);return[r,s]}function In(e){const n=ye();return ge(()=>{n.current=e},[e]),n.current}let Sn={};function Ht(e,n){return he(()=>{if(n)return n;const r=Sn[e]==null?0:Sn[e]+1;return Sn[e]=r,e+"-"+r},[e,n])}function Hr(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];return s.reduce((o,c)=>{const l=Object.entries(c);for(const[u,d]of l){const m=o[u];m!=null&&(o[u]=m+e*d)}return o},{...n})}}const ht=Hr(1),Tt=Hr(-1);function bi(e){return"clientX"in e&&"clientY"in e}function Xn(e){if(!e)return!1;const{KeyboardEvent:n}=Te(e.target);return n&&e instanceof n}function wi(e){if(!e)return!1;const{TouchEvent:n}=Te(e.target);return n&&e instanceof n}function Fn(e){if(wi(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:r}=e.touches[0];return{x:n,y:r}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:r}=e.changedTouches[0];return{x:n,y:r}}}return bi(e)?{x:e.clientX,y:e.clientY}:null}const jt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:r}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:r}=e;return"scaleX("+n+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[jt.Translate.toString(e),jt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:r,easing:s}=e;return n+" "+r+"ms "+s}}}),wr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function xi(e){return e.matches(wr)?e:e.querySelector(wr)}const yi={display:"none"};function Ni(e){let{id:n,value:r}=e;return re.createElement("div",{id:n,style:yi},r)}function Di(e){let{id:n,announcement:r,ariaLiveType:s="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return re.createElement("div",{id:n,style:i,role:"status","aria-live":s,"aria-atomic":!0},r)}function Si(){const[e,n]=fe("");return{announce:ae(s=>{s!=null&&n(s)},[]),announcement:e}}const Vr=It(null);function Ci(e){const n=at(Vr);ge(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}function Oi(){const[e]=fe(()=>new Set),n=ae(s=>(e.add(s),()=>e.delete(s)),[e]);return[ae(s=>{let{type:i,event:o}=s;e.forEach(c=>{var l;return(l=c[i])==null?void 0:l.call(c,o)})},[e]),n]}const Pi={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ri={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was moved over droppable area "+r.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:r}=e;return r?"Draggable item "+n.id+" was dropped over droppable area "+r.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function _i(e){let{announcements:n=Ri,container:r,hiddenTextDescribedById:s,screenReaderInstructions:i=Pi}=e;const{announce:o,announcement:c}=Si(),l=Ht("DndLiveRegion"),[u,d]=fe(!1);if(ge(()=>{d(!0)},[]),Ci(he(()=>({onDragStart(h){let{active:g}=h;o(n.onDragStart({active:g}))},onDragMove(h){let{active:g,over:v}=h;n.onDragMove&&o(n.onDragMove({active:g,over:v}))},onDragOver(h){let{active:g,over:v}=h;o(n.onDragOver({active:g,over:v}))},onDragEnd(h){let{active:g,over:v}=h;o(n.onDragEnd({active:g,over:v}))},onDragCancel(h){let{active:g,over:v}=h;o(n.onDragCancel({active:g,over:v}))}}),[o,n])),!u)return null;const m=re.createElement(re.Fragment,null,re.createElement(Ni,{id:s,value:i.draggable}),re.createElement(Di,{id:l,announcement:c}));return r?Is(m,r):m}var Ce;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Ce||(Ce={}));function on(){}function xr(e,n){return he(()=>({sensor:e,options:n??{}}),[e,n])}function Ei(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return he(()=>[...n].filter(s=>s!=null),[...n])}const Ue=Object.freeze({x:0,y:0});function Yr(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function Kr(e,n){let{data:{value:r}}=e,{data:{value:s}}=n;return r-s}function ki(e,n){let{data:{value:r}}=e,{data:{value:s}}=n;return s-r}function yr(e){let{left:n,top:r,height:s,width:i}=e;return[{x:n,y:r},{x:n+i,y:r},{x:n,y:r+s},{x:n+i,y:r+s}]}function Qr(e,n){if(!e||e.length===0)return null;const[r]=e;return r[n]}function Nr(e,n,r){return n===void 0&&(n=e.left),r===void 0&&(r=e.top),{x:n+e.width*.5,y:r+e.height*.5}}const Ti=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:s}=e;const i=Nr(n,n.left,n.top),o=[];for(const c of s){const{id:l}=c,u=r.get(l);if(u){const d=Yr(Nr(u),i);o.push({id:l,data:{droppableContainer:c,value:d}})}}return o.sort(Kr)},ji=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:s}=e;const i=yr(n),o=[];for(const c of s){const{id:l}=c,u=r.get(l);if(u){const d=yr(u),m=i.reduce((g,v,P)=>g+Yr(d[P],v),0),h=Number((m/4).toFixed(4));o.push({id:l,data:{droppableContainer:c,value:h}})}}return o.sort(Kr)};function Ai(e,n){const r=Math.max(n.top,e.top),s=Math.max(n.left,e.left),i=Math.min(n.left+n.width,e.left+e.width),o=Math.min(n.top+n.height,e.top+e.height),c=i-s,l=o-r;if(s<i&&r<o){const u=n.width*n.height,d=e.width*e.height,m=c*l,h=m/(u+d-m);return Number(h.toFixed(4))}return 0}const Ii=e=>{let{collisionRect:n,droppableRects:r,droppableContainers:s}=e;const i=[];for(const o of s){const{id:c}=o,l=r.get(c);if(l){const u=Ai(l,n);u>0&&i.push({id:c,data:{droppableContainer:o,value:u}})}}return i.sort(ki)};function Fi(e,n,r){return{...e,scaleX:n&&r?n.width/r.width:1,scaleY:n&&r?n.height/r.height:1}}function Zr(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:Ue}function zi(e){return function(r){for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return i.reduce((c,l)=>({...c,top:c.top+e*l.y,bottom:c.bottom+e*l.y,left:c.left+e*l.x,right:c.right+e*l.x}),{...r})}}const $i=zi(1);function Li(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}else if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}function Gi(e,n,r){const s=Li(n);if(!s)return e;const{scaleX:i,scaleY:o,x:c,y:l}=s,u=e.left-c-(1-i)*parseFloat(r),d=e.top-l-(1-o)*parseFloat(r.slice(r.indexOf(" ")+1)),m=i?e.width/i:e.width,h=o?e.height/o:e.height;return{width:m,height:h,top:d,right:u+m,bottom:d+h,left:u}}const Mi={ignoreTransform:!1};function gt(e,n){n===void 0&&(n=Mi);let r=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:d,transformOrigin:m}=Te(e).getComputedStyle(e);d&&(r=Gi(r,d,m))}const{top:s,left:i,width:o,height:c,bottom:l,right:u}=r;return{top:s,left:i,width:o,height:c,bottom:l,right:u}}function Dr(e){return gt(e,{ignoreTransform:!0})}function Ui(e){const n=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:n,bottom:r,width:n,height:r}}function Bi(e,n){return n===void 0&&(n=Te(e).getComputedStyle(e)),n.position==="fixed"}function Wi(e,n){n===void 0&&(n=Te(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=n[i];return typeof o=="string"?r.test(o):!1})}function pn(e,n){const r=[];function s(i){if(n!=null&&r.length>=n||!i)return r;if(qn(i)&&i.scrollingElement!=null&&!r.includes(i.scrollingElement))return r.push(i.scrollingElement),r;if(!Jt(i)||Xr(i)||r.includes(i))return r;const o=Te(e).getComputedStyle(i);return i!==e&&Wi(i,o)&&r.push(i),Bi(i,o)?r:s(i.parentNode)}return e?s(e):r}function es(e){const[n]=pn(e,1);return n??null}function Cn(e){return!mn||!e?null:pt(e)?e:Wn(e)?qn(e)||e===ft(e).scrollingElement?window:Jt(e)?e:null:null}function ts(e){return pt(e)?e.scrollX:e.scrollLeft}function ns(e){return pt(e)?e.scrollY:e.scrollTop}function zn(e){return{x:ts(e),y:ns(e)}}var Oe;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Oe||(Oe={}));function rs(e){return!mn||!e?!1:e===document.scrollingElement}function ss(e){const n={x:0,y:0},r=rs(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},i=e.scrollTop<=n.y,o=e.scrollLeft<=n.x,c=e.scrollTop>=s.y,l=e.scrollLeft>=s.x;return{isTop:i,isLeft:o,isBottom:c,isRight:l,maxScroll:s,minScroll:n}}const qi={x:.2,y:.2};function Ji(e,n,r,s,i){let{top:o,left:c,right:l,bottom:u}=r;s===void 0&&(s=10),i===void 0&&(i=qi);const{isTop:d,isBottom:m,isLeft:h,isRight:g}=ss(e),v={x:0,y:0},P={x:0,y:0},C={height:n.height*i.y,width:n.width*i.x};return!d&&o<=n.top+C.height?(v.y=Oe.Backward,P.y=s*Math.abs((n.top+C.height-o)/C.height)):!m&&u>=n.bottom-C.height&&(v.y=Oe.Forward,P.y=s*Math.abs((n.bottom-C.height-u)/C.height)),!g&&l>=n.right-C.width?(v.x=Oe.Forward,P.x=s*Math.abs((n.right-C.width-l)/C.width)):!h&&c<=n.left+C.width&&(v.x=Oe.Backward,P.x=s*Math.abs((n.left+C.width-c)/C.width)),{direction:v,speed:P}}function Xi(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:c}=window;return{top:0,left:0,right:o,bottom:c,width:o,height:c}}const{top:n,left:r,right:s,bottom:i}=e.getBoundingClientRect();return{top:n,left:r,right:s,bottom:i,width:e.clientWidth,height:e.clientHeight}}function is(e){return e.reduce((n,r)=>ht(n,zn(r)),Ue)}function Hi(e){return e.reduce((n,r)=>n+ts(r),0)}function Vi(e){return e.reduce((n,r)=>n+ns(r),0)}function Yi(e,n){if(n===void 0&&(n=gt),!e)return;const{top:r,left:s,bottom:i,right:o}=n(e);es(e)&&(i<=0||o<=0||r>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Ki=[["x",["left","right"],Hi],["y",["top","bottom"],Vi]];class Hn{constructor(n,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=pn(r),i=is(s);this.rect={...n},this.width=n.width,this.height=n.height;for(const[o,c,l]of Ki)for(const u of c)Object.defineProperty(this,u,{get:()=>{const d=l(s),m=i[o]-d;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Dt{constructor(n){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=n}add(n,r,s){var i;(i=this.target)==null||i.addEventListener(n,r,s),this.listeners.push([n,r,s])}}function Qi(e){const{EventTarget:n}=Te(e);return e instanceof n?e:ft(e)}function On(e,n){const r=Math.abs(e.x),s=Math.abs(e.y);return typeof n=="number"?Math.sqrt(r**2+s**2)>n:"x"in n&&"y"in n?r>n.x&&s>n.y:"x"in n?r>n.x:"y"in n?s>n.y:!1}var Le;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Le||(Le={}));function Sr(e){e.preventDefault()}function Zi(e){e.stopPropagation()}var pe;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(pe||(pe={}));const as={start:[pe.Space,pe.Enter],cancel:[pe.Esc],end:[pe.Space,pe.Enter,pe.Tab]},ea=(e,n)=>{let{currentCoordinates:r}=n;switch(e.code){case pe.Right:return{...r,x:r.x+25};case pe.Left:return{...r,x:r.x-25};case pe.Down:return{...r,y:r.y+25};case pe.Up:return{...r,y:r.y-25}}};class Vn{constructor(n){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=n;const{event:{target:r}}=n;this.props=n,this.listeners=new Dt(ft(r)),this.windowListeners=new Dt(Te(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Le.Resize,this.handleCancel),this.windowListeners.add(Le.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Le.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:n,onStart:r}=this.props,s=n.node.current;s&&Yi(s),r(Ue)}handleKeyDown(n){if(Xn(n)){const{active:r,context:s,options:i}=this.props,{keyboardCodes:o=as,coordinateGetter:c=ea,scrollBehavior:l="smooth"}=i,{code:u}=n;if(o.end.includes(u)){this.handleEnd(n);return}if(o.cancel.includes(u)){this.handleCancel(n);return}const{collisionRect:d}=s.current,m=d?{x:d.left,y:d.top}:Ue;this.referenceCoordinates||(this.referenceCoordinates=m);const h=c(n,{active:r,context:s.current,currentCoordinates:m});if(h){const g=Tt(h,m),v={x:0,y:0},{scrollableAncestors:P}=s.current;for(const C of P){const I=n.code,{isTop:R,isRight:L,isLeft:E,isBottom:M,maxScroll:j,minScroll:y}=ss(C),b=Xi(C),_={x:Math.min(I===pe.Right?b.right-b.width/2:b.right,Math.max(I===pe.Right?b.left:b.left+b.width/2,h.x)),y:Math.min(I===pe.Down?b.bottom-b.height/2:b.bottom,Math.max(I===pe.Down?b.top:b.top+b.height/2,h.y))},S=I===pe.Right&&!L||I===pe.Left&&!E,w=I===pe.Down&&!M||I===pe.Up&&!R;if(S&&_.x!==h.x){const F=C.scrollLeft+g.x,J=I===pe.Right&&F<=j.x||I===pe.Left&&F>=y.x;if(J&&!g.y){C.scrollTo({left:F,behavior:l});return}J?v.x=C.scrollLeft-F:v.x=I===pe.Right?C.scrollLeft-j.x:C.scrollLeft-y.x,v.x&&C.scrollBy({left:-v.x,behavior:l});break}else if(w&&_.y!==h.y){const F=C.scrollTop+g.y,J=I===pe.Down&&F<=j.y||I===pe.Up&&F>=y.y;if(J&&!g.x){C.scrollTo({top:F,behavior:l});return}J?v.y=C.scrollTop-F:v.y=I===pe.Down?C.scrollTop-j.y:C.scrollTop-y.y,v.y&&C.scrollBy({top:-v.y,behavior:l});break}}this.handleMove(n,ht(Tt(h,this.referenceCoordinates),v))}}}handleMove(n,r){const{onMove:s}=this.props;n.preventDefault(),s(r)}handleEnd(n){const{onEnd:r}=this.props;n.preventDefault(),this.detach(),r()}handleCancel(n){const{onCancel:r}=this.props;n.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Vn.activators=[{eventName:"onKeyDown",handler:(e,n,r)=>{let{keyboardCodes:s=as,onActivation:i}=n,{active:o}=r;const{code:c}=e.nativeEvent;if(s.start.includes(c)){const l=o.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function Cr(e){return!!(e&&"distance"in e)}function Or(e){return!!(e&&"delay"in e)}class Yn{constructor(n,r,s){var i;s===void 0&&(s=Qi(n.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=n,this.events=r;const{event:o}=n,{target:c}=o;this.props=n,this.events=r,this.document=ft(c),this.documentListeners=new Dt(this.document),this.listeners=new Dt(s),this.windowListeners=new Dt(Te(c)),this.initialCoordinates=(i=Fn(o))!=null?i:Ue,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:n,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(n.move.name,this.handleMove,{passive:!1}),this.listeners.add(n.end.name,this.handleEnd),n.cancel&&this.listeners.add(n.cancel.name,this.handleCancel),this.windowListeners.add(Le.Resize,this.handleCancel),this.windowListeners.add(Le.DragStart,Sr),this.windowListeners.add(Le.VisibilityChange,this.handleCancel),this.windowListeners.add(Le.ContextMenu,Sr),this.documentListeners.add(Le.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Or(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(Cr(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(n,r){const{active:s,onPending:i}=this.props;i(s,n,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:n}=this,{onStart:r}=this.props;n&&(this.activated=!0,this.documentListeners.add(Le.Click,Zi,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Le.SelectionChange,this.removeTextSelection),r(n))}handleMove(n){var r;const{activated:s,initialCoordinates:i,props:o}=this,{onMove:c,options:{activationConstraint:l}}=o;if(!i)return;const u=(r=Fn(n))!=null?r:Ue,d=Tt(i,u);if(!s&&l){if(Cr(l)){if(l.tolerance!=null&&On(d,l.tolerance))return this.handleCancel();if(On(d,l.distance))return this.handleStart()}if(Or(l)&&On(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}n.cancelable&&n.preventDefault(),c(u)}handleEnd(){const{onAbort:n,onEnd:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleCancel(){const{onAbort:n,onCancel:r}=this.props;this.detach(),this.activated||n(this.props.active),r()}handleKeydown(n){n.code===pe.Esc&&this.handleCancel()}removeTextSelection(){var n;(n=this.document.getSelection())==null||n.removeAllRanges()}}const ta={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Kn extends Yn{constructor(n){const{event:r}=n,s=ft(r.target);super(n,ta,s)}}Kn.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;return!r.isPrimary||r.button!==0?!1:(s==null||s({event:r}),!0)}}];const na={move:{name:"mousemove"},end:{name:"mouseup"}};var $n;(function(e){e[e.RightClick=2]="RightClick"})($n||($n={}));class ra extends Yn{constructor(n){super(n,na,ft(n.event.target))}}ra.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;return r.button===$n.RightClick?!1:(s==null||s({event:r}),!0)}}];const Pn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class sa extends Yn{constructor(n){super(n,Pn)}static setup(){return window.addEventListener(Pn.move.name,n,{capture:!1,passive:!1}),function(){window.removeEventListener(Pn.move.name,n)};function n(){}}}sa.activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:r}=e,{onActivation:s}=n;const{touches:i}=r;return i.length>1?!1:(s==null||s({event:r}),!0)}}];var St;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(St||(St={}));var cn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(cn||(cn={}));function ia(e){let{acceleration:n,activator:r=St.Pointer,canScroll:s,draggingRect:i,enabled:o,interval:c=5,order:l=cn.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:m,delta:h,threshold:g}=e;const v=oa({delta:h,disabled:!o}),[P,C]=vi(),I=ye({x:0,y:0}),R=ye({x:0,y:0}),L=he(()=>{switch(r){case St.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case St.DraggableRect:return i}},[r,i,u]),E=ye(null),M=ae(()=>{const y=E.current;if(!y)return;const b=I.current.x*R.current.x,_=I.current.y*R.current.y;y.scrollBy(b,_)},[]),j=he(()=>l===cn.TreeOrder?[...d].reverse():d,[l,d]);ge(()=>{if(!o||!d.length||!L){C();return}for(const y of j){if((s==null?void 0:s(y))===!1)continue;const b=d.indexOf(y),_=m[b];if(!_)continue;const{direction:S,speed:w}=Ji(y,_,L,n,g);for(const F of["x","y"])v[F][S[F]]||(w[F]=0,S[F]=0);if(w.x>0||w.y>0){C(),E.current=y,P(M,c),I.current=w,R.current=S;return}}I.current={x:0,y:0},R.current={x:0,y:0},C()},[n,M,s,C,o,c,JSON.stringify(L),JSON.stringify(v),P,d,j,m,JSON.stringify(g)])}const aa={x:{[Oe.Backward]:!1,[Oe.Forward]:!1},y:{[Oe.Backward]:!1,[Oe.Forward]:!1}};function oa(e){let{delta:n,disabled:r}=e;const s=In(n);return Xt(i=>{if(r||!s||!i)return aa;const o={x:Math.sign(n.x-s.x),y:Math.sign(n.y-s.y)};return{x:{[Oe.Backward]:i.x[Oe.Backward]||o.x===-1,[Oe.Forward]:i.x[Oe.Forward]||o.x===1},y:{[Oe.Backward]:i.y[Oe.Backward]||o.y===-1,[Oe.Forward]:i.y[Oe.Forward]||o.y===1}}},[r,n,s])}function ca(e,n){const r=n!=null?e.get(n):void 0,s=r?r.node.current:null;return Xt(i=>{var o;return n==null?null:(o=s??i)!=null?o:null},[s,n])}function la(e,n){return he(()=>e.reduce((r,s)=>{const{sensor:i}=s,o=i.activators.map(c=>({eventName:c.eventName,handler:n(c.handler,s)}));return[...r,...o]},[]),[e,n])}var At;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(At||(At={}));var Ln;(function(e){e.Optimized="optimized"})(Ln||(Ln={}));const Pr=new Map;function da(e,n){let{dragging:r,dependencies:s,config:i}=n;const[o,c]=fe(null),{frequency:l,measure:u,strategy:d}=i,m=ye(e),h=I(),g=kt(h),v=ae(function(R){R===void 0&&(R=[]),!g.current&&c(L=>L===null?R:L.concat(R.filter(E=>!L.includes(E))))},[g]),P=ye(null),C=Xt(R=>{if(h&&!r)return Pr;if(!R||R===Pr||m.current!==e||o!=null){const L=new Map;for(let E of e){if(!E)continue;if(o&&o.length>0&&!o.includes(E.id)&&E.rect.current){L.set(E.id,E.rect.current);continue}const M=E.node.current,j=M?new Hn(u(M),M):null;E.rect.current=j,j&&L.set(E.id,j)}return L}return R},[e,o,r,h,u]);return ge(()=>{m.current=e},[e]),ge(()=>{h||v()},[r,h]),ge(()=>{o&&o.length>0&&c(null)},[JSON.stringify(o)]),ge(()=>{h||typeof l!="number"||P.current!==null||(P.current=setTimeout(()=>{v(),P.current=null},l))},[l,h,v,...s]),{droppableRects:C,measureDroppableContainers:v,measuringScheduled:o!=null};function I(){switch(d){case At.Always:return!1;case At.BeforeDragging:return r;default:return!r}}}function os(e,n){return Xt(r=>e?r||(typeof n=="function"?n(e):e):null,[n,e])}function ua(e,n){return os(e,n)}function ha(e){let{callback:n,disabled:r}=e;const s=Jn(n),i=he(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,r]);return ge(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function fn(e){let{callback:n,disabled:r}=e;const s=Jn(n),i=he(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[r]);return ge(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function ma(e){return new Hn(gt(e),e)}function Rr(e,n,r){n===void 0&&(n=ma);const[s,i]=fe(null);function o(){i(u=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=u??r)!=null?d:null}const m=n(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const c=ha({callback(u){if(e)for(const d of u){const{type:m,target:h}=d;if(m==="childList"&&h instanceof HTMLElement&&h.contains(e)){o();break}}}}),l=fn({callback:o});return Je(()=>{o(),e?(l==null||l.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),c==null||c.disconnect())},[e]),s}function pa(e){const n=os(e);return Zr(e,n)}const _r=[];function fa(e){const n=ye(e),r=Xt(s=>e?s&&s!==_r&&e&&n.current&&e.parentNode===n.current.parentNode?s:pn(e):_r,[e]);return ge(()=>{n.current=e},[e]),r}function ga(e){const[n,r]=fe(null),s=ye(e),i=ae(o=>{const c=Cn(o.target);c&&r(l=>l?(l.set(c,zn(c)),new Map(l)):null)},[]);return ge(()=>{const o=s.current;if(e!==o){c(o);const l=e.map(u=>{const d=Cn(u);return d?(d.addEventListener("scroll",i,{passive:!0}),[d,zn(d)]):null}).filter(u=>u!=null);r(l.length?new Map(l):null),s.current=e}return()=>{c(e),c(o)};function c(l){l.forEach(u=>{const d=Cn(u);d==null||d.removeEventListener("scroll",i)})}},[i,e]),he(()=>e.length?n?Array.from(n.values()).reduce((o,c)=>ht(o,c),Ue):is(e):Ue,[e,n])}function Er(e,n){n===void 0&&(n=[]);const r=ye(null);return ge(()=>{r.current=null},n),ge(()=>{const s=e!==Ue;s&&!r.current&&(r.current=e),!s&&r.current&&(r.current=null)},[e]),r.current?Tt(e,r.current):Ue}function va(e){ge(()=>{if(!mn)return;const n=e.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of n)r==null||r()}},e.map(n=>{let{sensor:r}=n;return r}))}function ba(e,n){return he(()=>e.reduce((r,s)=>{let{eventName:i,handler:o}=s;return r[i]=c=>{o(c,n)},r},{}),[e,n])}function cs(e){return he(()=>e?Ui(e):null,[e])}const kr=[];function wa(e,n){n===void 0&&(n=gt);const[r]=e,s=cs(r?Te(r):null),[i,o]=fe(kr);function c(){o(()=>e.length?e.map(u=>rs(u)?s:new Hn(n(u),u)):kr)}const l=fn({callback:c});return Je(()=>{l==null||l.disconnect(),c(),e.forEach(u=>l==null?void 0:l.observe(u))},[e]),i}function xa(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return Jt(n)?n:e}function ya(e){let{measure:n}=e;const[r,s]=fe(null),i=ae(d=>{for(const{target:m}of d)if(Jt(m)){s(h=>{const g=n(m);return h?{...h,width:g.width,height:g.height}:g});break}},[n]),o=fn({callback:i}),c=ae(d=>{const m=xa(d);o==null||o.disconnect(),m&&(o==null||o.observe(m)),s(m?n(m):null)},[n,o]),[l,u]=an(c);return he(()=>({nodeRef:l,rect:r,setRef:u}),[r,l,u])}const Na=[{sensor:Kn,options:{}},{sensor:Vn,options:{}}],Da={current:{}},tn={draggable:{measure:Dr},droppable:{measure:Dr,strategy:At.WhileDragging,frequency:Ln.Optimized},dragOverlay:{measure:gt}};class Ct extends Map{get(n){var r;return n!=null&&(r=super.get(n))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(n=>{let{disabled:r}=n;return!r})}getNodeFor(n){var r,s;return(r=(s=this.get(n))==null?void 0:s.node.current)!=null?r:void 0}}const Sa={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ct,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:on},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:tn,measureDroppableContainers:on,windowRect:null,measuringScheduled:!1},Ca={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:on,draggableNodes:new Map,over:null,measureDroppableContainers:on},gn=It(Ca),ls=It(Sa);function Oa(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ct}}}function Pa(e,n){switch(n.type){case Ce.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case Ce.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case Ce.DragEnd:case Ce.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ce.RegisterDroppable:{const{element:r}=n,{id:s}=r,i=new Ct(e.droppable.containers);return i.set(s,r),{...e,droppable:{...e.droppable,containers:i}}}case Ce.SetDroppableDisabled:{const{id:r,key:s,disabled:i}=n,o=e.droppable.containers.get(r);if(!o||s!==o.key)return e;const c=new Ct(e.droppable.containers);return c.set(r,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:c}}}case Ce.UnregisterDroppable:{const{id:r,key:s}=n,i=e.droppable.containers.get(r);if(!i||s!==i.key)return e;const o=new Ct(e.droppable.containers);return o.delete(r),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Ra(e){let{disabled:n}=e;const{active:r,activatorEvent:s,draggableNodes:i}=at(gn),o=In(s),c=In(r==null?void 0:r.id);return ge(()=>{if(!n&&!s&&o&&c!=null){if(!Xn(o)||document.activeElement===o.target)return;const l=i.get(c);if(!l)return;const{activatorNode:u,node:d}=l;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const m of[u.current,d.current]){if(!m)continue;const h=xi(m);if(h){h.focus();break}}})}},[s,n,i,c,o]),null}function _a(e,n){let{transform:r,...s}=n;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...s}),r):r}function Ea(e){return he(()=>({draggable:{...tn.draggable,...e==null?void 0:e.draggable},droppable:{...tn.droppable,...e==null?void 0:e.droppable},dragOverlay:{...tn.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function ka(e){let{activeNode:n,measure:r,initialRect:s,config:i=!0}=e;const o=ye(!1),{x:c,y:l}=typeof i=="boolean"?{x:i,y:i}:i;Je(()=>{if(!c&&!l||!n){o.current=!1;return}if(o.current||!s)return;const d=n==null?void 0:n.node.current;if(!d||d.isConnected===!1)return;const m=r(d),h=Zr(m,s);if(c||(h.x=0),l||(h.y=0),o.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const g=es(d);g&&g.scrollBy({top:h.y,left:h.x})}},[n,c,l,s,r])}const ds=It({...Ue,scaleX:1,scaleY:1});var tt;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(tt||(tt={}));const Ta=js(function(n){var r,s,i,o;let{id:c,accessibility:l,autoScroll:u=!0,children:d,sensors:m=Na,collisionDetection:h=Ii,measuring:g,modifiers:v,...P}=n;const C=As(Pa,void 0,Oa),[I,R]=C,[L,E]=Oi(),[M,j]=fe(tt.Uninitialized),y=M===tt.Initialized,{draggable:{active:b,nodes:_,translate:S},droppable:{containers:w}}=I,F=b!=null?_.get(b):null,J=ye({initial:null,translated:null}),N=he(()=>{var _e;return b!=null?{id:b,data:(_e=F==null?void 0:F.data)!=null?_e:Da,rect:J}:null},[b,F]),p=ye(null),[x,G]=fe(null),[U,K]=fe(null),se=kt(P,Object.values(P)),le=Ht("DndDescribedBy",c),k=he(()=>w.getEnabled(),[w]),O=Ea(g),{droppableRects:A,measureDroppableContainers:B,measuringScheduled:q}=da(k,{dragging:y,dependencies:[S.x,S.y],config:O.droppable}),X=ca(_,b),ne=he(()=>U?Fn(U):null,[U]),H=ys(),te=ua(X,O.draggable.measure);ka({activeNode:b!=null?_.get(b):null,config:H.layoutShiftCompensation,initialRect:te,measure:O.draggable.measure});const Q=Rr(X,O.draggable.measure,te),oe=Rr(X?X.parentElement:null),me=ye({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:A,draggableNodes:_,draggingNode:null,draggingNodeRect:null,droppableContainers:w,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),be=w.getNodeFor((r=me.current.over)==null?void 0:r.id),D=ya({measure:O.dragOverlay.measure}),T=(s=D.nodeRef.current)!=null?s:X,z=y?(i=D.rect)!=null?i:Q:null,Z=!!(D.nodeRef.current&&D.rect),Y=pa(Z?null:Q),ee=cs(T?Te(T):null),$=fa(y?be??X:null),W=wa($),ue=_a(v,{transform:{x:S.x-Y.x,y:S.y-Y.y,scaleX:1,scaleY:1},activatorEvent:U,active:N,activeNodeRect:Q,containerNodeRect:oe,draggingNodeRect:z,over:me.current.over,overlayNodeRect:D.rect,scrollableAncestors:$,scrollableAncestorRects:W,windowRect:ee}),xe=ne?ht(ne,S):null,Ne=ga($),Be=Er(Ne),vt=Er(Ne,[Q]),lt=ht(ue,Be),dt=z?$i(z,ue):null,bt=N&&dt?h({active:N,collisionRect:dt,droppableRects:A,droppableContainers:k,pointerCoordinates:xe}):null,Zn=Qr(bt,"id"),[Ke,er]=fe(null),gs=Z?ue:ht(ue,vt),vs=Fi(gs,(o=Ke==null?void 0:Ke.rect)!=null?o:null,Q),vn=ye(null),tr=ae((_e,je)=>{let{sensor:Ae,options:Qe}=je;if(p.current==null)return;const $e=_.get(p.current);if(!$e)return;const Ie=_e.nativeEvent,We=new Ae({active:p.current,activeNode:$e,event:Ie,options:Qe,context:me,onAbort(Pe){if(!_.get(Pe))return;const{onDragAbort:qe}=se.current,Xe={id:Pe};qe==null||qe(Xe),L({type:"onDragAbort",event:Xe})},onPending(Pe,Ze,qe,Xe){if(!_.get(Pe))return;const{onDragPending:xt}=se.current,et={id:Pe,constraint:Ze,initialCoordinates:qe,offset:Xe};xt==null||xt(et),L({type:"onDragPending",event:et})},onStart(Pe){const Ze=p.current;if(Ze==null)return;const qe=_.get(Ze);if(!qe)return;const{onDragStart:Xe}=se.current,wt={activatorEvent:Ie,active:{id:Ze,data:qe.data,rect:J}};Yt(()=>{Xe==null||Xe(wt),j(tt.Initializing),R({type:Ce.DragStart,initialCoordinates:Pe,active:Ze}),L({type:"onDragStart",event:wt}),G(vn.current),K(Ie)})},onMove(Pe){R({type:Ce.DragMove,coordinates:Pe})},onEnd:ut(Ce.DragEnd),onCancel:ut(Ce.DragCancel)});vn.current=We;function ut(Pe){return async function(){const{active:qe,collisions:Xe,over:wt,scrollAdjustedTranslate:xt}=me.current;let et=null;if(qe&&xt){const{cancelDrop:yt}=se.current;et={activatorEvent:Ie,active:qe,collisions:Xe,delta:xt,over:wt},Pe===Ce.DragEnd&&typeof yt=="function"&&await Promise.resolve(yt(et))&&(Pe=Ce.DragCancel)}p.current=null,Yt(()=>{R({type:Pe}),j(tt.Uninitialized),er(null),G(null),K(null),vn.current=null;const yt=Pe===Ce.DragEnd?"onDragEnd":"onDragCancel";if(et){const bn=se.current[yt];bn==null||bn(et),L({type:yt,event:et})}})}}},[_]),bs=ae((_e,je)=>(Ae,Qe)=>{const $e=Ae.nativeEvent,Ie=_.get(Qe);if(p.current!==null||!Ie||$e.dndKit||$e.defaultPrevented)return;const We={active:Ie};_e(Ae,je.options,We)===!0&&($e.dndKit={capturedBy:je.sensor},p.current=Qe,tr(Ae,je))},[_,tr]),nr=la(m,bs);va(m),Je(()=>{Q&&M===tt.Initializing&&j(tt.Initialized)},[Q,M]),ge(()=>{const{onDragMove:_e}=se.current,{active:je,activatorEvent:Ae,collisions:Qe,over:$e}=me.current;if(!je||!Ae)return;const Ie={active:je,activatorEvent:Ae,collisions:Qe,delta:{x:lt.x,y:lt.y},over:$e};Yt(()=>{_e==null||_e(Ie),L({type:"onDragMove",event:Ie})})},[lt.x,lt.y]),ge(()=>{const{active:_e,activatorEvent:je,collisions:Ae,droppableContainers:Qe,scrollAdjustedTranslate:$e}=me.current;if(!_e||p.current==null||!je||!$e)return;const{onDragOver:Ie}=se.current,We=Qe.get(Zn),ut=We&&We.rect.current?{id:We.id,rect:We.rect.current,data:We.data,disabled:We.disabled}:null,Pe={active:_e,activatorEvent:je,collisions:Ae,delta:{x:$e.x,y:$e.y},over:ut};Yt(()=>{er(ut),Ie==null||Ie(Pe),L({type:"onDragOver",event:Pe})})},[Zn]),Je(()=>{me.current={activatorEvent:U,active:N,activeNode:X,collisionRect:dt,collisions:bt,droppableRects:A,draggableNodes:_,draggingNode:T,draggingNodeRect:z,droppableContainers:w,over:Ke,scrollableAncestors:$,scrollAdjustedTranslate:lt},J.current={initial:z,translated:dt}},[N,X,bt,dt,_,T,z,A,w,Ke,$,lt]),ia({...H,delta:S,draggingRect:dt,pointerCoordinates:xe,scrollableAncestors:$,scrollableAncestorRects:W});const ws=he(()=>({active:N,activeNode:X,activeNodeRect:Q,activatorEvent:U,collisions:bt,containerNodeRect:oe,dragOverlay:D,draggableNodes:_,droppableContainers:w,droppableRects:A,over:Ke,measureDroppableContainers:B,scrollableAncestors:$,scrollableAncestorRects:W,measuringConfiguration:O,measuringScheduled:q,windowRect:ee}),[N,X,Q,U,bt,oe,D,_,w,A,Ke,B,$,W,O,q,ee]),xs=he(()=>({activatorEvent:U,activators:nr,active:N,activeNodeRect:Q,ariaDescribedById:{draggable:le},dispatch:R,draggableNodes:_,over:Ke,measureDroppableContainers:B}),[U,nr,N,Q,R,le,_,Ke,B]);return re.createElement(Vr.Provider,{value:E},re.createElement(gn.Provider,{value:xs},re.createElement(ls.Provider,{value:ws},re.createElement(ds.Provider,{value:vs},d)),re.createElement(Ra,{disabled:(l==null?void 0:l.restoreFocus)===!1})),re.createElement(_i,{...l,hiddenTextDescribedById:le}));function ys(){const _e=(x==null?void 0:x.autoScrollEnabled)===!1,je=typeof u=="object"?u.enabled===!1:u===!1,Ae=y&&!_e&&!je;return typeof u=="object"?{...u,enabled:Ae}:{enabled:Ae}}}),ja=It(null),Tr="button",Aa="Draggable";function Ia(e){let{id:n,data:r,disabled:s=!1,attributes:i}=e;const o=Ht(Aa),{activators:c,activatorEvent:l,active:u,activeNodeRect:d,ariaDescribedById:m,draggableNodes:h,over:g}=at(gn),{role:v=Tr,roleDescription:P="draggable",tabIndex:C=0}=i??{},I=(u==null?void 0:u.id)===n,R=at(I?ds:ja),[L,E]=an(),[M,j]=an(),y=ba(c,n),b=kt(r);Je(()=>(h.set(n,{id:n,key:o,node:L,activatorNode:M,data:b}),()=>{const S=h.get(n);S&&S.key===o&&h.delete(n)}),[h,n]);const _=he(()=>({role:v,tabIndex:C,"aria-disabled":s,"aria-pressed":I&&v===Tr?!0:void 0,"aria-roledescription":P,"aria-describedby":m.draggable}),[s,v,C,I,P,m.draggable]);return{active:u,activatorEvent:l,activeNodeRect:d,attributes:_,isDragging:I,listeners:s?void 0:y,node:L,over:g,setNodeRef:E,setActivatorNodeRef:j,transform:R}}function Fa(){return at(ls)}const za="Droppable",$a={timeout:25};function La(e){let{data:n,disabled:r=!1,id:s,resizeObserverConfig:i}=e;const o=Ht(za),{active:c,dispatch:l,over:u,measureDroppableContainers:d}=at(gn),m=ye({disabled:r}),h=ye(!1),g=ye(null),v=ye(null),{disabled:P,updateMeasurementsFor:C,timeout:I}={...$a,...i},R=kt(C??s),L=ae(()=>{if(!h.current){h.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{d(Array.isArray(R.current)?R.current:[R.current]),v.current=null},I)},[I]),E=fn({callback:L,disabled:P||!c}),M=ae((_,S)=>{E&&(S&&(E.unobserve(S),h.current=!1),_&&E.observe(_))},[E]),[j,y]=an(M),b=kt(n);return ge(()=>{!E||!j.current||(E.disconnect(),h.current=!1,E.observe(j.current))},[j,E]),ge(()=>(l({type:Ce.RegisterDroppable,element:{id:s,key:o,disabled:r,node:j,rect:g,data:b}}),()=>l({type:Ce.UnregisterDroppable,key:o,id:s})),[s]),ge(()=>{r!==m.current.disabled&&(l({type:Ce.SetDroppableDisabled,id:s,key:o,disabled:r}),m.current.disabled=r)},[s,o,r,l]),{active:c,rect:g,isOver:(u==null?void 0:u.id)===s,node:j,over:u,setNodeRef:y}}function Qn(e,n,r){const s=e.slice();return s.splice(r<0?s.length+r:r,0,s.splice(n,1)[0]),s}function Ga(e,n){return e.reduce((r,s,i)=>{const o=n.get(s);return o&&(r[i]=o),r},Array(e.length))}function Zt(e){return e!==null&&e>=0}function Ma(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function Ua(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const us=e=>{let{rects:n,activeIndex:r,overIndex:s,index:i}=e;const o=Qn(n,s,r),c=n[i],l=o[i];return!l||!c?null:{x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height}},en={scaleX:1,scaleY:1},Ba=e=>{var n;let{activeIndex:r,activeNodeRect:s,index:i,rects:o,overIndex:c}=e;const l=(n=o[r])!=null?n:s;if(!l)return null;if(i===r){const d=o[c];return d?{x:0,y:r<c?d.top+d.height-(l.top+l.height):d.top-l.top,...en}:null}const u=Wa(o,i,r);return i>r&&i<=c?{x:0,y:-l.height-u,...en}:i<r&&i>=c?{x:0,y:l.height+u,...en}:{x:0,y:0,...en}};function Wa(e,n,r){const s=e[n],i=e[n-1],o=e[n+1];return s?r<n?i?s.top-(i.top+i.height):o?o.top-(s.top+s.height):0:o?o.top-(s.top+s.height):i?s.top-(i.top+i.height):0:0}const hs="Sortable",ms=re.createContext({activeIndex:-1,containerId:hs,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:us,disabled:{draggable:!1,droppable:!1}});function qa(e){let{children:n,id:r,items:s,strategy:i=us,disabled:o=!1}=e;const{active:c,dragOverlay:l,droppableRects:u,over:d,measureDroppableContainers:m}=Fa(),h=Ht(hs,r),g=l.rect!==null,v=he(()=>s.map(y=>typeof y=="object"&&"id"in y?y.id:y),[s]),P=c!=null,C=c?v.indexOf(c.id):-1,I=d?v.indexOf(d.id):-1,R=ye(v),L=!Ma(v,R.current),E=I!==-1&&C===-1||L,M=Ua(o);Je(()=>{L&&P&&m(v)},[L,v,P,m]),ge(()=>{R.current=v},[v]);const j=he(()=>({activeIndex:C,containerId:h,disabled:M,disableTransforms:E,items:v,overIndex:I,useDragOverlay:g,sortedRects:Ga(v,u),strategy:i}),[C,h,M.draggable,M.droppable,E,v,I,u,g,i]);return re.createElement(ms.Provider,{value:j},n)}const Ja=e=>{let{id:n,items:r,activeIndex:s,overIndex:i}=e;return Qn(r,s,i).indexOf(n)},Xa=e=>{let{containerId:n,isSorting:r,wasDragging:s,index:i,items:o,newIndex:c,previousItems:l,previousContainerId:u,transition:d}=e;return!d||!s||l!==o&&i===c?!1:r?!0:c!==i&&n===u},Ha={duration:200,easing:"ease"},ps="transform",Va=jt.Transition.toString({property:ps,duration:0,easing:"linear"}),Ya={roleDescription:"sortable"};function Ka(e){let{disabled:n,index:r,node:s,rect:i}=e;const[o,c]=fe(null),l=ye(r);return Je(()=>{if(!n&&r!==l.current&&s.current){const u=i.current;if(u){const d=gt(s.current,{ignoreTransform:!0}),m={x:u.left-d.left,y:u.top-d.top,scaleX:u.width/d.width,scaleY:u.height/d.height};(m.x||m.y)&&c(m)}}r!==l.current&&(l.current=r)},[n,r,s,i]),ge(()=>{o&&c(null)},[o]),o}function Qa(e){let{animateLayoutChanges:n=Xa,attributes:r,disabled:s,data:i,getNewIndex:o=Ja,id:c,strategy:l,resizeObserverConfig:u,transition:d=Ha}=e;const{items:m,containerId:h,activeIndex:g,disabled:v,disableTransforms:P,sortedRects:C,overIndex:I,useDragOverlay:R,strategy:L}=at(ms),E=Za(s,v),M=m.indexOf(c),j=he(()=>({sortable:{containerId:h,index:M,items:m},...i}),[h,i,M,m]),y=he(()=>m.slice(m.indexOf(c)),[m,c]),{rect:b,node:_,isOver:S,setNodeRef:w}=La({id:c,data:j,disabled:E.droppable,resizeObserverConfig:{updateMeasurementsFor:y,...u}}),{active:F,activatorEvent:J,activeNodeRect:N,attributes:p,setNodeRef:x,listeners:G,isDragging:U,over:K,setActivatorNodeRef:se,transform:le}=Ia({id:c,data:j,attributes:{...Ya,...r},disabled:E.draggable}),k=gi(w,x),O=!!F,A=O&&!P&&Zt(g)&&Zt(I),B=!R&&U,q=B&&A?le:null,ne=A?q??(l??L)({rects:C,activeNodeRect:N,activeIndex:g,overIndex:I,index:M}):null,H=Zt(g)&&Zt(I)?o({id:c,items:m,activeIndex:g,overIndex:I}):M,te=F==null?void 0:F.id,Q=ye({activeId:te,items:m,newIndex:H,containerId:h}),oe=m!==Q.current.items,me=n({active:F,containerId:h,isDragging:U,isSorting:O,id:c,index:M,items:m,newIndex:Q.current.newIndex,previousItems:Q.current.items,previousContainerId:Q.current.containerId,transition:d,wasDragging:Q.current.activeId!=null}),be=Ka({disabled:!me,index:M,node:_,rect:b});return ge(()=>{O&&Q.current.newIndex!==H&&(Q.current.newIndex=H),h!==Q.current.containerId&&(Q.current.containerId=h),m!==Q.current.items&&(Q.current.items=m)},[O,H,h,m]),ge(()=>{if(te===Q.current.activeId)return;if(te&&!Q.current.activeId){Q.current.activeId=te;return}const T=setTimeout(()=>{Q.current.activeId=te},50);return()=>clearTimeout(T)},[te]),{active:F,activeIndex:g,attributes:p,data:j,rect:b,index:M,newIndex:H,items:m,isOver:S,isSorting:O,isDragging:U,listeners:G,node:_,overIndex:I,over:K,setNodeRef:k,setActivatorNodeRef:se,setDroppableNodeRef:w,setDraggableNodeRef:x,transform:be??ne,transition:D()};function D(){if(be||oe&&Q.current.newIndex===M)return Va;if(!(B&&!Xn(J)||!d)&&(O||me))return jt.Transition.toString({...d,property:ps})}}function Za(e,n){var r,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(r=e==null?void 0:e.draggable)!=null?r:n.draggable,droppable:(s=e==null?void 0:e.droppable)!=null?s:n.droppable}}function ln(e){if(!e)return!1;const n=e.data.current;return!!(n&&"sortable"in n&&typeof n.sortable=="object"&&"containerId"in n.sortable&&"items"in n.sortable&&"index"in n.sortable)}const eo=[pe.Down,pe.Right,pe.Up,pe.Left],to=(e,n)=>{let{context:{active:r,collisionRect:s,droppableRects:i,droppableContainers:o,over:c,scrollableAncestors:l}}=n;if(eo.includes(e.code)){if(e.preventDefault(),!r||!s)return;const u=[];o.getEnabled().forEach(h=>{if(!h||h!=null&&h.disabled)return;const g=i.get(h.id);if(g)switch(e.code){case pe.Down:s.top<g.top&&u.push(h);break;case pe.Up:s.top>g.top&&u.push(h);break;case pe.Left:s.left>g.left&&u.push(h);break;case pe.Right:s.left<g.left&&u.push(h);break}});const d=ji({collisionRect:s,droppableRects:i,droppableContainers:u});let m=Qr(d,"id");if(m===(c==null?void 0:c.id)&&d.length>1&&(m=d[1].id),m!=null){const h=o.get(r.id),g=o.get(m),v=g?i.get(g.id):null,P=g==null?void 0:g.node.current;if(P&&v&&h&&g){const I=pn(P).some((y,b)=>l[b]!==y),R=fs(h,g),L=no(h,g),E=I||!R?{x:0,y:0}:{x:L?s.width-v.width:0,y:L?s.height-v.height:0},M={x:v.left,y:v.top};return E.x&&E.y?M:Tt(M,E)}}}};function fs(e,n){return!ln(e)||!ln(n)?!1:e.data.current.sortable.containerId===n.data.current.sortable.containerId}function no(e,n){return!ln(e)||!ln(n)||!fs(e,n)?!1:e.data.current.sortable.index<n.data.current.sortable.index}const ro=e=>`field_${e.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}`,so=({field:e,index:n,fields:r,onFieldsChange:s,editingFieldId:i,setEditingFieldId:o,newValue:c,setNewValue:l,conditionFieldId:u,setConditionFieldId:d,conditionDependsOn:m,setConditionDependsOn:h,conditionValue:g,setConditionValue:v})=>{const{attributes:P,listeners:C,setNodeRef:I,transform:R,transition:L,isDragging:E}=Qa({id:e.id}),M={transform:jt.Transform.toString(R),transition:L,opacity:E?.5:1},j=(N,p)=>{s(r.map(x=>x.id===N?{...x,label:p}:x))},y=N=>{s(r.filter(p=>p.id!==N))},b=N=>{c.trim()&&(s(r.map(p=>{if(p.id===N){if(p.type==="text")return{...p,value:c};{const x=[...p.values||[],c];return{...p,values:x}}}return p})),l(""))},_=(N,p)=>{s(r.map(x=>{var G,U;if(x.id===N){if(x.type==="text")return{...x,value:""};{const K=((G=x.values)==null?void 0:G.filter((k,O)=>O!==p))||[],se=(U=x.values)==null?void 0:U[p||0];let le=x.defaultValue;return se===x.defaultValue&&(le=K.length>0?K[0]:void 0),{...x,values:K,defaultValue:le}}}return x}))},S=(N,p)=>{s(r.map(x=>x.id===N?{...x,defaultValue:p}:x))},w=N=>{s(r.map(p=>p.id===N?{...p,defaultValue:void 0}:p))},F=(N,p,x)=>{s(r.map(G=>{if(G.id===N){const U=[...G.conditions||[]],K=U.findIndex(se=>se.fieldId===p);return K>=0?U[K]={fieldId:p,value:x}:U.push({fieldId:p,value:x}),{...G,conditions:U}}return G}))},J=(N,p)=>{s(r.map(x=>{var G;if(x.id===N){const U=((G=x.conditions)==null?void 0:G.filter((K,se)=>se!==p))||[];return{...x,conditions:U.length>0?U:void 0}}return x}))};return t(ce,{ref:I,style:M,className:`border border-default-200 ${E?"bg-default-100 shadow-lg":""}`,children:a(de,{className:"space-y-4",children:[a("div",{className:"flex items-center justify-between",children:[a("div",{className:"flex items-center gap-3 flex-1",children:[t("div",{...P,...C,className:"cursor-grab active:cursor-grabbing hover:text-primary transition-colors",title:"Drag to reorder",children:t(f,{icon:"tabler:grip-vertical",fontSize:20})}),t("div",{className:"flex items-center justify-center w-8 h-8 rounded bg-default-100 text-sm font-semibold",children:n+1}),t("div",{className:"flex-1",children:t(Ee,{label:"Field Label",value:e.label,onChange:N=>j(e.id,N.target.value),size:"sm",classNames:{input:"urbana-input"}})}),t("div",{className:"px-3 py-2 rounded bg-default-100 text-sm font-medium min-w-max",children:e.type==="text"?"Text Field":"Dropdown"})]}),t(V,{isIconOnly:!0,color:"danger",variant:"light",size:"sm",onPress:()=>y(e.id),className:"ml-2",children:t(f,{icon:"tabler:trash",fontSize:18})})]}),a(ke,{children:[t(Ot,{}),a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:e.type==="text"?"tabler:list":"tabler:list-check",fontSize:18,className:"text-default-500"}),t("span",{className:"font-medium text-sm",children:e.type==="text"?"Text Value":"Dropdown Options"})]}),e.type==="text"&&a("div",{className:"space-y-2",children:[e.value&&a("div",{className:"flex items-center justify-between gap-2 p-2 bg-default-50 rounded",children:[t("span",{className:"text-sm truncate flex-1",children:e.value}),t(V,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>_(e.id),children:t(f,{icon:"tabler:x",fontSize:16})})]}),!e.value&&a("div",{className:"flex gap-2",children:[t(Ee,{placeholder:"Enter text value",value:i===e.id?c:"",onChange:N=>{o(e.id),l(N.target.value)},onFocus:()=>o(e.id),onKeyDown:N=>{N.key==="Enter"&&i===e.id&&b(e.id)},size:"sm",classNames:{input:"urbana-input"}}),t(V,{size:"sm",color:"secondary",onPress:()=>b(e.id),isDisabled:i!==e.id||!c.trim(),children:t(f,{icon:"tabler:plus",fontSize:16})})]})]}),e.type==="dropdown"&&a("div",{className:"space-y-2",children:[e.values&&e.values.length>0&&t("div",{className:"space-y-2 pl-2",children:e.values.map((N,p)=>a("div",{className:"flex items-center justify-between gap-2 p-2 bg-default-50 rounded",children:[a("div",{className:"flex items-center gap-2 flex-1",children:[t("span",{className:"text-sm truncate flex-1",children:N}),t(Ve,{isSelected:e.defaultValue===N,onChange:x=>{x?S(e.id,N):w(e.id)},size:"sm",classNames:{label:"text-xs"},children:"Default"})]}),t(V,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>_(e.id,p),children:t(f,{icon:"tabler:x",fontSize:16})})]},p))}),a("div",{className:"flex gap-2 pt-2",children:[t(Ee,{placeholder:"Add option (e.g., Red, Blue, Green)",value:i===e.id?c:"",onChange:N=>{o(e.id),l(N.target.value)},onFocus:()=>o(e.id),onKeyDown:N=>{N.key==="Enter"&&i===e.id&&b(e.id)},size:"sm",classNames:{input:"urbana-input"}}),t(V,{size:"sm",color:"secondary",onPress:()=>b(e.id),isDisabled:i!==e.id||!c.trim(),children:t(f,{icon:"tabler:plus",fontSize:16})})]}),t("div",{className:"text-xs text-default-400 italic pt-1",children:e.defaultValue?`Default: "${e.defaultValue}"`:`No default set - will show "Select ${e.label}"`})]})]})]}),e.type==="dropdown"&&a(ke,{children:[t(Ot,{}),a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"tabler:branching",fontSize:18,className:"text-default-500"}),t("span",{className:"font-medium text-sm",children:"Show When (Conditions)"})]}),e.conditions&&e.conditions.length>0&&t("div",{className:"space-y-2 pl-2",children:e.conditions.map((N,p)=>{const x=r.find(G=>G.id===N.fieldId);return a("div",{className:"flex items-center justify-between gap-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800",children:[a("span",{className:"text-sm",children:[t("span",{className:"font-medium",children:(x==null?void 0:x.label)||"Unknown Field"})," = ",a("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:['"',N.value,'"']})]}),t(V,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>J(e.id,p),children:t(f,{icon:"tabler:x",fontSize:16})})]},p)})}),u===e.id?a("div",{className:"space-y-2 p-3 bg-default-50 rounded border border-default-200",children:[a("div",{className:"grid grid-cols-2 gap-2",children:[t(it,{label:"Depends on Field",selectedKeys:m?[m]:[],onChange:N=>h(N.target.value),size:"sm",children:r.map(N=>N.type==="dropdown"&&N.id!==e.id?t(nt,{children:N.label},N.id):null)}),m&&t(it,{label:"When Value is",selectedKeys:g?[g]:[],onChange:N=>v(N.target.value),size:"sm",children:(()=>{var p;const N=r.find(x=>x.id===m);return((p=N==null?void 0:N.values)==null?void 0:p.map(x=>t(nt,{children:x},x)))||[]})()})]}),a("div",{className:"flex gap-2 justify-end",children:[t(V,{size:"sm",variant:"light",onPress:()=>{d(null),h(""),v("")},children:"Cancel"}),t(V,{size:"sm",color:"primary",onPress:()=>{m&&g&&(F(e.id,m,g),d(null),h(""),v(""))},isDisabled:!m||!g,children:"Add Condition"})]})]}):t(V,{size:"sm",variant:"bordered",className:"w-full",onPress:()=>d(e.id),startContent:t(f,{icon:"tabler:plus",fontSize:16}),children:"Add Condition"}),(!e.conditions||e.conditions.length===0)&&t("div",{className:"text-xs text-default-400 italic",children:"No conditions set - this field will always be visible"})]})]})]})})},io=({fields:e=[],onFieldsChange:n})=>{const[r,s]=re.useState(""),[i,o]=re.useState("text"),[c,l]=re.useState(""),[u,d]=re.useState(null),[m,h]=re.useState(null),[g,v]=re.useState(""),[P,C]=re.useState(""),I=()=>{if(!r.trim())return;const E={id:ro(r),label:r,type:i,value:i==="text"?"":void 0,values:i==="dropdown"?[]:void 0,defaultValue:void 0};n([...e,E]),s(""),o("text"),l(""),d(null)},R=E=>{const{active:M,over:j}=E;if(j&&M.id!==j.id){const y=e.findIndex(_=>_.id===M.id),b=e.findIndex(_=>_.id===j.id);y!==-1&&b!==-1&&n(Qn(e,y,b))}},L=Ei(xr(Kn),xr(Vn,{coordinateGetter:to}));return a("div",{className:"space-y-4",children:[t("div",{className:"text-sm text-default-500",children:"Configure custom fields for the Core Design Element. Text fields have a single value, while dropdown fields can have multiple options with a default selection."}),t(ce,{className:"bg-default-100",children:a(de,{className:"space-y-4",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"tabler:plus",fontSize:20}),t("h3",{className:"font-semibold",children:"Add New Field"})]}),a("div",{className:"grid grid-cols-2 gap-4",children:[t(Ee,{label:"Field Label",placeholder:"e.g., Material, Color, Size",value:r,onChange:E=>s(E.target.value),classNames:{input:"urbana-input"},onKeyDown:E=>{E.key==="Enter"&&I()}}),a(it,{label:"Field Type",selectedKeys:[i],onChange:E=>o(E.target.value),children:[t(nt,{children:"Text Field"},"text"),t(nt,{children:"Dropdown"},"dropdown")]})]}),t("div",{className:"flex justify-end",children:t(V,{color:"primary",onPress:I,isDisabled:!r.trim(),children:"Add Field"})})]})}),t("div",{className:"space-y-3",children:e.length===0?t(ce,{className:"bg-default-50 border border-dashed border-default-300",children:t(de,{className:"py-8",children:t("p",{className:"text-center text-default-400 text-sm",children:"No fields added yet. Create your first field above."})})}):t(Ta,{sensors:L,collisionDetection:Ti,onDragEnd:R,children:t(qa,{items:e.map(E=>E.id),strategy:Ba,children:e.map((E,M)=>t(so,{field:E,index:M,fields:e,onFieldsChange:n,editingFieldId:u,setEditingFieldId:d,newValue:c,setNewValue:l,conditionFieldId:m,setConditionFieldId:h,conditionDependsOn:g,setConditionDependsOn:v,conditionValue:P,setConditionValue:C},E.id))})})}),e.length>0&&a("div",{className:"text-xs text-default-400 text-center",children:["Total Fields: ",e.length,e.filter(E=>E.type==="dropdown").length>0&&` • Dropdowns: ${e.filter(E=>E.type==="dropdown").length}`,t("br",{}),t("span",{className:"text-xs italic",children:"Drag fields by the handle icon to reorder"})]})]})};class He{static generateAssetStructure(n,r,s,i){const o=[];return s.forEach(c=>{var C,I;const l=(C=Object.entries(i.rangeToProducts).find(([R,L])=>L.includes(c.id)))==null?void 0:C[0];if(!l)return;const u=r.find(R=>R.id===l);if(!u)return;const d=(I=Object.entries(i.groupToRanges).find(([R,L])=>L.includes(l)))==null?void 0:I[0];if(!d)return;const m=n.find(R=>R.id===d);if(!m)return;const h=this.sanitizePathSegment(m.name),g=this.sanitizePathSegment(u.name),v=this.sanitizePathSegment(c.code),P={category:m.name.toLowerCase(),range:u.name.toLowerCase().replace(/\s+/g,"-"),productCode:c.code.toLowerCase(),paths:{imagesPath:`${this.baseAssetsPath}/${h}/${g}/${v}/images`,downloadsPath:`${this.baseAssetsPath}/${h}/${g}/${v}/downloads`,fullImagePath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${h}/${g}/${v}/images`,fullDownloadPath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${h}/${g}/${v}/downloads`}};o.push(P)}),o}static sanitizePathSegment(n){let r=n.replace(/[^a-zA-Z0-9\s\-_]/g," ");return r=r.replace(/\s+/g," "),r.toLowerCase().trim()}static async generateFoldersAPI(n){var r;try{const s=await fetch("/wp-json/urbana/v1/generate-asset-folders",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((r=window.urbanaAdmin)==null?void 0:r.nonce)||""},body:JSON.stringify({structures:n.map(o=>({category:o.category,range:o.range,productCode:o.productCode,imagesPath:o.paths.imagesPath,downloadsPath:o.paths.downloadsPath}))})});if(!s.ok)throw new Error(`Failed to generate folders: ${s.status} ${s.statusText}`);return await s.json()}catch(s){throw console.error("Error generating folders:",s),s}}static async debugPaths(){var n;try{const r=await fetch("/wp-json/urbana/v1/debug-paths",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((n=window.urbanaAdmin)==null?void 0:n.nonce)||""}});if(!r.ok)throw new Error(`Failed to get debug info: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error getting debug info:",r),r}}static generateFolderPreview(n){const r=[];return n.forEach(s=>{r.push(s.paths.imagesPath),r.push(s.paths.downloadsPath)}),[...new Set(r)].sort()}static updateProductPaths(n,r){return n.map(s=>{const i=r.find(l=>l.productCode===s.code.toLowerCase());if(!i)return s;const o=s.imageGallery.length>0?s.imageGallery.map((l,u)=>!l||l.includes("shelter/")||l.includes("toilet/")||l.includes("bridge/")||l.includes("access/")?`${i.paths.imagesPath}/image-${u+1}.jpg`:l):[`${i.paths.imagesPath}/hero-image.jpg`],c={};return Object.entries(s.files).forEach(([l,u])=>{u.includes("/")?c[l]=u:c[l]=`${i.paths.downloadsPath}/${u}`}),{...s,imageGallery:o,files:c}})}static async fetchAndUpdateAllProductAssets(n,r,s,i,o,c){var u;if(this.generateAssetStructure(n,r,s,i).length===0)return{success:!1,updatedCount:0,message:"No products found with proper group/range relationships."};try{const d=await fetch("/wp-json/urbana/v1/fetch-all-product-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((u=window.urbanaAdmin)==null?void 0:u.nonce)||""},body:JSON.stringify({stepperID:c||1})});if(!d.ok)throw new Error(`Failed to fetch assets: ${d.status}`);const m=await d.json();if(m.success){let h=0;return Object.entries(m.productAssets).forEach(([g,v])=>{const P=s.find(C=>C.code===g);P?(o(P.id,{imageGallery:v.images||[],files:v.files||{}}),h++):console.warn("Product not found for code:",g)}),{success:!0,updatedCount:h,message:`Successfully updated ${h} products with their assets.`}}else return{success:!1,updatedCount:0,message:"Failed to fetch assets: "+m.message}}catch(d){throw console.error("Error fetching all product assets:",d),d}}static async testDigitalOceanConnection(){var n;try{const r=await fetch("/wp-json/urbana/v1/digital-ocean/test-connection",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((n=window.urbanaAdmin)==null?void 0:n.nonce)||""}});if(!r.ok)throw new Error(`Connection test failed: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error testing Digital Ocean connection:",r),r}}static async fetchDigitalOceanAssets(n=""){var r;try{const s=await fetch("/wp-json/urbana/v1/digital-ocean/fetch-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((r=window.urbanaAdmin)==null?void 0:r.nonce)||""},body:JSON.stringify({prefix:n})});if(!s.ok)throw new Error(`Failed to fetch assets: ${s.status} ${s.statusText}`);return await s.json()}catch(s){throw console.error("Error fetching Digital Ocean assets:",s),s}}static async fetchDigitalOceanAssetsForProducts(n,r,s,i,o){try{const c=[];if(n.forEach(m=>{var E,M;const h=i.find(j=>j.code.toLowerCase()===m.toLowerCase());if(!h)return;const g=(E=Object.entries(o.rangeToProducts).find(([j,y])=>y.includes(h.id)))==null?void 0:E[0];if(!g)return;const v=s.find(j=>j.id===g);if(!v)return;const P=(M=Object.entries(o.groupToRanges).find(([j,y])=>y.includes(g)))==null?void 0:M[0];if(!P)return;const C=r.find(j=>j.id===P);if(!C)return;const I=this.sanitizePathSegment(C.name),R=this.sanitizePathSegment(v.name),L=this.sanitizePathSegment(h.code);c.push(`${I}/${R}/${L}`)}),c.length===0)throw new Error("No valid products found to sync");const l=this.findCommonPrefix(c),u=await this.fetchDigitalOceanAssets("");if(!u.success)return u;const d=this.filterStructuredDataByProducts(u.structured_data,n,r,s,i,o);return{...u,structured_data:d}}catch(c){throw console.error("Error fetching Digital Ocean assets for products:",c),c}}static findCommonPrefix(n){if(n.length===0)return"";if(n.length===1)return n[0];const r=n.map(o=>o.split("/")),s=[],i=Math.min(...r.map(o=>o.length));for(let o=0;o<i;o++){const c=r[0][o];if(r.every(l=>l[o]===c))s.push(c);else break}return s.length>0?s.join("/")+"/":""}static filterStructuredDataByProducts(n,r,s,i,o,c){const l={},u=new Map;return r.forEach(d=>{var C,I;const m=o.find(R=>R.code.toLowerCase()===d.toLowerCase());if(!m)return;const h=(C=Object.entries(c.rangeToProducts).find(([R,L])=>L.includes(m.id)))==null?void 0:C[0];if(!h)return;const g=i.find(R=>R.id===h);if(!g)return;const v=(I=Object.entries(c.groupToRanges).find(([R,L])=>L.includes(h)))==null?void 0:I[0];if(!v)return;const P=s.find(R=>R.id===v);P&&u.set(d.toLowerCase(),{category:P.name,range:g.name,productCode:d})}),Object.entries(n).forEach(([d,m])=>{Object.entries(m).forEach(([h,g])=>{Object.entries(g).forEach(([v,P])=>{const C=v.toLowerCase();for(const[I,R]of u.entries())if(I===C){const L=d.toLowerCase().includes(R.category.toLowerCase())||R.category.toLowerCase().includes(d.toLowerCase()),E=h.toLowerCase().replace(/[\s-_]/g,"")===R.range.toLowerCase().replace(/[\s-_]/g,"");L&&E&&(l[d]||(l[d]={}),l[d][h]||(l[d][h]={}),l[d][h][v]=P);break}})})}),l}static async getDigitalOceanConfig(){var n;try{const r=await fetch("/wp-json/urbana/v1/digital-ocean/config",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((n=window.urbanaAdmin)==null?void 0:n.nonce)||""}});if(!r.ok)throw new Error(`Failed to get config: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error getting Digital Ocean config:",r),r}}static updateProductPathsFromDigitalOcean(n,r,s,i,o){return n.map(c=>{var R,L;const l=(R=Object.entries(o.rangeToProducts).find(([E,M])=>M.includes(c.id)))==null?void 0:R[0];if(!l)return console.warn(`No range found for product: ${c.code}`),c;const u=i.find(E=>E.id===l);if(!u)return console.warn(`Range not found for rangeId: ${l}`),c;const d=(L=Object.entries(o.groupToRanges).find(([E,M])=>M.includes(l)))==null?void 0:L[0];if(!d)return console.warn(`No group found for range: ${u.name}`),c;const m=s.find(E=>E.id===d);if(!m)return console.warn(`Group not found for groupId: ${d}`),c;let h=null,g=null,v=null;for(const[E,M]of Object.entries(r)){if(typeof M=="object"&&!Array.isArray(M)&&(E.toLowerCase().includes(m.name.toLowerCase())||m.name.toLowerCase().includes(E.toLowerCase())))for(const[j,y]of Object.entries(M)){if(typeof y=="object"&&!Array.isArray(y)&&j.toLowerCase().replace(/[\s-_]/g,"")===u.name.toLowerCase().replace(/[\s-_]/g,"")){for(const[_,S]of Object.entries(y))if(_.toLowerCase()===c.code.toLowerCase()){h=S,g=E,v=j;break}}if(h)break}if(h)break}if(!h)return console.warn(`No Digital Ocean data found for product: ${c.code} (Group: ${m.name}, Range: ${u.name})`),c;console.log(`Found match for ${c.code}:`,{category:g,range:v,images:h.images.length,downloads:h.downloads.length,optionGroups:h.img_conf?Object.keys(h.img_conf).length:0});const P=h.images.map(E=>E.url),C={};h.downloads.forEach(E=>{const M=this.generateFileDisplayNameFromFilename(E.filename);C[M]=E.url});const I={};return h.img_conf&&Object.entries(h.img_conf).forEach(([E,M])=>{I[E]=Object.entries(M).map(([j,y])=>({value:j,imageUrl:y.url})),I[E].sort((j,y)=>j.value.localeCompare(y.value))}),{...c,imageGallery:P.length>0?P:c.imageGallery,files:Object.keys(C).length>0?C:c.files,options:Object.keys(I).length>0?I:c.options}})}static generateFileDisplayNameFromFilename(n){var o;const r=n.replace(/\.[^/.]+$/,""),s=((o=n.split(".").pop())==null?void 0:o.toLowerCase())||"",i=r.replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");switch(s){case"pdf":return/spec/i.test(r)?"PDF Specification":/install/i.test(r)?"Installation Guide":/manual/i.test(r)?"User Manual":`${i} (PDF)`;case"dwg":return"CAD Drawing";case"rvt":return"Revit Model";case"doc":case"docx":return`${i} (Document)`;default:return i}}static buildCompleteStructureFromDigitalOcean(n){const r=[],s=[],i=[],o={groupToRanges:{},rangeToProducts:{}};return Object.entries(n).forEach(([c,l])=>{const u=this.sanitizePathSegment(c);r.push({id:u,name:c,icon:this.getDefaultIconForGroup(c),description:this.getDescriptionForGroup(c)}),o.groupToRanges[u]=[],Object.entries(l).forEach(([d,m])=>{const h=this.sanitizePathSegment(d);s.push({id:h,name:d,image:"",description:this.getDescriptionForRange(d),tags:this.getTagsForRange(d)}),o.groupToRanges[u].push(h),o.rangeToProducts[h]=[],Object.entries(m).forEach(([g,v])=>{const P=this.sanitizePathSegment(g),C={};v.img_conf&&Object.entries(v.img_conf).forEach(([I,R])=>{C[I]=Object.entries(R).map(([L,E])=>({value:L,imageUrl:E.url}))}),i.push({id:P,code:g,name:this.generateProductName(g),overview:`Overview for ${g}`,description:`Detailed description for ${g}`,specifications:[],imageGallery:v.images.map(I=>I.url),files:v.downloads.reduce((I,R)=>{const L=this.generateFileDisplayNameFromFilename(R.filename);return I[L]=R.url,I},{}),options:Object.keys(C).length>0?C:void 0}),o.rangeToProducts[h].push(P)})})}),{productGroups:r,productRanges:s,products:i,relationships:o}}static getDefaultIconForGroup(n){const r=n.toLowerCase();return r.includes("shelter")?"lucide:home":r.includes("toilet")?"lucide:door-open":r.includes("access")?"lucide:key":r.includes("config")?"lucide:settings":"lucide:package"}static getDescriptionForGroup(n){return`${n} product category`}static getDescriptionForRange(n){return`${n} product range`}static getTagsForRange(n){return[n.toLowerCase()]}static generateProductName(n){return n.toUpperCase()}}rr(He,"baseAssetsPath","assets/products");const ao=({stepperID:e})=>{const{products:n,productRanges:r,productGroups:s,addProduct:i,updateProduct:o,removeProduct:c,linkProductToRange:l,unlinkProductFromRange:u,relationships:d,productData:m}=Re(),{isOpen:h,onOpen:g,onOpenChange:v,onClose:P}=Ft(),[C,I]=re.useState(null),[R,L]=re.useState({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{},options:void 0,coreDesignElement:[],faqs:[],active:!0}),[E,M]=re.useState({}),[j,y]=re.useState(new Set),[b,_]=re.useState(new Set),[S,w]=re.useState(!1),[F,J]=re.useState({}),N=he(()=>{var Y,ee;if(!C)return null;const D=(Y=Object.entries(d.rangeToProducts).find(([$,W])=>W.includes(C.id)))==null?void 0:Y[0];if(!D)return null;const T=r.find($=>$.id===D);if(!T)return null;const z=(ee=Object.entries(d.groupToRanges).find(([$,W])=>W.includes(D)))==null?void 0:ee[0];if(!z)return null;const Z=s.find($=>$.id===z);return Z?{category:Z.name,range:T.name,productCode:C.code}:null},[C,d,r,s]);ae(async()=>{if(confirm("This will fetch images and files from plugin folders for ALL products and update their data. This action cannot be undone. Continue?"))try{const T=await He.fetchAndUpdateAllProductAssets(s,r,n,d,o,e??void 0);Se({color:T.success?"success":T.updatedCount===0?"warning":"danger",title:T.message})}catch(T){console.error("Error fetching all product assets:",T),Se({color:"danger",title:"Error fetching assets. Please check console for details."})}},[o]);const p=ae(()=>{I(null),L({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{},options:void 0,coreDesignElement:[],active:!0}),M({}),y(new Set),J({}),g()},[g]),x=ae(D=>{I(D),L({code:D.code,name:D.name,overview:D.overview,description:D.description,specifications:[...D.specifications],imageGallery:[...D.imageGallery],files:{...D.files},faqs:D.faqs||[],options:D.options,coreDesignElement:D.coreDesignElement||[],active:D.active}),M(D.options||{});const T=new Set;Object.entries(d.rangeToProducts).forEach(([z,Z])=>{Z.includes(D.id)&&T.add(z)}),y(T),J({}),g()},[d.rangeToProducts,g]),G=ae(D=>{confirm("Are you sure you want to delete this product?")&&c(D)},[c]),U=ae((D,T)=>{if(L(z=>({...z,[D]:T})),D==="name"&&!R.code&&typeof T=="string"){const z=T.toUpperCase().replace(/\s+/g,"-").replace(/[^A-Z0-9-]/g,"");L(Z=>({...Z,code:z}))}F[D]&&J(z=>({...z,[D]:""}))},[R.code,F]),K=ae(()=>{const D={};return R.code.trim()||(D.code="Product code is required"),n.some(z=>z.code.toLowerCase()===R.code.toLowerCase()&&(!C||z.id!==C.id))&&(D.code="A product with this code already exists"),R.name.trim()||(D.name="Product name is required"),R.overview.trim()||(D.overview="Product overview is required"),R.description.trim()||(D.description="Product description is required"),j.size===0&&(D.ranges="Please select at least one product range"),J(D),Object.keys(D).length===0},[R,n,C,j]),se=async(D,T,z,Z)=>{var Y,ee;try{const $=`${Z}/${z}/${D}`,W=`${Z}/${z}/${T}`,ue=((Y=window.urbanaAdmin)==null?void 0:Y.apiUrl)||"/wp-json/urbana/v1/",xe=await fetch(`${ue}digital-ocean/rename-folder`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((ee=window.urbanaAdmin)==null?void 0:ee.nonce)||""},body:JSON.stringify({old_path:$,new_path:W})});if(!xe.ok)throw new Error(`HTTP error! status: ${xe.status}`);const Ne=await xe.json();if(!Ne.success)throw new Error(Ne.message||"Failed to rename folder");return!0}catch($){throw console.error("Failed to rename folder in Digital Ocean:",$),$}},le=ae(async()=>{var Z,Y;if(!K())return;console.log("[ProductsManager] Form Data Before Submit:",R),console.log("[ProductsManager] coreDesignElement:",R.coreDesignElement);let D=!1,T=null,z=null;if(C){if(D=C.code!==R.code,T=C.code,D){const $=(Z=Object.entries(d.rangeToProducts).find(([W,ue])=>ue.includes(C.id)))==null?void 0:Z[0];if($){const W=r.find(ue=>ue.id===$);if(W){const ue=(Y=Object.entries(d.groupToRanges).find(([xe,Ne])=>Ne.includes($)))==null?void 0:Y[0];if(ue){const xe=s.find(Ne=>Ne.id===ue);xe&&(z={rangeName:W.name,groupName:xe.name})}}}}o(C.id,{...R,options:Object.keys(E).length>0?E:void 0});const ee=new Set(Object.entries(d.rangeToProducts).filter(([$,W])=>W.includes(C.id)).map(([$,W])=>$));ee.forEach($=>{j.has($)||u($,C.id)}),j.forEach($=>{ee.has($)||l($,C.id)})}else{const ee={...R,options:Object.keys(E).length>0?E:void 0};i(ee);const $=k(R.code);j.forEach(W=>{l(W,$)})}if(D&&T&&z&&confirm(`The product code has changed from "${T}" to "${R.code}".

Do you want to rename the folder in Digital Ocean as well?
This will move all contents from:
  ${z.groupName}/${z.rangeName}/${T}/
to:
  ${z.groupName}/${z.rangeName}/${R.code}/`))try{await se(T,R.code,z.rangeName,z.groupName),alert(`✅ Successfully renamed folder in Digital Ocean from "${T}" to "${R.code}"`)}catch($){alert(`❌ Failed to rename folder in Digital Ocean. Error: ${$ instanceof Error?$.message:"Unknown error"}

The product has been updated in WordPress, but the Digital Ocean folder was not renamed.`)}P()},[K,C,o,R,E,d.rangeToProducts,d.groupToRanges,u,i,j,l,r,s,P]),k=D=>D.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),O=ae(()=>{const D={},T=[];return n.forEach(z=>{let Z=!1;Object.entries(d.rangeToProducts).forEach(([Y,ee])=>{if(ee.includes(z.id)){const $=r.find(W=>W.id===Y);$&&(D[$.name]||(D[$.name]=[]),D[$.name].push(z),Z=!0)}}),Z||T.push(z)}),{grouped:D,ungrouped:T}},[n,d.rangeToProducts,r]),A=ae(D=>{_(T=>{const z=new Set(T);return z.has(D)?z.delete(D):z.add(D),z})},[]),B=ae(()=>{b.size===n.length?_(new Set):_(new Set(n.map(D=>D.id)))},[n,b.size]),q=ae(async()=>{if(b.size===0){Se({color:"warning",title:"No products selected",description:"Please select at least one product to sync"});return}if(confirm(`This will fetch and update assets from Digital Ocean for ${b.size} selected product(s). Continue?`)){w(!0);try{const T=n.filter(Y=>b.has(Y.id)),z=T.map(Y=>Y.code),Z=await He.fetchDigitalOceanAssetsForProducts(z,s,r,n,d);if(Z.success){const Y=He.updateProductPathsFromDigitalOcean(T,Z.structured_data,s,r,d);let ee=0,$=0;Y.forEach(W=>{const ue=n.find(xe=>xe.id===W.id);ue&&(JSON.stringify(ue.imageGallery)!==JSON.stringify(W.imageGallery)||JSON.stringify(ue.files)!==JSON.stringify(W.files)||JSON.stringify(ue.options)!==JSON.stringify(W.options))&&(o(W.id,{imageGallery:W.imageGallery,files:W.files,options:W.options}),ee++)}),$=b.size-Y.filter(W=>W.imageGallery.length>0||Object.keys(W.files).length>0).length,ee>0?Se({color:"success",title:"Digital Ocean sync completed!",description:`Updated ${ee} out of ${b.size} selected products${$>0?`. ${$} products had no assets found`:""}`}):$===b.size?Se({color:"warning",title:"No assets found",description:"No assets were found in Digital Ocean for the selected products"}):Se({color:"secondary",title:"No updates needed",description:"Selected products already have the latest assets"}),_(new Set)}else throw new Error(Z.message)}catch(T){console.error("Error syncing with Digital Ocean:",T),Se({color:"danger",title:"Sync failed",description:T instanceof Error?T.message:"Unknown error occurred"})}finally{w(!1)}}},[b,n,s,r,d,o]),{grouped:X,ungrouped:ne}=O(),[H,te]=re.useState({grouped:{},ungrouped:[]}),Q=re.useCallback(async()=>{var D,T;try{const z=((D=window.urbanaAdmin)==null?void 0:D.apiUrl)||"/wp-json/urbana/v1/",Z=await fetch(`${z}digital-ocean/check-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((T=window.urbanaAdmin)==null?void 0:T.nonce)||""},body:JSON.stringify({type:"products"})});if(Z.ok){const Y=await Z.json();console.log("[DO Sync] API /check-folders result:",Y),Y.success&&Y.results&&te(ee=>{console.log("[DO Sync] Previous syncItemsGrouped:",ee);const $={...ee.grouped},W=[...ee.ungrouped];Object.keys($).forEach(xe=>{$[xe]=$[xe].map(Ne=>{const Be=Y.results.find(vt=>vt.id===Ne.id);return Be?console.log(`[DO Sync] Mapping item id: ${Ne.id}, exists:`,Be.exists):console.warn(`[DO Sync] No existence data for item id: ${Ne.id}`),{...Ne,exists:Be?Be.exists:!1}})}),W.forEach((xe,Ne)=>{const Be=Y.results.find(vt=>vt.id===xe.id);Be?(console.log(`[DO Sync] Mapping ungrouped item id: ${xe.id}, exists:`,Be.exists),W[Ne]={...xe,exists:Be.exists}):console.warn(`[DO Sync] No existence data for ungrouped item id: ${xe.id}`)});const ue={grouped:$,ungrouped:W};return console.log("[DO Sync] Updated syncItemsGrouped:",ue),ue})}else console.error("[DO Sync] check-folders returned HTTP",Z.status),te(Y=>{const ee={...Y.grouped},$=[...Y.ungrouped];return Object.keys(ee).forEach(W=>{ee[W]=ee[W].map(ue=>({...ue,exists:!1}))}),$.forEach((W,ue)=>{$[ue]={...W,exists:!1}}),{grouped:ee,ungrouped:$}})}catch(z){console.error("❌ Failed to check folder existence:",z)}},[]);re.useEffect(()=>{const{grouped:D,ungrouped:T}=O(),z={};Object.entries(D).forEach(([Y,ee])=>{z[Y]=ee.map($=>({id:$.id,name:$.name||$.code,type:"product",exists:void 0,checked:!1}))});const Z=T.map(Y=>({id:Y.id,name:Y.name||Y.code,type:"product",exists:void 0,checked:!1}));te({grouped:z,ungrouped:Z}),Q()},[n,d,r]);const oe=(D,T)=>{te(z=>{const Z={...z.grouped},Y=[...z.ungrouped];Object.keys(Z).forEach($=>{Z[$]=Z[$].map(W=>W.id===D?{...W,checked:T}:W)});const ee=Y.findIndex($=>$.id===D);return ee!==-1&&(Y[ee]={...Y[ee],checked:T}),{grouped:Z,ungrouped:Y}})},me=D=>{te(T=>{const z={...T.grouped},Z=[...T.ungrouped];return Object.keys(z).forEach(Y=>{z[Y]=z[Y].map(ee=>({...ee,checked:D}))}),Z.forEach((Y,ee)=>{Z[ee]={...Y,checked:D}}),{grouped:z,ungrouped:Z}})},be=async D=>{var T,z;try{const Z=((T=window.urbanaAdmin)==null?void 0:T.apiUrl)||"/wp-json/urbana/v1/",Y=await fetch(`${Z}digital-ocean/create-product-folders`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((z=window.urbanaAdmin)==null?void 0:z.nonce)||""},body:JSON.stringify({product_ids:D})});if(!Y.ok)throw new Error(`HTTP error! status: ${Y.status}`);const ee=await Y.json();if(!ee.success)throw new Error(ee.message||"Failed to create folders");te($=>{const W={...$.grouped},ue=[...$.ungrouped];return Object.keys(W).forEach(xe=>{W[xe]=W[xe].map(Ne=>D.includes(Ne.id)?{...Ne,exists:!0,checked:!1}:Ne)}),ue.forEach((xe,Ne)=>{D.includes(xe.id)&&(ue[Ne]={...xe,exists:!0,checked:!1})}),{grouped:W,ungrouped:ue}})}catch(Z){throw Z}};return a(ke,{children:[a("div",{className:"flex justify-between items-center mb-6",children:[a("div",{children:[t("h3",{className:"text-xl font-semibold",children:"Products"}),t("p",{className:"text-sm text-foreground-500",children:"Manage individual products with detailed specifications"})]}),a("div",{className:"flex gap-2",children:[n.length>0&&t(V,{color:"default",variant:"flat",size:"sm",onPress:B,startContent:t(f,{icon:b.size===n.length?"lucide:square-check":"lucide:square",width:16}),children:b.size===n.length?"Deselect All":"Select All"}),b.size>0&&t(V,{color:"secondary",variant:"flat",onPress:q,isLoading:S,startContent:S?void 0:t(f,{icon:"lucide:cloud-download",width:18}),children:S?"Syncing...":`Sync DO (${b.size})`}),t(V,{color:"primary",onPress:p,startContent:t(f,{icon:"lucide:plus",width:18}),isDisabled:r.length===0,children:"Add Product"})]})]}),a(Ye,{"aria-label":"Products Options",className:"mb-6",children:[t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:package",width:16}),t("span",{children:"Manage Products"})]}),children:t("div",{className:"mt-4",children:r.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Available"}),t("p",{className:"text-sm text-foreground-500",children:"You need to create product ranges first before adding products"})]})]})})}):n.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:package",width:48,className:"text-foreground-300"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Products Yet"}),t("p",{className:"text-sm text-foreground-500",children:"Create your first product to get started"})]}),t(V,{color:"primary",onPress:p,startContent:t(f,{icon:"lucide:plus",width:18}),children:"Add Product"})]})})}):a("div",{className:"space-y-6",children:[Object.entries(X).map(([D,T])=>{var ee;const z=r.find($=>$.name===D);let Z=null,Y=null;if(z){const $=(ee=Object.entries(d.groupToRanges).find(([,ue])=>ue.includes(z.id)))==null?void 0:ee[0],W=$?s.find(ue=>ue.id===$):null;W&&(Z=W.name,Y=W.icon)}return a("div",{children:[Z&&a("div",{className:"mb-2 flex items-center gap-2 text-primary",children:[Y&&t(f,{icon:Y,width:16}),t("span",{className:"text-sm font-medium",children:Z})]}),a("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[t(f,{icon:"lucide:grid-3x3",width:18}),D,a(ie,{size:"sm",variant:"flat",children:[T.length," product",T.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map($=>t(Gn,{product:$,onEdit:x,onDelete:G,isSelected:b.has($.id),onToggleSelect:A},$.id))})]},D)}),ne.length>0&&a("div",{children:[a("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[t(f,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Products",a(ie,{size:"sm",variant:"flat",color:"warning",children:[ne.length," product",ne.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ne.map(D=>t(Gn,{product:D,onEdit:x,onDelete:G,isSelected:b.has(D.id),onToggleSelect:A},D.id))})]})]})})},"manage"),t(we,{title:a("div",{className:"flex items-center space-x-2",children:[t(f,{icon:"lucide:cloud-upload",width:16}),t("span",{children:"Digital Ocean Sync"})]}),children:t("div",{className:"mt-4",children:a(ce,{className:"urbana-card",children:[a(De,{className:"flex gap-3",children:[t(f,{icon:"lucide:cloud-upload",width:24}),a("div",{className:"flex flex-col",children:[t("p",{className:"text-md font-semibold",children:"Products - Digital Ocean Sync"}),t("p",{className:"text-small text-default-500",children:"Organize by ranges like the Manage Products tab"})]})]}),a(de,{children:[a("div",{className:"flex items-center justify-between mb-4",children:[t(V,{color:"primary",variant:"flat",size:"sm",onPress:()=>me(!0),startContent:t(f,{icon:"lucide:check-square",width:16}),children:"Select All"}),t(V,{color:"default",variant:"flat",size:"sm",onPress:()=>me(!1),startContent:t(f,{icon:"lucide:square",width:16}),children:"Clear All"}),t(V,{color:"primary",size:"sm",onPress:()=>{const D=[];Object.values(H.grouped).forEach(T=>{T.forEach(z=>{z.checked&&D.push(z.id)})}),H.ungrouped.forEach(T=>{T.checked&&D.push(T.id)}),be(D)},isDisabled:(()=>{let D=!1;return Object.values(H.grouped).forEach(T=>{T.forEach(z=>{z.checked&&(D=!0)})}),H.ungrouped.forEach(T=>{T.checked&&(D=!0)}),!D})(),startContent:t(f,{icon:"lucide:upload",width:16}),children:"Sync Selected"})]}),Object.keys(H.grouped).length===0&&H.ungrouped.length===0?a("div",{className:"text-center py-8 text-foreground-500",children:[t(f,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),t("p",{children:"No products available to sync"})]}):a("div",{className:"space-y-6",children:[Object.entries(H.grouped).map(([D,T])=>{var ee;const z=r.find($=>$.name===D),Z=z?(ee=Object.entries(d.groupToRanges).find(([,$])=>$.includes(z.id)))==null?void 0:ee[0]:null,Y=Z?s.find($=>$.id===Z):null;return a("div",{className:"space-y-3",children:[Y&&a("div",{className:"flex items-center gap-2 mb-1",children:[t(f,{icon:Y.icon,width:16,className:"text-default-500"}),t("span",{className:"text-sm text-default-500",children:Y.name})]}),a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:grid-3x3",width:18,className:"text-primary"}),t("h4",{className:"font-semibold text-lg text-primary",children:D}),a(ie,{size:"sm",variant:"flat",color:"primary",children:[T.length," product",T.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map($=>{const W=n.find(ue=>ue.id===$.id);return a(ce,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${$.checked?"border-primary bg-primary/5":"border-transparent hover:border-primary/30"}`,isPressable:!0,onPress:()=>oe($.id,!$.checked),children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[a("div",{className:"relative",children:[t("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:package",width:20,className:"text-secondary-600"})}),t("div",{className:"absolute -top-1 -right-1",children:t(Ve,{isSelected:$.checked||!1,onValueChange:ue=>{oe($.id,ue)},size:"sm",onClick:ue=>ue.stopPropagation()})})]}),a("div",{children:[t("h4",{className:"text-md font-semibold",children:$.name}),W&&t("p",{className:"text-xs text-foreground-500",children:W.code})]})]}),t(ie,{size:"sm",variant:"flat",color:$.exists===!0?"success":$.exists===!1?"warning":"default",startContent:$.exists===void 0?t(f,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):$.exists?t(f,{icon:"lucide:check-circle",width:14}):t(f,{icon:"lucide:alert-circle",width:14}),children:$.exists===void 0?"Checking...":$.exists?"Exists":"Missing"})]})}),W&&W.overview&&t(de,{className:"pt-0",children:t("p",{className:"text-sm text-foreground-600 line-clamp-2",children:W.overview})})]},$.id)})})]},D)}),H.ungrouped.length>0&&a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:alert-triangle",width:18,className:"text-warning"}),t("h4",{className:"font-semibold text-lg text-warning",children:"Ungrouped Products"}),a(ie,{size:"sm",variant:"flat",color:"warning",children:[H.ungrouped.length," product",H.ungrouped.length!==1?"s":""]})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:H.ungrouped.map(D=>{const T=n.find(z=>z.id===D.id);return a(ce,{className:`hover:shadow-lg transition-all cursor-pointer border-2 ${D.checked?"border-warning bg-warning/5":"border-transparent hover:border-warning/30"}`,isPressable:!0,onPress:()=>oe(D.id,!D.checked),children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3",children:[a("div",{className:"relative",children:[t("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:package",width:20,className:"text-warning-600"})}),t("div",{className:"absolute -top-1 -right-1",children:t(Ve,{isSelected:D.checked||!1,onValueChange:z=>{oe(D.id,z)},size:"sm",onClick:z=>z.stopPropagation()})})]}),a("div",{children:[t("h4",{className:"text-md font-semibold",children:D.name}),T&&t("p",{className:"text-xs text-foreground-500",children:T.code})]})]}),t(ie,{size:"sm",variant:"flat",color:D.exists===!0?"success":D.exists===!1?"warning":"default",startContent:D.exists===void 0?t(f,{icon:"lucide:loader-2",width:12,className:"animate-spin"}):D.exists?t(f,{icon:"lucide:check-circle",width:14}):t(f,{icon:"lucide:alert-circle",width:14}),children:D.exists===void 0?"Checking...":D.exists?"Exists":"Missing"})]})}),T&&T.overview&&t(de,{className:"pt-0",children:t("p",{className:"text-sm text-foreground-600 line-clamp-2",children:T.overview})})]},D.id)})})]})]}),(()=>{const D=Object.values(H.grouped).reduce((T,z)=>T+z.filter(Z=>Z.checked).length,0)+H.ungrouped.filter(T=>T.checked).length;return D===0?null:t("div",{className:"mt-4 bg-primary/10 rounded-lg p-3",children:a("p",{className:"text-sm text-primary font-medium",children:[D," product folder(s) will be created in Digital Ocean Spaces"]})})})()]})]})})},"sync")]}),t(zt,{isDismissable:!1,isKeyboardDismissDisabled:!0,isOpen:h,onOpenChange:v,size:"4xl",scrollBehavior:"inside",className:"urbana-modal",children:t($t,{children:D=>a(ke,{children:[t(Lt,{children:C?"Edit Product":"Add Product"}),t(Gt,{children:a(Ye,{"aria-label":"Product Details",defaultSelectedKey:"basic",children:[t(we,{title:"Basic Info",children:a("div",{className:"space-y-4",children:[a("div",{className:"grid grid-cols-2 gap-4",children:[t(Ee,{label:"Product Code",placeholder:"e.g., SH-PEN-001",value:R.code,onChange:T=>U("code",T.target.value),errorMessage:F.code,isInvalid:!!F.code,isRequired:!0,classNames:{input:"urbana-input"}}),t(Ee,{label:"Product Name",placeholder:"Enter product name",value:R.name,onChange:T=>U("name",T.target.value),errorMessage:F.name,isInvalid:!!F.name,isRequired:!0,classNames:{input:"urbana-input"}})]}),t(it,{label:"Product Ranges",placeholder:"Select product ranges",selectionMode:"multiple",selectedKeys:j,onSelectionChange:T=>y(T),errorMessage:F.ranges,isInvalid:!!F.ranges,isRequired:!0,children:r.map(T=>t(nt,{children:T.name},T.id))}),t(Pt,{label:"Overview",placeholder:"Brief product overview",value:R.overview,onChange:T=>U("overview",T.target.value),errorMessage:F.overview,isInvalid:!!F.overview,isRequired:!0,rows:2,classNames:{input:"urbana-input"}}),t(Pt,{label:"Description",placeholder:"Detailed product description",value:R.description,onChange:T=>U("description",T.target.value),errorMessage:F.description,isInvalid:!!F.description,isRequired:!0,rows:4,classNames:{input:"urbana-input"}})]})},"basic"),t(we,{title:"Images",children:t(fi,{imageGallery:R.imageGallery,onImageGalleryChange:T=>U("imageGallery",T),productCode:(N==null?void 0:N.productCode)||R.code,category:N==null?void 0:N.category,range:N==null?void 0:N.range})},"images"),t(we,{title:"Files",children:t(pi,{files:R.files,onFilesChange:T=>U("files",T),productCode:(N==null?void 0:N.productCode)||R.code,category:N==null?void 0:N.category,range:N==null?void 0:N.range})},"files"),t(we,{title:"Core Design Element",children:t(io,{fields:R.coreDesignElement,onFieldsChange:T=>U("coreDesignElement",T)})},"coreDesignElement"),t(we,{title:"FAQs",children:a("div",{className:"space-y-4",children:[t("p",{className:"text-sm text-default-500",children:"Add frequently asked questions for this product. These will appear in the product details FAQ tab in the frontend."}),(R.faqs||[]).map((T,z)=>a("div",{className:"grid grid-cols-12 gap-2 items-start",children:[t("input",{className:"col-span-12 urbana-input",placeholder:`Question ${z+1}`,value:T.question,onChange:Z=>{const Y=[...R.faqs||[]];Y[z]={...Y[z],question:Z.target.value},U("faqs",Y)}}),t("textarea",{className:"col-span-12 urbana-input",placeholder:`Answer ${z+1}`,rows:3,value:T.answer,onChange:Z=>{const Y=[...R.faqs||[]];Y[z]={...Y[z],answer:Z.target.value},U("faqs",Y)}}),t("div",{className:"col-span-12 flex justify-end",children:t(V,{variant:"light",color:"danger",onPress:()=>{const Z=[...R.faqs||[]];Z.splice(z,1),U("faqs",Z)},children:"Remove"})})]},z)),t("div",{children:t(V,{onPress:()=>U("faqs",[...R.faqs||[],{question:"",answer:""}]),children:"Add FAQ"})})]})},"faqs")]})}),a(Mt,{children:[t(V,{variant:"light",onPress:D,children:"Cancel"}),a(V,{color:"primary",onPress:le,children:[C?"Update":"Add"," Product"]})]})]})})})]})},Gn=re.memo(({product:e,onEdit:n,onDelete:r,isSelected:s,onToggleSelect:i})=>{const{updateProduct:o}=Re(),c=e.imageGallery.length>0&&e.imageGallery[0]&&e.imageGallery[0].trim()!=="",l=()=>{o(e.id,{active:typeof e.active>"u"?!1:!e.active})};return a(ce,{className:"hover:shadow-lg transition-shadow",children:[t(De,{className:"pb-3",children:a("div",{className:"flex justify-between items-start w-full",children:[a("div",{className:"flex items-center gap-3 flex-1",children:[t(Ve,{isSelected:s,onValueChange:()=>i(e.id),size:"sm"}),c?t("div",{className:"w-10 h-10 rounded-lg overflow-hidden flex-shrink-0",children:t(Jr,{imagePath:e.imageGallery[0],productCode:e.code,alt:e.name,className:"w-full h-full object-cover"})}):t("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center",children:t(f,{icon:"lucide:package",width:20,className:"text-success-600"})}),a("div",{className:"flex-1",children:[t("h4",{className:"text-lg font-semibold",children:e.name}),a("div",{className:"flex flex-wrap gap-1 mt-1",children:[typeof e.active<"u"&&!e.active&&t(ie,{size:"sm",variant:"flat",color:"warning",children:"Inactive"}),t(ie,{size:"sm",variant:"flat",color:"success",children:e.code})]})]})]}),a(Ut,{children:[t(Bt,{children:t(V,{isIconOnly:!0,variant:"light",size:"sm",children:t(f,{icon:"lucide:more-vertical",width:16})})}),a(Wt,{"aria-label":"Product Actions",children:[t(Fe,{startContent:t(f,{icon:"lucide:edit",width:16}),onPress:()=>n(e),children:"Edit"},"edit"),t(Fe,{startContent:t(f,{icon:typeof e.active<"u"&&!e.active?"lucide:eye":"lucide:eye-off",width:16}),onPress:l,children:typeof e.active<"u"&&!e.active?"Activate":"Deactivate"},"toggle-active"),t(Fe,{className:"text-danger",color:"danger",startContent:t(f,{icon:"lucide:trash",width:16}),onPress:()=>r(e.id),children:"Delete"},"delete")]})]})]})}),a(de,{className:"pt-0",children:[t("p",{className:"text-sm text-foreground-600 mb-2",children:e.overview}),e.specifications.length>0&&a("div",{className:"space-y-1",children:[t("p",{className:"text-xs font-semibold text-foreground-700",children:"Specifications:"}),a("div",{className:"text-xs text-foreground-500",children:[e.specifications.slice(0,3).map((u,d)=>a("div",{children:["• ",u]},d)),e.specifications.length>3&&a("div",{children:["... and ",e.specifications.length-3," more"]})]})]})]})]})});Gn.displayName="ProductCard";const oo=()=>{const{productGroups:e,productRanges:n,products:r,relationships:s,linkRangeToGroup:i,unlinkRangeFromGroup:o,linkProductToRange:c,unlinkProductFromRange:l}=Re(),[u,d]=re.useState(null),[m,h]=re.useState(null),[g,v]=re.useState(!1),P=()=>e.map(w=>{const F=s.groupToRanges[w.id]||[],J=F.map(N=>{const p=n.find(U=>U.id===N),x=s.rangeToProducts[N]||[],G=x.map(U=>{const K=r.find(se=>se.id===U);return{id:U,name:(K==null?void 0:K.name)||"Unknown Product",code:K==null?void 0:K.code,overview:K==null?void 0:K.overview,type:"product",hasIssues:!K}}).filter(Boolean);return{id:N,name:(p==null?void 0:p.name)||"Unknown Range",description:p==null?void 0:p.description,type:"range",children:G,hasIssues:!p||x.length===0}}).filter(Boolean);return{id:w.id,name:w.name,description:w.description,type:"group",children:J,hasIssues:F.length===0}}),C=()=>{const w=n.filter(J=>!Object.values(s.groupToRanges).some(N=>N.includes(J.id))),F=r.filter(J=>!Object.values(s.rangeToProducts).some(N=>N.includes(J.id)));return{orphanedRanges:w,orphanedProducts:F}},I=()=>{const{orphanedRanges:w,orphanedProducts:F}=C(),J=Object.values(s.groupToRanges).reduce((p,x)=>p+x.length,0)+Object.values(s.rangeToProducts).reduce((p,x)=>p+x.length,0),N=Math.round((e.length-e.filter(p=>(s.groupToRanges[p.id]||[]).length===0).length+(n.length-w.length)+(r.length-F.length))/(e.length+n.length+r.length)*100);return{totalConnections:J,orphanedRanges:w.length,orphanedProducts:F.length,completionRate:isNaN(N)?0:N}},R=(w,F)=>{i(w,F)},L=(w,F)=>{o(w,F)},E=(w,F)=>{c(w,F)},M=(w,F)=>{l(w,F)},j=async()=>{v(!0),await new Promise(w=>setTimeout(w,1500)),v(!1)},y=P(),{orphanedRanges:b,orphanedProducts:_}=C(),S=I();return a("div",{children:[a("div",{className:"flex justify-between items-center mb-6",children:[a("div",{children:[t("h3",{className:"text-xl font-semibold",children:"Relationship Manager"}),t("p",{className:"text-sm text-foreground-500",children:"Manage connections between groups, ranges, and products"})]}),t("div",{className:"flex gap-2",children:t(V,{color:"secondary",variant:"flat",onPress:j,startContent:t(f,{icon:"lucide:search",width:18}),isLoading:g,children:g?"Analyzing...":"Analyze Structure"})})]}),t(ce,{className:"mb-6",children:t(de,{children:a("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-primary-600",children:S.totalConnections}),t("div",{className:"text-sm text-foreground-500",children:"Total Connections"})]}),a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-warning-600",children:S.orphanedRanges}),t("div",{className:"text-sm text-foreground-500",children:"Orphaned Ranges"})]}),a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-danger-600",children:S.orphanedProducts}),t("div",{className:"text-sm text-foreground-500",children:"Orphaned Products"})]}),a("div",{className:"text-center",children:[a("div",{className:"text-2xl font-bold text-success-600",children:[S.completionRate,"%"]}),t("div",{className:"text-sm text-foreground-500",children:"Structure Complete"}),t(zr,{value:S.completionRate,color:S.completionRate>80?"success":S.completionRate>50?"warning":"danger",size:"sm",className:"mt-1"})]})]})})}),a(Ye,{"aria-label":"Relationship Views",defaultSelectedKey:"tree",children:[t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:git-branch",width:16}),"Tree View"]}),children:a("div",{className:"space-y-4",children:[y.length===0?t(ce,{children:t(de,{className:"text-center py-12",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(f,{icon:"lucide:git-branch",width:48,className:"text-foreground-300"}),a("div",{children:[t("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Structure Yet"}),t("p",{className:"text-sm text-foreground-500",children:"Create groups, ranges, and products to see the relationship tree"})]})]})})}):t(Ir,{selectionMode:"multiple",variant:"bordered",children:y.map(w=>{var F;return t(Fr,{title:a("div",{className:"flex items-center gap-3",children:[t(st,{icon:t(f,{icon:"lucide:folder",width:16,style:{stroke:"currentColor",fill:"currentColor"}}),className:"w-6 h-6 bg-primary-100 text-primary-600"}),a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-semibold",children:w.name}),w.hasIssues&&t(f,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),t("div",{className:"text-xs text-foreground-500",children:w.description||"No description"})]}),t(or,{classNames:{base:"absolute"},content:((F=w.children)==null?void 0:F.length)||0,color:"primary",size:"sm",children:t("div",{className:"w-4 h-4"})})]}),classNames:{indicator:"-rotate-90 data-[open=true]:rotate-90 rtl:-rotate-180"},children:w.children&&w.children.length>0?t("div",{className:"space-y-3 pl-4",children:w.children.map(J=>{var N;return a("div",{className:"border-l-2 border-gray-200 pl-4",children:[a("div",{className:"flex items-center gap-3 mb-2",children:[t(st,{icon:t(f,{icon:"lucide:grid-3x3",width:16,style:{stroke:"currentColor",fill:"currentColor"}}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-medium",children:J.name}),J.hasIssues&&t(f,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),t("div",{className:"text-xs text-foreground-500",children:J.description||"No description"})]}),t(or,{classNames:{base:"absolute"},content:((N=J.children)==null?void 0:N.length)||0,color:"secondary",size:"sm",children:t("div",{className:"w-4 h-4"})})]}),J.children&&J.children.length>0&&t("div",{className:"space-y-2 pl-8",children:J.children.map(p=>a("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[t(st,{icon:t(f,{icon:"lucide:package",width:16}),className:"w-5 h-5 bg-success-100 text-success-600"}),a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-2",children:[t("span",{className:"text-sm font-medium",children:p.name}),p.code&&t(ie,{size:"sm",variant:"flat",color:"success",children:p.code}),p.hasIssues&&t(f,{icon:"lucide:alert-triangle",width:14,className:"text-warning-500"})]}),p.overview&&t("div",{className:"text-xs text-foreground-500",children:p.overview})]})]},p.id))})]},J.id)})}):a("div",{className:"text-center py-6 text-foreground-400",children:[t(f,{icon:"lucide:inbox",width:32,className:"mx-auto mb-2"}),t("p",{className:"text-sm",children:"No ranges linked to this group"})]})},w.id)})}),(b.length>0||_.length>0)&&a(ce,{className:"border-warning-200 bg-warning-50",children:[t(De,{children:a("div",{className:"flex items-center gap-2 text-warning-700",children:[t(f,{icon:"lucide:alert-triangle",width:20}),t("h4",{className:"font-semibold",children:"Orphaned Items"})]})}),a(de,{className:"pt-0",children:[b.length>0&&a("div",{className:"mb-4",children:[t("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Ranges:"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:b.map(w=>a("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[t(f,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),t("span",{className:"text-sm",children:w.name}),t("span",{className:"text-xs text-gray-500",children:w.description})]},w.id))})]}),_.length>0&&a("div",{children:[t("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Products:"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:_.map(w=>a("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[t(f,{icon:"lucide:package",width:16,className:"text-success-600"}),t("span",{className:"text-sm",children:w.name}),t(ie,{size:"sm",variant:"flat",color:"success",children:w.code})]},w.id))})]})]})]})]})},"tree"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:link",width:16}),"Manage Links"]}),children:a("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a(ce,{children:[t(De,{children:a("h4",{className:"font-semibold flex items-center gap-2",children:[t(f,{icon:"lucide:arrow-right",width:16}),"Group → Range Links"]})}),t(de,{children:a("div",{className:"space-y-4",children:[t(it,{label:"Select Group",placeholder:"Choose a product group",selectedKeys:u?new Set([u]):new Set,onSelectionChange:w=>d(Array.from(w)[0]||null),children:e.map(w=>t(nt,{children:w.name},w.id))}),u&&a("div",{className:"space-y-3",children:[t("p",{className:"text-sm font-medium text-foreground-700",children:"Available Ranges:"}),n.map(w=>{const F=(s.groupToRanges[u]||[]).includes(w.id);return a("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a("div",{className:"flex items-center gap-3",children:[t(f,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),a("div",{children:[t("div",{className:"font-medium text-sm",children:w.name}),t("div",{className:"text-xs text-foreground-500",children:w.description})]})]}),t(V,{size:"sm",color:F?"danger":"primary",variant:F?"flat":"solid",onPress:()=>{F?L(u,w.id):R(u,w.id)},children:F?"Unlink":"Link"})]},w.id)})]})]})})]}),a(ce,{children:[t(De,{children:a("h4",{className:"font-semibold flex items-center gap-2",children:[t(f,{icon:"lucide:arrow-right",width:16}),"Range → Product Links"]})}),t(de,{children:a("div",{className:"space-y-4",children:[t(it,{label:"Select Range",placeholder:"Choose a product range",selectedKeys:m?new Set([m]):new Set,onSelectionChange:w=>h(Array.from(w)[0]||null),children:n.map(w=>t(nt,{children:w.name},w.id))}),m&&a("div",{className:"space-y-3",children:[t("p",{className:"text-sm font-medium text-foreground-700",children:"Available Products:"}),r.map(w=>{const F=(s.rangeToProducts[m]||[]).includes(w.id);return a("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a("div",{className:"flex items-center gap-3",children:[t(f,{icon:"lucide:package",width:16,className:"text-success-600"}),a("div",{children:[t("div",{className:"font-medium text-sm",children:w.name}),t("div",{className:"text-xs text-foreground-500",children:w.code})]})]}),t(V,{size:"sm",color:F?"danger":"primary",variant:F?"flat":"solid",onPress:()=>{F?M(m,w.id):E(m,w.id)},children:F?"Unlink":"Link"})]},w.id)})]})]})})]})]})},"manage"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:bar-chart-3",width:16}),"Analysis"]}),children:t("div",{className:"space-y-6",children:g?t(ce,{children:a(de,{className:"text-center py-12",children:[t(Nt,{size:"lg",color:"primary"}),t("p",{className:"mt-4 text-foreground-600",children:"Analyzing relationship structure..."})]})}):a(ke,{children:[a(ce,{children:[t(De,{children:t("h4",{className:"font-semibold",children:"Structure Analysis"})}),t(de,{children:a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a("div",{children:[t("h5",{className:"font-medium text-sm mb-2",children:"Groups"}),a("div",{className:"space-y-2",children:[a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Total Groups"}),t("span",{className:"text-sm font-medium",children:e.length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"With Ranges"}),t("span",{className:"text-sm font-medium",children:e.filter(w=>(s.groupToRanges[w.id]||[]).length>0).length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Empty Groups"}),t("span",{className:"text-sm font-medium text-warning-600",children:e.filter(w=>(s.groupToRanges[w.id]||[]).length===0).length})]})]})]}),a("div",{children:[t("h5",{className:"font-medium text-sm mb-2",children:"Ranges"}),a("div",{className:"space-y-2",children:[a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Total Ranges"}),t("span",{className:"text-sm font-medium",children:n.length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Linked to Groups"}),t("span",{className:"text-sm font-medium",children:n.length-b.length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"With Products"}),t("span",{className:"text-sm font-medium",children:n.filter(w=>(s.rangeToProducts[w.id]||[]).length>0).length})]})]})]}),a("div",{children:[t("h5",{className:"font-medium text-sm mb-2",children:"Products"}),a("div",{className:"space-y-2",children:[a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Total Products"}),t("span",{className:"text-sm font-medium",children:r.length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Linked to Ranges"}),t("span",{className:"text-sm font-medium",children:r.length-_.length})]}),a("div",{className:"flex justify-between",children:[t("span",{className:"text-sm",children:"Orphaned"}),t("span",{className:"text-sm font-medium text-danger-600",children:_.length})]})]})]})]})})]}),a(ce,{children:[t(De,{children:a("h4",{className:"font-semibold flex items-center gap-2",children:[t(f,{icon:"lucide:lightbulb",width:16}),"Recommendations"]})}),t(de,{children:a("div",{className:"space-y-3",children:[S.orphanedProducts>0&&a("div",{className:"flex items-start gap-3 p-3 bg-danger-50 rounded-lg border border-danger-200",children:[t(f,{icon:"lucide:alert-triangle",width:16,className:"text-danger-600 mt-0.5"}),a("div",{children:[a("p",{className:"text-sm font-medium text-danger-800",children:["You have ",S.orphanedProducts," unlinked product",S.orphanedProducts!==1?"s":""]}),t("p",{className:"text-xs text-danger-600",children:"Link these products to ranges so they appear in your product stepper."})]})]}),S.orphanedRanges>0&&a("div",{className:"flex items-start gap-3 p-3 bg-warning-50 rounded-lg border border-warning-200",children:[t(f,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),a("div",{children:[a("p",{className:"text-sm font-medium text-warning-800",children:["You have ",S.orphanedRanges," unlinked range",S.orphanedRanges!==1?"s":""]}),t("p",{className:"text-xs text-warning-600",children:"Link these ranges to product groups to organize your structure."})]})]}),e.filter(w=>(s.groupToRanges[w.id]||[]).length===0).length>0&&a("div",{className:"flex items-start gap-3 p-3 bg-primary-50 rounded-lg border border-primary-200",children:[t(f,{icon:"lucide:info",width:16,className:"text-primary-600 mt-0.5"}),a("div",{children:[t("p",{className:"text-sm font-medium text-primary-800",children:"Some product groups are empty"}),t("p",{className:"text-xs text-primary-600",children:"Consider linking ranges to these groups or removing unused groups."})]})]}),S.completionRate>=90&&a("div",{className:"flex items-start gap-3 p-3 bg-success-50 rounded-lg border border-success-200",children:[t(f,{icon:"lucide:check-circle",width:16,className:"text-success-600 mt-0.5"}),a("div",{children:[t("p",{className:"text-sm font-medium text-success-800",children:"Great job! Your structure is well organized"}),t("p",{className:"text-xs text-success-600",children:"Your data structure is ready for the product stepper."})]})]})]})})]})]})})},"analysis")]})]})},co=()=>{const{productGroups:e,productRanges:n,products:r,relationships:s,exportData:i,importData:o}=Re(),{isOpen:c,onOpen:l,onOpenChange:u,onClose:d}=Ft(),[m,h]=re.useState(""),[g,v]=re.useState(""),[P,C]=re.useState("structure"),I=he(()=>i(),[i]),R=he(()=>{const b={};return I.stepperForm.steps.forEach(_=>{_.step===3&&_.products&&Object.entries(_.products).forEach(([S,w])=>{b[S]||(b[S]=[]),w.forEach(F=>{var p,x,G,U;const J=(x=(p=I.stepperForm.steps[3])==null?void 0:p.productDetails)==null?void 0:x[F],N=(U=(G=I.stepperForm.steps[4])==null?void 0:G.productOptions)==null?void 0:U[F];J&&b[S].push({code:F,...J,options:N||{},hasOptions:N&&Object.keys(N).length>0})})})}),b},[I]),L=he(()=>{var S;const b=Object.values(R).reduce((w,F)=>w+F.length,0),_=Object.values(R).reduce((w,F)=>w+F.filter(J=>J.hasOptions).length,0);return{totalSteps:I.stepperForm.steps.length,totalCategories:Object.keys(R).length,totalProducts:b,productsWithOptions:_,hasIssues:((S=I.stepperForm.steps[1])==null?void 0:S.ranges)&&Object.keys(I.stepperForm.steps[1].ranges).length===0}},[I,R]),E=ae(()=>{const b=i();v(JSON.stringify(b,null,2)),C("json")},[i]),M=ae(()=>{try{const b=JSON.parse(m);o(b),h(""),d()}catch{alert("Invalid JSON format. Please check your data.")}},[m,o,d]),j=ae(()=>{const b=i(),_=JSON.stringify(b,null,2),S="data:application/json;charset=utf-8,"+encodeURIComponent(_),w="stepper-config.json",F=document.createElement("a");F.setAttribute("href",S),F.setAttribute("download",w),F.click()},[i]),y=ae(()=>{const b=i();navigator.clipboard.writeText(JSON.stringify(b,null,2))},[i]);return a(ke,{children:[a("div",{className:"flex justify-between items-center mb-6",children:[a("div",{children:[t("h3",{className:"text-xl font-semibold",children:"Data Preview"}),t("p",{className:"text-sm text-foreground-500",children:"Preview and export your stepper configuration"})]}),a("div",{className:"flex gap-2",children:[t(V,{variant:"flat",onPress:l,startContent:t(f,{icon:"lucide:upload",width:18}),children:"Import"}),t(V,{color:"secondary",onPress:E,startContent:t(f,{icon:"lucide:download",width:18}),children:"Export Data"}),t(V,{color:"primary",onPress:j,startContent:t(f,{icon:"lucide:file-down",width:18}),children:"Download Config"})]})]}),t(ce,{className:"mb-6",children:t(de,{children:a("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-primary-600",children:L.totalSteps}),t("div",{className:"text-sm text-foreground-500",children:"Stepper Steps"})]}),a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-secondary-600",children:L.totalCategories}),t("div",{className:"text-sm text-foreground-500",children:"Ranges"})]}),a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-success-600",children:L.totalProducts}),t("div",{className:"text-sm text-foreground-500",children:"Products"})]}),a("div",{className:"text-center",children:[t("div",{className:"text-2xl font-bold text-warning-600",children:L.productsWithOptions}),t("div",{className:"text-sm text-foreground-500",children:"With Options"})]}),a("div",{className:"text-center",children:[t("div",{className:`flex justify-center text-2xl font-bold ${L.hasIssues?"text-warning-600":"text-success-600"}`,children:L.hasIssues?t(f,{icon:"lucide:alert-triangle",width:32}):t(f,{icon:"lucide:check-circle",width:32})}),t("div",{className:"text-sm text-foreground-500",children:L.hasIssues?"Has Issues":"Ready"})]})]})})}),a(Ye,{"aria-label":"Preview Options",selectedKey:P,onSelectionChange:b=>C(b),children:[t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:layers",width:16}),"Structure Preview"]}),children:a("div",{className:"space-y-6",children:[a(ce,{children:[t(De,{children:a("h4",{className:"font-semibold flex items-center gap-2",children:[t(f,{icon:"lucide:list",width:16}),"Stepper Steps"]})}),t(de,{children:I.stepperForm.steps.length===0?a("div",{className:"text-center py-8",children:[t(f,{icon:"lucide:layers",width:48,className:"mx-auto text-foreground-300 mb-4"}),t("p",{className:"text-foreground-600",children:"No stepper steps configured"}),t("p",{className:"text-sm text-foreground-500",children:"Create product groups to generate stepper steps"})]}):t("div",{className:"space-y-4",children:I.stepperForm.steps.map(b=>a("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[t("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:t("span",{className:"text-sm font-bold text-primary-600",children:b.step})}),a("div",{className:"flex-1",children:[t("h5",{className:"font-semibold",children:b.title}),b.step===1&&b.categories&&b.categories.length>0&&t("div",{className:"flex gap-1 mt-1 flex-wrap",children:b.categories.map((_,S)=>t(ie,{size:"sm",variant:"flat",color:"secondary",children:_},S))}),b.step===2&&b.ranges&&Object.keys(b.ranges).length>0&&a("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.ranges).length," group(s) with ranges"]}),b.step===3&&b.products&&Object.keys(b.products).length>0&&a("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.products).length," range(s) with products"]}),b.step===4&&b.productDetails&&Object.keys(b.productDetails).length>0&&a("p",{className:"text-sm text-foreground-500 mt-1",children:[Object.keys(b.productDetails).length," product detail(s)"]}),b.step===5&&a("div",{className:"flex gap-2 mt-1",children:[b.options&&Object.keys(b.options).length>0&&a(ie,{size:"sm",variant:"flat",color:"primary",children:[Object.keys(b.options).length," global option group(s)"]}),b.productOptions&&Object.keys(b.productOptions).length>0&&a(ie,{size:"sm",variant:"flat",color:"warning",children:[Object.keys(b.productOptions).length," product(s) with options"]})]})]})]},b.step))})})]}),a(ce,{children:[t(De,{children:a("h4",{className:"font-semibold flex items-center gap-2",children:[t(f,{icon:"lucide:package",width:16}),"Products by Range"]})}),t(de,{children:Object.keys(R).length===0?a("div",{className:"text-center py-8",children:[t(f,{icon:"lucide:package",width:48,className:"mx-auto text-foreground-300 mb-4"}),t("p",{className:"text-foreground-600",children:"No products configured"}),t("p",{className:"text-sm text-foreground-500",children:"Link products to ranges to see them here"})]}):t(Ir,{variant:"bordered",children:Object.entries(R).map(([b,_])=>t(Fr,{title:a("div",{className:"flex items-center gap-3",children:[t(st,{icon:t(f,{icon:"lucide:grid-3x3",width:16}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),t("span",{className:"font-medium",children:b}),a(ie,{size:"sm",variant:"flat",color:"secondary",children:[_.length," product",_.length!==1?"s":""]}),_.some(S=>S.hasOptions)&&a(ie,{size:"sm",variant:"flat",color:"warning",children:[_.filter(S=>S.hasOptions).length," with options"]})]}),children:t("div",{className:"space-y-3 pl-4",children:_.map(S=>{var w,F;return t("div",{className:"border-l-2 border-success-200 pl-4",children:a("div",{className:"flex items-start gap-3",children:[t(st,{icon:t(f,{icon:"lucide:package",width:16}),className:"w-8 h-8 bg-success-100 text-success-600 mt-1"}),a("div",{className:"flex-1",children:[a("div",{className:"flex items-center gap-2 mb-1",children:[t("h6",{className:"font-semibold",children:S.name}),t(ie,{size:"sm",variant:"flat",color:"success",children:S.code}),S.hasOptions&&a(ie,{size:"sm",variant:"flat",color:"warning",startContent:t(f,{icon:"lucide:settings",width:12}),children:[Object.keys(S.options).length," option groups"]})]}),t("p",{className:"text-sm text-foreground-600 mb-2",children:S.overview}),a("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 text-xs",children:[a("div",{children:[t("span",{className:"font-medium text-foreground-700",children:"Specifications:"}),t("span",{className:"text-foreground-500 ml-1",children:((w=S.specifications)==null?void 0:w.length)||0})]}),a("div",{children:[t("span",{className:"font-medium text-foreground-700",children:"Images:"}),t("span",{className:"text-foreground-500 ml-1",children:((F=S.imageGallery)==null?void 0:F.length)||0})]}),a("div",{children:[t("span",{className:"font-medium text-foreground-700",children:"Files:"}),t("span",{className:"text-foreground-500 ml-1",children:Object.keys(S.files||{}).length})]}),a("div",{children:[t("span",{className:"font-medium text-foreground-700",children:"Options:"}),t("span",{className:"text-foreground-500 ml-1",children:S.hasOptions?Object.keys(S.options).length:"None"})]})]}),S.hasOptions&&a("div",{className:"mt-3 p-3 bg-warning-50 rounded-medium border border-warning-200",children:[a("h6",{className:"text-xs font-semibold text-warning-800 mb-2 flex items-center gap-1",children:[t(f,{icon:"lucide:settings",width:12}),"Configuration Options"]}),t("div",{className:"space-y-2",children:Object.entries(S.options).map(([J,N])=>a("div",{className:"text-xs",children:[a("span",{className:"font-medium text-foreground-700",children:[J,":"]}),t("div",{className:"flex flex-wrap gap-1 mt-1",children:N.map((p,x)=>t(ie,{size:"sm",variant:"flat",color:"default",startContent:p.imageUrl&&t(f,{icon:"lucide:image",width:10}),children:typeof p=="string"?p:p.value},x))})]},J))})]})]})]})},S.code)})})},b))})})]})]})},"structure"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:code",width:16}),"JSON Preview"]}),children:a(ce,{children:[a(De,{className:"flex flex-row justify-between items-center",children:[t("h4",{className:"font-semibold",children:"Configuration JSON"}),a("div",{className:"flex gap-2",children:[t(V,{size:"sm",variant:"flat",onPress:y,startContent:t(f,{icon:"lucide:copy",width:16}),children:"Copy"}),t(V,{size:"sm",color:"primary",onPress:j,startContent:t(f,{icon:"lucide:download",width:16}),children:"Download"})]})]}),t(de,{children:t("pre",{className:"w-full px-2 py-1 h-fit font-mono font-normal bg-default/40 text-default-700 rounded-small text-xs overflow-x-auto",children:t("code",{children:g||JSON.stringify(I,null,2)})})})]})},"json")]}),t(zt,{isOpen:c,onOpenChange:u,size:"2xl",children:t($t,{children:b=>a(ke,{children:[t(Lt,{children:"Import Configuration"}),t(Gt,{children:a("div",{className:"space-y-4",children:[t("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:a("div",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),a("div",{children:[t("p",{className:"text-sm font-medium text-warning-800",children:"Warning"}),t("p",{className:"text-xs text-warning-600",children:"Importing will replace all current data. Make sure to export your current configuration first if needed."})]})]})}),t(Pt,{label:"JSON Data",placeholder:"Paste your exported JSON configuration here...",value:m,onChange:_=>h(_.target.value),rows:12,className:"font-mono text-sm"})]})}),a(Mt,{children:[t(V,{variant:"light",onPress:b,children:"Cancel"}),t(V,{color:"primary",onPress:M,isDisabled:!m.trim(),children:"Import"})]})]})})})]})},lo=()=>{const{productGroups:e,productRanges:n,products:r,relationships:s}=Re(),[i,o]=fe(!1),[c,l]=fe(!1),[u,d]=fe({groups:[],ranges:[],products:[]}),[m,h]=fe([]),[g,v]=fe(null),P=ae(async(y=!1)=>{o(!0),v(null);try{const b=window.urbanaAdmin;console.log("Fetching DO folders...",{ajaxUrl:b==null?void 0:b.ajaxUrl,forceRefresh:y});const _=new URL(b.ajaxUrl);_.searchParams.append("action","urbana_list_all_folders"),_.searchParams.append("_wpnonce",b.nonce),y&&_.searchParams.append("force_refresh","true");const S=await fetch(_.toString(),{method:"GET",credentials:"same-origin"});console.log("Response status:",S.status);const w=await S.json();console.log("Response data:",w),w.success&&w.data&&w.data.folders?(console.log("Setting DO folders:",w.data.folders),console.log("Total DO folders count:",w.data.folders.length),console.log("First 10 folders:",w.data.folders.slice(0,10)),h(w.data.folders)):w.success===!1&&w.data&&w.data.message?(console.error("Error from server:",w.data.message),v(w.data.message),h([])):(console.error("Unexpected response format:",w),v("Unexpected response from server"),h([]))}catch(b){console.error("Failed to fetch DO folders:",b),v(b instanceof Error?b.message:"Network error"),h([])}finally{o(!1)}},[]),C=ae(()=>{const y=[],b=[],_=[],S=N=>{const p=N.toLowerCase();return m.some(x=>x.toLowerCase()===p)};e.forEach(N=>{const p=S(N.name);y.push({path:N.name,name:N.name,type:"group",exists_do:p,exists_site:!0,synced:p,checked:!1})});const w=new Set;m.forEach(N=>{if(!N.includes("/")){const p=N.toLowerCase();!e.some(G=>G.name.toLowerCase()===p)&&!w.has(p)&&(y.push({path:N,name:N,type:"group",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),w.add(p))}}),n.forEach(N=>{var K;const p=(K=Object.entries(s.groupToRanges).find(([,se])=>se.includes(N.id)))==null?void 0:K[0],x=p?e.find(se=>se.id===p):null,G=x?`${x.name}/${N.name}`:N.name,U=S(G);b.push({path:G,name:N.name,type:"range",exists_do:U,exists_site:!0,synced:U,checked:!1})});const F=new Set;m.forEach(N=>{const p=N.split("/");if(p.length===2){const x=N.toLowerCase();!n.some(U=>{var k;const K=(k=Object.entries(s.groupToRanges).find(([,O])=>O.includes(U.id)))==null?void 0:k[0],se=K?e.find(O=>O.id===K):null;return(se?`${se.name}/${U.name}`:U.name).toLowerCase()===x})&&!F.has(x)&&(b.push({path:N,name:p[1],type:"range",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),F.add(x))}}),r.forEach(N=>{var K,se;const p=(K=Object.entries(s.rangeToProducts).find(([,le])=>le.includes(N.id)))==null?void 0:K[0],x=p?n.find(le=>le.id===p):null;let G=N.code;if(x){const le=(se=Object.entries(s.groupToRanges).find(([,O])=>O.includes(x.id)))==null?void 0:se[0],k=le?e.find(O=>O.id===le):null;k?G=`${k.name}/${x.name}/${N.code}`:G=`${x.name}/${N.code}`}const U=S(G);_.push({path:G,name:N.name,type:"product",exists_do:U,exists_site:!0,synced:U,checked:!1})});const J=new Set;m.forEach(N=>{const p=N.split("/");if(console.log("Checking DO folder:",N,"parts:",p),p.length===3){const x=N.toLowerCase(),G=p[2],U=r.some(K=>K.code.toLowerCase()===G.toLowerCase());console.log("Product check:",{folder:N,productCode:G,existsInSite:U}),!U&&!J.has(x)&&(_.push({path:N,name:G,type:"product",exists_do:!0,exists_site:!1,synced:!1,checked:!1}),J.add(x))}}),d({groups:y.sort((N,p)=>N.name.localeCompare(p.name)),ranges:b.sort((N,p)=>N.name.localeCompare(p.name)),products:_.sort((N,p)=>N.name.localeCompare(p.name))}),console.log("Built folder comparison:",{groups:y.length,ranges:b.length,products:_.length,doFoldersCount:m.length,productGroupsCount:e.length,productRangesCount:n.length,productsCount:r.length})},[e,n,r,s,m]);ge(()=>{console.log("BiDirectionalSync mounted"),P()},[P]),ge(()=>{console.log("Building folder comparison...",{hasDoFolders:m.length>0,hasGroups:e.length>0,hasRanges:n.length>0,hasProducts:r.length>0}),C()},[m,e,n,r,C]);const I=(y,b)=>{d(_=>({..._,[y]:_[y].map((S,w)=>w===b?{...S,checked:!S.checked}:S)}))},R=(y,b)=>{d(_=>({..._,[y]:_[y].map(S=>({...S,checked:b}))}))},L=async()=>{var y;l(!0);try{const b=[];if(Object.values(u).flat().forEach(J=>{J.checked&&J.exists_site&&!J.exists_do&&b.push(J.path)}),b.length===0){alert("No folders selected to sync to Digital Ocean");return}const _=window.urbanaAdmin,S=new FormData;S.append("action","urbana_sync_folders_to_do"),S.append("_wpnonce",_.nonce),S.append("folders",JSON.stringify(b));const F=await(await fetch(_.ajaxUrl,{method:"POST",credentials:"same-origin",body:S})).json();console.log("Sync result:",F),F.success?(alert(`Successfully synced ${b.length} folder(s) to Digital Ocean`),P()):alert(`Sync failed: ${((y=F.data)==null?void 0:y.message)||"Unknown error"}`)}catch(b){console.error("Sync failed:",b),alert("Failed to sync folders")}finally{l(!1)}},E=async()=>{l(!0);try{const{addProductGroup:y,addProductRange:b,addProduct:_,linkRangeToGroup:S,linkProductToRange:w}=Re.getState(),F=[];if(Object.values(u).flat().forEach(x=>{x.checked&&x.exists_do&&!x.exists_site&&F.push(x)}),F.length===0){alert("No 'DO Only' items selected to import");return}let J=0;const N=[],p=F.sort((x,G)=>{const U={group:0,range:1,product:2};return U[x.type]-U[G.type]});for(const x of p)try{const G=x.path.split("/");if(x.type==="group"){const U=G[0];y({name:U,icon:"lucide:folder",description:"Imported from Digital Ocean",active:!0}),J++,console.log("Imported group:",U)}else if(x.type==="range"){const U=G[0],K=G[1];let se=e.find(le=>le.name.toLowerCase()===U.toLowerCase());if(!se){const le=crypto.randomUUID();y({name:U,icon:"lucide:folder",description:"Auto-created during import",active:!0}),se=Re.getState().productGroups.find(k=>k.name.toLowerCase()===U.toLowerCase())}if(se){const le=crypto.randomUUID();b({name:K,image:"",description:"Imported from Digital Ocean",tags:[],active:!0});const k=Re.getState().productRanges.find(O=>O.name.toLowerCase()===K.toLowerCase());k&&S(se.id,k.id),J++,console.log("Imported range:",K)}}else if(x.type==="product"){const U=G[0],K=G[1],se=G[2];let le=e.find(O=>O.name.toLowerCase()===U.toLowerCase());le||(y({name:U,icon:"lucide:folder",description:"Auto-created during import",active:!0}),le=Re.getState().productGroups.find(O=>O.name.toLowerCase()===U.toLowerCase()));let k=n.find(O=>O.name.toLowerCase()===K.toLowerCase());if(!k&&le&&(b({name:K,image:"",description:"Auto-created during import",tags:[],active:!0}),k=Re.getState().productRanges.find(O=>O.name.toLowerCase()===K.toLowerCase()),k&&S(le.id,k.id)),k){_({name:se,code:se,overview:"Imported from Digital Ocean",description:"",specifications:[],imageGallery:[],files:{},active:!0});const O=Re.getState().products.find(A=>A.code.toLowerCase()===se.toLowerCase());O&&w(k.id,O.id),J++,console.log("Imported product:",se)}}}catch(G){console.error(`Failed to import ${x.path}:`,G),N.push(`${x.path}: ${G instanceof Error?G.message:"Unknown error"}`)}N.length>0?alert(`Imported ${J} item(s) with ${N.length} error(s):

${N.join(`
`)}`):alert(`Successfully imported ${J} item(s) from Digital Ocean!`),P(!0)}catch(y){console.error("Import failed:",y),alert(`Import failed: ${y instanceof Error?y.message:"Unknown error"}`)}finally{l(!1)}},M=(y,b)=>{if(y.length===0)return a("div",{className:"text-center py-8 text-foreground-500",children:[t(f,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),t("p",{children:"No items found"})]});const _=y.filter(S=>S.checked).length;return a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center justify-between mb-3",children:[a("div",{className:"flex gap-2",children:[t(V,{size:"sm",variant:"flat",onPress:()=>R(b,!0),startContent:t(f,{icon:"lucide:check-square",width:14}),children:"Select All"}),t(V,{size:"sm",variant:"flat",onPress:()=>R(b,!1),startContent:t(f,{icon:"lucide:square",width:14}),children:"Clear"})]}),_>0&&a(ie,{size:"sm",color:"primary",variant:"flat",children:[_," selected"]})]}),t("div",{className:"grid grid-cols-1 gap-2",children:y.map((S,w)=>t(ce,{className:`cursor-pointer border-2 transition-all ${S.checked?"border-primary bg-primary/5":"border-transparent hover:border-default-300"}`,isPressable:!0,onPress:()=>I(b,w),children:t(de,{className:"py-3",children:a("div",{className:"flex items-center justify-between",children:[a("div",{className:"flex items-center gap-3 flex-1",children:[t(Ve,{isSelected:S.checked,onValueChange:()=>I(b,w),size:"sm",onClick:F=>F.stopPropagation()}),a("div",{className:"flex-1",children:[t("p",{className:"font-medium",children:S.name}),t("p",{className:"text-xs text-foreground-500",children:S.path})]})]}),t("div",{className:"flex items-center gap-2",children:S.synced?t(ie,{size:"sm",color:"success",variant:"flat",startContent:t(f,{icon:"lucide:check-circle",width:14}),children:"Synced"}):a(ke,{children:[S.exists_site&&t(ie,{size:"sm",color:"primary",variant:"dot",children:"Site"}),S.exists_do&&t(ie,{size:"sm",color:"secondary",variant:"dot",children:"DO"}),!S.exists_site&&S.exists_do&&t(ie,{size:"sm",color:"warning",variant:"flat",startContent:t(f,{icon:"lucide:cloud",width:14}),children:"DO Only"}),S.exists_site&&!S.exists_do&&t(ie,{size:"sm",color:"warning",variant:"flat",startContent:t(f,{icon:"lucide:database",width:14}),children:"Site Only"})]})})]})})},S.path))})]})},j={groups:{total:u.groups.length,synced:u.groups.filter(y=>y.synced).length,siteOnly:u.groups.filter(y=>y.exists_site&&!y.exists_do).length,doOnly:u.groups.filter(y=>!y.exists_site&&y.exists_do).length},ranges:{total:u.ranges.length,synced:u.ranges.filter(y=>y.synced).length,siteOnly:u.ranges.filter(y=>y.exists_site&&!y.exists_do).length,doOnly:u.ranges.filter(y=>!y.exists_site&&y.exists_do).length},products:{total:u.products.length,synced:u.products.filter(y=>y.synced).length,siteOnly:u.products.filter(y=>y.exists_site&&!y.exists_do).length,doOnly:u.products.filter(y=>!y.exists_site&&y.exists_do).length}};return a("div",{className:"space-y-4",children:[a(ce,{children:[a(De,{className:"flex gap-3",children:[t(f,{icon:"lucide:refresh-cw",width:24}),a("div",{className:"flex flex-col flex-1",children:[t("p",{className:"text-md font-semibold",children:"Bi-Directional Sync Manager"}),t("p",{className:"text-small text-default-500",children:"Compare and sync folders between your site and Digital Ocean Spaces"})]}),t(V,{color:"primary",variant:"flat",onPress:()=>P(!0),isLoading:i,startContent:i?void 0:t(f,{icon:"lucide:refresh-cw",width:16}),children:"Refresh"})]}),a(de,{children:[g&&t("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:a("div",{className:"flex items-center gap-2 text-danger",children:[t(f,{icon:"lucide:alert-circle",width:20}),a("div",{children:[t("p",{className:"font-semibold",children:"Error fetching Digital Ocean folders"}),t("p",{className:"text-sm",children:g}),g.includes("not configured")&&t("p",{className:"text-xs mt-1",children:"Please configure Digital Ocean Spaces in Settings"})]})]})}),!g&&m.length===0&&!i&&t("div",{className:"mb-4 p-3 bg-warning/10 border border-warning/20 rounded-lg",children:a("div",{className:"flex items-center gap-2 text-warning",children:[t(f,{icon:"lucide:info",width:20}),a("div",{children:[t("p",{className:"font-semibold",children:"No folders in Digital Ocean"}),t("p",{className:"text-sm",children:'All items shown are only in your site. Use "Sync to Digital Ocean" to create them.'})]})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[t(ce,{className:"bg-primary/10",children:t(de,{className:"py-3",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[t("p",{className:"text-xs text-foreground-500",children:"Total Items"}),t("p",{className:"text-2xl font-bold text-primary",children:j.groups.total+j.ranges.total+j.products.total})]}),t(f,{icon:"lucide:folder",width:32,className:"text-primary opacity-50"})]})})}),t(ce,{className:"bg-success/10",children:t(de,{className:"py-3",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[t("p",{className:"text-xs text-foreground-500",children:"Synced"}),t("p",{className:"text-2xl font-bold text-success",children:j.groups.synced+j.ranges.synced+j.products.synced})]}),t(f,{icon:"lucide:check-circle",width:32,className:"text-success opacity-50"})]})})}),t(ce,{className:"bg-warning/10",children:t(de,{className:"py-3",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[t("p",{className:"text-xs text-foreground-500",children:"Need Sync"}),t("p",{className:"text-2xl font-bold text-warning",children:j.groups.siteOnly+j.ranges.siteOnly+j.products.siteOnly+j.groups.doOnly+j.ranges.doOnly+j.products.doOnly})]}),t(f,{icon:"lucide:alert-circle",width:32,className:"text-warning opacity-50"})]})})})]}),a("div",{className:"flex gap-2 flex-wrap",children:[t(V,{color:"primary",onPress:L,isLoading:c,isDisabled:u.groups.filter(y=>y.checked&&y.exists_site&&!y.exists_do).length===0&&u.ranges.filter(y=>y.checked&&y.exists_site&&!y.exists_do).length===0&&u.products.filter(y=>y.checked&&y.exists_site&&!y.exists_do).length===0,startContent:c?void 0:t(f,{icon:"lucide:cloud-upload",width:16}),children:c?"Syncing...":"Sync to Digital Ocean"}),t(V,{color:"secondary",variant:"flat",isLoading:c,isDisabled:c||u.groups.filter(y=>y.checked&&!y.exists_site&&y.exists_do).length===0&&u.ranges.filter(y=>y.checked&&!y.exists_site&&y.exists_do).length===0&&u.products.filter(y=>y.checked&&!y.exists_site&&y.exists_do).length===0,startContent:c?void 0:t(f,{icon:"lucide:download-cloud",width:16}),onPress:E,children:"Import from Digital Ocean"})]})]})]}),a(Ye,{"aria-label":"Folder Types",children:[t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:layers",width:16}),t("span",{children:"Product Groups"}),t(ie,{size:"sm",variant:"flat",children:j.groups.total})]}),children:t("div",{className:"mt-4",children:i?t("div",{className:"flex justify-center py-12",children:t(Nt,{})}):M(u.groups,"groups")})},"groups"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:grid-3x3",width:16}),t("span",{children:"Product Ranges"}),t(ie,{size:"sm",variant:"flat",children:j.ranges.total})]}),children:t("div",{className:"mt-4",children:i?t("div",{className:"flex justify-center py-12",children:t(Nt,{})}):M(u.ranges,"ranges")})},"ranges"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:package",width:16}),t("span",{children:"Products"}),t(ie,{size:"sm",variant:"flat",children:j.products.total})]}),children:t("div",{className:"mt-4",children:i?t("div",{className:"flex justify-center py-12",children:t(Nt,{})}):M(u.products,"products")})},"products")]})]})},uo=({isOpen:e,onOpenChange:n})=>{const{productGroups:r,productRanges:s,products:i,relationships:o,updateProduct:c,addProductGroup:l,addProductRange:u,addProduct:d,linkRangeToGroup:m,linkProductToRange:h,resetData:g,updateOptions:v}=Re(),[P,C]=fe(null),[I,R]=fe(!1),[L,E]=fe(!1),[M,j]=fe(!1),[y,b]=fe(null),[_,S]=fe(null),[w,F]=fe(!0),[J,N]=fe(""),[p,x]=fe("update"),G=he(()=>{if(!_)return{categories:0,ranges:0,products:0,totalFiles:0,totalFolders:0,optionGroups:0,optionImages:0};const{structured_data:O,total_folders:A,total_objects:B}=_,q=Object.keys(O).length;let X=0,ne=0,H=0,te=0,Q=0;return Object.values(O).forEach(oe=>{X+=Object.keys(oe).length,Object.values(oe).forEach(me=>{ne+=Object.keys(me).length,Object.values(me).forEach(be=>{H+=be.images.length+be.downloads.length,be.img_conf&&(te+=Object.keys(be.img_conf).length,Object.values(be.img_conf).forEach(D=>{Q+=Object.keys(D).length}))})})}),{categories:q,ranges:X,products:ne,totalFiles:H,totalFolders:A||0,optionGroups:te,optionImages:Q}},[_]);ge(()=>{e&&(U(),S(null),b(null))},[e]);const U=ae(async()=>{R(!0);try{const O=await He.getDigitalOceanConfig();C(O)}catch(O){console.error("Failed to load config:",O),Se({color:"danger",title:"Failed to load Digital Ocean configuration"})}finally{R(!1)}},[]),K=ae(async()=>{E(!0),b(null);try{const O=await He.testDigitalOceanConnection();b(O),Se({color:O.success?"success":"danger",title:O.message})}catch(O){const A=O instanceof Error?O.message:"Unknown error occurred";b({success:!1,message:A}),Se({color:"danger",title:"Connection test failed",description:A})}finally{E(!1)}},[]),se=ae(async()=>{j(!0),S(null);try{const O=await He.fetchDigitalOceanAssets(J);if(S(O),O.success)if(p==="replace"){const A=He.buildCompleteStructureFromDigitalOcean(O.structured_data);g(),A.productGroups.forEach(B=>{l({name:B.name,icon:B.icon,description:B.description,active:B.active})}),A.productRanges.forEach(B=>{u({name:B.name,image:B.image,description:B.description,tags:B.tags,active:B.active}),Object.entries(A.relationships.groupToRanges).forEach(([q,X])=>{X.includes(B.id)&&m(q,B.id)})}),A.products.forEach(B=>{d({code:B.code,name:B.name,overview:B.overview,description:B.description,specifications:B.specifications,imageGallery:B.imageGallery,files:B.files,options:B.options,active:B.active}),Object.entries(A.relationships.rangeToProducts).forEach(([q,X])=>{X.includes(B.id)&&h(q,B.id)})}),Se({color:"success",title:"Structure imported successfully!",description:`Created ${A.productGroups.length} groups, ${A.productRanges.length} ranges, and ${A.products.length} products with their options.`})}else{const A=He.updateProductPathsFromDigitalOcean(i,O.structured_data,r,s,o);let B=0;A.forEach(q=>{const X=i.find(ne=>ne.code.toLowerCase()===q.code.toLowerCase());X&&(JSON.stringify(X.imageGallery)!==JSON.stringify(q.imageGallery)||JSON.stringify(X.files)!==JSON.stringify(q.files)||JSON.stringify(X.options)!==JSON.stringify(q.options))&&(c(q.id,{imageGallery:q.imageGallery,files:q.files,options:q.options}),B++)}),Se({color:"success",title:"Assets fetched successfully!",description:`Updated ${B} products with Digital Ocean assets and their specific options.`})}}catch(O){const A=O instanceof Error?O.message:"Unknown error occurred";S({success:!1,message:A,total_folders:0,total_objects:0,raw_folders:[],raw_objects:[],structured_data:{},debug_info:{prefix:J||"",configuration:P||{bucket_name:"",region:"",endpoint:"",configured:!1},categories:[]}}),Se({color:"danger",title:"Failed to fetch assets",description:A})}finally{j(!1)}},[J,p,i,r,s,o,c,l,u,d,m,h,g,v,P]),le=ae(()=>{S(null),b(null),j(!1),E(!1),n(!1)},[n]),k=O=>Object.entries(O).map(([A,B])=>a("div",{className:"mb-4",children:[a("h4",{className:"font-semibold text-lg text-primary mb-2 flex items-center gap-2",children:[t(f,{icon:"lucide:folder",width:16}),A]}),Object.entries(B).map(([q,X])=>a("div",{className:"ml-4 mb-3",children:[a("h5",{className:"font-medium text-secondary mb-1 flex items-center gap-2",children:[t(f,{icon:"lucide:folder-open",width:14}),q]}),Object.entries(X).map(([ne,H])=>a("div",{className:"ml-4 mb-2",children:[a("h6",{className:"font-medium text-success mb-1 flex items-center gap-2",children:[t(f,{icon:"lucide:package",width:12}),ne]}),a("div",{className:"ml-4 text-sm space-y-1",children:[H.images.length>0&&a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:image",width:12,className:"text-primary"}),a("span",{children:["Images: ",H.images.length]}),t(ie,{size:"sm",variant:"flat",color:"primary",children:H.images.length})]}),H.downloads.length>0&&a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:file",width:12,className:"text-secondary"}),a("span",{children:["Downloads: ",H.downloads.length]}),t(ie,{size:"sm",variant:"flat",color:"secondary",children:H.downloads.length})]}),H.img_conf&&Object.keys(H.img_conf).length>0&&a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:settings",width:12,className:"text-warning"}),a("span",{children:["Option Groups: ",Object.keys(H.img_conf).length]}),t(ie,{size:"sm",variant:"flat",color:"warning",children:Object.keys(H.img_conf).length})]})]})]},ne))]},q))]},A));return t(zt,{isOpen:e,onOpenChange:n,size:"5xl",scrollBehavior:"inside",className:"urbana-modal",isDismissable:!M&&!L,children:t($t,{children:O=>a(ke,{children:[a(Lt,{className:"flex flex-col gap-1",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:cloud-download",width:20}),"Fetch from Digital Ocean Spaces"]}),t("p",{className:"text-sm text-foreground-500 font-normal",children:"Fetch assets from Digital Ocean Spaces and update product paths automatically"})]}),t(Gt,{children:a("div",{className:"space-y-6",children:[t(ce,{className:P!=null&&P.configured?"border-success":"border-warning",children:a(de,{children:[a("div",{className:"flex items-center justify-between",children:[a("div",{className:"flex items-center gap-3",children:[t(f,{icon:P!=null&&P.configured?"lucide:check-circle":"lucide:alert-circle",width:20,className:P!=null&&P.configured?"text-success":"text-warning"}),a("div",{children:[t("h4",{className:"font-semibold",children:"Configuration Status"}),t("p",{className:"text-sm text-foreground-500",children:P!=null&&P.configured?"Digital Ocean Spaces is configured":"Configuration required"})]})]}),t(V,{color:"primary",variant:"flat",size:"sm",onPress:K,isLoading:L,isDisabled:!(P!=null&&P.configured)||L||M,startContent:L?void 0:t(f,{icon:"lucide:wifi",width:16}),children:L?"Testing...":"Test Connection"})]}),P&&a("div",{className:"mt-3 text-sm text-foreground-600",children:[a("div",{children:["Bucket: ",P.bucket_name||"Not set"]}),a("div",{children:["Region: ",P.region||"Not set"]}),a("div",{children:["Endpoint: ",P.endpoint||"Not set"]})]}),y&&t("div",{className:"mt-3",children:t(ie,{size:"sm",variant:"flat",color:y.success?"success":"danger",startContent:t(f,{icon:y.success?"lucide:check":"lucide:x",width:12}),children:y.message})})]})}),t(ce,{children:t(de,{children:a("div",{className:"space-y-4",children:[a("h4",{className:"font-semibold flex items-center gap-2 mb-2",children:[t(f,{icon:"lucide:settings",width:16}),"Fetch Options"]}),t(Ee,{label:"Prefix Filter (Optional)",placeholder:"e.g., shelter/ or shelter/peninsula/",value:J,onValueChange:N,description:"Filter objects by prefix to limit the search scope",startContent:t(f,{icon:"lucide:filter",width:16}),isDisabled:M,classNames:{input:"urbana-input"}}),t(Ot,{}),a("div",{className:"space-y-3",children:[t("h5",{className:"font-medium text-sm",children:"Import Mode"}),a("div",{className:"flex flex-col gap-2",children:[t(Ve,{isSelected:p==="update",onValueChange:A=>x(A?"update":"replace"),isDisabled:M,size:"sm",children:a("div",{className:"ml-2",children:[t("div",{className:"font-medium",children:"Update existing products only"}),t("div",{className:"text-xs text-foreground-500",children:"Only update assets for products that already exist in your store"})]})}),t(Ve,{isSelected:p==="replace",onValueChange:A=>x(A?"replace":"update"),isDisabled:M,size:"sm",children:a("div",{className:"ml-2",children:[t("div",{className:"font-medium",children:"Replace entire structure"}),t("div",{className:"text-xs text-foreground-500",children:"Clear existing data and import complete structure from Digital Ocean"})]})})]})]}),p==="replace"&&t("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:a("div",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),a("div",{className:"text-sm text-warning-700",children:[t("strong",{children:"Warning:"})," This will clear all existing product groups, ranges, and products, then import the complete structure from Digital Ocean Spaces."]})]})})]})})}),M&&t(ce,{className:"border-primary",children:t(de,{children:a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:loader",width:16,className:"animate-spin text-primary"}),t("span",{className:"font-semibold",children:"Fetching Assets..."})]}),t(zr,{isIndeterminate:!0,color:"primary",size:"sm",className:"w-full"}),t("p",{className:"text-sm text-foreground-500",children:"Please wait while we fetch assets from Digital Ocean Spaces..."})]})})}),_&&t(ce,{className:_.success?"border-success":"border-danger",children:t(de,{children:a(Ye,{"aria-label":"Fetch Results",children:[t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:bar-chart",width:16}),"Summary"]}),children:a("div",{className:"space-y-4",children:[a("div",{className:"flex items-center gap-2",children:[t(f,{icon:_.success?"lucide:check-circle":"lucide:x-circle",width:16,className:_.success?"text-success":"text-danger"}),t("span",{className:"font-semibold",children:_.success?"Fetch Successful!":"Fetch Failed"})]}),t("p",{className:"text-sm",children:_.message}),_.success&&a("div",{className:"grid grid-cols-7 gap-4 text-center mt-4",children:[a("div",{children:[t("div",{className:"text-2xl font-bold text-primary",children:G.categories}),t("div",{className:"text-sm text-foreground-500",children:"Categories"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-secondary",children:G.ranges}),t("div",{className:"text-sm text-foreground-500",children:"Ranges"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-success",children:G.products}),t("div",{className:"text-sm text-foreground-500",children:"Products"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-warning",children:G.totalFiles}),t("div",{className:"text-sm text-foreground-500",children:"Files"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-danger",children:G.totalFolders}),t("div",{className:"text-sm text-foreground-500",children:"Folders"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-primary",children:G.optionGroups}),t("div",{className:"text-sm text-foreground-500",children:"Option Groups"})]}),a("div",{children:[t("div",{className:"text-2xl font-bold text-secondary",children:G.optionImages}),t("div",{className:"text-sm text-foreground-500",children:"Option Images"})]})]})]})},"summary"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:folder-tree",width:16}),"Structure"]}),children:t(Kt,{className:"max-h-96",children:t("div",{className:"text-sm",children:Object.keys(_.structured_data).length>0?k(_.structured_data):a("div",{className:"text-center text-foreground-500 py-8",children:[t(f,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),t("p",{children:"No structured data found"})]})})})},"structure"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:bug",width:16}),"Debug"]}),children:t(Kt,{className:"max-h-96",children:a("div",{className:"space-y-4 text-sm",children:[a("div",{children:[t("h5",{className:"font-medium mb-2",children:"Configuration"}),t(xn,{className:"text-xs",children:JSON.stringify(_.debug_info.configuration,null,2)})]}),a("div",{children:[t("h5",{className:"font-medium mb-2",children:"Folders Found"}),t(Kt,{className:"max-h-32",children:t(xn,{className:"text-xs",children:_.raw_folders.length>0?_.raw_folders.join(`
`):"No folders found"})})]}),a("div",{children:[t("h5",{className:"font-medium mb-2",children:"Fetch Summary"}),a("div",{className:"space-y-1",children:[a("div",{children:["Prefix: ",_.debug_info.prefix||"(none)"]}),a("div",{children:["Total Folders: ",_.total_folders]}),a("div",{children:["Total Objects: ",_.total_objects]}),a("div",{children:["Categories Found: ",_.debug_info.categories.join(", ")||"(none)"]})]})]}),_.raw_objects.length>0&&a("div",{children:[t("h5",{className:"font-medium mb-2",children:"Sample Objects"}),t(Kt,{className:"max-h-32",children:t(xn,{className:"text-xs",children:JSON.stringify(_.raw_objects.slice(0,5),null,2)})})]})]})})},"debug")]})})}),!_&&(P==null?void 0:P.configured)&&t(ce,{className:"bg-primary-50 border-primary",children:t(de,{children:a("div",{className:"space-y-3",children:[a("h4",{className:"font-semibold text-primary-600 flex items-center gap-2 mb-2",children:[t(f,{icon:"lucide:info",width:16}),"Instructions"]}),a("ul",{className:"text-sm space-y-2 text-foreground-600",children:[a("li",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Expected folder structure: category/range/product_code/type/filename"]}),a("li",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Example: shelter/peninsula/k302/images/hero.jpg"]}),a("li",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),'Type folders should be either "images" or "downloads" or "img_conf"']}),a("li",{className:"flex items-start gap-2",children:[t(f,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Use prefix filter to limit search scope for better performance"]})]})]})})})]})}),a(Mt,{children:[t(V,{variant:"light",onPress:le,isDisabled:M||L,children:_?"Close":"Cancel"}),!_&&t(V,{color:"primary",onPress:se,isLoading:M,isDisabled:!(P!=null&&P.configured)||M||L,startContent:M?void 0:t(f,{icon:"lucide:cloud-download",width:16}),children:M?"Fetching...":"Fetch Assets"})]})]})})})},ho=()=>{const{productGroups:e,productRanges:n,products:r,relationships:s,exportData:i,importData:o,error:c,productData:l,loadData:u,saveData:d,isLoading:m,isSaving:h,isDirty:g,lastSaved:v,initializeFromWindowData:P,clearError:C}=Re(),[I,R]=fe(null),{isOpen:L,onOpen:E,onOpenChange:M}=Ft();ge(()=>{const S=window.urbanaAdmin;S&&(P(),R(S.stepperId||1))},[P]);const j=async()=>{try{C();const S=await d();S&&R(S),Se({color:"success",title:"Data saved successfully!"})}catch(S){console.error("Failed to save data:",S),Se({color:"danger",title:"Failed to save data. Please try again."})}},y=async S=>{try{const w=new URL(window.location.href);w.searchParams.set("stepper_id",S.toString()),window.location.href=w.toString()}catch(w){console.error("Failed to load data builder:",w),Se({color:"danger",title:"Failed to load data builder"})}},b=()=>{try{const S=i(),w="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(S,null,2)),F=document.createElement("a");F.setAttribute("href",w),F.setAttribute("download","product-configurator-data.json"),document.body.appendChild(F),F.click(),F.remove(),Se({color:"success",title:"Data exported successfully!"})}catch(S){console.error("Export failed:",S),Se({color:"danger",title:"Failed to export data"})}},_=S=>{var J;const w=(J=S.target.files)==null?void 0:J[0];if(!w)return;const F=new FileReader;F.onload=N=>{var p;try{const x=JSON.parse((p=N.target)==null?void 0:p.result);o(x),S.target.value="",Se({color:"success",title:"Data imported successfully!"})}catch(x){console.error("Error parsing imported data:",x),Se({color:"danger",title:"Invalid data format. Please check your JSON file."})}},F.readAsText(w)};return a("div",{className:"urbana-builder-page max-w-7xl mx-auto",children:[a("div",{className:"flex justify-between items-center mb-6",children:[t("div",{className:"flex items-center gap-4",children:a("div",{children:[a("h2",{className:"text-2xl font-semibold text-foreground",children:["Data Management",I&&a("span",{className:"text-sm text-foreground-500 ml-2",children:["(Stepper ID: ",I,")"]})]}),t("p",{className:"text-sm text-foreground-500 mt-1",children:"Manage product groups, ranges, products, and their relationships"})]})}),a("div",{className:"flex gap-2",children:[v&&a("div",{className:"text-sm text-foreground-500 text-right ml-6",children:[t("div",{className:"text-xs",children:"Last saved:"}),t("div",{className:"font-medium",children:new Date(v).toLocaleString()})]}),t(V,{color:g?"primary":"success",variant:g?"solid":"flat",onPress:j,isLoading:h,isDisabled:h,startContent:h?"":t(f,{icon:"lucide:save",width:18}),children:h?"Saving...":g?"Save Changes":"Save Data"}),t(V,{color:"primary",variant:"flat",onPress:b,startContent:t(f,{icon:"lucide:download",width:18}),children:"Export Data"}),a("label",{className:"cursor-pointer",children:[t(V,{color:"primary",variant:"flat",as:"span",startContent:t(f,{icon:"lucide:upload",width:18}),children:"Import Data"}),t("input",{type:"file",accept:".json",className:"hidden",onChange:_})]}),t(V,{color:"warning",variant:"flat",onPress:E,startContent:t(f,{icon:"lucide:cloud-download",width:18}),isDisabled:r.length===0,children:"Fetch from Digital Ocean"})]})]}),t(ce,{className:"p-4 mb-6",children:a("div",{className:"flex items-center gap-4",children:[t("span",{className:"text-sm font-medium",children:"Switch to Stepper ID:"}),t("input",{type:"number",min:"1",className:"px-3 py-2 border rounded-md w-20",placeholder:"ID",onKeyDown:S=>{if(S.key==="Enter"){const w=parseInt(S.target.value);w>0&&y(w)}}}),t(V,{size:"sm",color:"primary",variant:"flat",onPress:()=>{const S=document.querySelector('input[type="number"]'),w=parseInt(S.value);w>0&&y(w)},children:"Switch"})]})}),t(ce,{className:"p-0",children:a(Ye,{"aria-label":"Data Builder Tabs",fullWidth:!0,classNames:{tabList:"gap-0"},children:[t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:layers",width:18}),t("span",{children:"Product Groups"}),t("span",{className:"text-xs bg-primary-100 text-primary-800 px-2 py-0.5 rounded-full",children:e.length})]}),children:t("div",{className:"p-6",children:t(ui,{})})},"groups"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:grid-3x3",width:18}),t("span",{children:"Product Ranges"}),t("span",{className:"text-xs bg-secondary-100 text-secondary-800 px-2 py-0.5 rounded-full",children:n.length})]}),children:t("div",{className:"p-6",children:t(mi,{})})},"ranges"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:package",width:18}),t("span",{children:"Products"}),t("span",{className:"text-xs bg-success-100 text-success-800 px-2 py-0.5 rounded-full",children:r.length})]}),children:t("div",{className:"p-6",children:t(ao,{stepperID:I})})},"products"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:link",width:18}),t("span",{children:"Relationships"})]}),children:t("div",{className:"p-6",children:t(oo,{})})},"relationships"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:refresh-cw",width:18}),t("span",{children:"Bi-Directional Sync"})]}),children:t("div",{className:"p-6",children:t(lo,{})})},"sync"),t(we,{title:a("div",{className:"flex items-center gap-2",children:[t(f,{icon:"lucide:eye",width:18}),t("span",{children:"Data Preview"})]}),children:t("div",{className:"p-6",children:t(co,{})})},"preview")]})}),t(uo,{isOpen:L,onOpenChange:M})]})};function mo(){const{productGroups:e,isLoading:n,error:r,clearError:s,initializeFromWindowData:i,loadData:o}=Re();ge(()=>{window.urbanaAdmin&&e.length===0&&i()},[i,e.length]);const c=async()=>{try{s(),await o()}catch(l){console.error("Load failed:",l)}};return n?t("div",{className:"min-h-screen bg-background flex items-center justify-center",children:a("div",{className:"flex flex-col items-center gap-4",children:[t(Nt,{size:"lg"}),t("p",{className:"text-foreground-600",children:"Loading product data..."})]})}):t("div",{className:"min-h-screen bg-background",children:a("div",{className:"py-6 px-4 sm:px-6",children:[a("div",{className:"flex justify-between items-start mb-6",children:[a("div",{children:[t("h1",{className:"text-3xl font-bold text-foreground",children:"Product Data Builder"}),t("p",{className:"text-foreground-500 mt-2",children:"Create and manage product configuration data"})]}),t("div",{className:"flex items-center gap-3",children:t(V,{variant:"flat",color:"primary",startContent:t(f,{icon:"lucide:refresh-cw",width:18}),onPress:c,isLoading:n,children:"Refresh Data"})})]}),r&&t(Gs,{color:"danger",variant:"flat",className:"mb-6",title:"Error",description:r,endContent:t(V,{variant:"light",color:"danger",size:"sm",onPress:s,children:"Dismiss"})}),t(ho,{})]})})}document.getElementById("urbana-data-builder-root");const po=()=>{const e=document.getElementById("urbana-data-builder-root");return e?(Fs.createRoot(e).render(t(re.StrictMode,{children:a(Ws,{children:[t(Ms,{}),t("main",{className:"text-foreground bg-background",children:t(mo,{})})]})})),!0):!1},fo=(e=20,n=100)=>{let r=0,s=!1;const i=()=>{r++,s=po(),!(s||r>=e)&&setTimeout(i,n)};i()};fo(20,100);
