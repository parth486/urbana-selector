import{f as ae,u as re,a as ie,c as ne,j as e,b as q,I as v,R as U,r as b,d as D,e as L,s as oe,l as le,i as z,g as ce,h as de}from"./client.js";import{i as ue,a as me,b as B,p as W,c as H,T as pe}from"./productData.js";import{m as E}from"./proxy.js";import{c as he,t as Z,a as $}from"./chunk-ML27DD5T.js";import{t as fe,c as ge,a as xe,d as be,p as we,H as je}from"./middleware.js";import"./accelerated-values.js";import"./create-visual-element.js";var ee=ae((t,a)=>{var s;const{as:r,className:m,children:d,...o}=t,i=r||"div",p=re(a),{slots:g,classNames:x}=ie(),N=ne(x==null?void 0:x.footer,m);return e.jsx(i,{ref:p,className:(s=g.footer)==null?void 0:s.call(g,{class:N}),...o,children:d})});ee.displayName="HeroUI.CardFooter";var ye=ee;const ve=({currentStep:t,totalSteps:a,onNext:s,onPrevious:r,canProceed:m,isLastStep:d,isSubmitting:o,isSubmitted:i,onSubmit:p})=>e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx("div",{children:t>1&&e.jsx(q,{variant:"flat",color:"default",onPress:r,startContent:e.jsx(v,{icon:"lucide:arrow-left",width:18}),children:"Previous"})}),e.jsxs("div",{className:"text-default-500 text-sm",children:["Step ",t," of ",a]}),e.jsx("div",{children:d?e.jsx(q,{color:"primary",isDisabled:!m||o||i,isLoading:o,onPress:p,endContent:!o&&!i&&e.jsx(v,{icon:"lucide:send",width:18}),children:i?e.jsxs(E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex items-center gap-2",children:[e.jsx(v,{icon:"lucide:check",width:18}),"Submitted"]}):"Submit"}):e.jsx(q,{color:"primary",isDisabled:!m,onPress:s,endContent:e.jsx(v,{icon:"lucide:arrow-right",width:18}),children:"Next"})})]}),Ne=({currentStep:t,totalSteps:a,steps:s,selections:r,onStepClick:m})=>{const d=o=>o===1?!0:o===2?!!r.productGroup:o===3?!!r.productRange:o===4||o===5||o===6?!!r.individualProduct:!1;return e.jsx("div",{className:"hidden md:block mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:s.map(o=>{const i=o.step===t,p=o.step<t,g=d(o.step);return e.jsxs(U.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${i?"bg-primary text-white":p?"bg-success text-white":"bg-default-100 text-default-500"} ${g?"cursor-pointer hover:opacity-80":"cursor-not-allowed opacity-60"}`,onClick:()=>g&&m(o.step),disabled:!g,"aria-label":`Go to step ${o.step}: ${o.title}`,children:p?e.jsx(v,{icon:"lucide:check",width:20}):e.jsx("span",{children:o.step})}),e.jsx("span",{className:`text-xs mt-2 text-center max-w-[80px] ${i?"text-primary font-medium":"text-default-500"}`,children:o.title})]}),o.step<a&&e.jsx("div",{className:"flex-1 h-[2px] mx-2 bg-default-200",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:p?"100%":"0%"}})})]},o.step)})})})},Se=({data:t,selection:a,onSelect:s})=>{const r=b.useMemo(()=>{var o;return t.productGroups&&Array.isArray(t.productGroups)?t.productGroups.filter(i=>i.active!==!1):((o=t.categories)==null?void 0:o.map(i=>({id:i.toLowerCase().replace(/\s+/g,"-"),name:i,icon:ke(i),description:_e(i),active:!0})))||[]},[t.productGroups,t.categories]),m={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},d={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return e.jsxs("div",{children:[e.jsx("p",{className:"text-default-600 mb-6",children:"Please select a product category to begin your configuration."}),e.jsx(E.div,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",variants:m,initial:"hidden",animate:"show",children:r.map(o=>e.jsx(E.div,{variants:d,children:e.jsx(D,{isPressable:!0,onPress:()=>s(o.name),className:`transition-all duration-200 ${a===o.name?"border-2 border-primary shadow-md":"border border-default-200 hover:border-primary hover:shadow-sm"}`,children:e.jsxs(L,{className:"flex flex-col items-center text-center p-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-3 ${a===o.name?"bg-primary text-white":"bg-default-100 text-default-500"}`,children:e.jsx(v,{icon:o.icon,width:24})}),e.jsx("h3",{className:"text-lg font-medium",children:o.name}),e.jsx("p",{className:"text-default-500 text-sm mt-1",children:o.description})]})})},o.id))})]})};function ke(t){return{Shelter:"lucide:home",Toilet:"lucide:bath",Bridge:"lucide:route",Access:"lucide:wheelchair",Seating:"lucide:armchair",Lighting:"lucide:lamp"}[t]||"lucide:box"}function _e(t){return{Shelter:"Outdoor structures for shade and protection",Toilet:"Public and portable sanitation facilities",Bridge:"Pedestrian and light vehicle crossings",Access:"Ramps, stairs, and accessibility solutions",Seating:"Benches and outdoor furniture options",Lighting:"Outdoor and pathway lighting solutions"}[t]||"Product category"}const Pe=({data:t,productGroup:a,selection:s,onSelect:r})=>{t.ranges[a];const m=b.useMemo(()=>{var p,g;if(t.productRanges&&t.relationships){const x=a.toLowerCase().replace(/\s+/g,"-"),N=((p=t.relationships.groupToRanges)==null?void 0:p[x])||[];return t.productRanges.filter(w=>N.includes(w.id)&&w.active!==!1)}return(((g=t.ranges)==null?void 0:g[a])||[]).map(x=>({id:x.toLowerCase().replace(/\s+/g,"-"),name:x,image:"",description:Ce(x),tags:Ee(x),active:!0}))},[t.productRanges,t.relationships,t.ranges,a]),d={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},o={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return e.jsxs("div",{children:[e.jsxs("p",{className:"text-default-600 mb-6",children:["Select a product range from the ",a," category:"]}),e.jsx(E.div,{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",variants:d,initial:"hidden",animate:"show",children:m.map((i,p)=>{const g=s===i.name;return e.jsx(E.div,{variants:o,children:e.jsx(D,{isPressable:!0,onPress:()=>r(i.name),className:`transition-all duration-200 ${g?"border-2 border-primary shadow-md":"border border-default-200 hover:border-primary hover:shadow-sm"}`,children:e.jsx(L,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[i.image&&e.jsx(he,{className:"p-0",children:e.jsx(ue,{src:i.image,alt:i.name,className:"w-full h-40 object-cover",radius:"none"})}),e.jsxs("div",{className:"p-4 flex-1",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsx("p",{className:"text-default-500 text-sm mt-2",children:i.description}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:i.tags.map(x=>e.jsx("span",{className:"text-xs px-2 py-1 bg-default-100 text-default-700 rounded-medium",children:x},x))})]})]})})})},i.id)})})]})};function Ce(t){return{Peninsula:"Modern shelters with excellent weather protection for parks and urban settings",Whyalla:"Robust shelters designed for coastal and high-wind environments",Coastal:"Corrosion-resistant designs perfect for beachfront and marine locations",Urban:"Contemporary designs that blend with modern city landscapes",Heritage:"Traditional designs that complement historic and cultural settings",EcoSan:"Environmentally friendly composting toilet solutions with minimal water usage",Standard:"Reliable and cost-effective public toilet facilities",Accessible:"Fully compliant accessible toilet facilities with enhanced features",Premium:"High-end toilet facilities with superior finishes and amenities",Compact:"Space-saving designs for areas with limited footprint","Small Span":"Compact bridges for garden paths and small water crossings","Large Span":"Extended bridges for wider crossings and heavier loads",Pedestrian:"Dedicated walkways designed for high foot traffic areas","Decorative Bridge":"Ornamental bridges that serve as landscape features","Heavy Duty":"Reinforced bridges capable of supporting maintenance vehicles",Ramp:"Gentle slope access solutions for wheelchairs and strollers",Staircase:"Step access with various configurations and safety features",Pathway:"Connected walkway systems for parks and public spaces",Boardwalk:"Elevated walkways for wetlands and sensitive environments",Platform:"Viewing platforms and elevated observation areas",Bench:"Traditional seating options for parks and public spaces","Table Setting":"Combined table and seating arrangements for picnic areas",Lounge:"Comfortable extended seating for relaxation areas",Stadium:"Tiered seating solutions for sports and event venues",Custom:"Bespoke seating arrangements designed to specification",Solar:"Self-sufficient lighting powered by renewable energy","Mains Powered":"Connected lighting solutions with reliable performance","Decorative Light":"Aesthetic lighting features that enhance landscapes",Security:"High visibility lighting for safety and security","Pathway Light":"Directional lighting for walkways and pedestrian areas"}[t]||`${t} product line with various options and configurations.`}function Ee(t,a){const s={Peninsula:["Modern","Weather-resistant","Versatile"],Whyalla:["Robust","Wind-resistant","Durable"],Coastal:["Corrosion-resistant","Salt-proof","UV-stable"],Urban:["Contemporary","Modular","Space-efficient"],Heritage:["Traditional","Ornate","Classic"],EcoSan:["Eco-friendly","Low-water","Composting"],Standard:["Cost-effective","Reliable","Low-maintenance"],Accessible:["ADA Compliant","Spacious","Universal"],Premium:["High-end","Enhanced features","Superior finishes"],Compact:["Space-saving","Efficient","Urban-friendly"],"Small Span":["Compact","Decorative","Easy-install"],"Large Span":["Extended","Reinforced","Heavy-load"],Pedestrian:["High-traffic","Safety-focused","Accessible"],Decorative:["Ornamental","Artistic","Feature piece"],"Heavy Duty":["Vehicle-rated","Industrial","Maximum strength"],default:["Quality","Durable","Customizable"]};return s[t]||s.default}const Me=({data:t,productRange:a,selection:s,onSelect:r})=>{t.products[a];const m=b.useMemo(()=>{var p;if(t.productsData&&t.relationships){const g=a.toLowerCase().replace(/\s+/g,"-"),x=t.relationships.rangeToProducts[g]||[];return t.productsData.filter(N=>x.includes(N.id)&&N.active!==!1)}return(((p=t.products)==null?void 0:p[a])||[]).map(g=>({id:g.toLowerCase(),code:g,name:`${g} Product`,overview:V(g),description:V(g),specifications:[],imageGallery:[],files:{},active:!0}))},[t.productsData,t.relationships,t.products,a]),d={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.05}}},o={hidden:{opacity:0,y:10},show:{opacity:1,y:0}};return e.jsxs("div",{children:[e.jsxs("p",{className:"text-default-600 mb-6",children:["Select a specific product from the ",a," range:"]}),e.jsx(E.div,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",variants:d,initial:"hidden",animate:"show",children:m.map(i=>{const p=s===i.code;return i.imageGallery.length>0,e.jsx(E.div,{variants:o,children:e.jsxs(D,{isPressable:!0,onPress:()=>r(i.code),className:`h-full w-full transition-all duration-200 ${p?"border-2 border-primary shadow-md":"border border-default-200 hover:border-primary hover:shadow-sm"}`,children:[e.jsxs(L,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("h3",{className:"text-lg font-medium",children:i.name})}),e.jsx("p",{className:"text-default-500 text-sm text-center",children:i.overview||i.description}),i.specifications.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-default-700 text-center",children:"Key Features:"}),e.jsxs("div",{className:"text-xs text-default-500",children:[i.specifications.slice(0,3).map((g,x)=>e.jsxs("div",{className:"flex items-start justify-center",children:[e.jsx(v,{icon:"lucide:check",width:14,className:"mr-1 mt-0.5 text-success"}),e.jsx("span",{children:g})]},x)),i.specifications.length>3&&e.jsxs("div",{className:"text-default-400 mt-1",children:["+",i.specifications.length-3," more features"]})]})]})]}),Object.keys(i.files).length>0&&e.jsx(ye,{className:"border-t border-default-100 px-4 py-2 justify-center",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-default-600",children:[e.jsx(v,{icon:"lucide:file-text",width:14}),e.jsxs("span",{children:[Object.keys(i.files).length," document",Object.keys(i.files).length!==1?"s":""," available"]})]})})]})},i.id)})})]})};function V(t){const a=t.match(/[A-Z]+\d+/),s=a?a[0]:t;return{K301:"Compact shelter with modern design, suitable for parks and urban settings.",K302:"Medium-sized shelter with extended roof coverage for picnic areas.",K308:"Large shelter with multiple seating options and enhanced weather protection.",K310:"Premium shelter with architectural design elements and superior materials.",K315:"Deluxe shelter with integrated seating and optional power connections.",E201:"Eco-friendly toilet with composting technology and minimal water usage.",E202:"Solar-powered toilet facility with self-contained waste management.",SS101:"Small pedestrian bridge for garden paths and decorative water crossings.",SS102:"Compact bridge with enhanced load capacity for light maintenance vehicles.",R101:"ADA compliant access ramp with gentle slope and non-slip surface.",R102:"Modular ramp system adaptable to various height requirements."}[s]||`${t} model with standard features and customization options.`}const R=new Map,F=new Map;async function T(t,a){if(!t)return null;if(R.has(t))return R.get(t);if(F.has(t))return F.get(t);const s=(async()=>{var o,i;const r=((o=window.urbanaPublic)==null?void 0:o.nonce)||((i=window.urbanaAdmin)==null?void 0:i.nonce)||"",m=await fetch("/wp-json/urbana/v1/image-proxy",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":r},body:JSON.stringify({image_path:t})});if(!m.ok)throw new Error(`HTTP ${m.status}: ${m.statusText}`);const d=await m.json();if(d.success&&d.method==="presigned_url"&&d.image_url){const p={url:d.image_url,method:"presigned_url"};return R.set(t,p),F.delete(t),p}if(d.success&&d.image_data){const p={url:d.image_data,method:d.method||"base64"};return R.set(t,p),F.delete(t),p}throw F.delete(t),new Error(d.error||d.message||"Failed to fetch image")})();return F.set(t,s),s}const G=({imagePath:t,productCode:a,className:s="",alt:r="Product image",onClick:m,loading:d="lazy",fetchPriority:o="auto"})=>{var S,C;const[i,p]=b.useState(""),[g,x]=b.useState(!0),[N,w]=b.useState(""),[j,u]=b.useState(""),c=window.urbanaDebugMode||((S=window.urbanaAdmin)==null?void 0:S.debugMode)||((C=window.urbanaPublic)==null?void 0:C.debugMode)||!1;return b.useEffect(()=>{t&&(async()=>{var k,M;try{x(!0),w("");const l=((k=window.urbanaPublic)==null?void 0:k.nonce)||((M=window.urbanaAdmin)==null?void 0:M.nonce)||"";c&&console.log(`[SecureImage] Fetching: ${t}`,{productCode:a,nonce:l?"present":"missing",debugMode:c});try{const f=R.get(t);if(f){c&&console.log("[SecureImage] Using cached signed URL",t),u(f.method||"cached"),p(f.url);return}const h=await T(t,a);if(h){c&&console.log("[SecureImage] Prefetch result",h),u(h.method||"fetched"),p(h.url);return}}catch(f){c&&console.warn("[SecureImage] prefetchImage failed, falling back to inline fetch",f)}const P=await fetch("/wp-json/urbana/v1/image-proxy",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":l},body:JSON.stringify({image_path:t})});if(!P.ok)throw new Error(`HTTP ${P.status}: ${P.statusText}`);const n=await P.json();if(c&&console.log(`[SecureImage] Response for ${t}:`,{method:n.method,success:n.success,hasImageUrl:!!n.image_url,hasImageData:!!n.image_data,error:n.error,message:n.message}),n.success)if(n.method==="presigned_url"&&n.image_url)c&&console.log("âœ… Using presigned URL method (instant loading from DO)"),u("presigned_url"),p(n.image_url),R.set(t,{url:n.image_url,method:"presigned_url"});else if(n.method==="base64_fallback"&&n.image_data)c&&console.log("âš ï¸ Using base64 fallback method (slower, full data transfer)"),u("base64_fallback"),p(n.image_data),R.set(t,{url:n.image_data,method:"base64_fallback"});else if(n.image_data)c&&console.log("âš ï¸ Using legacy base64 format"),u("base64_legacy"),p(n.image_data),R.set(t,{url:n.image_data,method:"base64_legacy"});else if(n.imageData)c&&console.log("âš ï¸ Using legacy imageData format"),u("imageData_legacy"),p(n.imageData),R.set(t,{url:n.imageData,method:"imageData_legacy"});else throw c&&console.error("No image URL or data received from server"),new Error("No image URL or data received");else if(n.use_svg_icon)c&&console.warn("Server requested SVG icon fallback:",n.error),u("svg_fallback"),w("Failed to load image - using SVG icon instead");else throw new Error(n.error||n.message||"Failed to get image")}catch(l){c&&console.error(`[SecureImage] Fetch error for ${t}:`,l.message,l),w(l.message)}finally{x(!1)}})()},[t,a]),g?e.jsx("div",{className:`${s} bg-gray-100 animate-pulse flex items-center justify-center`,children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-gray-400",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}):N||!i?e.jsxs("div",{className:`${s} bg-orange-100 border-2 border-orange-300 flex items-center justify-center relative group`,title:N||"Image failed to load",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:"text-orange-600",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),c&&N&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-gray-900 text-white text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:[N.substring(0,50),"..."]})]}):e.jsxs("div",{className:"relative group h-full",children:[e.jsx("img",{src:i,alt:r,className:s,loading:d,decoding:"async",fetchpriority:o,onClick:_=>{var M,l;(window.urbanaDebugMode||((M=window.urbanaAdmin)==null?void 0:M.debugMode)||((l=window.urbanaPublic)==null?void 0:l.debugMode)||!1)&&console.log("[SecureImage] image clicked",t),m&&m(_)},title:c&&j?`Loaded via: ${j}`:"",onError:()=>{w("Image load failed")}}),c&&j&&e.jsx("div",{className:"absolute top-0 left-0 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded opacity-70 group-hover:opacity-100 transition-opacity font-semibold",title:`Method: ${j}`,children:j==="presigned_url"?"ðŸ”— URL":j==="base64_fallback"?"ðŸ“¦ B64":"âš ï¸"})]})},te=({images:t,productCode:a="",open:s,initialIndex:r=0,onClose:m,onIndexChange:d})=>{var x,N;const[o,i]=U.useState(r);try{(window.urbanaDebugMode||((x=window.urbanaAdmin)==null?void 0:x.debugMode)||((N=window.urbanaPublic)==null?void 0:N.debugMode)||!1)&&console.warn("[Lightbox] props",{open:s,initialIndex:r,imagesLength:t==null?void 0:t.length,productCode:a})}catch{}if(b.useEffect(()=>{i(r)},[r]),b.useEffect(()=>{if(s)try{t[o+1]&&T(t[o+1],a).catch(()=>{}),t[o-1]&&T(t[o-1],a).catch(()=>{})}catch{}},[s,o,t,a]),b.useEffect(()=>{var u,c;if((window.urbanaDebugMode||((u=window.urbanaAdmin)==null?void 0:u.debugMode)||((c=window.urbanaPublic)==null?void 0:c.debugMode)||!1)&&console.warn("[Lightbox] effect open changed",{open:s,index:o,imagesLength:t.length}),!s)return;const j=S=>{console.warn("[Lightbox] keydown",S.key),S.key==="Escape"&&m(),S.key==="ArrowLeft"&&i(C=>Math.max(0,C-1)),S.key==="ArrowRight"&&i(C=>Math.min(t.length-1,C+1))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[s,t.length,m]),b.useEffect(()=>{window.urbanaDebugMode&&console.log(`[Lightbox] open: ${s}, index: ${o}, images: ${t.length}`)},[s,o,t.length]),b.useEffect(()=>{d&&d(o)},[o]),!s)return null;const p=()=>{window.urbanaDebugMode&&console.log("[Lightbox] prev clicked"),i(w=>Math.max(0,w-1))},g=()=>{window.urbanaDebugMode&&console.log("[Lightbox] next clicked"),i(w=>Math.min(t.length-1,w+1))};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",children:e.jsxs("div",{className:"relative w-full max-w-6xl mx-auto",children:[e.jsx("button",{"aria-label":"Close",onClick:()=>{window.urbanaDebugMode&&console.log("[Lightbox] close clicked"),m()},className:"absolute right-2 top-2 z-50 rounded-full bg-white/10 hover:bg-white/20 p-2 text-white",children:e.jsx(v,{icon:"lucide:x",width:18})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("button",{"aria-label":"Previous",onClick:p,className:"flex items-center justify-center w-10 h-10 md:w-12 md:h-12 rounded-full bg-white/10 hover:bg-white/20 text-white mr-4",children:e.jsx(v,{icon:"lucide:chevron-left",width:20})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"max-h-[85vh] w-full flex items-center justify-center",children:e.jsx(G,{imagePath:t[o],productCode:a,className:"max-w-full max-h-[85vh] object-contain",alt:`Image ${o+1} of ${t.length}`,loading:"eager",fetchPriority:"high"})})}),e.jsx("button",{"aria-label":"Next",onClick:g,className:"flex items-center justify-center w-10 h-10 md:w-12 md:h-12 rounded-full bg-white/10 hover:bg-white/20 text-white ml-4",children:e.jsx(v,{icon:"lucide:chevron-right",width:20})})]}),t.length>1&&e.jsx("div",{className:"mt-4 flex gap-2 overflow-x-auto px-2",children:t.map((w,j)=>e.jsx("button",{onClick:()=>i(j),onMouseEnter:()=>T(w).catch(()=>{}),className:`flex-shrink-0 w-20 h-20 rounded-small overflow-hidden border-2 ${j===o?"border-primary":"border-transparent"}`,"aria-label":`View image ${j+1}`,children:e.jsx(G,{imagePath:w,productCode:a,className:"w-full h-full object-cover",alt:`Thumb ${j+1}`,loading:"lazy"})},j))})]})})},Oe=({data:t,productId:a})=>{const s=t.productDetails[a],r=window.urbanaDebugMode||!1,m=b.useCallback(async(u,c)=>{try{const S=u.includes("digitaloceanspaces.com");let C=u;if(S)try{let M=(new URL(u).pathname||"").replace(/^\//,"");if(M){const l=new URL("/wp-json/urbana/v1/proxy-download",window.location.origin);l.searchParams.set("path",M),C=l.toString()}else{const l=new URL("/wp-json/urbana/v1/proxy-download",window.location.origin);l.searchParams.set("url",u),C=l.toString()}}catch{const M=new URL("/wp-json/urbana/v1/proxy-download",window.location.origin);M.searchParams.set("url",u),C=M.toString()}else if(!/^https?:\/\//i.test(u)){const k=new URL("/wp-json/urbana/v1/proxy-download",window.location.origin);k.searchParams.set("path",u),C=k.toString()}const _=document.createElement("a");_.href=C,_.download=c,_.style.display="none",_.target="_blank",document.body.appendChild(_),_.click(),document.body.removeChild(_)}catch(S){r&&console.error("Download failed:",S),alert("Failed to download file. Please try again or contact support.")}},[]);if(!s)return e.jsxs("div",{className:"text-center p-8",children:[e.jsx(v,{icon:"lucide:file-question",className:"mx-auto mb-4 text-default-400",width:48}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"Product Information Unavailable"}),e.jsxs("p",{className:"text-default-500",children:["Detailed information for ",a," is not available at this time. Please continue to the next step or contact our support team for assistance."]})]});const d={hidden:{opacity:0},show:{opacity:1,transition:{duration:.5}}},o=s.imageGallery.length>0?s.imageGallery[0]:"",i=b.useRef(null),[p,g]=b.useState(!1),[x,N]=b.useState(0),w=u=>{r&&console.warn(`[Step4] openLightboxAt called with index: ${u}`),N(u),g(!0)};b.useEffect(()=>{r&&console.warn("[Step4] lightboxOpen state changed",{lightboxOpen:p,lightboxIndex:x})},[p,x]);const j=()=>g(!1);return b.useEffect(()=>{r&&console.log("[Step4] useEffect mount â€” Step4ProductContent mounted",{galleryRefPresent:!!i.current});const u=c=>{var S,C;try{const _=i.current;if(!_)return;r&&console.log("[Step4 gallery container click] event",c.type,"target:",(S=c.target)==null?void 0:S.tagName,"defaultPrevented",c.defaultPrevented);let k=c.target;for(;k&&k!==_;){if(k.nodeType!==Node.ELEMENT_NODE){k=k.parentNode;continue}const n=k,f=(C=n.getAttribute)==null?void 0:C.call(n,"data-gallery-index");if(f!=null){r&&console.log(`[Step4 gallery container click] index found: ${f}`),w(parseInt(f,10));return}const h=window.getComputedStyle(n);r&&console.log("[Step4 gallery container click] ancestor:",n.tagName,"pointer-events:",h.pointerEvents),k=k.parentNode}const M=c.clientX,l=c.clientY,P=_.querySelectorAll("[data-gallery-index]");for(let n=0;n<P.length;n++){const f=P[n],h=f.getBoundingClientRect();if(M>=h.left&&M<=h.right&&l>=h.top&&l<=h.bottom){const y=f.getAttribute("data-gallery-index");r&&console.log(`[Step4 gallery container click] bounding-match index: ${y}`),w(parseInt(y||"0",10));return}}}catch(_){console.error("Gallery handler error",_)}};return document.addEventListener("click",u,!0),()=>document.removeEventListener("click",u,!0)},[i,w,r]),e.jsxs(E.div,{className:"space-y-8",initial:"hidden",animate:"show",variants:d,children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-full md:w-1/2",children:o?e.jsx("div",{"data-gallery-index":0,className:"cursor-pointer",onClick:()=>{r&&console.log("[Step4] featured image clicked index: 0"),w(0)},onMouseEnter:()=>{T(o).catch(()=>{})},children:e.jsx(G,{imagePath:o,productCode:a,alt:s.name,className:"w-full h-64 object-cover rounded-medium",onClick:()=>w(0),loading:"eager",fetchPriority:"high"})}):e.jsx("div",{className:"w-full h-64 bg-gray-100 rounded-medium flex items-center justify-center",children:e.jsx(v,{icon:"lucide:image",width:48,className:"text-gray-400"})})}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-default-600 mb-4",children:s.overview}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{icon:"lucide:check-circle",className:"text-success",width:20}),e.jsx("span",{children:"In Stock"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{icon:"lucide:truck",className:"text-default-500",width:20}),e.jsx("span",{children:"Standard Delivery: 2-4 weeks"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{icon:"lucide:shield",className:"text-default-500",width:20}),e.jsx("span",{children:"10 Year Warranty"})]})]})]})]}),e.jsxs(Z,{"aria-label":"Product information tabs",variant:"underlined",color:"primary",children:[e.jsx($,{title:"Details",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("p",{className:"text-default-700",children:s.description}),e.jsx("h4",{className:"text-lg font-medium mt-6 mb-3",children:"Specifications"}),e.jsx("ul",{className:"space-y-2",children:s.specifications.map((u,c)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{icon:"lucide:chevron-right",className:"text-primary mt-1 flex-shrink-0",width:16}),e.jsx("span",{children:u})]},c))})]})})})},"details"),e.jsx($,{title:"Image Gallery",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsx("div",{ref:i,className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:s.imageGallery.map((u,c)=>e.jsx("div",{"data-gallery-index":c,className:"aspect-square cursor-pointer pointer-events-auto",onClick:S=>{r&&console.log(`[Step4 wrapper click] index: ${c}`),S.stopPropagation(),w(c)},onMouseEnter:()=>{T(u).catch(()=>{})},children:e.jsx(G,{imagePath:u,productCode:a,alt:`${s.name} - Image ${c+1}`,className:"w-full h-full object-cover rounded-medium",onClick:()=>w(c),loading:"lazy"})},c))})})})},"gallery"),e.jsx($,{title:"Downloads",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-default-600 mb-4",children:"Download product documentation and technical files:"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.files).map(([u,c])=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-default-200 rounded-medium hover:border-primary transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-default-100 rounded-medium",children:e.jsx(v,{icon:De(c),className:"text-default-600",width:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:u}),e.jsx("p",{className:"text-xs text-default-500",children:Le(c)})]})]}),e.jsx(q,{size:"sm",variant:"flat",color:"primary",onPress:()=>m(c,Ie(c,u)),endContent:e.jsx(v,{icon:"lucide:download",width:16}),children:"Download"})]},c))})]})})})},"files"),e.jsx($,{title:"FAQ",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsx(me,{children:s.faqs&&s.faqs.length>0?s.faqs.map((u,c)=>e.jsx(B,{title:u.question,children:u.answer},c)):[{q:"What is the installation process?",a:"Installation typically requires a concrete foundation and can be completed by our certified installers. The process usually takes 1-3 days depending on the product complexity and site conditions."},{q:"What maintenance is required?",a:"Our products are designed for minimal maintenance. We recommend a visual inspection every 6 months and cleaning as needed. Specific maintenance schedules are provided in the product documentation."},{q:"Are customizations available?",a:"Yes, most products can be customized with different colors, materials, and additional features. Custom options can be selected in the next step of this configuration process."},{q:"What warranty is provided?",a:"Standard warranty is 10 years on structural components and 5 years on other elements. Extended warranties are available for purchase. All warranties cover manufacturing defects and normal wear."}].map((u,c)=>e.jsx(B,{title:u.q,children:u.a},`fallback-${c}`))})})})},"faq")]}),e.jsx(te,{images:s.imageGallery,productCode:a,open:p,initialIndex:x,onClose:j})]})};function De(t){var r;const a=(r=t.split(".").pop())==null?void 0:r.toLowerCase(),s={pdf:"lucide:file-text",dwg:"lucide:file-cog",rvt:"lucide:file-3d",doc:"lucide:file-text",docx:"lucide:file-text",xls:"lucide:file-spreadsheet",xlsx:"lucide:file-spreadsheet",zip:"lucide:file-archive",default:"lucide:file"};return s[a||""]||s.default}function Le(t){var r;const a=(r=t.split(".").pop())==null?void 0:r.toLowerCase(),s={pdf:"2.4 MB",dwg:"5.8 MB",rvt:"12.6 MB",doc:"1.2 MB",docx:"1.5 MB",xls:"3.1 MB",xlsx:"3.4 MB",zip:"8.7 MB",default:"1.0 MB"};return s[a||""]||s.default}function Ie(t,a){try{let r="";try{r=(new URL(t).pathname||"").split("/").pop()||""}catch{const d=t.split("/");r=d[d.length-1]||""}if(r=r.split("?")[0].split("#")[0],r&&r.includes("."))return decodeURIComponent(r)}catch(r){debugMode&&console.error("Error extracting filename from URL:",r)}const s=(t.split(".").pop()||"").toLowerCase().split("?")[0].split("#")[0];return s&&!a.includes(".")?`${a}.${s}`:a}const Re=({data:t,options:a,onOptionsChange:s,selectedProductCode:r})=>{const m=window.urbanaDebugMode||!1,d=b.useRef(r),o=b.useRef(null),i=b.useMemo(()=>{var n;return r?(n=t.productOptions)!=null&&n[r]?t.productOptions[r]:{}:t.options},[r,t.productOptions,t.options]);m&&console.log(t);const p=b.useMemo(()=>Object.keys(i).length>0,[i]),g=b.useMemo(()=>{const n={};return Object.keys(i).forEach(h=>{a[h]&&(n[h]=a[h])}),n},[a,i]);b.useEffect(()=>{if(d.current!==r){d.current=r;const n=Object.keys(i),f=Object.keys(a);if(f.some(y=>!n.includes(y))||f.length===0){const y={};f.forEach(O=>{n.includes(O)&&(y[O]=a[O])}),JSON.stringify(y)!==JSON.stringify(a)&&s(y)}}},[r,i]);const x=b.useCallback((n,f)=>{o.current=n,s({...g,[n]:f})},[g,s]),N=b.useMemo(()=>{var f;const n=Object.keys(i);if(n.length===0)return null;if(o.current&&a[o.current]){const h=(f=i[o.current])==null?void 0:f.find(y=>y.value===a[o.current]);if(h!=null&&h.imageUrl)return h.imageUrl}for(let h=n.length-1;h>=0;h--){const y=n[h],I=a[y];if(I&&i[y]){const O=i[y].find(se=>se.value===I);if(O!=null&&O.imageUrl)return O.imageUrl}}return null},[a,i]),w=b.useMemo(()=>{var n;if(r&&((n=t.productDetails)!=null&&n[r])){const f=t.productDetails[r].imageGallery;if(f&&f.length>0)return f[0]}return"https://img.heroui.chat/image/landscape?w=800&h=600&u=preview_default"},[r,t.productDetails]),j=N||w,u={hidden:{opacity:0},show:{opacity:1,transition:{duration:.5}}};if(!p)return e.jsx(E.div,{className:"space-y-6",initial:"hidden",animate:"show",variants:u,children:e.jsx(D,{children:e.jsxs(L,{className:"p-8 text-center",children:[e.jsx(v,{icon:"lucide:settings",width:48,className:"text-default-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Configuration Options"}),e.jsx("p",{className:"text-default-600",children:r?e.jsxs(e.Fragment,{children:["This product doesn't have any configurable options.",e.jsxs("span",{className:"block mt-2 text-sm",children:["Product: ",e.jsx("strong",{children:r})]})]}):"Please select a product first to see available configuration options."}),e.jsx("p",{className:"text-sm text-default-500 mt-4",children:r?"Proceed to the next step to complete your inquiry.":"Go back to the previous step and select a product."})]})})});const[c,S]=b.useState(!1),[C,_]=b.useState(0),[k,M]=b.useState([]),l=(n,f=0)=>{M(n||[]),_(f),S(!0)},P=()=>S(!1);return e.jsxs(E.div,{className:"space-y-6",initial:"hidden",animate:"show",variants:u,children:[r&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-default-600",children:[e.jsx(v,{icon:"lucide:package",width:16}),e.jsxs("span",{children:["Configuring options for: ",e.jsx("strong",{children:r})]})]}),e.jsx("p",{className:"text-default-600 mb-4",children:"Customize your product by selecting from the available options below:"}),e.jsxs(Z,{"aria-label":"Product configuration tabs",variant:"underlined",color:"primary",children:[e.jsx($,{title:"Configuration Options",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:Object.entries(i).map(([n,f])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:n}),e.jsx(oe,{label:n,placeholder:`Select ${n}`,selectedKeys:a[n]?[a[n]]:[],onChange:h=>{const y=h.target.value;o.current=n,x(n,y)},className:"max-w-full",children:f.map(h=>e.jsx(le,{children:typeof h=="string"?h:h.value},typeof h=="string"?h:h.value))})]},n))}),e.jsx("div",{children:e.jsxs("div",{className:"border border-default-200 rounded-medium p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Preview"}),e.jsx("div",{className:"aspect-video mb-4 cursor-pointer",onClick:()=>l([j],0),children:e.jsx(G,{imagePath:j,productCode:r||"",className:"w-full h-full object-cover rounded-medium",onClick:()=>l([j],0)},j)}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-medium text-default-500",children:"Selected Options:"}),Object.keys(g).length>0?e.jsx("ul",{className:"text-sm space-y-1",children:Object.entries(g).map(([n,f])=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(v,{icon:"lucide:check",className:"text-success",width:14}),e.jsxs("span",{className:"font-medium",children:[n,":"]})," ",f]},n))}):e.jsx("p",{className:"text-sm text-default-500",children:"No options selected yet. Choose from the available options."})]})]})})]})})})},"options"),e.jsx($,{title:"Option Impact",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:"How Options Affect Your Product"}),e.jsx("p",{className:"text-default-600",children:"Different options can impact the appearance, durability, and functionality of your product. Below is a summary of how each option affects your selection."})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(i).map(([n,f])=>e.jsxs("div",{className:"border-b border-default-200 pb-4 last:border-0",children:[e.jsx("h5",{className:"font-medium mb-2",children:n}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:f.map((h,y)=>{const I=typeof h=="string"?h:h.value,O=typeof h=="object"&&h.imageUrl?h.imageUrl:null;return e.jsxs("div",{className:"p-3 border border-default-200 rounded-medium",children:[O&&e.jsx("div",{className:"aspect-video mb-2 rounded-small overflow-hidden cursor-pointer",onClick:()=>l([O],0),children:e.jsx(G,{imagePath:O,productCode:r||"",className:"w-full h-full object-cover",onClick:()=>l([O],0)})}),e.jsx("div",{className:"font-medium",children:I}),e.jsxs("div",{className:"text-sm text-default-500",children:[y===0&&"Standard option with included features",y===1&&"Enhanced durability and premium finish",y===2&&"Maximum performance and longevity"]})]},I)})})]},n))})]})})})},"impact"),e.jsx($,{title:"Pricing Impact",children:e.jsx(D,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Option Pricing"}),e.jsx("p",{className:"text-default-600",children:"Different configuration options affect the final price of your product. Below is a breakdown of how each selection impacts pricing."})]}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-default-200",children:[e.jsx("th",{className:"py-2 px-4 text-left font-medium",children:"Option"}),e.jsx("th",{className:"py-2 px-4 text-left font-medium",children:"Selection"}),e.jsx("th",{className:"py-2 px-4 text-right font-medium",children:"Price Impact"})]})}),e.jsx("tbody",{children:Object.entries(i).map(([n,f])=>e.jsx(U.Fragment,{children:f.map((h,y)=>{const I=typeof h=="string"?h:h.value;return e.jsxs("tr",{className:"border-b border-default-100",children:[y===0?e.jsx("td",{className:"py-2 px-4 align-top",rowSpan:f.length,children:n}):null,e.jsxs("td",{className:"py-2 px-4",children:[I,y===0&&e.jsx("span",{className:"text-xs text-default-400 ml-2",children:"(Standard)"})]}),e.jsx("td",{className:"py-2 px-4 text-right",children:y===0?"Included":`+$${(y*250+Math.random()*100).toFixed(0)}`})]},`${n}-${I}`)})},n))})]}),e.jsx("div",{className:"bg-default-50 p-4 rounded-medium",children:e.jsxs("p",{className:"text-sm text-default-600",children:[e.jsx(v,{icon:"lucide:info",className:"inline-block mr-2",width:16}),"For exact pricing including all options and installation, please complete the form in the next step and our team will provide a detailed quote."]})})]})})})},"pricing")]}),e.jsx(te,{images:k,productCode:r||"",open:c,initialIndex:C,onClose:P})]})},Ue=({data:t,contactInfo:a,onContactInfoChange:s,isSubmitting:r,isSubmitted:m,onSubmit:d})=>{const[o,i]=U.useState(!1),[p,g]=U.useState({}),x=(c,S)=>{s({...a,[c]:S}),p[c]&&g({...p,[c]:""})},N=()=>{const c={};return a.fullName.trim()||(c.fullName="Full name is required"),a.email.trim()?/^\S+@\S+\.\S+$/.test(a.email)||(c.email="Please enter a valid email address"):c.email="Email is required",o||(c.terms="You must accept the terms and conditions"),g(c),Object.keys(c).length===0},w=()=>{N()&&d()},j={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},u={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return m?e.jsxs(E.div,{className:"text-center py-8",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},children:[e.jsx("div",{className:"w-16 h-16 bg-success/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(v,{icon:"lucide:check",className:"text-success",width:32})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Thank You!"}),e.jsx("p",{className:"text-default-600 max-w-md mx-auto mb-6",children:"Your product configuration has been submitted successfully. Our team will review your selections and contact you shortly with pricing and next steps."})]}):e.jsxs(E.div,{className:"space-y-6",variants:j,initial:"hidden",animate:"show",children:[e.jsx(E.p,{variants:u,className:"text-default-600",children:"Please provide your contact information to receive a detailed quote for your configured product."}),e.jsxs(E.div,{variants:u,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{label:"Full Name",placeholder:"Enter your full name",value:a.fullName,onValueChange:c=>x("fullName",c),isRequired:!0,isInvalid:!!p.fullName,errorMessage:p.fullName}),e.jsx(z,{label:"Email Address",placeholder:"Enter your email address",type:"email",value:a.email,onValueChange:c=>x("email",c),isRequired:!0,isInvalid:!!p.email,errorMessage:p.email})]}),e.jsxs(E.div,{variants:u,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{label:"Phone Number",placeholder:"Enter your phone number",type:"tel",value:a.phone,onValueChange:c=>x("phone",c)}),e.jsx(z,{label:"Company/Organization",placeholder:"Enter your company or organization",value:a.company,onValueChange:c=>x("company",c)})]}),e.jsx(E.div,{variants:u,children:e.jsx(fe,{label:"Additional Notes",placeholder:"Enter any specific requirements or questions",value:a.message,onValueChange:c=>x("message",c),minRows:3})}),e.jsxs(E.div,{variants:u,className:"space-y-4",children:[e.jsx(ge,{isSelected:o,onValueChange:i,isInvalid:!!p.terms,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:"I agree to the Terms and Conditions and Privacy Policy"}),p.terms&&e.jsx("span",{className:"text-danger text-xs mt-1",children:p.terms})]})}),e.jsx("div",{className:"bg-default-50 p-4 rounded-medium text-sm text-default-600",children:e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx(v,{icon:"lucide:shield",className:"text-default-500 mt-0.5 flex-shrink-0",width:16}),e.jsx("span",{children:"Your information is secure and will only be used to process your product inquiry. We will never share your details with third parties without your consent."})]})})]}),e.jsx(E.div,{variants:u,className:"pt-4",children:e.jsx(q,{color:"primary",size:"lg",className:"w-full md:w-auto",isDisabled:r,isLoading:r,onPress:w,endContent:!r&&e.jsx(v,{icon:"lucide:send",width:18}),children:"Submit Configuration"})})]})},K={productGroup:null,productRange:null,individualProduct:null,options:{},contactInfo:{fullName:"",email:"",phone:"",company:"",message:""}},A=xe()(be(we((t,a)=>({productData:null,currentStep:1,selections:K,isSubmitting:!1,isSubmitted:!1,initializeProductData:()=>{const s=window.urbanaPublic;s!=null&&s.productData?(console.log("Initializing stepper with database product data"),t({productData:s.productData})):console.warn("No database product data found in window.urbanaPublic")},setProductData:s=>{t({productData:s})},setCurrentStep:s=>t({currentStep:s}),updateSelection:(s,r)=>t(m=>{const d={...m.selections};return s==="productGroup"?(d.productGroup=r,d.productRange=null,d.individualProduct=null):s==="productRange"?(d.productRange=r,d.individualProduct=null):s==="options"?d.options={...d.options,...r}:s==="contactInfo"?d.contactInfo={...d.contactInfo,...r}:d[s]=r,{selections:d}}),nextStep:()=>t(s=>({currentStep:Math.min(s.currentStep+1,6)})),previousStep:()=>t(s=>({currentStep:Math.max(s.currentStep-1,1)})),goToStep:s=>{var o,i;const{selections:r,productData:m}=a(),d=((i=(o=m==null?void 0:m.stepperForm)==null?void 0:o.steps)==null?void 0:i.length)||6;return s<1||s>d?!1:s===1||s===2&&r.productGroup||s===3&&r.productRange||s>=4&&r.individualProduct?(t({currentStep:s}),!0):!1},setSubmitting:s=>t({isSubmitting:s}),setSubmitted:s=>t({isSubmitted:s}),resetStepper:()=>t({currentStep:1,selections:K,isSubmitting:!1,isSubmitted:!1}),canProceedToStep:s=>{var o,i;const{selections:r,productData:m}=a(),d=((i=(o=m==null?void 0:m.stepperForm)==null?void 0:o.steps)==null?void 0:i.length)||6;if(s>d)return!1;switch(s){case 1:return!0;case 2:return!!r.productGroup;case 3:return!!r.productRange;case 4:case 5:case 6:return!!r.individualProduct;default:return!1}}}),{name:"urbana-stepper-storage",partialize:t=>({selections:t.selections,currentStep:t.currentStep})}),{name:"urbana-stepper"})),$e=({data:t})=>{const{currentStep:a,selections:s,isSubmitting:r,isSubmitted:m,updateSelection:d,nextStep:o,previousStep:i,goToStep:p,canProceedToStep:g}=A(),x=window.urbanaDebugMode||!1,N=t.stepperForm.steps.length,w=b.useMemo(()=>{var h;if(!s.individualProduct)return{};const l=t.stepperForm.steps[4],P=(h=l==null?void 0:l.productOptions)==null?void 0:h[s.individualProduct];if(!P)return{};const n={},f=Object.keys(P);return Object.entries(s.options).forEach(([y,I])=>{f.includes(y)&&(n[y]=I)}),n},[s.individualProduct,s.options,t.stepperForm.steps]);b.useEffect(()=>{x&&(console.log("[ProductStepper] currentStep:",a),console.log("[ProductStepper] selections:",s),console.log("[ProductStepper] stepData:",t.stepperForm.steps[a-1]),console.log("[ProductStepper] validProductOptions:",w))},[a,s,t.stepperForm.steps,w,x]);const j=b.useCallback(async()=>{var l;A.getState().setSubmitting(!0);try{const P={productGroup:s.productGroup,productRange:s.productRange,individualProduct:s.individualProduct,options:w,contactInfo:s.contactInfo};if(x&&console.log("Submitting form data:",P),!(await fetch("/wp-json/urbana/v1/submit-form",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((l=window.urbanaPublic)==null?void 0:l.nonce)||""},body:JSON.stringify({selections:P,submittedAt:new Date().toISOString()})})).ok)throw new Error("Failed to submit form");A.getState().setSubmitted(!0)}catch(P){console.error("Error submitting form:",P),alert("Failed to submit form. Please try again.")}finally{A.getState().setSubmitting(!1)}},[s,w]),u=l=>{p(l)},c=()=>{o()},S=()=>{i()},C=U.useCallback(()=>{const l=t.stepperForm.steps[a-1];switch(a){case 1:return e.jsx(Se,{data:{categories:(l==null?void 0:l.categories)||[],productGroups:(l==null?void 0:l.productGroups)||[]},selection:s.productGroup||null,onSelect:n=>d("productGroup",n)});case 2:return e.jsx(Pe,{data:{ranges:(l==null?void 0:l.ranges)||{},productRanges:(l==null?void 0:l.productRanges)||[],relationships:l==null?void 0:l.relationships},productGroup:s.productGroup||"",selection:s.productRange||null,onSelect:n=>d("productRange",n)});case 3:return e.jsx(Me,{data:{products:(l==null?void 0:l.products)||{},productsData:(l==null?void 0:l.productsData)||[],relationships:l==null?void 0:l.relationships},productRange:s.productRange||"",selection:s.individualProduct||null,onSelect:n=>d("individualProduct",n)});case 4:const P=s.individualProduct||"unknown-product";return console.log("Step 4 Data:",l==null?void 0:l.productDetails),console.log("Product ID:",P),e.jsx(Oe,{data:{productDetails:(l==null?void 0:l.productDetails)||{}},productId:P});case 5:return e.jsx(Re,{data:{options:(l==null?void 0:l.options)||{},productOptions:(l==null?void 0:l.productOptions)||{},dynamicUpdates:(l==null?void 0:l.dynamicUpdates)||{updateImages:!1,updateFiles:!1}},options:s.options||{},onOptionsChange:n=>d("options",n),selectedProductCode:s.individualProduct||void 0});case 6:return e.jsx(Ue,{data:{fields:(l==null?void 0:l.fields)||[]},contactInfo:s.contactInfo,onContactInfoChange:n=>d("contactInfo",n),isSubmitting:r,isSubmitted:m,onSubmit:j});default:return e.jsx("div",{children:"Unknown step"})}},[a,t.stepperForm.steps,s,d,r,m,j]),_=g(a+1),k=a===N,M={hidden:{opacity:0,x:10},visible:{opacity:1,x:0},exit:{opacity:0,x:-10}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ne,{currentStep:a,totalSteps:N,steps:t.stepperForm.steps,selections:s,onStepClick:u}),e.jsx(D,{className:"shadow-sm",children:e.jsx(L,{className:"p-6",children:e.jsxs(E.div,{initial:"hidden",animate:"visible",exit:"exit",variants:M,transition:{duration:.25},children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:t.stepperForm.steps[a-1].title}),C()]},a)})}),e.jsx(ve,{currentStep:a,totalSteps:N,onNext:c,onPrevious:S,canProceed:_,isLastStep:k,isSubmitting:r,isSubmitted:m,onSubmit:j})]})};function Ae(){const{productData:t,initializeProductData:a}=A(),[s,r]=b.useState(!0),[m,d]=b.useState(null),o=window.urbanaDebugMode||!1;return b.useEffect(()=>{try{const i=window.urbanaPublic;i!=null&&i.productData?(o&&console.log("Loading product data from database:",i.productData),a(),d(null)):(o&&console.warn("No product data found in window.urbanaPublic, using default data"),A.getState().setProductData(W),d("Using default product data - database may be empty"))}catch(i){o&&console.error("Error initializing product data:",i),d("Failed to load product data"),A.getState().setProductData(W)}finally{r(!1)}},[a]),s?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ce,{size:"lg"}),e.jsx("p",{className:"text-foreground-600",children:"Loading product configuration..."})]})})}):t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"py-12 px-4 sm:px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Product Configuration"}),e.jsx("p",{className:"text-foreground-500 mt-2",children:"Select and customize your product in a few simple steps"})]}),m&&e.jsx(H,{color:"warning",variant:"flat",className:"mb-6",title:"Development Notice",description:m,startContent:e.jsx(v,{icon:"lucide:info",width:20})}),e.jsx($e,{data:t})]})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"py-12 px-4 sm:px-6",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(H,{color:"danger",variant:"flat",className:"mb-6",title:"Configuration Error",description:"Unable to load product configuration data. Please contact support.",startContent:e.jsx(v,{icon:"lucide:alert-triangle",width:20})})})})})}class Fe extends U.Component{constructor(a){super(a),this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,s){try{console.error("ErrorBoundary caught error",a,s),window.__urbana_diag=window.__urbana_diag||{errors:[]},window.__urbana_diag.errors.push({type:"error_boundary",message:a.message,stack:a.stack||null,info:s})}catch{}}render(){var a;return this.state.hasError?e.jsxs("div",{className:"p-8 bg-danger/5 border border-danger/10 rounded-medium text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-danger mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-default-600 mb-4",children:"An unexpected error occurred while rendering this application."}),e.jsx("pre",{className:"text-xs text-default-400 whitespace-pre-wrap",children:(a=this.state.error)==null?void 0:a.message})]}):this.props.children}}var Y,J;if(typeof window<"u"){window.__urbana_diag=window.__urbana_diag||{errors:[]};try{(window.urbanaDebugMode||((Y=window.urbanaAdmin)==null?void 0:Y.debugMode)||((J=window.urbanaPublic)==null?void 0:J.debugMode)||!1)&&console.warn("[Urbana Stepper] ENTRY: bundle evaluated"),window.__urbana_diag.entryEvaluated=!0}catch{}}try{de.createRoot(document.getElementById("urbana-stepper-root")).render(e.jsx(U.StrictMode,{children:e.jsxs(je,{children:[e.jsx(pe,{}),e.jsx(Fe,{children:e.jsx("main",{className:"text-foreground bg-background",children:e.jsx(Ae,{})})})]})}))}catch(t){console.error("[Urbana Stepper] render call failed",t);try{window.__urbana_diag=window.__urbana_diag||{errors:[]},window.__urbana_diag.errors.push({type:"render_error",message:String(t),stack:t&&t.stack?t.stack:null})}catch{}}var X,Q;if(typeof window<"u"){window.__urbana_diag=window.__urbana_diag||{errors:[]},window.addEventListener("error",t=>{try{const a=t&&(t.error&&t.error.message?t.error.message:t.message||String(t));console.error("[Urbana diag] global error:",a,t.error||t),window.__urbana_diag.errors.push({type:"error",message:a,stack:t&&t.error&&t.error.stack?t.error.stack:null})}catch{}},!0),window.addEventListener("unhandledrejection",t=>{try{const a=t&&(t.reason&&t.reason.message?t.reason.message:String(t.reason));console.error("[Urbana diag] unhandledrejection:",a,t.reason||t),window.__urbana_diag.errors.push({type:"unhandledrejection",message:a,stack:t&&t.reason&&t.reason.stack?t.reason.stack:null})}catch{}},!0);try{window.urbanaStepperEntry=!0;const t=window.urbanaDebugMode||((X=window.urbanaAdmin)==null?void 0:X.debugMode)||((Q=window.urbanaPublic)==null?void 0:Q.debugMode)||!1;t&&(console.warn("[Urbana Stepper] module entry"),console.log("[Urbana Stepper] attempting to render"));try{window.urbanaStepperLoaded=!0,t&&console.log("[Urbana Stepper] main bundle loaded")}catch(a){throw console.error("[Urbana Stepper] error setting loaded flag",a),window.__urbana_diag.errors.push({type:"flag_error",message:String(a),stack:a&&a.stack?a.stack:null}),a}}catch(t){console.error("[Urbana Stepper] module initialization error",t);try{window.__urbana_diag.errors.push({type:"init_error",message:String(t),stack:t&&t.stack?t.stack:null})}catch{}}}
